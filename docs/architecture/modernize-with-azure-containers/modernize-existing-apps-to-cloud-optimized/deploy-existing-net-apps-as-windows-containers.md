---
title: Развертывание существующих приложений .NET в качестве контейнеров Windows
description: Модернизировать существующих приложений .NET с помощью Azure Cloud and Windows Containers | Развертывание существующих приложений .NET как контейнеров Windows
ms.date: 04/29/2018
ms.openlocfilehash: 28568ca363bfc8100f78b100f8a7f0242c4f04c9
ms.sourcegitcommit: 559fcfbe4871636494870a8b716bf7325df34ac5
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/30/2019
ms.locfileid: "73089560"
---
# <a name="deploy-existing-net-apps-as-windows-containers"></a>Развертывание существующих приложений .NET в качестве контейнеров Windows

Развертывания, основанные на контейнерах Windows, применимы к оптимизированным для облака приложениям и облачным приложениям.

Однако в этом разделе и особенно в следующих разделах основное внимание уделяется использованию контейнеров Windows для *оптимизированных для облака* приложений, в которых вам не нужно перерабатывать архитектуру приложения.

## <a name="what-are-containers-linux-or-windows"></a>Что такое контейнеры? (Linux или Windows)

Контейнеры — это способ переноса приложения в собственный изолированный пакет. В своем контейнере приложения не затрагиваются приложениями или процессами, которые существуют вне контейнера. Все, от которого зависит приложение, успешно выполняется, так как процесс находится внутри контейнера. Всякий раз, когда контейнер может перемещаться, требования к приложению всегда будут выполнены с точки зрения прямых зависимостей, так как они объединены в пакеты, необходимые для выполнения (зависимости библиотек, среды выполнения и т. д.).

Основной характеристикой контейнера является то, что он делает среду одинаковой в разных развертываниях, так как сам контейнер имеет все необходимые зависимости. Вы можете выполнить отладку приложения на компьютере, а затем развернуть его на другом компьютере с гарантированно такой же средой.

Контейнер — это экземпляр образа контейнера. Образ контейнера — это способ упаковать приложение или службу (например, моментальный снимок), а затем развернуть его в надежном и воспроизводимом виде. Можно сказать, что DOCKER является не только технологией, но и философией и процессом.

По мере того, как контейнеры ежедневно становятся общими, они становятся всей отрасли «единицей развертывания».

## <a name="benefits-of-containers-docker-engine-on-linux-or-windows"></a>Преимущества контейнеров (подсистема DOCKER в Linux или Windows)

Создание приложений с помощью контейнеров, которые также могут быть определены в виде упрощенных блоков, обеспечивает значительное увеличение гибкости при создании, отправке и запуске любого приложения в любой инфраструктуре.

С помощью контейнеров можно взять любое приложение из разработки в рабочую среду с небольшим объемом изменений кода или без него благодаря интеграции DOCKER в средствах разработчика Майкрософт, операционных системах и облаке.

При развертывании на обычных виртуальных машинах, возможно, уже имеется метод развертывания приложений ASP.NET на виртуальных машинах. Однако, скорее всего, в вашем методе используется несколько ручных действий или сложные автоматизированные процессы с помощью средства развертывания, такого как puppet, или аналогичного средства. Возможно, потребуется выполнить такие задачи, как изменение элементов конфигурации, копирование содержимого приложения между серверами и выполнение интерактивных программ установки на основе параметров MSI, а затем тестирование. Все эти шаги в развертывании добавляются ко времени и риску. Если в целевой среде отсутствует зависимость, вы получите ошибки.

В контейнерах Windows процесс упаковки приложений полностью автоматизирован. Контейнеры Windows основаны на платформе DOCKER, которая предлагает автоматические обновления и откат для развертываний контейнеров. Основное улучшение использования подсистемы DOCKER заключается в том, что вы создаете образы, которые подобны моментальным снимкам приложения, со всеми его зависимостями. Образы — это образы DOCKER (в данном случае образ контейнера Windows). Образы запускают приложения ASP.NET в контейнерах, не возвращаясь к исходному коду. Моментальный снимок контейнера преобразуется в единицу развертывания.

Многие организации контейнеризация существующие монолитные приложения по следующим причинам:

- **Гибкость выпуска за счет улучшенного развертывания**. Контейнеры обеспечивают согласованный контракт развертывания между разработкой и операциями. Если вы используете контейнеры, вы не слышите разработчиков, скажем: «работает на моем компьютере, почему не в рабочей среде?» Они могут сказать: «он выполняется как контейнер, поэтому он будет работать в рабочей среде». Упакованное приложение со всеми его зависимостями можно выполнять в любой поддерживаемой среде на основе контейнера. Он будет работать так, как он предназначался для выполнения во всех целевых объектах развертывания (dev, QA, промежуточное развертывание, Рабочая среда). Контейнеры устраняют большинство трений, когда они переходят с одного этапа на следующий, что значительно улучшает развертывание, и вы можете выполнять доставку быстрее.

- **Снижение затрат**. Контейнеры позволяют снизить затраты на консолидацию и удаление существующего оборудования либо на выполнение приложений с более высокой плотностью на единицу оборудования.

- **Переносимость**. Контейнеры являются модульными и переносимыми. Контейнеры DOCKER поддерживаются в любой серверной операционной системе (Linux и Windows), в любом крупном общедоступном облаке (Microsoft Azure, Amazon AWS, Google, IBM), а также в локальных и частных или гибридных облачных средах.

- **Элемент управления**. Контейнеры предлагают гибкую и безопасную среду, контролируемую на уровне контейнера. Контейнер может быть защищен, изолирован и даже ограничен путем установки политик ограничения выполнения в контейнере. Как описано в разделе о контейнерах Windows, Windows Server 2016 и контейнеры Hyper-V предлагают дополнительные варианты корпоративной поддержки.

Значительное улучшение гибкости, переносимости и управления в конечном итоге приводит к значительному снижению затрат при использовании контейнеров для разработки и обслуживания приложений.

## <a name="what-is-docker"></a>Что такое Docker?

[DOCKER](https://www.docker.com/) — это [проект с открытым исходным кодом](https://github.com/docker/docker) , который автоматизирует развертывание приложений в виде переносимых, самостоятельных контейнеров, которые могут выполняться в облаке или в локальной среде. Docker — это также [компания](https://www.docker.com/), разрабатывающая эту технологию. Компания работает совместно с поставщиками облачных, Linux и Windows, включая Майкрософт.

![Схема, показывающая, как DOCKER развертывает контейнеры в гибридном облаке.](./media/deploy-existing-net-apps-as-windows-containers/docker-deploys-containers-all-layers.png)

**Рис. 4-6.** Docker развертывает контейнеры на всех уровнях гибридного облака

Для пользователей, знакомых с виртуальными машинами, контейнеры могут показаться похожими. Контейнер работает под управлением операционной системы, имеет файловую систему и может быть доступен по сети, как и физическая или виртуальная система компьютера. Однако технология и понятия, лежащие в основе контейнеров, значительно отличаются от виртуальных машин. С точки зрения разработчика контейнер должен обрабатываться более похожим на один процесс. Фактически, контейнер имеет одну точку входа для одного процесса.

Контейнеры DOCKER (для простоты, *контейнеры*) могут работать изначально в Linux и Windows. При выполнении обычных контейнеров контейнеры Windows могут выполняться только на узлах Windows (сервер узла или виртуальная машина), а контейнеры Linux могут работать только на узлах Linux. Однако в последних версиях Windows Server и Hyper-V контейнер Linux также можно запустить изначально на Windows Server с помощью технологии изоляции Hyper-V, которая в настоящее время доступна только в контейнерах Windows Server.

В ближайшем будущем смешанные среды с контейнерами Linux и Windows будут доступны и даже распространены.

## <a name="benefits-of-windows-containers-for-your-existing-net-applications"></a>Преимущества контейнеров Windows для существующих приложений .NET

Преимущества использования контейнеров Windows являются основными преимуществами, получаемыми от контейнеров в целом. Использование контейнеров Windows значительно повышает гибкость, мобильность и управление.

Существующие приложения .NET ссылаются на приложения, созданные с помощью .NET Framework. Например, они могут быть традиционными веб-приложениями ASP.NET. они не используют .NET Core, которая более новая и выполняется на разных платформах под управлением Linux, Windows и MacOS.

Основной зависимостью в .NET Framework является Windows. У него также есть дополнительные зависимости, например IIS, и System. Web в традиционных ASP.NET.

Приложение .NET Framework должно выполняться в Windows, period. Если вы хотите контейнеризовать существующие приложения .NET Framework и вы не можете или не хотите вкладывать миграцию в .NET Core ("если она работает правильно, не переносит ее"), единственным выбором для контейнеров является использование контейнеров Windows.

Таким образом, одно из основных преимуществ контейнеров Windows заключается в том, что они предлагают способ модернизироватьи существующих приложений .NET Framework, работающих на основе контейнеров Windows. В конечном итоге, контейнеры Windows позволяют получить нужные вам преимущества с помощью контейнеров — гибкость, переносимость и улучшенное управление.

## <a name="choose-an-os-to-target-with-net-based-containers"></a>Выберите ОС для целевого объекта. Контейнеры на основе NET

Учитывая разнообразие операционных систем, поддерживаемых DOCKER, а также различия между .NET Framework и .NET Core, следует ориентироваться на конкретную ОС и конкретные версии на основе используемой платформы.

Для Windows можно использовать Windows Server Core или Windows Nano Server. Эти версии Windows предоставляют различные характеристики (например, IIS и самостоятельно размещенный веб-сервер, например Kestrel), которые могут потребоваться для приложений .NET Framework или .NET Core.

Для Linux доступно и поддерживается множество дистрибутивов в официальных образах Docker .NET (например, Debian).

На рис. 4-7 показаны целевые версии ОС в зависимости от версии приложения .NET Framework.

![Схема, показывающая целевую ОПЕРАЦИОНную систему в зависимости от версии .NET Framework.](./media/deploy-existing-net-apps-as-windows-containers/dotnet-framework-operating-systems.png)

**Рис. 4-7.** Целевые операционные системы, основанные на версии .NET Framework

В сценариях миграции для существующих или устаревших приложений, основанных на .NET Framework приложениях, основные зависимости находятся в Windows и IIS. Единственный вариант — использовать образы DOCKER на основе Windows Server Core и .NET Framework.

При добавлении имени образа в файл Dockerfile можно выбрать операционную систему и версию с помощью тега, как показано в следующих примерах для образов контейнеров Windows на основе .NET Framework:

> | **Тегами** | **Система и версия** |
> |---|---|
> | **Microsoft/DotNet-Framework: 4. x — windowsservercore** | .NET Framework 4. x в Windows Server Core |
> | **Microsoft/ASPNET: 4. x — windowsservercore** | .NET Framework 4. x с дополнительной настройкой ASP.NET в Windows Server Core |

Для .NET Core (кросс-платформенный для Linux и Windows) теги будут выглядеть следующим образом:

> | **Тегами** | **Система и версия**
> |---|---|
> | **Microsoft/DotNet: 2.0.0-Runtime** | Среда выполнения .NET Core 2,0 — только в Linux |
> | **Microsoft/DotNet: 2.0.0-Runtime-Server — сервер** | Среда выполнения .NET Core 2,0 — только в Windows Nano Server |

### <a name="multi-arch-images"></a>Образы с несколькими дугами

Начиная с середины 2017, можно также использовать новую функцию в DOCKER, называемую [многоуровневой](https://github.com/moby/moby/issues/15866) образами. Образы DOCKER в .NET Core могут использовать теги с несколькими дугами. Вашим файлам Dockerfile больше не нужно определять операционную систему, для которой вы нацелены. Функция множественного разделения позволяет использовать один тег в нескольких конфигурациях компьютера. Например, с помощью Multi-Arch можно использовать один общий тег: **Microsoft/DotNet: 2.0.0-Runtime**. Если извлечь этот тег из среды контейнера Linux, вы получите образ на основе Debian. Если вы выберете этот тег из среды контейнера Windows, вы получаете образ на основе Nano Server.

Для .NET Frameworkных образов, поскольку традиционные .NET Framework поддерживают только Windows, функцию множественной связи использовать нельзя.

## <a name="windows-container-types"></a>Типы контейнеров Windows

Как и контейнеры Linux, Управление контейнерами Windows Server осуществляется с помощью подсистемы DOCKER. В отличие от контейнеров Linux, контейнеры Windows включают два разных типа контейнеров или время выполнения — контейнеры Windows Server и изоляция Hyper-V.

**Контейнеры Windows Server**. обеспечивает изоляцию приложений посредством технологии изоляции процессов и пространства имен. Контейнер Windows Server использует ядро совместно с узлом контейнера и всеми контейнерами, работающими на узле. Эти контейнеры не предоставляют защищенную границу безопасности и не должны использоваться для изоляции ненадежного кода. Из-за общего пространства ядра для этих контейнеров требуется одна и та же версия и конфигурация ядра.

**Изоляция Hyper-V**. расширяет изоляцию, предоставляемые контейнерами Windows Server, запустив каждый контейнер на высокооптимизированной виртуальной машине. В этой конфигурации ядро узла контейнера не используется совместно с другими контейнерами на том же узле. Эти контейнеры предназначены для злонамеренного размещения на разных клиентах с теми же гарантиями безопасности виртуальной машины. Так как эти контейнеры не используют ядро совместно с узлом или другими контейнерами на узле, они могут запускать ядра с разными версиями и конфигурациями (с поддерживаемыми версиями). Например, все контейнеры Windows в Windows 10 используют изоляцию Hyper-V для использования версии и конфигурации ядра Windows Server.

Выполнение контейнера в Windows с изоляцией или без изоляции Hyper-V является решением во время выполнения. Вы можете сначала создать контейнер с изоляцией Hyper-V, а во время выполнения выбрать запуск этого контейнера в качестве контейнера Windows Server.

### <a name="additional-resources"></a>Дополнительные ресурсы

- **Документация по контейнерам Windows**

    <https://docs.microsoft.com/virtualization/windowscontainers/>

- **Основы контейнеров Windows**

    <https://docs.microsoft.com/virtualization/windowscontainers/about/>

- **Инфографика: Microsoft и контейнеры**

    <https://info.microsoft.com/rs/157-GQE-382/images/Container%20infographic%201.4.17.pdf>

## <a name="the-container-ecosystem-in-azure"></a>Экосистема контейнеров в Azure

В предыдущих разделах были объяснены преимущества контейнеров DOCKER, а также сведения о конкретных образах контейнеров для приложений .NET. Все эти общие сведения являются фундаментальными для разработки или контейнеризовать приложения.
Однако при обдумывании рабочей среды развертывания или даже средств контроля качества и среды разработки и тестирования Microsoft Azure предоставляет открытый и широкий спектр вариантов выбора, полную экосистему контейнеров в облаке (показанную на схеме ниже). В зависимости от потребностей конкретного приложения следует выбрать один или другой продукт Azure.

![Схема экосистемы контейнеров в Azure.](./media/deploy-existing-net-apps-as-windows-containers/azure-container-ecosystem.png)

**Рис. 4 — 7,5.** Экосистема контейнеров в Azure

Из экосистемы контейнеров в Azure следующие продукты, поддерживающие контейнеры, которые считаются инфраструктурой:

- **Экземпляры контейнеров Azure (ACI)**
- **Виртуальные машины Azure** (с поддержкой контейнеров);
- **Масштабируемые наборы виртуальных машин Azure** (с поддержкой контейнера)

На этих трех ACIах есть отличное преимущество, которое является тем, что не требуется поддерживать базовую ОС, не требуется обновление, исправление и т. д., но ACI по-прежнему размещается на уровне инфраструктуры, как более подробно описывается в будущих разделах этой книги.

Продукты в Azure, поддерживающие контейнеры, которые в то же время размещаются на уровне PaaS (платформа как услуга):

- **служба приложений Azure**;
- **Служба Kubernetes Azure (AKS и ACS)**
- **Пакетная служба Azure**

Затем реестр контейнеров Azure — это большой масштабируемый реестр контейнеров, размещенный в Azure, который можно использовать во всех предыдущих продуктах при регистрации и развертывании пользовательских образов контейнеров.

Кроме того, из контейнеров можно использовать другие управляемые службы в Azure, такие как база данных SQL Azure, кэш Redis для Azure, Azure Cosmos DB и т. д. Кроме того, в Azure Marketplace доступны сторонние решения и платформы, такие как Cloud Foundry и OpenShift, где можно также использовать контейнеры в Azure.

В следующих разделах вы можете изучить рекомендации Майкрософт по использованию каждого из этих продуктов и решений Azure, специально предназначенных для контейнеров Windows.

>[!div class="step-by-step"]
>[Назад](what-about-cloud-native-applications.md)
>[Вперед](when-not-to-deploy-to-windows-containers.md)
