---
title: Развертывание существующих приложений .NET в качестве контейнеров Windows
description: Модернизация существующих приложений .NET с помощью облака Azure и контейнеров Windows | Развертывание существующих приложений .NET в качестве контейнеров Windows
ms.date: 04/29/2018
ms.openlocfilehash: 28568ca363bfc8100f78b100f8a7f0242c4f04c9
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/14/2020
ms.locfileid: "73089560"
---
# <a name="deploy-existing-net-apps-as-windows-containers"></a>Развертывание существующих приложений .NET в качестве контейнеров Windows

Развертывания на основе контейнеров Windows применимы к оптимизированным для облака приложениям и полностью облачным приложениям.

Однако в этом руководстве и особенно в следующих разделах основное внимание уделяется использованию контейнеров Windows для *оптимизированных для облака* приложений, для которых не требуется повторное проектирование.

## <a name="what-are-containers-linux-or-windows"></a>Что такое контейнеры (Linux или Windows)

Контейнеры предоставляют способ помещения приложения в собственный изолированный пакет. На приложение не влияют приложения или процессы, которые существуют вне его контейнера. Все, от чего зависит успешное выполнение приложения как процесса, находится внутри его контейнера. Всякий раз, когда контейнер перемещается, требования к приложению всегда будут выполнены с точки зрения прямых зависимостей, так как в нем содержится все, необходимое для выполнения приложения (зависимости библиотек, среды выполнения и т. д.).

Основная характеристика контейнера заключается в том, что благодаря ему среда одинакова в разных развертываниях, так как сам контейнер поставляется со всеми необходимыми зависимостями. Можно отладить приложение на одном компьютере, а затем развернуть его на другом компьютере и получить ту же среду.

Контейнер представляет собой экземпляр образа контейнера. Образ контейнера — это способ упаковки приложения или службы (например, моментального снимка) для надежного и воспроизводимого развертывания. Можно сказать, что Docker является не только технологией, но и целой философией и процессом.

С ростом популярности контейнеров они становятся общеотраслевой "единицей развертывания".

## <a name="benefits-of-containers-docker-engine-on-linux-or-windows"></a>Преимущества контейнеров (модуль Docker в Linux или Windows)

Создание приложений с использованием контейнеров, которые также можно определить как компактные строительные блоки, значительно повышает гибкость при создании, доставке и запуске любого приложения в любой инфраструктуре.

При использовании контейнеров можно перенести любое приложение из среды разработки в рабочую среду с минимальным объемом изменений кода или без них благодаря интеграции Docker со средствами разработчика Майкрософт, операционными системами и облаком.

У вас, вероятно, уже есть метод для развертывания приложений ASP.NET на обычных виртуальных машинах. Однако вполне вероятно, что ваш метод включает в себя несколько шагов, выполняемых в ручном режиме, или сложные автоматизированные процессы с использованием средства развертывания, такого как Puppet или аналогичного. Возможно, потребуется изменить элементы конфигурации, скопировать содержимое приложения между серверами и запустить интерактивные программы установки на основе конфигурации MSI-файла, а затем выполнить тестирование. Все эти шаги в развертывании увеличивают время выполнения и риски возникновения сбоев развертывания. Сбои будут возникать всякий раз, когда зависимость отсутствует в целевой среде.

В контейнерах Windows процесс упаковки приложений полностью автоматизирован. Контейнеры Windows основаны на платформе Docker, которая предлагает автоматические обновления и откаты для развертываний контейнеров. Основное улучшение, которое обеспечивает модуль Docker, заключается в том, что вы создаете образы, которые похожи на мгновенные снимки вашего приложения со всеми его зависимостями. Это образы DOCKER (в данном случае образ контейнера Windows). Образы запускают приложения ASP.NET в контейнерах, не возвращаясь к исходному коду. Моментальный снимок контейнера преобразуется в единицу развертывания.

Многие организации контейнеризируют существующие монолитные приложения по следующим причинам:

- **Гибкость выпуска за счет улучшенной функции развертывания**. Контейнеры обеспечивают контракт о согласованном развертывании между процессами разработки и эксплуатации. При работе с контейнерами разработчики никогда не жалуются, что приложение работает только на локальном компьютере, но не в рабочей среде. Они могут сказать: "приложение выполняется как контейнер, поэтому оно будет работать в рабочей среде". Упакованное приложение со всеми его зависимостями можно выполнять в любой поддерживаемой среде на основе контейнера. Оно будет работать должным образом во всех целевых средах развертывания (разработки, контроля качества, промежуточной и рабочей). Контейнеры устраняют большинство трудностей, которые возникают при перемещении с одного этапа на другой, что значительно улучшает эффективность развертывания и позволяет ускорить поставку.

- **Сокращение расходов**. Контейнеры позволяют снизить затраты за счет консолидации и удаления существующего оборудования либо выполнения приложений с более высокой плотностью на единицу оборудования.

- **Мобильность.** Контейнеры являются модульными и переносимыми. Контейнеры Docker поддерживаются в любой серверной операционной системе (Linux и Windows), в любом крупном публичном облаке (Microsoft Azure, Amazon AWS, Google и IBM), а также в локальных, частных или гибридных облачных средах.

- **Контроль**. Контейнеры обеспечивают гибкую и безопасную среду, контролируемую на уровне контейнера. Контейнер можно защитить, изолировать и даже ограничить путем установки политик ограничения выполнения в контейнере. Как описано в разделе о контейнерах Windows, контейнеры Windows Server 2016 и Hyper-V предлагают дополнительные варианты корпоративной поддержки.

Значительные улучшения в аспектах гибкости, переносимости и управления в конечном счете приводят к значительному снижению затрат при использовании контейнеров для разработки и обслуживания приложений.

## <a name="what-is-docker"></a>Что такое Docker?

[Docker](https://www.docker.com/) — это [проект с открытым исходным кодом](https://github.com/docker/docker) для автоматизации развертывания приложений в виде переносимых автономных контейнеров, выполняемых в облаке или локальной среде. Docker — это также [компания](https://www.docker.com/), разрабатывающая эту технологию. Компания работает в сотрудничестве с поставщиками облачных технологий и приложений для Linux и Windows, включая Майкрософт.

![Схема, показывающая, как среда Docker развертывает контейнеры в гибридном облаке.](./media/deploy-existing-net-apps-as-windows-containers/docker-deploys-containers-all-layers.png)

**Рис. 4-6.** Docker развертывает контейнеры на всех уровнях гибридного облака

Для пользователей, знакомых с виртуальными машинами, контейнеры могут показаться похожими. Контейнер работает под управлением операционной системы, содержит файловую систему, и к нему можно получить сетевой доступ, чем он напоминает физический или виртуальный компьютер. Однако у контейнеров и виртуальных машин совершенно разные технология и принцип работы. С точки зрения разработчика контейнер должен рассматриваться скорее как единый процесс. Фактически контейнер имеет единую точку входа для каждого процесса.

Контейнеры Docker (или просто *контейнеры*) работают в исходном формате в Linux и Windows. Обычные контейнеры Windows могут работать только на узлах Windows (сервер узла или виртуальная машина), а обычные контейнеры Linux могут работать только на узлах Linux. Однако в последних версиях контейнеров Windows Server и Hyper-V контейнер Linux также может работать на Windows Server благодаря технологии изоляции Hyper-V, которая в настоящее время доступна только при использовании контейнеров Windows Server.

В ближайшем будущем смешанные среды, содержащие контейнеры Linux и Windows, станут возможными и даже распространенными.

## <a name="benefits-of-windows-containers-for-your-existing-net-applications"></a>Преимущества контейнеров Windows для имеющихся приложений .NET

Преимущества использования контейнеров Windows в основном аналогичны получаемым от контейнеров в целом. Использование контейнеров Windows значительно повышает гибкость, мобильность и эффективность управления.

Имеющиеся приложения .NET относятся к приложениям, созданным с помощью платформы .NET Framework. Например, это могут быть традиционные веб-приложения ASP.NET, не использующие платформу .NET Core, которая является более новой и работает на платформах Linux, Windows и MacOS.

Основной зависимостью в .NET Framework является Windows. Есть также дополнительные зависимости, например IIS и System.Web в традиционной платформе ASP.NET.

Приложение .NET Framework должно работать в Windows. Если вы хотите контейнеризировать имеющиеся приложения .NET Framework и не можете или не хотите инвестировать в миграцию в .NET Core (если приложение работает правильно, не переносите его), единственный вариант — использовать контейнеры Windows.

Таким образом, одним из основных преимуществ контейнеров Windows является то, что они предлагают способ модернизации имеющихся приложений .NET Framework, работающих с использованием контейнеризации в Windows. В конечном счете, контейнеры Windows обеспечивают требуемые преимущества — гибкость, мобильность и более эффективное управление.

## <a name="choose-an-os-to-target-with-net-based-containers"></a>Выбор целевой ОС для контейнеров на основе .NET

Учитывая разнообразие операционных систем, поддерживаемых Docker, и различия между .NET Framework и .NET Core, следует выбирать определенные ОС и определенные версии в зависимости от используемой платформы.

Для Windows можно использовать Windows Server Core или Windows Nano Server. Эти версии Windows предоставляют разные особенности (например, IIS или резидентный веб-сервер, такой как Kestrel), которые могут быть необходимы в приложениях .NET Framework или .NET Core соответственно.

Для Linux доступно и поддерживается множество дистрибутивов в официальных образах Docker .NET (например, Debian).

На рис. 4-7 показаны версии ОС, которые можно настроить как целевые в зависимости от версии .NET Framework приложения.

![Схема, показывающая, на какую ОС ориентироваться на основе версии .NET Framework.](./media/deploy-existing-net-apps-as-windows-containers/dotnet-framework-operating-systems.png)

**Рис. 4-7**. Схема, показывающая, на какую ОС ориентироваться на основе версии .NET Framework

В сценариях миграции имеющихся приложений или приложений прежних версий, основанных на приложениях .NET Framework, основными зависимостями являются Windows и IIS. Единственным вариантом является использование образов Docker на основе Windows Server Core и платформы .NET Framework.

При добавлении имени образа в файл Dockerfile можно выбрать операционную систему и версию, используя тег, как показано в следующих примерах для образов контейнера Windows на базе .NET Framework:

> | **Тег** | **Система и версия** |
> |---|---|
> | **microsoft/dotnet-framework:4.x-windowsservercore** | .NET Framework 4.x в Windows Server Core |
> | **microsoft/aspnet:4.x-windowsservercore** | .NET Framework 4. x с дополнительной настройкой ASP.NET в Windows Server Core |

Для .NET Core (кроссплатформенные приложения для Linux и Windows) теги будут выглядеть следующим образом:

> | **Тег** | **Система и версия**
> |---|---|
> | **microsoft/dotnet:2.0.0-runtime** | Среда выполнения .NET Core 2.0, только в Linux |
> | **microsoft/dotnet:2.0.0-runtime-nanoserver** | Среда выполнения .NET Core 2.0, только в Windows Nano Server |

### <a name="multi-arch-images"></a>Мультиархитектурный образ

Начиная с середины 2017 года в Docker можно также использовать новую функцию, называемую [мультиархитектурные образы](https://github.com/moby/moby/issues/15866). Образы Docker в .NET Core могут использовать мультиархитектурные теги. В файлах Dockerfile больше не нужно определять целевую операционную систему. Функция мультиархитектурности позволяет использовать один тег в нескольких конфигурациях компьютера. Например, эта функция позволяет использовать один общий тег: **microsoft/dotnet:2.0.0-runtime**. Если извлечь этот тег из среды контейнеров Linux, вы получите образ на основе Debian. Если извлечь этот тег из среды контейнеров Windows, вы получите образ на основе Nano Server.

Так как традиционная платформа .NET Framework поддерживает только Windows, для образов .NET Framework функцию мультиархитектурности использовать нельзя.

## <a name="windows-container-types"></a>Типы контейнеров Windows

Как и в случае с контейнерами Linux, управление контейнерами Windows Server осуществляется с помощью модуля Docker. В отличие от контейнеров Linux, контейнеры Windows включают в себя два различных типа контейнеров или среды выполнения — контейнеры Windows Server и изоляцию Hyper-V.

**Контейнеры Windows Server**: изолируют приложение с помощью технологии изоляции процесса и пространства имен. Контейнер Windows Server использует ядро совместно с узлом контейнеров и всеми остальными контейнерами на узле. Эти контейнеры не обеспечивают надежную границу безопасности и не должны использоваться для изоляции ненадежного кода. Из-за общего пространства ядра для этих контейнеров требуется одинаковая версия ядра и конфигурация.

**Изоляция Hyper-V**: увеличивает изоляцию, обеспеченную контейнерами Windows Server, запуская каждый контейнер в оптимизированной виртуальной машине. В этой конфигурации ядро узла контейнера не используется совместно с другими контейнерами на том же узле. Эти контейнеры предназначены для неблагоприятных мультитенантных размещений с аналогичными гарантиями безопасности виртуальной машины. Так как эти контейнеры не используют ядро совместно с узлом или другими контейнерами на узле, они могут запускать ядра с различными версиями и конфигурациями (с поддерживаемыми версиями). Например, все контейнеры Windows в Windows 10 реализуют изоляцию Hyper-V для использования версии ядра и конфигурации Windows Server.

Решение о запуске контейнера в Windows с изоляцией Hyper-V или без нее принимается во время выполнения. Сначала можно создать контейнер с изоляцией Hyper-V, а во время выполнения запустить этот контейнер в качестве контейнера Windows Server.

### <a name="additional-resources"></a>Дополнительные ресурсы

- **Документация по контейнерам Windows**

    <https://docs.microsoft.com/virtualization/windowscontainers/>

- **Основы контейнеров Windows**

    <https://docs.microsoft.com/virtualization/windowscontainers/about/>

- **Infographic: Майкрософт и контейнеры**

    <https://info.microsoft.com/rs/157-GQE-382/images/Container%20infographic%201.4.17.pdf>

## <a name="the-container-ecosystem-in-azure"></a>Экосистема контейнеров в Azure

В предыдущих разделах рассмотрены преимущества контейнеров Docker, а также подробно описаны конкретные образы контейнеров для приложений .NET. Вся эта общая информация является основополагающей для разработки или контейнеризации приложения.
Однако при рассмотрении рабочей среды развертывания или сред контроля качества, разработки и тестирования Microsoft Azure предоставляет открытый и широкий выбор вариантов, полную экосистему контейнеров в облаке (показано на схеме ниже). В зависимости от потребностей конкретного приложения следует выбрать тот или иной продукт Azure.

![Схема экосистемы контейнеров в Azure](./media/deploy-existing-net-apps-as-windows-containers/azure-container-ecosystem.png)

**Рис. 4-7.5.** Экосистема контейнеров в Azure

Поддерживающие контейнеры продукты из экосистемы контейнеров в Azure, которые считаются инфраструктурой:

- **Экземпляры контейнеров Azure (ACI)**
- **Виртуальные машины Azure** (с поддержкой контейнеров).
- **Масштабируемые наборы виртуальных машин Azure** (с поддержкой контейнеров).

Из этих трех вариантов служба ACI обеспечивает большое преимущество, которое заключается в том, что вам не нужно поддерживать базовую ОС, не нужно выполнять обновления и исправления и т. д. Тем не менее ACI по-прежнему позиционируется на уровне инфраструктуры, как подробно описано в следующих разделах этой книги.

Продукты в Azure, поддерживающие контейнеры, которые в то же время позиционируются на уровне PaaS (платформа как услуга):

- **служба приложений Azure**;
- **Служба Kubernetes Azure (AKS и ACS)** .
- **Пакетная служба Azure**

Реестр контейнеров Azure — это высокомасштабируемый реестр контейнеров, размещенный в Azure, который можно использовать во всех предыдущих продуктах при регистрации и развертывании пользовательских образов контейнеров.

Кроме того, из контейнеров можно использовать другие управляемые службы в Azure, такие как База данных SQL Azure, кэш Redis Azure, Azure Cosmos DB и т. д. В Azure Marketplace доступны сторонние решения и платформы, такие как Cloud Foundry и OpenShift, где также можно использовать контейнеры в Azure.

В следующих разделах приведены рекомендации корпорации Майкрософт о том, когда следует использовать каждый из этих продуктов и решений Azure, ориентируясь на контейнеры Windows.

>[!div class="step-by-step"]
>[Назад](what-about-cloud-native-applications.md)
>[Вперед](when-not-to-deploy-to-windows-containers.md)
