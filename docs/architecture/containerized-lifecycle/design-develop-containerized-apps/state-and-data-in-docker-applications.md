---
title: Состояние и данные в приложениях Docker
description: Сведения о доступной возможности для сохранения состояния в контейнерных приложениях.
ms.date: 02/15/2019
ms.openlocfilehash: b2368efb0eff2bdce48b77b2addcc4de89822c74
ms.sourcegitcommit: 2e95559d957a1a942e490c5fd916df04b39d73a9
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/16/2019
ms.locfileid: "72394643"
---
# <a name="state-and-data-in-docker-applications"></a>Состояние и данные в приложениях Docker

Представьте себе контейнер как экземпляр процесса. Процесс не находится в неизменном состоянии. И хотя контейнер может записывать данные в локальное хранилище, предполагать, что экземпляр всегда будет на месте — это все равно, что надеяться на постоянство одной ячейки памяти. Следует считать, что образы контейнеров, как и процессы, имеют несколько экземпляров и в конечном итоге будут завершены. Если они управляются с помощью оркестратора контейнеров, они могут перемещаться между узлами или виртуальными машинами.

Для управления постоянными данными в приложениях Docker используются следующие решения:

Из узла Docker в качестве [томов Docker](https://docs.docker.com/engine/admin/volumes/):

- **Тома** хранятся в той части файловой системы узла, которая находится под управлением Docker.

- **Подключения привязок** можно сопоставить с любой папкой в файловой системе узла, поэтому доступом невозможно управлять из процесса Docker, что может представлять угрозу для безопасности, поскольку контейнер может получить доступ к конфиденциальным папкам операционной системы.

- **Подключения tmpfs** аналогичны виртуальным папкам, которые существуют только в памяти узла и никогда не записываются в файловую систему.

Из удаленного хранилища:

- [Служба хранилища Azure](https://azure.microsoft.com/documentation/services/storage/), предоставляющая геораспределенное хранилище для долгосрочного хранения данных контейнеров.

- Удаленные реляционные базы данных, например [База данных SQL Azure](https://azure.microsoft.com/services/sql-database/), базы данных NoSQL, такие как [Azure Cosmos DB](https://docs.microsoft.com/azure/cosmos-db/introduction), или службы кэша, такие как [Redis](https://redis.io/).

Из контейнера Docker:

- Docker имеет функцию под названием *оверлейная файловая система*. Эта функция выполняет копирование при записи, при котором обновленная информация сохраняется в корневой файловой системе контейнера. Эта информация "накладывается" на изначальный образ, на котором базируется контейнер. Если удалить контейнер из системы, эти изменения будут утеряны. Поэтому, хоть и возможно сохранить состояние контейнера в его локальном хранилище, создание системы на базе этой функции будет противоречить конструкции контейнера, состояние которого по умолчанию не отслеживается.

- Тем не менее тома Docker являются предпочтительным способом обработки локальных данных в Docker. Если вам требуются дополнительные сведения о хранении в контейнерах, ознакомьтесь с разделами [Docker storage drivers](https://docs.docker.com/engine/userguide/storagedriver/) (Драйверы хранилища Docker) и [About images, containers, and storage drivers](https://docs.docker.com/engine/userguide/storagedriver/imagesandcontainers/) (Основные сведения об образах, контейнерах и драйверах хранилища).

Ниже подробно описаны эти варианты.

**Тома** — это каталоги из ОС узла, сопоставленные с каталогами в контейнерах. Если код в контейнере имеет доступ к каталогу, на самом деле он обращается к каталогу на ОС узла. Этот каталог не привязан к времени существования самого контейнера, находится под управлением Docker и изолирован от основных функциональных возможностей хост-компьютера. Поэтому тома данных хранят данные независимо от контейнера. Если удалить контейнер или образ из узла Docker, данные из томов данных не будут удалены.

Тома могут быть именованными или анонимными (по умолчанию). Именованные тома — это следующий этап развития **контейнеров томов данных**. Они упрощают обмен данными между контейнерами. Тома также поддерживают драйверы томов, позволяющие хранить данные на удаленных узлах и т. д.

**Подключения привязки** доступны довольно давно и позволяют сопоставлять любую папку с точкой подключения в контейнере. Подключения привязки имеют больше ограничений, чем тома, и с ними связаны некоторые проблемы безопасности, поэтому тома являются рекомендуемым способом.

**Подключения `tmpfs`** являются виртуальными папками, которые существуют только в памяти узла и никогда не записываются в файловую систему. Они быстрые и безопасные, но используют ресурсы памяти и предназначены только для временных данных.

Как показано на рисунке 4-5, обычные тома Docker могут храниться за пределами самих контейнерами, но в физических границах сервера узла или виртуальной машины. Тем не менее контейнеры Docker с одного сервера узла или виртуальной машины не могут обращаться к тому на другом сервере узла или виртуальной машине. Другими словами, с помощью этих томов невозможно управлять данными контейнеров, которые выполняются на разных узлах Docker, хотя такой режим работы можно реализовать с помощью драйвера томов, который поддерживает удаленные узлы.

![Схема, показывающая тома Docker, хранящиеся за пределами контейнеров](./media/state-and-data-in-docker-applications/container-based-application-external-data-sources.png)

**Рис. 4-5**. Тома и внешние источники данных для приложений на основе контейнера

Кроме того, когда контейнеры Docker управляются оркестратором, контейнеры могут "перемещаться" между узлами в рамках оптимизации, выполняемой кластером. Поэтому тома данных не рекомендуется использовать для бизнес-данных. Но это хороший инструмент для работы с файлами трассировки, временными файлами или подобными элементами, которые не влияют на целостность бизнес-данных.

**Удаленные источники данных и инструменты кэширования**, такие как база данных Azure SQL, Azure Cosmos DB или служба кэша, например Redis, можно использовать в упакованных в контейнеры приложениях так же, как они используются при разработке без контейнеров. Это проверенный способ хранения данных бизнес-приложений.

**Служба хранилища Azure** Бизнес-данные, как правило, необходимо хранить во внешних ресурсах или базах данных, например в службе хранилища Azure. Служба хранилища Azure предоставляет следующие службы в облаке:

- Хранилище BLOB-объектов хранит неструктурированные данные объектов. Большой двоичный объект может представлять собой текстовые или двоичные данные любого типа, например документ или файл мультимедиа (файлы с изображением, аудио и видео). Хранилище BLOB-объектов также называют хранилищем объектов.

- Хранилище файлов — это совместно используемое хранилище для старых приложений, доступ к которому осуществляется на основе стандартного протокола SMB. Виртуальные машины Azure и облачные службы могут совместно использовать данные файлов в компонентах приложений через подключенный общий ресурс. Локальные приложения могут обращаться к данным файлов в общем ресурсе через REST API файловой службы.

- Хранилище таблиц содержит структурированные наборы данных. Хранилище таблиц — это хранилище данных NoSQL типа "ключ-значение", обеспечивающее быструю разработку и доступ к большим объемам данных.

**Реляционные базы данных и базы данных NoSQL.** Существует множество вариантов внешних баз данных — реляционные базы данных, такие как SQL Server, PostgreSQL, Oracle или базы данных NoSQL, например Azure Cosmos DB, MongoDB и т. д. Эти базы данных являются отдельной темой и не будут рассматриваться в данном руководстве.

>[!div class="step-by-step"]
>[Назад](monolithic-applications.md)
>[Вперед](soa-applications.md)
