---
title: Безопасность Azure для облачных приложений
description: Создание архитектуры облачных приложений .NET для Azure | Безопасность Azure для собственных облачных приложений
ms.date: 06/30/2019
ms.openlocfilehash: 44e81bc91fa952448f501a29e9db8afb2dbda752
ms.sourcegitcommit: 559259da2738a7b33a46c0130e51d336091c2097
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/22/2019
ms.locfileid: "73841273"
---
# <a name="azure-security-for-cloud-native-apps"></a><span data-ttu-id="059e6-103">Безопасность Azure для облачных приложений</span><span class="sxs-lookup"><span data-stu-id="059e6-103">Azure security for cloud-native apps</span></span>

[!INCLUDE [book-preview](../../../includes/book-preview.md)]

<span data-ttu-id="059e6-104">Облачные приложения могут быть как простыми, так и более сложными в защите, чем традиционные приложения.</span><span class="sxs-lookup"><span data-stu-id="059e6-104">Cloud-native applications can be both easier and more difficult to secure than traditional applications.</span></span> <span data-ttu-id="059e6-105">С недостатком, необходимо защитить более небольшие приложения и выделить больше энергии для создания инфраструктуры безопасности.</span><span class="sxs-lookup"><span data-stu-id="059e6-105">On the downside, you need to secure more smaller applications and dedicate more energy to build out the security infrastructure.</span></span> <span data-ttu-id="059e6-106">Разнородная природа языков программирования и стилей в большинстве развертываний служб также означает, что необходимо уделять больше внимания бюллетеням безопасности от многих разных поставщиков.</span><span class="sxs-lookup"><span data-stu-id="059e6-106">The heterogeneous nature of programming languages and styles in most service deployments also means you need to pay more attention to security bulletins from many different providers.</span></span>

<span data-ttu-id="059e6-107">На стороне зеркального отображения небольшие службы, каждый из которых имеет собственное хранилище данных, ограничивают область атаки.</span><span class="sxs-lookup"><span data-stu-id="059e6-107">On the flip side, smaller services, each with their own data store, limit the scope of an attack.</span></span> <span data-ttu-id="059e6-108">Если злоумышленник нарушает одну систему, скорее всего, злоумышленник сможет выполнить переход на другую систему, чем в монолитном приложении.</span><span class="sxs-lookup"><span data-stu-id="059e6-108">If an attacker compromises one system, it's probably more difficult for the attacker to make the jump to another system than it is in a monolithic application.</span></span> <span data-ttu-id="059e6-109">Границы процессов являются строгой границей.</span><span class="sxs-lookup"><span data-stu-id="059e6-109">Process boundaries are strong boundaries.</span></span> <span data-ttu-id="059e6-110">Кроме того, если происходит утечка резервной копии базы данных, то повреждение более ограничено, так как эта база данных содержит только подмножество данных и вряд ли будет содержать персональные данные.</span><span class="sxs-lookup"><span data-stu-id="059e6-110">Also, if a database backup leaks, then the damage is more limited, as that database contains only a subset of data and is unlikely to contain personal data.</span></span>

## <a name="threat-modeling"></a><span data-ttu-id="059e6-111">Моделирование угроз</span><span class="sxs-lookup"><span data-stu-id="059e6-111">Threat modeling</span></span>

<span data-ttu-id="059e6-112">Не имеет значения, если преимущества перевешивают недостатки облачных приложений, необходимо соблюдать одинаковую целостность системы безопасности.</span><span class="sxs-lookup"><span data-stu-id="059e6-112">No matter if the advantages outweigh the disadvantages of cloud-native applications, the same holistic security mindset must be followed.</span></span> <span data-ttu-id="059e6-113">Безопасность и безопасное обдумывание должны быть частью каждого этапа разработки и эксплуатации.</span><span class="sxs-lookup"><span data-stu-id="059e6-113">Security and secure thinking must be part of every step of the development and operations story.</span></span> <span data-ttu-id="059e6-114">При планировании приложения задайте такие вопросы:</span><span class="sxs-lookup"><span data-stu-id="059e6-114">When planning an application ask questions like:</span></span>

- <span data-ttu-id="059e6-115">Каковы последствия потери данных?</span><span class="sxs-lookup"><span data-stu-id="059e6-115">What would be the impact of this data being lost?</span></span>
- <span data-ttu-id="059e6-116">Как можно ограничить ущерб от недопустимых данных, внедренных в эту службу?</span><span class="sxs-lookup"><span data-stu-id="059e6-116">How can we limit the damage from bad data being injected into this service?</span></span>
- <span data-ttu-id="059e6-117">Кто должен иметь доступ к этим данным?</span><span class="sxs-lookup"><span data-stu-id="059e6-117">Who should have access to this data?</span></span>
- <span data-ttu-id="059e6-118">Существуют ли политики аудита на месте процесса разработки и выпуска?</span><span class="sxs-lookup"><span data-stu-id="059e6-118">Are there auditing policies in place around the development and release process?</span></span>

<span data-ttu-id="059e6-119">Все эти вопросы являются частью процесса, называемого [моделированием угроз](https://docs.microsoft.com/azure/security/azure-security-threat-modeling-tool).</span><span class="sxs-lookup"><span data-stu-id="059e6-119">All these questions are part of a process called [threat modeling](https://docs.microsoft.com/azure/security/azure-security-threat-modeling-tool).</span></span> <span data-ttu-id="059e6-120">Этот процесс пытается ответить на вопрос о том, какие угрозы есть в системе, насколько вероятны угрозы, а также о потенциальном повреждении.</span><span class="sxs-lookup"><span data-stu-id="059e6-120">This process tries to answer the question of what threats there are to the system, how likely the threats are, and the potential damage from them.</span></span>

<span data-ttu-id="059e6-121">После того как список угроз будет установлен, необходимо решить, стоит ли отказаться от их устранения.</span><span class="sxs-lookup"><span data-stu-id="059e6-121">Once the list of threats has been established, you need to decide whether they're worth mitigating.</span></span> <span data-ttu-id="059e6-122">Иногда угроза может быть настолько маловероятной и дорогостоящей для планирования того, что она не стоит тратить на энергию.</span><span class="sxs-lookup"><span data-stu-id="059e6-122">Sometimes a threat is so unlikely and expensive to plan for that it isn't worth spending energy on it.</span></span> <span data-ttu-id="059e6-123">Например, некоторые субъекты уровня состояния могут внедрять изменения в структуру процесса, который используется миллионами устройств.</span><span class="sxs-lookup"><span data-stu-id="059e6-123">For instance, some state level actor could inject changes into the design of a process that is used by millions of devices.</span></span> <span data-ttu-id="059e6-124">Теперь вместо выполнения определенного фрагмента кода в [кольце 3](https://en.wikipedia.org/wiki/Protection_ring)этот код выполняется в кольцевой 0.</span><span class="sxs-lookup"><span data-stu-id="059e6-124">Now, instead of running a certain piece of code in [Ring 3](https://en.wikipedia.org/wiki/Protection_ring), that code is run in Ring 0.</span></span> <span data-ttu-id="059e6-125">Это позволяет использовать оболочку, которая может обходить гипервизор и запускать код атаки на компьютерах без операционной системы, что позволяет выполнять атаки на всех виртуальных машинах, работающих на этом оборудовании.</span><span class="sxs-lookup"><span data-stu-id="059e6-125">This allows an exploit that can bypass the hypervisor and run the attack code on the bare metal machines, allowing attacks on all the virtual machines that are running on that hardware.</span></span>

<span data-ttu-id="059e6-126">Измененные процессоры трудно обнаружить без микрообласти и получить расширенные знания о архитектуре этого процессора.</span><span class="sxs-lookup"><span data-stu-id="059e6-126">The altered processors are difficult to detect without a microscope and advanced knowledge of the on silicon design of that processor.</span></span> <span data-ttu-id="059e6-127">Этот сценарий вряд ли будет выполняться и дешевле, поэтому, вероятно, ни одна из моделей угроз не рекомендует создавать для нее защиту от эксплойтов.</span><span class="sxs-lookup"><span data-stu-id="059e6-127">This scenario is unlikely to happen and expensive to mitigate, so probably no threat model would recommend building exploit protection for it.</span></span>

<span data-ttu-id="059e6-128">Более вероятные угрозы, такие как неработающие элементы управления доступом, позволяющие `Id` увеличением числа атак (замена `Id=2` с `Id=3` в URL-адресе) или внедрением кода SQL, являются более привлекательными для создания защиты.</span><span class="sxs-lookup"><span data-stu-id="059e6-128">More likely threats, such as broken access controls permitting `Id` incrementing attacks (replacing `Id=2` with `Id=3` in the URL) or SQL injection, are more attractive to build protections against.</span></span> <span data-ttu-id="059e6-129">Устранение этих угроз вполне оправдано для создания и предотвращения брешей в безопасности, мониторе репутацию компании.</span><span class="sxs-lookup"><span data-stu-id="059e6-129">The mitigations for these threats are quite reasonable to build and prevent embarrassing security holes that smear the company's reputation.</span></span>

## <a name="principle-of-least-privilege"></a><span data-ttu-id="059e6-130">Принцип наименьших привилегий</span><span class="sxs-lookup"><span data-stu-id="059e6-130">Principle of least privilege</span></span>

<span data-ttu-id="059e6-131">Одной из найденных идей в области безопасности компьютера является принцип наименьших привилегий (ПОЛП).</span><span class="sxs-lookup"><span data-stu-id="059e6-131">One of the founding ideas in computer security is the Principle of Least Privilege (POLP).</span></span> <span data-ttu-id="059e6-132">На самом деле, это основано на том, что в большинстве случаев безопасность является цифровой или физической.</span><span class="sxs-lookup"><span data-stu-id="059e6-132">It's actually a foundational idea in most any form of security be it digital or physical.</span></span> <span data-ttu-id="059e6-133">Вкратце, принцип состоит в том, что любой пользователь или процесс должен иметь наименьшее количество прав для выполнения задачи.</span><span class="sxs-lookup"><span data-stu-id="059e6-133">In short, the principle is that any user or process should have the smallest number of rights possible to execute its task.</span></span>

<span data-ttu-id="059e6-134">Например, представьте, что говорят в банке. доступ к сейфу является нераспространенным действием.</span><span class="sxs-lookup"><span data-stu-id="059e6-134">As an example, think of the tellers at a bank: accessing the safe is an uncommon activity.</span></span> <span data-ttu-id="059e6-135">Таким образом, среднее значение не может открыть само себя.</span><span class="sxs-lookup"><span data-stu-id="059e6-135">So, the average teller can't open the safe themselves.</span></span> <span data-ttu-id="059e6-136">Чтобы получить доступ, им нужно эскалировать свой запрос через Банк Manager, который выполняет дополнительные проверки безопасности.</span><span class="sxs-lookup"><span data-stu-id="059e6-136">To gain access, they need to escalate their request through a bank manager, who performs additional security checks.</span></span>

<span data-ttu-id="059e6-137">В компьютерной системе, отличный пример, — права пользователя, подключающегося к базе данных.</span><span class="sxs-lookup"><span data-stu-id="059e6-137">In a computer system, a fantastic example is the rights of a user connecting to a database.</span></span> <span data-ttu-id="059e6-138">Во многих случаях используется одна учетная запись пользователя для создания структуры базы данных и запуска приложения.</span><span class="sxs-lookup"><span data-stu-id="059e6-138">In many cases, there's a single user account used to both build the database structure and run the application.</span></span> <span data-ttu-id="059e6-139">За исключением крайних случаев, учетной записи, в которой выполняется приложение, не требуется возможность обновлять сведения о схеме.</span><span class="sxs-lookup"><span data-stu-id="059e6-139">Except in extreme cases, the account running the application doesn't need the ability to update schema information.</span></span> <span data-ttu-id="059e6-140">Должно быть несколько учетных записей, которые предоставляют различные уровни привилегий.</span><span class="sxs-lookup"><span data-stu-id="059e6-140">There should be several accounts that provide different levels of privilege.</span></span> <span data-ttu-id="059e6-141">Приложение должно использовать только уровень разрешений, предоставляющий доступ на чтение и запись к данным в таблицах.</span><span class="sxs-lookup"><span data-stu-id="059e6-141">The application should only use the permission level that grants read and write access to the data in the tables.</span></span> <span data-ttu-id="059e6-142">Такой тип защиты позволит избежать атак, направленных на удаление таблиц базы данных или ввод вредоносных триггеров.</span><span class="sxs-lookup"><span data-stu-id="059e6-142">This kind of protection would eliminate attacks that aimed to drop database tables or introduce malicious triggers.</span></span>

<span data-ttu-id="059e6-143">Почти во всех частях создания облачных приложений может быть полезно помнить принцип минимальных привилегий.</span><span class="sxs-lookup"><span data-stu-id="059e6-143">Almost every part of building a cloud-native application can benefit from remembering the principle of least privilege.</span></span> <span data-ttu-id="059e6-144">Его можно найти при настройке брандмауэров, групп безопасности сети, ролей и областей в контроле доступа на основе ролей (RBAC).</span><span class="sxs-lookup"><span data-stu-id="059e6-144">You can find it at play when setting up firewalls, network security groups, roles, and scopes in Role-based access control (RBAC).</span></span>

## <a name="penetration-testing"></a><span data-ttu-id="059e6-145">тестирование уязвимости;</span><span class="sxs-lookup"><span data-stu-id="059e6-145">Penetration testing</span></span>

<span data-ttu-id="059e6-146">По мере того, как приложения становятся более сложными, число векторов атак увеличивается по скорости сигнализации.</span><span class="sxs-lookup"><span data-stu-id="059e6-146">As applications become more complicated the number of attack vectors increases at an alarming rate.</span></span> <span data-ttu-id="059e6-147">Нарушение моделирования угроз в том, что она обычно выполняется теми же людьми, которые создают систему.</span><span class="sxs-lookup"><span data-stu-id="059e6-147">Threat modeling is flawed in that it tends to be executed by the same people building the system.</span></span> <span data-ttu-id="059e6-148">Точно так же, как многие разработчики испытывают проблемы с представлением взаимодействия с пользователем, а затем создают непригодные для использования пользовательские интерфейсы, большинство разработчиков испытывают трудности при просмотре каждого вектора атак.</span><span class="sxs-lookup"><span data-stu-id="059e6-148">In the same way that many developers have trouble envisioning user interactions and then build unusable user interfaces, most developers have difficulty seeing every attack vector.</span></span> <span data-ttu-id="059e6-149">Также возможно, что разработчики, создающие систему, не очень попадают в методологии атак и не имеют какого-либо важного.</span><span class="sxs-lookup"><span data-stu-id="059e6-149">It's also possible that the developers building the system aren't well versed in attack methodologies and miss something crucial.</span></span>

<span data-ttu-id="059e6-150">Тестирование на проникновение или "тестирование пера" предполагает, что внешние субъекты попытаются атаковать систему.</span><span class="sxs-lookup"><span data-stu-id="059e6-150">Penetration testing or "pen testing" involves bringing in external actors to attempt to attack the system.</span></span> <span data-ttu-id="059e6-151">Злоумышленники могут быть внешней консалтинговой компанией или другими разработчиками, имеющими хорошие знания о безопасности из другой части бизнеса.</span><span class="sxs-lookup"><span data-stu-id="059e6-151">These attackers may be an external consulting company or other developers with good security knowledge from another part of the business.</span></span> <span data-ttu-id="059e6-152">Они получают полномочияу корзины, чтобы попытаться обходят систему.</span><span class="sxs-lookup"><span data-stu-id="059e6-152">They're given carte blanche to attempt to subvert the system.</span></span> <span data-ttu-id="059e6-153">Часто они находят обширные бреши в системе безопасности, которые необходимо исправить.</span><span class="sxs-lookup"><span data-stu-id="059e6-153">Frequently, they'll find extensive security holes that need to be patched.</span></span> <span data-ttu-id="059e6-154">Иногда вектор атаки будет полностью непредвиденным образом, например с помощью атаки фишинга от Генерального директора.</span><span class="sxs-lookup"><span data-stu-id="059e6-154">Sometimes the attack vector will be something totally unexpected like exploiting a phishing attack against the CEO.</span></span>

<span data-ttu-id="059e6-155">Azure постоянно подключается к атакам от [группы хакеров внутри корпорации Майкрософт](https://azure.microsoft.com/resources/videos/red-vs-blue-internal-security-penetration-testing-of-microsoft-azure/).</span><span class="sxs-lookup"><span data-stu-id="059e6-155">Azure itself is constantly undergoing attacks from a [team of hackers inside Microsoft](https://azure.microsoft.com/resources/videos/red-vs-blue-internal-security-penetration-testing-of-microsoft-azure/).</span></span> <span data-ttu-id="059e6-156">В течение многих лет они первыми нашли десятки потенциально разрушительных направлений атак, закрыв их, прежде чем они смогут использовать извне.</span><span class="sxs-lookup"><span data-stu-id="059e6-156">Over the years, they've been the first to find dozens of potentially catastrophic attack vectors, closing them before they can be exploited externally.</span></span> <span data-ttu-id="059e6-157">Чем больше используется цель, тем более вероятно, что нескончаемые Actors попытается использовать его, и несколько целевых объектов в мире будут более заманчивыми, чем Azure.</span><span class="sxs-lookup"><span data-stu-id="059e6-157">The more tempting a target, the more likely that eternal actors will attempt to exploit it and there are a few targets in the world more tempting than Azure.</span></span>

## <a name="monitoring"></a><span data-ttu-id="059e6-158">Мониторинг</span><span class="sxs-lookup"><span data-stu-id="059e6-158">Monitoring</span></span>

<span data-ttu-id="059e6-159">Если злоумышленник пытается проникнуть приложение, это должно быть предупреждение.</span><span class="sxs-lookup"><span data-stu-id="059e6-159">Should an attacker attempt to penetrate an application, there should be some warning of it.</span></span> <span data-ttu-id="059e6-160">Часто атаки можно проанализировать, изучив журналы в службах.</span><span class="sxs-lookup"><span data-stu-id="059e6-160">Frequently, attacks can be spotted by examining the logs from services.</span></span> <span data-ttu-id="059e6-161">Атаки оставляют знаки признаков, которые могут быть обнаружены до того, как они будут выполнены.</span><span class="sxs-lookup"><span data-stu-id="059e6-161">Attacks leave telltale signs that can be spotted before they succeed.</span></span> <span data-ttu-id="059e6-162">Например, злоумышленник, пытающийся угадать пароль, будет выполнять много запросов к системе входа.</span><span class="sxs-lookup"><span data-stu-id="059e6-162">For instance, an attacker attempting to guess a password will make many requests to a login system.</span></span> <span data-ttu-id="059e6-163">Мониторинг системы входа в систему может обнаружить странные шаблоны, которые не являются стандартными, с обычным шаблоном доступа.</span><span class="sxs-lookup"><span data-stu-id="059e6-163">Monitoring around the login system can detect weird patterns that are out of line with the typical access pattern.</span></span> <span data-ttu-id="059e6-164">Этот мониторинг можно включить в оповещение, которое может, в свою очередь, оповещать пользователя об активации некоторого рода контрмер.</span><span class="sxs-lookup"><span data-stu-id="059e6-164">This monitoring can be turned into an alert that can, in turn, alert an operations person to activate some sort of countermeasure.</span></span> <span data-ttu-id="059e6-165">Высокозрелая система мониторинга может даже предпринять действия на основе этих отклонений, заранее добавляя правила для блокировки запросов или регулирования ответов.</span><span class="sxs-lookup"><span data-stu-id="059e6-165">A highly mature monitoring system might even take action based on these deviations proactively adding rules to block requests or throttle responses.</span></span>

## <a name="securing-the-build"></a><span data-ttu-id="059e6-166">Обеспечение безопасности сборки</span><span class="sxs-lookup"><span data-stu-id="059e6-166">Securing the build</span></span>

<span data-ttu-id="059e6-167">В одном месте, где часто изменяются проблемы безопасности, является процесс сборки.</span><span class="sxs-lookup"><span data-stu-id="059e6-167">One place where security is often overlooked is around the build process.</span></span> <span data-ttu-id="059e6-168">Не только проверки безопасности запуска сборки, например сканирование небезопасного кода или учетных данных для возврата, но сама сборка должна быть безопасной.</span><span class="sxs-lookup"><span data-stu-id="059e6-168">Not only should the build run security checks, such as scanning for insecure code or checked-in credentials, but the build itself should be secure.</span></span> <span data-ttu-id="059e6-169">Если сервер сборки скомпрометирован, он предоставляет отличный вектор для введения в продукт произвольного кода.</span><span class="sxs-lookup"><span data-stu-id="059e6-169">If the build server is compromised, then it provides a fantastic vector for introducing arbitrary code into the product.</span></span>

<span data-ttu-id="059e6-170">Представьте себе, что злоумышленнику нужно украсть пароли людей, которые подписывается в веб-приложение.</span><span class="sxs-lookup"><span data-stu-id="059e6-170">Imagine that an attacker is looking to steal the passwords of people signing into a web application.</span></span> <span data-ttu-id="059e6-171">Они могут ввести этап сборки, который изменяет возвращенный код для отражения любого запроса на вход на другой сервер.</span><span class="sxs-lookup"><span data-stu-id="059e6-171">They could introduce a build step that modifies the checked-out code to mirror any login request to another server.</span></span> <span data-ttu-id="059e6-172">Следующий код проходит через сборку, он обновляется автоматически.</span><span class="sxs-lookup"><span data-stu-id="059e6-172">The next time code goes through the build, it's silently updated.</span></span> <span data-ttu-id="059e6-173">Сканирование уязвимостей исходного кода не перехватывает это, как оно выполняется перед сборкой.</span><span class="sxs-lookup"><span data-stu-id="059e6-173">The source code vulnerability scanning won't catch this as it runs before the build.</span></span> <span data-ttu-id="059e6-174">В этом случае никто не будет перехватывать его при проверке кода, так как на сервере сборки выполняется процедура сборки.</span><span class="sxs-lookup"><span data-stu-id="059e6-174">Equally, nobody will catch it in a code review because the build steps live on the build server.</span></span> <span data-ttu-id="059e6-175">Код злоумышленника перейдет в рабочую среду, где он сможет собирать пароли.</span><span class="sxs-lookup"><span data-stu-id="059e6-175">The exploited code will go to production where it can harvest passwords.</span></span> <span data-ttu-id="059e6-176">Возможно, нет журнала аудита для процесса сборки или хотя бы никто не отслеживает аудит.</span><span class="sxs-lookup"><span data-stu-id="059e6-176">Probably there's no audit log of the build process changes, or at least nobody monitoring the audit.</span></span>

<span data-ttu-id="059e6-177">Это идеальный пример целевого объекта с низкой ценностью, который можно использовать для разбиения системы на части.</span><span class="sxs-lookup"><span data-stu-id="059e6-177">This is a perfect example of a seemingly low value target that can be used to break into the system.</span></span> <span data-ttu-id="059e6-178">После того как злоумышленник нарушает периметр системы, он может начать работу над поиском способов повышения их разрешений до момента, когда они могут вызвать реальные угрозы в любом месте.</span><span class="sxs-lookup"><span data-stu-id="059e6-178">Once an attacker breaches the perimeter of the system, they can start working on finding ways to elevate their permissions to the point that they can cause real harm anywhere they like.</span></span>

## <a name="building-secure-code"></a><span data-ttu-id="059e6-179">Создание безопасного кода</span><span class="sxs-lookup"><span data-stu-id="059e6-179">Building secure code</span></span>

<span data-ttu-id="059e6-180">.NET Framework уже является весьма безопасной платформой.</span><span class="sxs-lookup"><span data-stu-id="059e6-180">The .NET Framework is already a quite secure framework.</span></span> <span data-ttu-id="059e6-181">Он позволяет избежать некоторых ловушек неуправляемого кода, таких как проход по концам массивов.</span><span class="sxs-lookup"><span data-stu-id="059e6-181">It avoids some of the pitfalls of unmanaged code, such as walking off the ends of arrays.</span></span> <span data-ttu-id="059e6-182">Работа активно выполняется для устранения брешей в системе безопасности по мере их обнаружения.</span><span class="sxs-lookup"><span data-stu-id="059e6-182">Work is actively done to fix security holes as they're discovered.</span></span> <span data-ttu-id="059e6-183">Существует даже [Программа поощренияа ошибок](https://www.microsoft.com/msrc/bounty) , которая выплачивает исследователи, чтобы найти проблемы в платформе и сообщить о них вместо использования их.</span><span class="sxs-lookup"><span data-stu-id="059e6-183">There's even a [bug bounty program](https://www.microsoft.com/msrc/bounty) that pays researchers to find issues in the framework and report them instead of exploiting them.</span></span>

<span data-ttu-id="059e6-184">Существует множество способов повышения безопасности кода .NET.</span><span class="sxs-lookup"><span data-stu-id="059e6-184">There are many ways to make .NET code more secure.</span></span> <span data-ttu-id="059e6-185">Следующие рекомендации, такие как [рекомендации по безопасному кодированию для статьи .NET](https://docs.microsoft.com/dotnet/standard/security/secure-coding-guidelines) , являются разумным шагом для обеспечения безопасности кода с самого начала.</span><span class="sxs-lookup"><span data-stu-id="059e6-185">Following guidelines such as the [Secure coding guidelines for .NET](https://docs.microsoft.com/dotnet/standard/security/secure-coding-guidelines) article is a reasonable step to take to ensure that the code is secure from the ground up.</span></span> <span data-ttu-id="059e6-186">[OWASP Top 10](https://www.owasp.org/index.php/Category:OWASP_Top_Ten_2017_Project) является еще одним ценным руководством по созданию безопасного кода.</span><span class="sxs-lookup"><span data-stu-id="059e6-186">The [OWASP top 10](https://www.owasp.org/index.php/Category:OWASP_Top_Ten_2017_Project) is another invaluable guide to build secure code.</span></span>

<span data-ttu-id="059e6-187">Процесс сборки является хорошим местом для размещения средств сканирования для обнаружения проблем в исходном коде до того, как они будут внесены в рабочую среду.</span><span class="sxs-lookup"><span data-stu-id="059e6-187">The build process is a good place to put scanning tools to detect problems in source code before they make it into production.</span></span> <span data-ttu-id="059e6-188">Большинство проектов имеют зависимости от других пакетов.</span><span class="sxs-lookup"><span data-stu-id="059e6-188">Most every project has dependencies on some other packages.</span></span> <span data-ttu-id="059e6-189">Средство, которое может выполнять поиск устаревших пакетов, будет перехватывать проблемы в ночных сборках.</span><span class="sxs-lookup"><span data-stu-id="059e6-189">A tool that can scan for outdated packages will catch problems in a nightly build.</span></span> <span data-ttu-id="059e6-190">Даже при создании образов DOCKER полезно проверить и убедиться, что в базовом образе отсутствуют известные уязвимости.</span><span class="sxs-lookup"><span data-stu-id="059e6-190">Even when building Docker images, it's useful to check and make sure that the base image doesn't have known vulnerabilities.</span></span> <span data-ttu-id="059e6-191">Еще одно, что нужно проверить: никто случайно не вернул учетные данные.</span><span class="sxs-lookup"><span data-stu-id="059e6-191">Another thing to check is that nobody has accidentally checked in credentials.</span></span>

## <a name="built-in-security"></a><span data-ttu-id="059e6-192">Встроенная безопасность</span><span class="sxs-lookup"><span data-stu-id="059e6-192">Built-in security</span></span>

<span data-ttu-id="059e6-193">Azure предназначен для балансировки использования и безопасности большинства пользователей.</span><span class="sxs-lookup"><span data-stu-id="059e6-193">Azure is designed to balance usability and security for the majority of users.</span></span> <span data-ttu-id="059e6-194">Разные пользователи будут иметь разные требования к безопасности, поэтому им нужно настроить подход к безопасности в облаке.</span><span class="sxs-lookup"><span data-stu-id="059e6-194">Different users are going to have different security requirements, so they need to fine-tune their approach to cloud security.</span></span> <span data-ttu-id="059e6-195">Корпорация Майкрософт публикует значительную часть сведений о безопасности в [центре управления безопасностью](https://azure.microsoft.com/support/trust-center/).</span><span class="sxs-lookup"><span data-stu-id="059e6-195">Microsoft publishes a great deal of security information in the [Trust Center](https://azure.microsoft.com/support/trust-center/).</span></span> <span data-ttu-id="059e6-196">Этот ресурс должен быть первым остановкой для специалистов, желающих понять, как работают встроенные технологии защиты от атак.</span><span class="sxs-lookup"><span data-stu-id="059e6-196">This resource should be the first stop for those professionals interested in understanding how the built-in attack mitigation technologies work.</span></span>

<span data-ttu-id="059e6-197">В портал Azure [помощник Azure](https://azure.microsoft.com/services/advisor/) — это система, которая постоянно сканирует среду и делает рекомендации.</span><span class="sxs-lookup"><span data-stu-id="059e6-197">Within the Azure portal, the [Azure Advisor](https://azure.microsoft.com/services/advisor/) is a system that is constantly scanning an environment and making recommendations.</span></span> <span data-ttu-id="059e6-198">Некоторые из этих рекомендаций предназначены для экономии денег пользователей, но другие предназначены для обнаружения потенциально небезопасных конфигураций, например для того, чтобы контейнер хранилища был открыт в мире и не защищен виртуальной сетью.</span><span class="sxs-lookup"><span data-stu-id="059e6-198">Some of these recommendations are designed to save users money, but others are designed to identify potentially insecure configurations, such as having a storage container open to the world and not protected by a Virtual Network.</span></span>

## <a name="azure-network-infrastructure"></a><span data-ttu-id="059e6-199">Инфраструктура сети Azure</span><span class="sxs-lookup"><span data-stu-id="059e6-199">Azure network infrastructure</span></span>

<span data-ttu-id="059e6-200">В локальной среде развертывания большой объем энергии выделен для настройки сети.</span><span class="sxs-lookup"><span data-stu-id="059e6-200">In an on-premises deployment environment, a great deal of energy is dedicated to setting up networking.</span></span> <span data-ttu-id="059e6-201">Настройка маршрутизаторов, коммутаторов и, например, усложняет работу.</span><span class="sxs-lookup"><span data-stu-id="059e6-201">Setting up routers, switches, and the such is complicated work.</span></span> <span data-ttu-id="059e6-202">Сети позволяют некоторым ресурсам взаимодействовать с другими ресурсами и запрещать доступ в некоторых случаях.</span><span class="sxs-lookup"><span data-stu-id="059e6-202">Networks allow certain resources to talk to other resources and prevent access in some cases.</span></span> <span data-ttu-id="059e6-203">Частое правило сети заключается в ограничении доступа к рабочей среде из среды разработки с тем, что разрабатывается вкось часть кода и удаляется сообщить данных.</span><span class="sxs-lookup"><span data-stu-id="059e6-203">A frequent network rule is to restrict access to the production environment from the development environment on the off chance that a half-developed piece of code runs awry and deletes a swath of data.</span></span>

<span data-ttu-id="059e6-204">В большинстве случаев большинство ресурсов Azure PaaS имеют только самую базовую и разрешающую сетевую установку.</span><span class="sxs-lookup"><span data-stu-id="059e6-204">Out of the box, most PaaS Azure resources have only the most basic and permissive networking setup.</span></span> <span data-ttu-id="059e6-205">Например, все, кто находится в Интернете, может получить доступ к службе приложений.</span><span class="sxs-lookup"><span data-stu-id="059e6-205">For instance, anybody on the Internet can access an app service.</span></span> <span data-ttu-id="059e6-206">Новые экземпляры SQL Server обычно бывают ограниченными, чтобы внешние стороны не могли получить к ним доступ, но диапазоны IP-адресов, используемые Azure, разрешены через.</span><span class="sxs-lookup"><span data-stu-id="059e6-206">New SQL Server instances typically come restricted, so that external parties can't access them, but the IP address ranges used by Azure itself are permitted through.</span></span> <span data-ttu-id="059e6-207">Таким образом, несмотря на то, что сервер SQL Server защищен от внешних угроз, злоумышленнику нужно только настроить Azure-плацдарм, откуда они смогут запускать атаки для всех экземпляров SQL в Azure.</span><span class="sxs-lookup"><span data-stu-id="059e6-207">So, while the SQL server is protected from external threats, an attacker only needs to set up an Azure bridgehead from where they can launch attacks against all SQL instances on Azure.</span></span>

<span data-ttu-id="059e6-208">К счастью, большинство ресурсов Azure можно разместить в виртуальной сети Azure, что позволяет более детально управлять доступом.</span><span class="sxs-lookup"><span data-stu-id="059e6-208">Fortunately, most Azure resources can be placed into an Azure Virtual Network that allows finer grained access control.</span></span> <span data-ttu-id="059e6-209">Подобно тому, как локальные сети устанавливают частные сети, защищенные из широкого мира, виртуальные сети — это острова частных IP-адресов, расположенных в сети Azure.</span><span class="sxs-lookup"><span data-stu-id="059e6-209">Similar to the way that on-premises networks establish private networks that are protected from the wider world, virtual networks are islands of private IP addresses that are located within the Azure network.</span></span>

<span data-ttu-id="059e6-210">![рис. 10-1. Виртуальная сеть в Azure](./media/virtual-network.png)
**рис. 10-1**.</span><span class="sxs-lookup"><span data-stu-id="059e6-210">![Figure 10-1 A virtual network in Azure](./media/virtual-network.png)
**Figure 10-1**.</span></span> <span data-ttu-id="059e6-211">Виртуальная сеть в Azure.</span><span class="sxs-lookup"><span data-stu-id="059e6-211">A virtual network in Azure.</span></span>

<span data-ttu-id="059e6-212">Так же, как локальные сети имеют брандмауэр, управляющий доступом к сети, вы можете установить аналогичный брандмауэр на границе виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="059e6-212">In the same way that on-premises networks have a firewall governing access to the network, you can establish a similar firewall at the boundary of the virtual network.</span></span> <span data-ttu-id="059e6-213">По умолчанию все ресурсы в виртуальной сети по-прежнему могут взаимодействовать с Интернетом.</span><span class="sxs-lookup"><span data-stu-id="059e6-213">By default, all the resources on a virtual network can still talk to the Internet.</span></span> <span data-ttu-id="059e6-214">Это только входящие подключения, требующие явной формы исключения брандмауэра.</span><span class="sxs-lookup"><span data-stu-id="059e6-214">It's only incoming connections that require some form of explicit firewall exception.</span></span>

<span data-ttu-id="059e6-215">После установки сети внутренние ресурсы, такие как учетные записи хранения, можно настроить для доступа только к ресурсам, которые также находятся в виртуальной сети.</span><span class="sxs-lookup"><span data-stu-id="059e6-215">With the network established, internal resources like storage accounts can be set up to only allow for access by resources that are also on the Virtual Network.</span></span> <span data-ttu-id="059e6-216">Этот брандмауэр обеспечивает дополнительный уровень безопасности, в случае утечки ключей для этой учетной записи хранения злоумышленники не смогут подключиться к ней для использования потерянных ключей.</span><span class="sxs-lookup"><span data-stu-id="059e6-216">This firewall provides an extra level of security, should the keys for that storage account be leaked, attackers wouldn't be able to connect to it to exploit the leaked keys.</span></span> <span data-ttu-id="059e6-217">Это еще один пример принципа наименьших привилегий.</span><span class="sxs-lookup"><span data-stu-id="059e6-217">This is another example of the principle of least privilege.</span></span>

<span data-ttu-id="059e6-218">Узлы в кластере Azure Kubernetes могут участвовать в виртуальной сети так же, как другие ресурсы, которые являются более машинными для Azure.</span><span class="sxs-lookup"><span data-stu-id="059e6-218">The nodes in an Azure Kubernetes cluster can participate in a virtual network just like other resources that are more native to Azure.</span></span> <span data-ttu-id="059e6-219">Эта функция называется [сетевым интерфейсом контейнера Azure](https://github.com/Azure/azure-container-networking/blob/master/docs/cni.md).</span><span class="sxs-lookup"><span data-stu-id="059e6-219">This functionality is called [Azure Container Networking Interface](https://github.com/Azure/azure-container-networking/blob/master/docs/cni.md).</span></span> <span data-ttu-id="059e6-220">Фактически она выделяет подсеть в виртуальной сети, в которой выделяются виртуальные машины и образы контейнеров.</span><span class="sxs-lookup"><span data-stu-id="059e6-220">In effect, it allocates a subnet within the virtual network on which virtual machines and container images are allocated.</span></span>

<span data-ttu-id="059e6-221">Продолжая путь, иллюстрирующий принцип наименьших привилегий, не каждый ресурс в виртуальной сети должен взаимодействовать с каждым другим ресурсом.</span><span class="sxs-lookup"><span data-stu-id="059e6-221">Continuing down the path of illustrating the principle of least privilege, not every resource within a Virtual Network needs to talk to every other resource.</span></span> <span data-ttu-id="059e6-222">Например, в приложении, которое предоставляет веб-API для учетной записи хранения и базы данных SQL, маловероятно, что базе данных и учетной записи хранения необходимо взаимодействовать друг с другом.</span><span class="sxs-lookup"><span data-stu-id="059e6-222">For instance, in an application that provides a web API over a storage account and a SQL database, it's unlikely that the database and the storage account need to talk to one another.</span></span> <span data-ttu-id="059e6-223">Любой обмен данными между ними будет проходить через веб-приложение.</span><span class="sxs-lookup"><span data-stu-id="059e6-223">Any data sharing between them would go through the web application.</span></span> <span data-ttu-id="059e6-224">Таким образом, для запрета трафика между двумя службами можно использовать [группу безопасности сети (NSG)](https://docs.microsoft.com/azure/virtual-network/security-overview) .</span><span class="sxs-lookup"><span data-stu-id="059e6-224">So, a [network security group (NSG)](https://docs.microsoft.com/azure/virtual-network/security-overview) could be used to deny traffic between the two services.</span></span>

<span data-ttu-id="059e6-225">Реализация политики запрета взаимодействия между ресурсами может быть неудобной для реализации, особенно поступающих из использования Azure без ограничений трафика.</span><span class="sxs-lookup"><span data-stu-id="059e6-225">A policy of denying communication between resources can be annoying to implement, especially coming from a background of using Azure without traffic restrictions.</span></span> <span data-ttu-id="059e6-226">В некоторых других облаках концепция групп безопасности сети гораздо более распространена.</span><span class="sxs-lookup"><span data-stu-id="059e6-226">On some other clouds, the concept of network security groups is much more prevalent.</span></span> <span data-ttu-id="059e6-227">Например, политика по умолчанию в AWS заключается в том, что ресурсы не могут взаимодействовать между собой, пока они не будут включены правилами в NSG.</span><span class="sxs-lookup"><span data-stu-id="059e6-227">For instance, the default policy on AWS is that resources can't communicate among themselves until enabled by rules in an NSG.</span></span> <span data-ttu-id="059e6-228">Хотя это и более медленный процесс разработки, более ограниченная среда обеспечивает более безопасную работу по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="059e6-228">While slower to develop this, more restrictive environment provides a more secure default.</span></span> <span data-ttu-id="059e6-229">Использование правильных методик DevOps, особенно с помощью [Azure Resource Manager или terraform](infrastructure-as-code.md) для управления разрешениями, упрощает управление правилами.</span><span class="sxs-lookup"><span data-stu-id="059e6-229">Making use of proper DevOps practices, especially using [Azure Resource Manager or Terraform](infrastructure-as-code.md) to manage permissions can make controlling the rules easier.</span></span>

<span data-ttu-id="059e6-230">Виртуальные сети также могут быть полезны при настройке обмена данными между локальными и облачными ресурсами.</span><span class="sxs-lookup"><span data-stu-id="059e6-230">Virtual Networks can also be useful when setting up communication between on-premises and cloud resources.</span></span> <span data-ttu-id="059e6-231">Виртуальную частную сеть можно использовать для беспроблемного подключения двух сетей друг к другу.</span><span class="sxs-lookup"><span data-stu-id="059e6-231">A virtual private network can be used to seamlessly attach the two networks together.</span></span> <span data-ttu-id="059e6-232">Это позволяет запускать виртуальную сеть без какого-либо шлюза для сценариев, в которых все пользователи находятся на месте.</span><span class="sxs-lookup"><span data-stu-id="059e6-232">This allows running a virtual network without any sort of gateway for scenarios where all the users are on-site.</span></span> <span data-ttu-id="059e6-233">Существует ряд технологий, которые можно использовать для установки этой сети.</span><span class="sxs-lookup"><span data-stu-id="059e6-233">There are a number of technologies that can be used to establish this network.</span></span> <span data-ttu-id="059e6-234">Проще всего использовать [VPN типа "сеть — сеть](https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-about-vpngateways?toc=%2fazure%2fvirtual-network%2ftoc.json#s2smulti) ", которую можно установить между многими маршрутизаторами и Azure.</span><span class="sxs-lookup"><span data-stu-id="059e6-234">The simplest is to use a [site-to-site VPN](https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-about-vpngateways?toc=%2fazure%2fvirtual-network%2ftoc.json#s2smulti) that can be established between many routers and Azure.</span></span> <span data-ttu-id="059e6-235">Трафик шифруется и подключается через Интернет по таким же затратам на каждый байт, как и любой другой трафик.</span><span class="sxs-lookup"><span data-stu-id="059e6-235">Traffic is encrypted and tunneled over the Internet at the same cost per byte as any other traffic.</span></span> <span data-ttu-id="059e6-236">Для сценариев, в которых предпочтительнее пропускная способность или более безопасность, Azure предлагает службу с именем [Express Route](https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-about-vpngateways?toc=%2fazure%2fvirtual-network%2ftoc.json#ExpressRoute) , которая использует частный канал между локальной сетью и Azure.</span><span class="sxs-lookup"><span data-stu-id="059e6-236">For scenarios where more bandwidth or more security is desirable, Azure offers a service called [Express Route](https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-about-vpngateways?toc=%2fazure%2fvirtual-network%2ftoc.json#ExpressRoute) that uses a private circuit between an on-premises network and Azure.</span></span> <span data-ttu-id="059e6-237">Он является более дорогостоящим и сложным в установке, но также более безопасным.</span><span class="sxs-lookup"><span data-stu-id="059e6-237">It's more costly and difficult to establish but also more secure.</span></span>

## <a name="role-based-access-control-for-restricting-access-to-azure-resources"></a><span data-ttu-id="059e6-238">Управление доступом на основе ролей для ограниченного доступа к ресурсам Azure</span><span class="sxs-lookup"><span data-stu-id="059e6-238">Role-based access control for restricting access to Azure resources</span></span>

<span data-ttu-id="059e6-239">RBAC — это система, которая предоставляет удостоверение для приложений, выполняющихся в Azure.</span><span class="sxs-lookup"><span data-stu-id="059e6-239">RBAC is a system that provides an identity to applications running in Azure.</span></span> <span data-ttu-id="059e6-240">Приложения могут обращаться к ресурсам с помощью этого удостоверения, а не в дополнение к использованию ключей или паролей.</span><span class="sxs-lookup"><span data-stu-id="059e6-240">Applications can access resources using this identity instead of or in addition to using keys or passwords.</span></span>

## <a name="security-principals"></a><span data-ttu-id="059e6-241">Субъекты безопасности</span><span class="sxs-lookup"><span data-stu-id="059e6-241">Security Principals</span></span>

<span data-ttu-id="059e6-242">Первый компонент RBAC — это субъект безопасности.</span><span class="sxs-lookup"><span data-stu-id="059e6-242">The first component in RBAC is a security principal.</span></span> <span data-ttu-id="059e6-243">Субъект безопасности может быть пользователем, группой, субъектом-службой или управляемым удостоверением.</span><span class="sxs-lookup"><span data-stu-id="059e6-243">A security principal can be a user, group, service principal, or managed identity.</span></span>

<span data-ttu-id="059e6-244">![рис. 10-2. различные типы субъектов безопасности](./media/rbac-security-principal.png)
**рис. 10-2**.</span><span class="sxs-lookup"><span data-stu-id="059e6-244">![Figure 10-2 Different types of security principals](./media/rbac-security-principal.png)
**Figure 10-2**.</span></span> <span data-ttu-id="059e6-245">Различные типы субъектов безопасности.</span><span class="sxs-lookup"><span data-stu-id="059e6-245">Different types of security principals.</span></span>

- <span data-ttu-id="059e6-246">Пользователь — любой пользователь с учетной записью в Azure Active Directory является пользователем.</span><span class="sxs-lookup"><span data-stu-id="059e6-246">User - Any user who has an account in Azure Active Directory is a user.</span></span>
- <span data-ttu-id="059e6-247">Группа — коллекция пользователей из Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="059e6-247">Group - A collection of users from Azure Active Directory.</span></span> <span data-ttu-id="059e6-248">Как член группы, пользователь принимает роли этой группы в дополнение к собственным.</span><span class="sxs-lookup"><span data-stu-id="059e6-248">As a member of a group, a user takes on the roles of that group in addition to their own.</span></span>
- <span data-ttu-id="059e6-249">Субъект-служба — удостоверение безопасности, под которым запускаются службы или приложения.</span><span class="sxs-lookup"><span data-stu-id="059e6-249">Service principal - A security identity under which services or applications run.</span></span>
- <span data-ttu-id="059e6-250">Управляемое удостоверение — удостоверение Azure Active Directory, управляемое Azure.</span><span class="sxs-lookup"><span data-stu-id="059e6-250">Managed identity - An Azure Active Directory identity managed by Azure.</span></span> <span data-ttu-id="059e6-251">Управляемые удостоверения обычно используются при разработке облачных приложений, которые управляют учетными данными для проверки подлинности в службах Azure.</span><span class="sxs-lookup"><span data-stu-id="059e6-251">Managed identities are typically used when developing cloud applications that manage the credentials for authenticating to Azure services.</span></span>

<span data-ttu-id="059e6-252">Субъект безопасности может применяться к большинству ресурсов.</span><span class="sxs-lookup"><span data-stu-id="059e6-252">The security principal can be applied to most any resource.</span></span> <span data-ttu-id="059e6-253">Это означает, что можно назначить субъект безопасности контейнеру, работающему в Azure Kubernetes, что позволит ему получить доступ к секретам, хранящимся в Key Vault.</span><span class="sxs-lookup"><span data-stu-id="059e6-253">This means that it's possible to assign a security principal to a container running within Azure Kubernetes, allowing it to access secrets stored in Key Vault.</span></span> <span data-ttu-id="059e6-254">Функция Azure может принимать разрешение на обмен данными с экземпляром Active Directory для проверки JWT для вызывающего пользователя.</span><span class="sxs-lookup"><span data-stu-id="059e6-254">An Azure Function could take on a permission allowing it to talk to an Active Directory instance to validate a JWT for a calling user.</span></span> <span data-ttu-id="059e6-255">После включения служб с помощью субъекта-службы их разрешения могут управляться детально с помощью ролей и областей.</span><span class="sxs-lookup"><span data-stu-id="059e6-255">Once services are enabled with a service principal, their permissions can be managed granularly using roles and scopes.</span></span>

## <a name="roles"></a><span data-ttu-id="059e6-256">Роли</span><span class="sxs-lookup"><span data-stu-id="059e6-256">Roles</span></span>

<span data-ttu-id="059e6-257">Субъект безопасности может принимать множество ролей или, используя более сарториал аналог, выполнять многие шляпы.</span><span class="sxs-lookup"><span data-stu-id="059e6-257">A security principal can take on many roles or, using a more sartorial analogy, wear many hats.</span></span> <span data-ttu-id="059e6-258">Каждая роль определяет ряд разрешений, например "чтение сообщений из конечной точки служебной шины Azure".</span><span class="sxs-lookup"><span data-stu-id="059e6-258">Each role defines a series of permissions such as "Read messages from Azure Service Bus endpoint".</span></span> <span data-ttu-id="059e6-259">Эффективный набор разрешений субъекта безопасности — это сочетание всех разрешений, назначенных всем ролям, которые имеют субъект безопасности.</span><span class="sxs-lookup"><span data-stu-id="059e6-259">The effective permission set of a security principal is the combination of all the permissions assigned to all the roles that security principal has.</span></span> <span data-ttu-id="059e6-260">В Azure имеется большое количество встроенных ролей, и пользователи могут определять собственные роли.</span><span class="sxs-lookup"><span data-stu-id="059e6-260">Azure has a large number of built-in roles and users can define their own roles.</span></span>

<span data-ttu-id="059e6-261">![рис. 10-3 определения ролей RBAC](./media/rbac-role-definition.png)
**рис. 10-3**.</span><span class="sxs-lookup"><span data-stu-id="059e6-261">![Figure 10-3 RBAC role definitions](./media/rbac-role-definition.png)
**Figure 10-3**.</span></span> <span data-ttu-id="059e6-262">Определения ролей RBAC.</span><span class="sxs-lookup"><span data-stu-id="059e6-262">RBAC role definitions.</span></span>

<span data-ttu-id="059e6-263">Встроенные в Azure, также представляют собой ряд высокоуровневых ролей, таких как владелец, участник, читатель и администратор учетных записей пользователей.</span><span class="sxs-lookup"><span data-stu-id="059e6-263">Built into Azure are also a number of high-level roles such as Owner, Contributor, Reader, and User Account Administrator.</span></span> <span data-ttu-id="059e6-264">С ролью владельца субъект безопасности может получить доступ ко всем ресурсам и назначить разрешения другим пользователям.</span><span class="sxs-lookup"><span data-stu-id="059e6-264">With the Owner role, a security principal can access all resources and assign permissions to others.</span></span> <span data-ttu-id="059e6-265">Участник имеет тот же уровень доступа ко всем ресурсам, но не может назначать разрешения.</span><span class="sxs-lookup"><span data-stu-id="059e6-265">A contributor has the same level of access to all resources but they can't assign permissions.</span></span> <span data-ttu-id="059e6-266">Читатель может только просматривать существующие ресурсы Azure, а администратор учетных записей пользователей может управлять доступом к ресурсам Azure.</span><span class="sxs-lookup"><span data-stu-id="059e6-266">A Reader can only view existing Azure resources and a User Account Administrator can manage access to Azure resources.</span></span>

<span data-ttu-id="059e6-267">Более детализированные встроенные роли, такие как [участник зоны DNS](https://docs.microsoft.com/azure/role-based-access-control/built-in-roles#dns-zone-contributor) , имеют права, ограниченные одной службой.</span><span class="sxs-lookup"><span data-stu-id="059e6-267">More granular built-in roles such as [DNS Zone Contributor](https://docs.microsoft.com/azure/role-based-access-control/built-in-roles#dns-zone-contributor) have rights limited to a single service.</span></span> <span data-ttu-id="059e6-268">Субъекты безопасности могут принимать любое количество ролей.</span><span class="sxs-lookup"><span data-stu-id="059e6-268">Security principals can take on any number of roles.</span></span>

## <a name="scopes"></a><span data-ttu-id="059e6-269">Области</span><span class="sxs-lookup"><span data-stu-id="059e6-269">Scopes</span></span>

<span data-ttu-id="059e6-270">Роли можно применять к ограниченному набору ресурсов в Azure.</span><span class="sxs-lookup"><span data-stu-id="059e6-270">Roles can be applied to a restricted set of resources within Azure.</span></span> <span data-ttu-id="059e6-271">Например, применение области к предыдущему примеру чтения из очереди служебной шины позволяет ограничить разрешение до одной очереди: "чтение сообщений из конечной точки служебной шины Azure `blah.servicebus.windows.net/queue1`"</span><span class="sxs-lookup"><span data-stu-id="059e6-271">For instance, applying scope to the previous example of reading from a Service Bus queue, you can narrow the permission to a single queue: "Read messages from Azure Service Bus endpoint `blah.servicebus.windows.net/queue1`"</span></span>

<span data-ttu-id="059e6-272">Область может быть такой же, как и один ресурс, или же ее можно применить ко всей группе ресурсов, подписке или даже к группе управления.</span><span class="sxs-lookup"><span data-stu-id="059e6-272">The scope can be as narrow as a single resource or it can be applied to an entire resource group, subscription, or even management group.</span></span>

<span data-ttu-id="059e6-273">При проверке того, имеет ли субъект безопасности определенные разрешения, учитывается сочетание роли и области.</span><span class="sxs-lookup"><span data-stu-id="059e6-273">When testing if a security principal has a certain permission, the combination of role and scope are taken into account.</span></span> <span data-ttu-id="059e6-274">Это сочетание обеспечивает мощный механизм авторизации.</span><span class="sxs-lookup"><span data-stu-id="059e6-274">This combination provides a powerful authorization mechanism.</span></span>

## <a name="deny"></a><span data-ttu-id="059e6-275">Запрещено</span><span class="sxs-lookup"><span data-stu-id="059e6-275">Deny</span></span>

<span data-ttu-id="059e6-276">Ранее для RBAC разрешены только правила "разрешить".</span><span class="sxs-lookup"><span data-stu-id="059e6-276">Previously, only "allow" rules were permitted for RBAC.</span></span> <span data-ttu-id="059e6-277">Это поведение сделало некоторые области сложными для сборки.</span><span class="sxs-lookup"><span data-stu-id="059e6-277">This behavior made some scopes complicated to build.</span></span> <span data-ttu-id="059e6-278">Например, разрешая субъекту безопасности доступ ко всем учетным записям хранения, за исключением одного, необходимо предоставить явное разрешение на потенциально неограниченный список учетных записей хранения.</span><span class="sxs-lookup"><span data-stu-id="059e6-278">For instance, allowing a security principal access to all storage accounts except one required granting explicit permission to a potentially endless list of storage accounts.</span></span> <span data-ttu-id="059e6-279">Каждый раз, когда новая учетная запись хранения была создана, ее необходимо добавить в этот список учетных записей.</span><span class="sxs-lookup"><span data-stu-id="059e6-279">Every time a new storage account was created, it would have to be added to this list of accounts.</span></span> <span data-ttu-id="059e6-280">Это дополнительные затраты на управление, которые наверняка не были желательны.</span><span class="sxs-lookup"><span data-stu-id="059e6-280">This added management overhead that certainly wasn't desirable.</span></span>

<span data-ttu-id="059e6-281">Правила запрета имеют приоритет над разрешающими правилами.</span><span class="sxs-lookup"><span data-stu-id="059e6-281">Deny rules take precedence over allow rules.</span></span> <span data-ttu-id="059e6-282">Теперь, представляя ту же область "разрешить все, кроме одной", можно представить в виде двух правил "разрешить все" и "отклонить только один из них".</span><span class="sxs-lookup"><span data-stu-id="059e6-282">Now representing the same "allow all but one" scope could be represented as two rules "allow all" and "deny this one specific one".</span></span> <span data-ttu-id="059e6-283">Запрещает использовать правила не только для упрощения управления, но и для обеспечения дополнительной безопасности ресурсов, запретив доступ всем.</span><span class="sxs-lookup"><span data-stu-id="059e6-283">Deny rules not only ease management but allow for resources that are extra secure by denying access to everybody.</span></span>

## <a name="checking-access"></a><span data-ttu-id="059e6-284">Проверка доступа</span><span class="sxs-lookup"><span data-stu-id="059e6-284">Checking access</span></span>

<span data-ttu-id="059e6-285">Как можно себе представить, наличие большого количества ролей и областей может значительно усложнить эффективное разрешение субъекта-службы.</span><span class="sxs-lookup"><span data-stu-id="059e6-285">As you can imagine, having a large number of roles and scopes can make figuring out the effective permission of a service principal quite difficult.</span></span> <span data-ttu-id="059e6-286">Накапливаться запрещает правила поверх этого, только увеличивает сложность.</span><span class="sxs-lookup"><span data-stu-id="059e6-286">Piling deny rules on top of that, only serves to increase the complexity.</span></span> <span data-ttu-id="059e6-287">К счастью, есть Калькулятор разрешений, который может показывать действующие разрешения для любого субъекта-службы.</span><span class="sxs-lookup"><span data-stu-id="059e6-287">Fortunately, there's a permissions calculator that can show the effective permissions for any service principal.</span></span> <span data-ttu-id="059e6-288">Обычно он находится на вкладке IAM на портале, как показано на рисунке 10-3.</span><span class="sxs-lookup"><span data-stu-id="059e6-288">It's typically found under the IAM tab in the portal, as shown in Figure 10-3.</span></span>

<span data-ttu-id="059e6-289">![рис. 10-4. Калькулятор разрешений для службы приложений](./media/check-rbac.png)
**рис. 10-4**.</span><span class="sxs-lookup"><span data-stu-id="059e6-289">![Figure 10-4 Permission calculator for an app service](./media/check-rbac.png)
**Figure 10-4**.</span></span> <span data-ttu-id="059e6-290">Калькулятор разрешений для службы приложений.</span><span class="sxs-lookup"><span data-stu-id="059e6-290">Permission calculator for an app service.</span></span>

## <a name="securing-secrets"></a><span data-ttu-id="059e6-291">Защита секретов</span><span class="sxs-lookup"><span data-stu-id="059e6-291">Securing secrets</span></span>

<span data-ttu-id="059e6-292">Пароли и сертификаты представляют собой распространенный вектор атаки для злоумышленников.</span><span class="sxs-lookup"><span data-stu-id="059e6-292">Passwords and certificates are a common attack vector for attackers.</span></span> <span data-ttu-id="059e6-293">Устройство взлома паролей может выполнять атаки методом подбора и пытаться угадать миллиарды паролей в секунду.</span><span class="sxs-lookup"><span data-stu-id="059e6-293">Password-cracking hardware can do a  brute-force attack and try to guess billions of passwords per second.</span></span> <span data-ttu-id="059e6-294">Поэтому важно, чтобы пароли, используемые для доступа к ресурсам, были надежными, с большим количеством символов.</span><span class="sxs-lookup"><span data-stu-id="059e6-294">So it's important that the passwords that are used to access resources are strong, with a large variety of characters.</span></span> <span data-ttu-id="059e6-295">Эти пароли — именно те пароли, которые практически невозможно запомнить.</span><span class="sxs-lookup"><span data-stu-id="059e6-295">These passwords are exactly the kind of passwords that are near impossible to remember.</span></span> <span data-ttu-id="059e6-296">К счастью, пароли в Azure не должны быть известны ни одним человеком.</span><span class="sxs-lookup"><span data-stu-id="059e6-296">Fortunately, the passwords in Azure don't actually need to be known by any human.</span></span>

<span data-ttu-id="059e6-297">Многие эксперты по безопасности [предполагают](https://www.troyhunt.com/password-managers-dont-have-to-be-perfect-they-just-have-to-be-better-than-not-having-one/) , что использование диспетчера паролей для сохранения собственных паролей является лучшим способом.</span><span class="sxs-lookup"><span data-stu-id="059e6-297">Many security [experts suggest](https://www.troyhunt.com/password-managers-dont-have-to-be-perfect-they-just-have-to-be-better-than-not-having-one/) that using a password manager to keep your own passwords is the best approach.</span></span> <span data-ttu-id="059e6-298">Хотя он централизует пароли в одном месте, он также позволяет использовать сложные пароли и обеспечивать их уникальность для каждой учетной записи.</span><span class="sxs-lookup"><span data-stu-id="059e6-298">While it centralizes your passwords in one location, it also allows using highly complex passwords and ensuring they're unique for each account.</span></span> <span data-ttu-id="059e6-299">Эта же система существует в Azure: центральное хранилище для секретов.</span><span class="sxs-lookup"><span data-stu-id="059e6-299">The same system exists within Azure: a central store for secrets.</span></span>

## <a name="azure-key-vault"></a><span data-ttu-id="059e6-300">Хранилище ключей Azure;</span><span class="sxs-lookup"><span data-stu-id="059e6-300">Azure Key Vault</span></span>

<span data-ttu-id="059e6-301">Azure Key Vault предоставляет централизованное расположение для хранения паролей для таких объектов, как базы данных, ключи API и сертификаты.</span><span class="sxs-lookup"><span data-stu-id="059e6-301">Azure Key Vault provides a centralized location to store passwords for things such as databases, API keys, and certificates.</span></span> <span data-ttu-id="059e6-302">После введения секрета в хранилище он никогда не отображается снова, и команды для их извлечения и просмотра становятся намеренно сложными.</span><span class="sxs-lookup"><span data-stu-id="059e6-302">Once a secret is entered into the Vault, it's never shown again and the commands to extract and view it are purposefully complicated.</span></span> <span data-ttu-id="059e6-303">Информация в безопасности защищена с помощью шифрования программного обеспечения или FIPS 140-2 уровня 2 проверенных аппаратных модулей безопасности.</span><span class="sxs-lookup"><span data-stu-id="059e6-303">The information in the safe is protected using either software encryption or FIPS 140-2 Level 2 validated Hardware Security Modules.</span></span>

<span data-ttu-id="059e6-304">Доступ к хранилищу ключей осуществляется через RBAC, что означает, что не только пользователь может получить доступ к информации в хранилище.</span><span class="sxs-lookup"><span data-stu-id="059e6-304">Access to the key vault is provided through RBACs, meaning that not just any user can access the information in the vault.</span></span> <span data-ttu-id="059e6-305">Предположим, что веб-приложению нужно получить доступ к строке подключения к базе данных, хранящейся в Azure Key Vault.</span><span class="sxs-lookup"><span data-stu-id="059e6-305">Say a web application wishes to access the database connection string stored in Azure Key Vault.</span></span> <span data-ttu-id="059e6-306">Чтобы получить доступ, приложения должны работать с помощью субъекта-службы.</span><span class="sxs-lookup"><span data-stu-id="059e6-306">To gain access, applications need to run using a service principal.</span></span> <span data-ttu-id="059e6-307">В рамках этой предпринятой роли они могут считывать секреты из безопасного.</span><span class="sxs-lookup"><span data-stu-id="059e6-307">Under this assumed role, they can read the secrets from the safe.</span></span> <span data-ttu-id="059e6-308">Существует ряд различных параметров безопасности, которые могут дополнительно ограничить доступ приложения к хранилищу, чтобы не обновлять секреты, но только считывать их.</span><span class="sxs-lookup"><span data-stu-id="059e6-308">There are a number of different security settings that can further limit the access that an application has to the vault, so that it can't update secrets but only read them.</span></span>

<span data-ttu-id="059e6-309">Доступ к хранилищу ключей можно отслеживать, чтобы обеспечить доступ к хранилищу только ожидаемым приложениям.</span><span class="sxs-lookup"><span data-stu-id="059e6-309">Access to the key vault can be monitored to ensure that only the expected applications are accessing the vault.</span></span> <span data-ttu-id="059e6-310">Журналы можно интегрировать обратно в Azure Monitor, разблокируя возможность настройки оповещений при обнаружении непредвиденных условий.</span><span class="sxs-lookup"><span data-stu-id="059e6-310">The logs can be integrated back into Azure Monitor, unlocking the ability to set up alerts when unexpected conditions are encountered.</span></span>

## <a name="kubernetes"></a><span data-ttu-id="059e6-311">Kubernetes</span><span class="sxs-lookup"><span data-stu-id="059e6-311">Kubernetes</span></span>

<span data-ttu-id="059e6-312">В Kubernetes существует аналогичная служба для обслуживания небольших фрагментов секретной информации.</span><span class="sxs-lookup"><span data-stu-id="059e6-312">Within Kubernetes, there's a similar service for maintaining small pieces of secret information.</span></span> <span data-ttu-id="059e6-313">Секреты Kubernetes можно задать с помощью обычного исполняемого файла `kubectl`.</span><span class="sxs-lookup"><span data-stu-id="059e6-313">Kubernetes Secrets can be set via the typical `kubectl` executable.</span></span>

<span data-ttu-id="059e6-314">Создание секрета так же просто, как поиск версии Base64 сохраняемых значений:</span><span class="sxs-lookup"><span data-stu-id="059e6-314">Creating a secret is as simple as finding the base64 version of the values to be stored:</span></span>

```console
echo -n 'admin' | base64
YWRtaW4=
echo -n '1f2d1e2e67df' | base64
MWYyZDFlMmU2N2Rm
```

<span data-ttu-id="059e6-315">Затем добавьте его в секретный файл с именем `secret.yml` например, как показано в следующем примере:</span><span class="sxs-lookup"><span data-stu-id="059e6-315">Then adding it to a secrets file named `secret.yml` for example that looks similar to the following example:</span></span>

```yml
apiVersion: v1
kind: Secret
metadata:
  name: mysecret
type: Opaque
data:
  username: YWRtaW4=
  password: MWYyZDFlMmU2N2Rm
```

<span data-ttu-id="059e6-316">Наконец, этот файл можно загрузить в Kubernetes, выполнив следующую команду:</span><span class="sxs-lookup"><span data-stu-id="059e6-316">Finally, this file can be loaded into Kubernetes by running the following command:</span></span>

```console
kubectl apply -f ./secret.yaml
```

<span data-ttu-id="059e6-317">Эти секреты затем можно подключить к томам или предоставить процессам контейнеров через переменные среды.</span><span class="sxs-lookup"><span data-stu-id="059e6-317">These secrets can then be mounted into volumes or exposed to container processes through environment variables.</span></span> <span data-ttu-id="059e6-318">Подход к созданию приложений из [двенадцати факторов](https://12factor.net/) предполагает использование наименьшего общего знаменателя для передачи параметров в приложение.</span><span class="sxs-lookup"><span data-stu-id="059e6-318">The [Twelve-factor app](https://12factor.net/) approach to building applications suggests using the lowest common denominator to transmit settings to an application.</span></span> <span data-ttu-id="059e6-319">Переменные среды — это самый низкий общий знаменатель, так как они поддерживаются независимо от операционной системы или приложения.</span><span class="sxs-lookup"><span data-stu-id="059e6-319">Environment variables are the lowest common denominator, because they're supported no matter the operating system or application.</span></span>

<span data-ttu-id="059e6-320">Альтернативой использованию встроенных секретов Kubernetes является доступ к секретам в Azure Key Vault из Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="059e6-320">An alternative to use the built-in Kubernetes secrets is to access the secrets in Azure Key Vault from within Kubernetes.</span></span> <span data-ttu-id="059e6-321">Самый простой способ сделать это — присвоить роль RBAC контейнеру для загрузки секретов.</span><span class="sxs-lookup"><span data-stu-id="059e6-321">The simplest way to do this is to assign an RBAC role to the container looking to load secrets.</span></span> <span data-ttu-id="059e6-322">Затем приложение может использовать Azure Key Vault интерфейсы API для доступа к секретам.</span><span class="sxs-lookup"><span data-stu-id="059e6-322">The application can then use the Azure Key Vault APIs to access the secrets.</span></span> <span data-ttu-id="059e6-323">Однако этот подход требует внесения изменений в код и не соответствует шаблону использования переменных среды.</span><span class="sxs-lookup"><span data-stu-id="059e6-323">However, this approach requires modifications to the code and doesn't follow the pattern of using environment variables.</span></span> <span data-ttu-id="059e6-324">Вместо этого можно внедрять значения в контейнер с помощью [Azure Key Vault инжектор](https://mrdevops.io/introducing-azure-key-vault-to-kubernetes-931f82364354).</span><span class="sxs-lookup"><span data-stu-id="059e6-324">Instead, it's possible to inject values into a container through the use of the [Azure Key Vault Injector](https://mrdevops.io/introducing-azure-key-vault-to-kubernetes-931f82364354).</span></span> <span data-ttu-id="059e6-325">Этот подход на самом деле более безопасен, чем использование секретов Kubernetes напрямую, так как к ним могут обращаться пользователи в кластере.</span><span class="sxs-lookup"><span data-stu-id="059e6-325">This approach is actually more secure than using the Kubernetes secrets directly, as they can be accessed by users on the cluster.</span></span>

## <a name="encryption-in-transit-and-at-rest"></a><span data-ttu-id="059e6-326">Шифрование при передаче и при хранении</span><span class="sxs-lookup"><span data-stu-id="059e6-326">Encryption in transit and at rest</span></span>

<span data-ttu-id="059e6-327">Обеспечение безопасности данных имеет большое значение, так как оно находится на диске или перемещается между различными службами.</span><span class="sxs-lookup"><span data-stu-id="059e6-327">Keeping data safe is important whether it's on disk or transiting between various different services.</span></span> <span data-ttu-id="059e6-328">Самый эффективный способ избежать утечки данных — это шифровать их в формате, который не может быть легко прочитан другими пользователями.</span><span class="sxs-lookup"><span data-stu-id="059e6-328">The most effective way to keep data from leaking is to encrypt it into a format that can't be easily read by others.</span></span> <span data-ttu-id="059e6-329">Azure поддерживает широкий спектр вариантов шифрования.</span><span class="sxs-lookup"><span data-stu-id="059e6-329">Azure supports a wide range of encryption options.</span></span>

### <a name="in-transit"></a><span data-ttu-id="059e6-330">При передаче</span><span class="sxs-lookup"><span data-stu-id="059e6-330">In transit</span></span>

<span data-ttu-id="059e6-331">Существует несколько способов шифрования трафика в сети в Azure.</span><span class="sxs-lookup"><span data-stu-id="059e6-331">There are several ways to encrypt traffic on the network in Azure.</span></span> <span data-ttu-id="059e6-332">Доступ к службам Azure обычно осуществляется через соединения, использующие протокол TLS.</span><span class="sxs-lookup"><span data-stu-id="059e6-332">The access to Azure services is typically done over connections that use Transport Layer Security (TLS).</span></span> <span data-ttu-id="059e6-333">Например, для всех подключений к API Azure требуются TLS-подключения.</span><span class="sxs-lookup"><span data-stu-id="059e6-333">For instance, all the connections to the Azure APIs require TLS connections.</span></span> <span data-ttu-id="059e6-334">Аналогично, подключения к конечным точкам в службе хранилища Azure могут быть ограничены для работы только через TLS зашифрованные соединения.</span><span class="sxs-lookup"><span data-stu-id="059e6-334">Equally, connections to endpoints in Azure storage can be restricted to work only over TLS encrypted connections.</span></span>

<span data-ttu-id="059e6-335">TLS — это сложный протокол, который просто гарантирует, что соединение использует TLS, не достаточным для обеспечения безопасности.</span><span class="sxs-lookup"><span data-stu-id="059e6-335">TLS is a complicated protocol and simply knowing that the connection is using TLS isn't sufficient to ensure security.</span></span> <span data-ttu-id="059e6-336">Например, TLS 1,0 стабильно небезопасно, а TLS 1,1 не намного лучше.</span><span class="sxs-lookup"><span data-stu-id="059e6-336">For instance, TLS 1.0 is chronically insecure, and TLS 1.1 isn't much better.</span></span> <span data-ttu-id="059e6-337">Даже в версиях TLS существуют различные параметры, которые могут упростить расшифровку подключений.</span><span class="sxs-lookup"><span data-stu-id="059e6-337">Even within the versions of TLS, there are various settings that can make the connections easier to decrypt.</span></span> <span data-ttu-id="059e6-338">Лучше всего проверить, использует ли подключение к серверу обновленные и правильно настроенные протоколы.</span><span class="sxs-lookup"><span data-stu-id="059e6-338">The best course of action is to check and see if the server connection is using up-to-date and well configured protocols.</span></span>

<span data-ttu-id="059e6-339">Эту проверку можно выполнить с помощью внешней службы, такой как проверка сервера SSL в лаборатории SSL.</span><span class="sxs-lookup"><span data-stu-id="059e6-339">This check can be done by an external service such as SSL labs' SSL Server Test.</span></span> <span data-ttu-id="059e6-340">Тестовый запуск для обычной конечной точки Azure, в данном случае конечной точки служебной шины, дает близкий к идеальному показателю.</span><span class="sxs-lookup"><span data-stu-id="059e6-340">A test run against a typical Azure endpoint, in this case a service bus endpoint, yields a near perfect score of A.</span></span>

<span data-ttu-id="059e6-341">Даже службы, такие как базы данных SQL Azure, используют шифрование TLS для сохранения скрытых данных.</span><span class="sxs-lookup"><span data-stu-id="059e6-341">Even services like Azure SQL databases use TLS encryption to keep data hidden.</span></span> <span data-ttu-id="059e6-342">Интересная часть, посвященная шифрованию данных при передаче с помощью TLS, заключается в том, что невозможно даже в корпорации Майкрософт ожидать подключения между компьютерами, на которых выполняется TLS.</span><span class="sxs-lookup"><span data-stu-id="059e6-342">The interesting part about encrypting the data in transit using TLS is that it isn't possible, even for Microsoft, to listen in on the connection between computers running TLS.</span></span> <span data-ttu-id="059e6-343">Это должно быть удобным для компаний, которые связаны с тем, что их данные могут быть подвержены риску от Microsoft правильного или даже субъекта штата с большим количеством ресурсов, чем у стандартного злоумышленника.</span><span class="sxs-lookup"><span data-stu-id="059e6-343">This should provide comfort for companies concerned that their data may be at risk from Microsoft proper or even a state actor with more resources than the standard attacker.</span></span>

<span data-ttu-id="059e6-344">![рис. 10-5. отчет по лабораториям SSL, в котором показана оценка для конечной точки служебной шины.](./media/ssl-report.png)
**рис. 10-5**.</span><span class="sxs-lookup"><span data-stu-id="059e6-344">![Figure 10-5 SSL labs report showing a score of A for a Service Bus endpoint.](./media/ssl-report.png)
**Figure 10-5**.</span></span> <span data-ttu-id="059e6-345">Отчет о лабораториях SSL, в котором показана оценка для конечной точки служебной шины.</span><span class="sxs-lookup"><span data-stu-id="059e6-345">SSL labs report showing a score of A for a Service Bus endpoint.</span></span>

<span data-ttu-id="059e6-346">Хотя этот уровень шифрования не будет достаточным для всего времени, он должен вдохновить уверенность в том, что подключения Azure TLS являются весьма безопасными.</span><span class="sxs-lookup"><span data-stu-id="059e6-346">While this level of encryption isn't going to be sufficient for all time, it should inspire confidence that Azure TLS connections are quite secure.</span></span> <span data-ttu-id="059e6-347">Azure продолжит развивать свои стандарты безопасности по мере улучшения шифрования.</span><span class="sxs-lookup"><span data-stu-id="059e6-347">Azure will continue to evolve its security standards as encryption improves.</span></span> <span data-ttu-id="059e6-348">Хорошо, что кто – то уже смотрит стандарты безопасности и обновляет Azure по мере их улучшения.</span><span class="sxs-lookup"><span data-stu-id="059e6-348">It's nice to know that there's somebody watching the security standards and updating Azure as they improve.</span></span>

### <a name="at-rest"></a><span data-ttu-id="059e6-349">Неактивных</span><span class="sxs-lookup"><span data-stu-id="059e6-349">At rest</span></span>

<span data-ttu-id="059e6-350">В любом приложении существует ряд мест, где данные хранятся на диске.</span><span class="sxs-lookup"><span data-stu-id="059e6-350">In any application, there are a number of places where data rests on disk.</span></span> <span data-ttu-id="059e6-351">Сам код приложения загружается из механизма хранения.</span><span class="sxs-lookup"><span data-stu-id="059e6-351">The application code itself is loaded from some storage mechanism.</span></span> <span data-ttu-id="059e6-352">В большинстве приложений также используется некоторый тип базы данных, например SQL Server, Cosmos DB или даже эффективное экономичное хранилище таблиц.</span><span class="sxs-lookup"><span data-stu-id="059e6-352">Most applications also use some kind of database such as SQL Server, Cosmos DB, or even the amazingly price-efficient Table Storage.</span></span> <span data-ttu-id="059e6-353">Все эти базы данных используют сильно зашифрованное хранилище, чтобы гарантировать, что никто, кроме приложений с соответствующими разрешениями, сможет считывать данные.</span><span class="sxs-lookup"><span data-stu-id="059e6-353">These databases all use heavily encrypted storage to ensure that nobody other than the applications with proper permissions can read your data.</span></span> <span data-ttu-id="059e6-354">Даже системные операторы не могут считывать данные, которые были зашифрованы.</span><span class="sxs-lookup"><span data-stu-id="059e6-354">Even the system operators can't read data that has been encrypted.</span></span> <span data-ttu-id="059e6-355">Поэтому клиенты могут оставаться уверенными в том, что секретные данные остаются секретными.</span><span class="sxs-lookup"><span data-stu-id="059e6-355">So customers can remain confident their secret information remains secret.</span></span>

### <a name="storage"></a><span data-ttu-id="059e6-356">Хранилище</span><span class="sxs-lookup"><span data-stu-id="059e6-356">Storage</span></span>

<span data-ttu-id="059e6-357">Лежащая в Azure является подсистемой хранилища Azure.</span><span class="sxs-lookup"><span data-stu-id="059e6-357">The underpinning of much of Azure is the Azure Storage engine.</span></span> <span data-ttu-id="059e6-358">Диски виртуальной машины подключены поверх хранилища Azure.</span><span class="sxs-lookup"><span data-stu-id="059e6-358">Virtual machine disks are mounted on top of Azure Storage.</span></span> <span data-ttu-id="059e6-359">Службы Azure Kubernetes Services выполняются на виртуальных машинах, которые сами располагаются в службе хранилища Azure.</span><span class="sxs-lookup"><span data-stu-id="059e6-359">Azure Kubernetes Services run on virtual machines that, themselves, are hosted on Azure Storage.</span></span> <span data-ttu-id="059e6-360">Даже бессерверные технологии, такие как приложения функций Azure и экземпляры контейнеров Azure, запустили диск, который входит в состав службы хранилища Azure.</span><span class="sxs-lookup"><span data-stu-id="059e6-360">Even serverless technologies, such as Azure Functions Apps and Azure Container Instances, run out of disk that is part of Azure Storage.</span></span>

<span data-ttu-id="059e6-361">Если служба хранилища Azure хорошо зашифрована, она предоставляет основу для большинства других элементов, которые также должны быть зашифрованы.</span><span class="sxs-lookup"><span data-stu-id="059e6-361">If Azure Storage is well encrypted, then it provides for a foundation for most everything else to also be encrypted.</span></span> <span data-ttu-id="059e6-362">Служба хранилища Azure [шифруется](https://docs.microsoft.com/azure/storage/common/storage-service-encryption) с помощью стандарта [FIPS 140-2](https://en.wikipedia.org/wiki/FIPS_140) , совместимого с [256-разрядным AES](https://en.wikipedia.org/wiki/Advanced_Encryption_Standard).</span><span class="sxs-lookup"><span data-stu-id="059e6-362">Azure Storage [is encrypted](https://docs.microsoft.com/azure/storage/common/storage-service-encryption) with [FIPS 140-2](https://en.wikipedia.org/wiki/FIPS_140) compliant [256-bit AES](https://en.wikipedia.org/wiki/Advanced_Encryption_Standard).</span></span> <span data-ttu-id="059e6-363">Это хорошо организованная технология шифрования, которая была предметом обширной ознакомительной версии за последние 20 лет.</span><span class="sxs-lookup"><span data-stu-id="059e6-363">This is a well-regarded encryption technology having been the subject of extensive academic scrutiny over the last 20 or so years.</span></span> <span data-ttu-id="059e6-364">В настоящее время нет известной практичной атаки, которая позволит пользователям без знания ключа читать данные, зашифрованные с помощью AES.</span><span class="sxs-lookup"><span data-stu-id="059e6-364">At present, there's no known practical attack that would allow someone without knowledge of the key to read data encrypted by AES.</span></span>

<span data-ttu-id="059e6-365">По умолчанию ключи, используемые для шифрования хранилища Azure, управляются корпорацией Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="059e6-365">By default, the keys used for encrypting Azure Storage are managed by Microsoft.</span></span> <span data-ttu-id="059e6-366">Для предотвращения вредоносного доступа к этим ключам существуют широкие возможности защиты.</span><span class="sxs-lookup"><span data-stu-id="059e6-366">There are extensive protections in place to ensure to prevent malicious access to these keys.</span></span> <span data-ttu-id="059e6-367">Однако пользователи с определенными требованиями к шифрованию также могут [предоставлять собственные ключи хранения](https://docs.microsoft.com/azure/storage/common/storage-encryption-keys-powershell) , управляемые в Azure Key Vault.</span><span class="sxs-lookup"><span data-stu-id="059e6-367">However, users with particular encryption requirements can also [provide their own storage keys](https://docs.microsoft.com/azure/storage/common/storage-encryption-keys-powershell) that are managed in Azure Key Vault.</span></span> <span data-ttu-id="059e6-368">Эти ключи могут быть отозваны в любое время, что эффективно выводит содержимое учетной записи хранения, используя недоступные данные.</span><span class="sxs-lookup"><span data-stu-id="059e6-368">These keys can be revoked at any time, which would effectively render the contents of the Storage account using them inaccessible.</span></span>

<span data-ttu-id="059e6-369">Виртуальные машины используют зашифрованное хранилище, но можно предоставить другой уровень шифрования с помощью таких технологий, как BitLocker в Windows или DM-Encryption в Linux.</span><span class="sxs-lookup"><span data-stu-id="059e6-369">Virtual machines use encrypted storage, but it's possible to provide another layer of encryption by using technologies like BitLocker on Windows or DM-Crypt on Linux.</span></span> <span data-ttu-id="059e6-370">Эти технологии означают, что даже если образ диска был утечкой из хранилища, он останется практически недоступен для чтения.</span><span class="sxs-lookup"><span data-stu-id="059e6-370">These technologies mean that even if the disk image was leaked off of storage, it would remain near impossible to read it.</span></span>

### <a name="azure-sql"></a><span data-ttu-id="059e6-371">SQL Azure</span><span class="sxs-lookup"><span data-stu-id="059e6-371">Azure SQL</span></span>

<span data-ttu-id="059e6-372">Базы данных, размещенные в Azure SQL, используют технологию, именуемую [прозрачное шифрование данных (TDE)](/sql/relational-databases/security/encryption/transparent-data-encryption) , чтобы гарантировать, что данные останутся зашифрованными.</span><span class="sxs-lookup"><span data-stu-id="059e6-372">Databases hosted on Azure SQL use a technology called [Transparent Data Encryption (TDE)](/sql/relational-databases/security/encryption/transparent-data-encryption) to ensure data remains encrypted.</span></span> <span data-ttu-id="059e6-373">Он включен по умолчанию во всех вновь создаваемых базах данных SQL, но должен быть включен вручную для устаревших баз данных.</span><span class="sxs-lookup"><span data-stu-id="059e6-373">It's enabled by default on all newly created SQL databases, but must be enabled manually for legacy databases.</span></span> <span data-ttu-id="059e6-374">TDE выполняет шифрование и расшифровку в режиме реального времени не только для базы данных, но также резервных копий и журналов транзакций.</span><span class="sxs-lookup"><span data-stu-id="059e6-374">TDE executes real-time encryption and decryption of not just the database, but also the backups and transaction logs.</span></span>

<span data-ttu-id="059e6-375">Параметры шифрования хранятся в базе данных `master` и во время запуска считываются в память для выполнения оставшихся операций.</span><span class="sxs-lookup"><span data-stu-id="059e6-375">The encryption parameters are stored in the `master` database and, on startup, are read into memory for the remaining operations.</span></span> <span data-ttu-id="059e6-376">Это означает, что база данных `master` должна остаться незашифрованной.</span><span class="sxs-lookup"><span data-stu-id="059e6-376">This means that the `master` database must remain unencrypted.</span></span> <span data-ttu-id="059e6-377">Фактический ключ управляется корпорацией Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="059e6-377">The actual key is managed by Microsoft.</span></span> <span data-ttu-id="059e6-378">Тем не менее пользователи, имеющие точные требования к безопасности, могут предоставить собственный ключ в Key Vault практически так же, как и для службы хранилища Azure.</span><span class="sxs-lookup"><span data-stu-id="059e6-378">However, users with exacting security requirements may provide their own key in Key Vault in much the same way as is done for Azure Storage.</span></span> <span data-ttu-id="059e6-379">Key Vault предоставляет такие службы, как смена ключа и отзыв.</span><span class="sxs-lookup"><span data-stu-id="059e6-379">The Key Vault provides for such services as key rotation and revocation.</span></span>

<span data-ttu-id="059e6-380">"Прозрачная" часть TDS связана с тем, что нет изменений клиента, необходимых для использования зашифрованной базы данных.</span><span class="sxs-lookup"><span data-stu-id="059e6-380">The "Transparent" part of TDS comes from the fact that there aren't client changes needed to use an encrypted database.</span></span> <span data-ttu-id="059e6-381">Хотя такой подход обеспечивает хорошую безопасность, для расшифровки данных пользователям достаточно утечки пароля базы данных.</span><span class="sxs-lookup"><span data-stu-id="059e6-381">While this approach provides for good security, leaking the database password is enough for users to be able to decrypt the data.</span></span> <span data-ttu-id="059e6-382">Существует другой подход, который шифрует отдельные столбцы или таблицы в базе данных.</span><span class="sxs-lookup"><span data-stu-id="059e6-382">There's another approach that encrypts individual columns or tables in a database.</span></span> <span data-ttu-id="059e6-383">[Always encrypted](https://docs.microsoft.com/azure/sql-database/sql-database-always-encrypted-azure-key-vault) гарантирует, что зашифрованные данные не отображаются в виде обычного текста внутри базы данных.</span><span class="sxs-lookup"><span data-stu-id="059e6-383">[Always Encrypted](https://docs.microsoft.com/azure/sql-database/sql-database-always-encrypted-azure-key-vault) ensures that at no point the encrypted data appears in plain text inside the database.</span></span>

<span data-ttu-id="059e6-384">Настройка этого уровня шифрования требует запуска мастера в SQL Server Management Studio для выбора типа шифрования и места в Key Vault для хранения связанных ключей.</span><span class="sxs-lookup"><span data-stu-id="059e6-384">Setting up this tier of encryption requires running through a wizard in SQL Server Management Studio to select the sort of encryption and where in Key Vault to store the associated keys.</span></span>

<span data-ttu-id="059e6-385">![рис. 10-6. Выбор столбцов в таблице для шифрования с помощью Always Encrypted](./media/always-encrypted.png)
**рис. 10-6**.</span><span class="sxs-lookup"><span data-stu-id="059e6-385">![Figure 10-6 Selecting columns in a table to be encrypted using Always Encrypted](./media/always-encrypted.png)
**Figure 10-6**.</span></span> <span data-ttu-id="059e6-386">Выбор столбцов в таблице для шифрования с помощью Always Encrypted.</span><span class="sxs-lookup"><span data-stu-id="059e6-386">Selecting columns in a table to be encrypted using Always Encrypted.</span></span>

<span data-ttu-id="059e6-387">Клиентским приложениям, считывающим информацию из этих зашифрованных столбцов, необходимо предоставить специальные квоты для чтения зашифрованных данных.</span><span class="sxs-lookup"><span data-stu-id="059e6-387">Client applications that read information from these encrypted columns need to make special allowances to read encrypted data.</span></span> <span data-ttu-id="059e6-388">Строки подключения необходимо обновить с `Column Encryption Setting=Enabled` а учетные данные клиента необходимо получить из Key Vault.</span><span class="sxs-lookup"><span data-stu-id="059e6-388">Connection strings need to be updated with `Column Encryption Setting=Enabled` and client credentials must be retrieved from the Key Vault.</span></span> <span data-ttu-id="059e6-389">После этого клиент SQL Server должен быть зашифрован с помощью ключей шифрования столбцов.</span><span class="sxs-lookup"><span data-stu-id="059e6-389">The SQL Server client must then be primed with the column encryption keys.</span></span> <span data-ttu-id="059e6-390">После этого оставшиеся действия используют стандартные интерфейсы для клиента SQL.</span><span class="sxs-lookup"><span data-stu-id="059e6-390">Once that is done, the remaining actions use the standard interfaces to SQL Client.</span></span> <span data-ttu-id="059e6-391">Таким образом, такие средства, как Dapper и Entity Framework, построенные на основе клиента SQL, продолжат работать без изменений.</span><span class="sxs-lookup"><span data-stu-id="059e6-391">That is, tools like Dapper and Entity Framework, which are built on top of SQL Client, will continue to work without changes.</span></span> <span data-ttu-id="059e6-392">Always Encrypted может быть еще не доступна для каждого драйвера SQL Server на каждом языке.</span><span class="sxs-lookup"><span data-stu-id="059e6-392">Always Encrypted may not yet be available for every SQL Server driver on every language.</span></span>

<span data-ttu-id="059e6-393">Сочетание TDE и Always Encrypted, которые можно использовать с клиентскими ключами, гарантирует, что поддерживаются даже наиболее точные требования к шифрованию.</span><span class="sxs-lookup"><span data-stu-id="059e6-393">The combination of TDE and Always Encrypted, both of which can be used with client-specific keys, ensures that even the most exacting encryption requirements are supported.</span></span>

### <a name="cosmos-db"></a><span data-ttu-id="059e6-394">Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="059e6-394">Cosmos DB</span></span>

<span data-ttu-id="059e6-395">Cosmos DB — самая новая база данных, предоставляемая корпорацией Майкрософт в Azure.</span><span class="sxs-lookup"><span data-stu-id="059e6-395">Cosmos DB is the newest database provided by Microsoft in Azure.</span></span> <span data-ttu-id="059e6-396">Он был создан с нуля с учетом безопасности и шифрования.</span><span class="sxs-lookup"><span data-stu-id="059e6-396">It has been built from the ground up with security and cryptography in mind.</span></span> <span data-ttu-id="059e6-397">Шифрование AES-256bit является стандартным для всех баз данных Cosmos DB и не может быть отключено.</span><span class="sxs-lookup"><span data-stu-id="059e6-397">AES-256bit encryption is standard for all Cosmos DB databases and can't be disabled.</span></span> <span data-ttu-id="059e6-398">В сочетании с требованием TLS 1,2 для обмена данными все решение хранилища шифруется.</span><span class="sxs-lookup"><span data-stu-id="059e6-398">Coupled with the TLS 1.2 requirement for communication, the entire storage solution is encrypted.</span></span>

<span data-ttu-id="059e6-399">![рис. 10-7. поток шифрования данных в Cosmos DB](./media/cosmos-encryption.png)
**рис. 10-7**.</span><span class="sxs-lookup"><span data-stu-id="059e6-399">![Figure 10-7 The flow of data encryption within Cosmos DB](./media/cosmos-encryption.png)
**Figure 10-7**.</span></span> <span data-ttu-id="059e6-400">Поток шифрования данных в Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="059e6-400">The flow of data encryption within Cosmos DB.</span></span>

<span data-ttu-id="059e6-401">Несмотря на то, что Cosmos DB не предоставляет ключи шифрования клиентов, группа выполнила значительную работу, чтобы обеспечить соответствие требованиям PCI-DSS без этого.</span><span class="sxs-lookup"><span data-stu-id="059e6-401">While Cosmos DB doesn't provide for supplying customer encryption keys, there has been significant work done by the team to ensure it remains PCI-DSS compliant without that.</span></span> <span data-ttu-id="059e6-402">Cosmos DB также не поддерживает любое шифрование одного столбца, аналогичное Always Encrypted SQL Azure.</span><span class="sxs-lookup"><span data-stu-id="059e6-402">Cosmos DB also doesn't support any sort of single column encryption similar to Azure SQL's Always Encrypted yet.</span></span>

## <a name="keeping-secure"></a><span data-ttu-id="059e6-403">Обеспечение безопасности</span><span class="sxs-lookup"><span data-stu-id="059e6-403">Keeping secure</span></span>

<span data-ttu-id="059e6-404">В Azure есть все необходимые средства для выпуска высокобезопасного продукта.</span><span class="sxs-lookup"><span data-stu-id="059e6-404">Azure has all the tools necessary to release a highly secure product.</span></span> <span data-ttu-id="059e6-405">Однако цепочка строго надежна, чем ее слабая ссылка.</span><span class="sxs-lookup"><span data-stu-id="059e6-405">However, a chain is only as strong as its weakest link.</span></span> <span data-ttu-id="059e6-406">Если приложения, развернутые на основе Azure, не разрабатывались с надлежащей защитой и хорошим аудитом безопасности, то они становятся слабой связью в цепочке.</span><span class="sxs-lookup"><span data-stu-id="059e6-406">If the applications deployed on top of Azure aren't developed with a proper security mindset and good security audits, then they become the weak link in the chain.</span></span> <span data-ttu-id="059e6-407">Существует множество замечательных средств статического анализа, библиотек шифрования и методов обеспечения безопасности, которые можно использовать, чтобы убедиться, что программное обеспечение, установленное в Azure, защищено как само Azure.</span><span class="sxs-lookup"><span data-stu-id="059e6-407">There are many great static analysis tools, encryption libraries, and security practices that can be used to ensure that the software installed on Azure is as secure as Azure itself.</span></span> <span data-ttu-id="059e6-408">Примеры включают в себя [статические средства анализа](https://www.whitesourcesoftware.com/), [библиотеки шифрования](https://www.libressl.org/)и [методики безопасности](https://azure.microsoft.com/resources/videos/red-vs-blue-internal-security-penetration-testing-of-microsoft-azure/).</span><span class="sxs-lookup"><span data-stu-id="059e6-408">Examples include [static analysis tools](https://www.whitesourcesoftware.com/), [encryption libraries](https://www.libressl.org/), and [security practices](https://azure.microsoft.com/resources/videos/red-vs-blue-internal-security-penetration-testing-of-microsoft-azure/).</span></span>

>[!div class="step-by-step"]
><span data-ttu-id="059e6-409">[Назад](security.md)
>[Вперед](devops.md)</span><span class="sxs-lookup"><span data-stu-id="059e6-409">[Previous](security.md)
[Next](devops.md)</span></span>
