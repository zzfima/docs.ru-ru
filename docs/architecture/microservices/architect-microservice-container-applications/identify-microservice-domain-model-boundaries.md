---
title: Определение границ модели предметной области для каждой микрослужбы
description: Изучите суть разделения большого приложения на микрослужбы для создания разумной архитектуры.
ms.date: 09/20/2018
ms.openlocfilehash: 9c433066dd8e93dbb09b15e58c9c85617775723d
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/14/2020
ms.locfileid: "71834418"
---
# <a name="identify-domain-model-boundaries-for-each-microservice"></a><span data-ttu-id="f2226-103">Определение границ модели предметной области для каждой микрослужбы</span><span class="sxs-lookup"><span data-stu-id="f2226-103">Identify domain-model boundaries for each microservice</span></span>

<span data-ttu-id="f2226-104">Границы и размеры модели для каждой микрослужбы необходимо определять не в целях мельчайшего разделения, хотя следует стремиться к минимальному размеру микрослужб.</span><span class="sxs-lookup"><span data-stu-id="f2226-104">The goal when identifying model boundaries and size for each microservice isn't to get to the most granular separation possible, although you should tend toward small microservices if possible.</span></span> <span data-ttu-id="f2226-105">Ваша цель — логичное разделение на основе ваших знаний о предметной области.</span><span class="sxs-lookup"><span data-stu-id="f2226-105">Instead, your goal should be to get to the most meaningful separation guided by your domain knowledge.</span></span> <span data-ttu-id="f2226-106">Главное не размер, а функционал.</span><span class="sxs-lookup"><span data-stu-id="f2226-106">The emphasis isn't on the size, but instead on business capabilities.</span></span> <span data-ttu-id="f2226-107">Кроме того, если для определенной области приложения требуется особая слаженность в связи с большим количеством зависимостей, это также указывает на необходимость создания отдельной микрослужбы.</span><span class="sxs-lookup"><span data-stu-id="f2226-107">In addition, if there's clear cohesion needed for a certain area of the application based on a high number of dependencies, that indicates the need for a single microservice, too.</span></span> <span data-ttu-id="f2226-108">Слаженность позволяет понять, как разделять или объединять микрослужбы.</span><span class="sxs-lookup"><span data-stu-id="f2226-108">Cohesion is a way to identify how to break apart or group together microservices.</span></span> <span data-ttu-id="f2226-109">Постепенно изучая предметную область, вы будете снова и снова менять размер микрослужб.</span><span class="sxs-lookup"><span data-stu-id="f2226-109">Ultimately, while you gain more knowledge about the domain, you should adapt the size of your microservice, iteratively.</span></span> <span data-ttu-id="f2226-110">Подбор правильного размера — это длительный процесс.</span><span class="sxs-lookup"><span data-stu-id="f2226-110">Finding the right size isn't a one-shot process.</span></span>

<span data-ttu-id="f2226-111">[Сэм Ньюмен](https://samnewman.io/), признанный специалист по микрослужбам и автор книги [Создание микросервисов](https://samnewman.io/books/building_microservices/), рекомендует создавать микрослужбы на основе ограниченного контекста (в рамках части предметной области), как было описано ранее.</span><span class="sxs-lookup"><span data-stu-id="f2226-111">[Sam Newman](https://samnewman.io/), a recognized promoter of microservices and author of the book [Building Microservices](https://samnewman.io/books/building_microservices/), highlights that you should design your microservices based on the Bounded Context (BC) pattern (part of domain-driven design), as introduced earlier.</span></span> <span data-ttu-id="f2226-112">В некоторых случаях ограниченный контекст может состоять из нескольких физических служб, но не наоборот.</span><span class="sxs-lookup"><span data-stu-id="f2226-112">Sometimes, a BC could be composed of several physical services, but not vice versa.</span></span>

<span data-ttu-id="f2226-113">Модель предметной области с определенными сущностями применяется в рамках конкретного ограниченного контекста или микрослужбы.</span><span class="sxs-lookup"><span data-stu-id="f2226-113">A domain model with specific domain entities applies within a concrete BC or microservice.</span></span> <span data-ttu-id="f2226-114">Ограниченный контекст разграничивает применение модели предметной области и дает разработчикам четкое представление о слаженности и возможности независимой разработки отдельных элементов.</span><span class="sxs-lookup"><span data-stu-id="f2226-114">A BC delimits the applicability of a domain model and gives developer team members a clear and shared understanding of what must be cohesive and what can be developed independently.</span></span> <span data-ttu-id="f2226-115">Такие же цели преследуются для микрослужб.</span><span class="sxs-lookup"><span data-stu-id="f2226-115">These are the same goals for microservices.</span></span>

<span data-ttu-id="f2226-116">Кроме того, при выборе структуры вам следует руководствоваться [законом Конвея](https://en.wikipedia.org/wiki/Conway%27s_law), который гласит, что приложение отражает социальные границы организации, создавшей его.</span><span class="sxs-lookup"><span data-stu-id="f2226-116">Another tool that informs your design choice is [Conway's law](https://en.wikipedia.org/wiki/Conway%27s_law), which states that an application will reflect the social boundaries of the organization that produced it.</span></span> <span data-ttu-id="f2226-117">Но иногда верно обратное — программное обеспечение формирует структуру организации.</span><span class="sxs-lookup"><span data-stu-id="f2226-117">But sometimes the opposite is true -the company's organization is formed by the software.</span></span> <span data-ttu-id="f2226-118">Попробуйте использовать закон Конвея в противоположную сторону и построить границы в соответствии со своими идеальными представлениями о компании, стараясь оптимизировать бизнес-процессы.</span><span class="sxs-lookup"><span data-stu-id="f2226-118">You might need to reverse Conway's law and build the boundaries the way you want the company to be organized, leaning toward business process consulting.</span></span>

<span data-ttu-id="f2226-119">Для определения ограниченных контекстов можно использовать шаблон DDD под названием [Шаблон сопоставления контекстов](https://www.infoq.com/articles/ddd-contextmapping).</span><span class="sxs-lookup"><span data-stu-id="f2226-119">To identify bounded contexts, you can use a DDD pattern called the [Context Mapping pattern](https://www.infoq.com/articles/ddd-contextmapping).</span></span> <span data-ttu-id="f2226-120">Сопоставляя контексты, вы определяете различные контексты в приложении и их границы.</span><span class="sxs-lookup"><span data-stu-id="f2226-120">With Context Mapping, you identify the various contexts in the application and their boundaries.</span></span> <span data-ttu-id="f2226-121">Как правило, существуют различные контексты и границы для каждой небольшой подсистемы.</span><span class="sxs-lookup"><span data-stu-id="f2226-121">It's common to have a different context and boundary for each small subsystem, for instance.</span></span> <span data-ttu-id="f2226-122">При сопоставлении контекстов становятся очевидными границы между предметными областями.</span><span class="sxs-lookup"><span data-stu-id="f2226-122">The Context Map is a way to define and make explicit those boundaries between domains.</span></span> <span data-ttu-id="f2226-123">Ограниченный контекст автономен и включает в себя элементы только одной предметной области, например сущности, а также определяет схему интеграции с другими ограниченными контекстами.</span><span class="sxs-lookup"><span data-stu-id="f2226-123">A BC is autonomous and includes the details of a single domain -details like the domain entities- and defines integration contracts with other BCs.</span></span> <span data-ttu-id="f2226-124">Этим он похож на микрослужбу: она автономна, реализует определенные возможности предметной области и обеспечивает интерфейсы.</span><span class="sxs-lookup"><span data-stu-id="f2226-124">This is similar to the definition of a microservice: it's autonomous, it implements certain domain capability, and it must provide interfaces.</span></span> <span data-ttu-id="f2226-125">Поэтому сопоставление контекстов и ограниченные контексты помогают определить границы модели предметной области для ваших микрослужб.</span><span class="sxs-lookup"><span data-stu-id="f2226-125">This is why Context Mapping and the Bounded Context pattern are good approaches for identifying the domain model boundaries of your microservices.</span></span>

<span data-ttu-id="f2226-126">При разработке крупного приложения вы увидите, как можно разделить его предметную область. Например, специалист по области каталога будет называть сущности в каталоге не так, как специалист по области доставки.</span><span class="sxs-lookup"><span data-stu-id="f2226-126">When designing a large application, you'll see how its domain model can be fragmented - a domain expert from the catalog domain will name entities differently in the catalog and inventory domains than a shipping domain expert, for instance.</span></span> <span data-ttu-id="f2226-127">Или сущность предметной области пользователя может отличаться по размеру и количеству атрибутов у специалиста по взаимодействию с клиентами, который хочет хранить все сведения о клиенте, и у специалиста по заказам, которому нужны лишь некоторые данные о клиенте.</span><span class="sxs-lookup"><span data-stu-id="f2226-127">Or the user domain entity might be different in size and number of attributes when dealing with a CRM expert who wants to store every detail about the customer than for an ordering domain expert who just needs partial data about the customer.</span></span> <span data-ttu-id="f2226-128">Очень трудно устранить неоднозначность всех терминов предметной области во всех областях в крупном приложении.</span><span class="sxs-lookup"><span data-stu-id="f2226-128">It's very hard to disambiguate all domain terms across all the domains related to a large application.</span></span> <span data-ttu-id="f2226-129">Но суть в том, что вам и не следует унифицировать термины.</span><span class="sxs-lookup"><span data-stu-id="f2226-129">But the most important thing is that you shouldn't try to unify the terms.</span></span> <span data-ttu-id="f2226-130">Просто примите различия и многообразие каждой предметной области.</span><span class="sxs-lookup"><span data-stu-id="f2226-130">Instead, accept the differences and richness provided by each domain.</span></span> <span data-ttu-id="f2226-131">Если вы попытаетесь создать единую базу данных для всего приложения, это будет непросто, и унифицированный словарь не устроит специалистов по разным областям.</span><span class="sxs-lookup"><span data-stu-id="f2226-131">If you try to have a unified database for the whole application, attempts at a unified vocabulary will be awkward and won't sound right to any of the multiple domain experts.</span></span> <span data-ttu-id="f2226-132">Поэтому ограниченные контексты (реализованные как микрослужбы) помогут понять, где можно использовать термины определенной предметной области и где следует разделить систему и создать дополнительные ограниченные контексты с другими предметными областями.</span><span class="sxs-lookup"><span data-stu-id="f2226-132">Therefore, BCs (implemented as microservices) will help you to clarify where you can use certain domain terms and where you'll need to split the system and create additional BCs with different domains.</span></span>

<span data-ttu-id="f2226-133">Вы поймете, что правильно выбрали границы и размеры всех ограниченных контекстов и моделей предметной области, если между этими моделями будет существовать несколько прочных связей, и вам не обязательно объединять информацию из нескольких моделей предметной области при выполнении типичных операций в приложении.</span><span class="sxs-lookup"><span data-stu-id="f2226-133">You'll know that you got the right boundaries and sizes of each BC and domain model if you have few strong relationships between domain models, and you do not usually need to merge information from multiple domain models when performing typical application operations.</span></span>

<span data-ttu-id="f2226-134">При выборе размера модели предметной области для каждой микрослужбы руководствуйтесь следующим принципом: у вас должен быть автономный и максимально изолированный ограниченный контекст, с которым можно работать без постоянного обращения к другим контекстам (другим моделям микрослужб).</span><span class="sxs-lookup"><span data-stu-id="f2226-134">Perhaps the best answer to the question of how large a domain model for each microservice should be is the following: it should have an autonomous BC, as isolated as possible, that enables you to work without having to constantly switch to other contexts (other microservice's models).</span></span> <span data-ttu-id="f2226-135">На рис. 4-10 показано, как несколько микрослужб (несколько ограниченных контекстов) могут иметь собственную модель и как их сущности могут быть определены в зависимости от конкретных требований для каждой предметной области в вашем приложении.</span><span class="sxs-lookup"><span data-stu-id="f2226-135">In Figure 4-10, you can see how multiple microservices (multiple BCs) each has their own model and how their entities can be defined, depending on the specific requirements for each of the identified domains in your application.</span></span>

![Схема, показывающая сущности в нескольких границах модели.](./media/identify-microservice-domain-model-boundaries/identify-entities-microservice-model-boundries.png)

<span data-ttu-id="f2226-137">**Рис. 4-10**.</span><span class="sxs-lookup"><span data-stu-id="f2226-137">**Figure 4-10**.</span></span> <span data-ttu-id="f2226-138">Определение сущностей и границ модели микрослужбы</span><span class="sxs-lookup"><span data-stu-id="f2226-138">Identifying entities and microservice model boundaries</span></span>

<span data-ttu-id="f2226-139">На рисунке 4-10 показан пример сценария, относящийся к системе управления сетевыми конференциями.</span><span class="sxs-lookup"><span data-stu-id="f2226-139">Figure 4-10 illustrates a sample scenario related to an online conference management system.</span></span> <span data-ttu-id="f2226-140">Та же сущность отображается как "Пользователи", "Покупатели", "Плательщики" и "Клиенты" в зависимости от ограниченного контекста.</span><span class="sxs-lookup"><span data-stu-id="f2226-140">The same entity appears as "Users", "Buyers", "Payers", and "Customers" depending on the bounded context.</span></span> <span data-ttu-id="f2226-141">Вы определяете несколько ограниченных контекстов, которые можно реализовать как микрослужбы, опираясь на предметные области, выбранные специалистами по этим областям.</span><span class="sxs-lookup"><span data-stu-id="f2226-141">You've identified several BCs that could be implemented as microservices, based on domains that domain experts defined for you.</span></span> <span data-ttu-id="f2226-142">Как видите, некоторые сущности представлены только в одной модели микрослужбы, например "Платежи" в микрослужбе оплаты.</span><span class="sxs-lookup"><span data-stu-id="f2226-142">As you can see, there are entities that are present just in a single microservice model, like Payments in the Payment microservice.</span></span> <span data-ttu-id="f2226-143">Это будет легко реализовать.</span><span class="sxs-lookup"><span data-stu-id="f2226-143">Those will be easy to implement.</span></span>

<span data-ttu-id="f2226-144">Но некоторые сущности могут иметь разные формы и один идентификатор в различных моделях предметных областей в различных микрослужбах.</span><span class="sxs-lookup"><span data-stu-id="f2226-144">However, you might also have entities that have a different shape but share the same identity across the multiple domain models from the multiple microservices.</span></span> <span data-ttu-id="f2226-145">Например, сущность "Пользователь" определена в микрослужбе управления конференциями.</span><span class="sxs-lookup"><span data-stu-id="f2226-145">For example, the User entity is identified in the Conferences Management microservice.</span></span> <span data-ttu-id="f2226-146">Тот же пользователь и с тем же идентификатором называется "Покупатель" в микрослужбе заказов, "Плательщик" в микрослужбе платежей и "Клиент" в микрослужбе клиентской службы.</span><span class="sxs-lookup"><span data-stu-id="f2226-146">That same user, with the same identity, is the one named Buyers in the Ordering microservice, or the one named Payer in the Payment microservice, and even the one named Customer in the Customer Service microservice.</span></span> <span data-ttu-id="f2226-147">Дело в том, что каждый специалист в предметной области использует [единый язык](https://martinfowler.com/bliki/UbiquitousLanguage.html), по-своему воспринимает пользователя и приписывает ему разные атрибуты.</span><span class="sxs-lookup"><span data-stu-id="f2226-147">This is because, depending on the [ubiquitous language](https://martinfowler.com/bliki/UbiquitousLanguage.html) that each domain expert is using, a user might have a different perspective even with different attributes.</span></span> <span data-ttu-id="f2226-148">Сущность пользователя в модели микрослужбы для управления конференциями содержит его персональные данные.</span><span class="sxs-lookup"><span data-stu-id="f2226-148">The user entity in the microservice model named Conferences Management might have most of its personal data attributes.</span></span> <span data-ttu-id="f2226-149">Но эти атрибуты могут не понадобиться этому же пользователю в роли плательщика в микрослужбе оплаты или в роли клиента в микрослужбе клиентской службы.</span><span class="sxs-lookup"><span data-stu-id="f2226-149">However, that same user in the shape of Payer in the microservice Payment or in the shape of Customer in the microservice Customer Service might not need the same list of attributes.</span></span>

<span data-ttu-id="f2226-150">Подобный подход проиллюстрирован на рис. 4-11.</span><span class="sxs-lookup"><span data-stu-id="f2226-150">A similar approach is illustrated in Figure 4-11.</span></span>

![Диаграмма, показывающая, как разбить модель данных на несколько моделей предметной области.](./media/identify-microservice-domain-model-boundaries/decompose-traditional-data-models.png)

<span data-ttu-id="f2226-152">**Рис. 4-11**.</span><span class="sxs-lookup"><span data-stu-id="f2226-152">**Figure 4-11**.</span></span> <span data-ttu-id="f2226-153">Разбиение традиционных моделей данных на несколько моделей предметной области</span><span class="sxs-lookup"><span data-stu-id="f2226-153">Decomposing traditional data models into multiple domain models</span></span>

<span data-ttu-id="f2226-154">При декомпозиции традиционной модели данных между ограниченными контекстами у вас может быть несколько сущностей, которые совместно используют одно удостоверение (покупатель также является пользователем), с различными атрибутами в каждом ограниченном контексте.</span><span class="sxs-lookup"><span data-stu-id="f2226-154">When decomposing a traditional data model between bounded contexts, you can have different entities that share the same identity (a buyer is also a user) with different attributes in each bounded context.</span></span> <span data-ttu-id="f2226-155">Вы видите, что пользователь присутствует в модели микрослужбы для управления конференциями в виде сущности "Пользователь". А в микрослужбе ценообразования он представлен как сущность "Покупатель" и имеет другие атрибуты и данные.</span><span class="sxs-lookup"><span data-stu-id="f2226-155">You can see how the user is present in the Conferences Management microservice model as the User entity and is also present in the form of the Buyer entity in the Pricing microservice, with alternate attributes or details about the user when it's actually a buyer.</span></span> <span data-ttu-id="f2226-156">Отдельным микрослужбам или ограниченным контекстам не нужны все данные сущности "Пользователь", только их часть, в зависимости от актуальной проблемы или контекста.</span><span class="sxs-lookup"><span data-stu-id="f2226-156">Each microservice or BC might not need all the data related to a User entity, just part of it, depending on the problem to solve or the context.</span></span> <span data-ttu-id="f2226-157">Например, в модели микрослужбы ценообразования не нужен адрес или имя пользователя, только идентификатор и статус для определения скидки при назначении цены за место для покупателя.</span><span class="sxs-lookup"><span data-stu-id="f2226-157">For instance, in the Pricing microservice model, you do not need the address or the name of the user, just the ID (as identity) and Status, which will have an impact on discounts when pricing the seats per buyer.</span></span>

<span data-ttu-id="f2226-158">Сущность "Рабочее место" имеет одно название, но разные атрибуты в каждой модели предметной области.</span><span class="sxs-lookup"><span data-stu-id="f2226-158">The Seat entity has the same name but different attributes in each domain model.</span></span> <span data-ttu-id="f2226-159">Однако у сущности "Рабочее место" везде одинаковый идентификатор, как у "Пользователя" и "Покупателя".</span><span class="sxs-lookup"><span data-stu-id="f2226-159">However, Seat shares identity based on the same ID, as happens with User and Buyer.</span></span>

<span data-ttu-id="f2226-160">По сути, существует общее понятие пользователя в различных службах (предметных областях), где он имеет один и тот же идентификатор.</span><span class="sxs-lookup"><span data-stu-id="f2226-160">Basically, there's a shared concept of a user that exists in multiple services (domains), which all share the identity of that user.</span></span> <span data-ttu-id="f2226-161">Но в каждой модели предметной области указаны разные сведения о сущности пользователя.</span><span class="sxs-lookup"><span data-stu-id="f2226-161">But in each domain model there might be additional or different details about the user entity.</span></span> <span data-ttu-id="f2226-162">Поэтому нужен способ сопоставления сущности пользователя в разных предметных областях (или микрослужбах).</span><span class="sxs-lookup"><span data-stu-id="f2226-162">Therefore, there needs to be a way to map a user entity from one domain (microservice) to another.</span></span>

<span data-ttu-id="f2226-163">Отказ от использования одной сущности пользователя с одинаковым набором атрибутов в разных предметных областях имеет свои преимущества.</span><span class="sxs-lookup"><span data-stu-id="f2226-163">There are several benefits to not sharing the same user entity with the same number of attributes across domains.</span></span> <span data-ttu-id="f2226-164">Одно из них — устранение дублирования. Таким образом, модели микрослужб не будут хранить данные, которые им не нужны.</span><span class="sxs-lookup"><span data-stu-id="f2226-164">One benefit is to reduce duplication, so that microservice models do not have any data that they do not need.</span></span> <span data-ttu-id="f2226-165">Еще одно преимущество — наличие главной микрослужбы, которая отвечает за определенный тип данных сущности, чтобы обновления и запросы по этому типу данных управлялись только этой микрослужбой.</span><span class="sxs-lookup"><span data-stu-id="f2226-165">Another benefit is having a master microservice that owns a certain type of data per entity so that updates and queries for that type of data are driven only by that microservice.</span></span>

>[!div class="step-by-step"]
><span data-ttu-id="f2226-166">[Назад](distributed-data-management.md)
>[Вперед](direct-client-to-microservice-communication-versus-the-api-gateway-pattern.md)</span><span class="sxs-lookup"><span data-stu-id="f2226-166">[Previous](distributed-data-management.md)
[Next](direct-client-to-microservice-communication-versus-the-api-gateway-pattern.md)</span></span>
