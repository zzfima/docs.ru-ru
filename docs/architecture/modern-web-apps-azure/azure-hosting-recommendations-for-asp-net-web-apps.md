---
title: Рекомендации по размещению веб-приложений ASP.NET Core в Azure
description: Разработка современных веб-приложений с помощью ASP.NET Core и Azure | Рекомендации по размещению веб-приложений ASP.NET Core в Azure
author: ardalis
ms.author: wiwagn
ms.date: 06/06/2019
ms.openlocfilehash: 5587b8b20da8a6801d77b722e9c3326f6e695574
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/14/2020
ms.locfileid: "73416715"
---
# <a name="azure-hosting-recommendations-for-aspnet-core-web-apps"></a>Рекомендации по размещению веб-приложений ASP.NET Core в Azure

> "Руководители бизнес-подразделений обходятся без участия ИТ-отдела, без труда приобретая облачные приложения (SaaS) и оплачивая их по принципу подписки на журнал. После того как услуга больше не нужна, они могут просто отменить подписку, не оставляя после себя простаивающего без дела оборудования".  
> _\- Дэрил Пламмер (Daryl Plummer), аналитик Gartner_

Microsoft Azure обеспечит соответствие любым требованиям для приложений с любой архитектурой. Вы можете разместить самый простой статический веб-сайт или сложное приложение, состоящее из десятков служб. Для монолитных веб-приложений ASP.NET Core и вспомогательных услуг существует ряд хорошо известных рекомендуемых конфигураций. Приведенные в этой статье рекомендации сгруппированы по виду размещаемых ресурсов (полное приложение, отдельные процессы или данные).

## <a name="web-applications"></a>Веб-приложения

Вариант размещения веб-приложений:

- Веб-приложения службы приложений

- Контейнеры (несколько вариантов)

- Виртуальные машины

В большинстве сценариев рекомендуемый вариант — веб-приложения службы приложений, в том числе простые приложения на основе контейнеров. Для архитектуры микрослужб следует рассмотреть подход на основе контейнеров. Если вам требуется больший контроль над машинами, на которых выполняется ваше приложение, рассмотрите возможность использования виртуальных машин Azure.

### <a name="app-service-web-apps"></a>Веб-приложения службы приложений

Веб-приложения службы приложений предоставляют полностью управляемую платформу, оптимизированную для размещения веб-приложений. Это предложение на основе модели "платформа как услуга" (PaaS) позволяет вам сосредоточиться на бизнес-логике, передав все задачи по организации инфраструктуры для выполнения и масштабирования приложения на сторону Azure. Некоторые основные возможности веб-приложений служб приложений:

- Оптимизация принципов DevOps (непрерывная интеграция и поставка, несколько окружений, A/B-тестирование, поддержка скриптов).

- Глобальная масштабируемость и высокий уровень доступности.

- Подключения к платформам SaaS и локальным данным.

- Безопасность и соответствие требованиям.

- Интеграция Visual Studio.

Самым оптимальным вариантом для большинства веб-приложений является служба приложений Azure. Функции развертывания и управления интегрированы в платформу, обеспечивается возможность быстрого масштабирования сайтов для обработки больших объемов трафика, а встроенные компоненты балансировки нагрузки и диспетчера трафика позволяют гарантировать высокий уровень доступности. Вы можете перенести существующий сайт в службу приложений Azure с помощью средства миграции в Интернете, использовать специальное приложение с открытым исходным кодом из коллекции веб-приложений, а также создать новый сайт с помощью удобных для вас средств и платформы. С помощью функции веб-заданий вы можете с легкостью реализовать фоновую обработку заданий в своем веб-приложении службы приложений. Если у вас есть приложение ASP.NET, которое размещено локально и использует локальную базу данных, достаточно будет просто перенести его в Службу приложений Azure в виде веб-приложения с подключенной Базой данных SQL Azure (или безопасным доступом к вашему локальному серверу с базой данных, если такой вариант предпочтительней).

![Рекомендуемая стратегия переноса локальных приложений .NET в Службу приложений Azure](./media/image1-6.png)

В большинстве случаев перейти с локально размещенного приложения ASP.NET на веб-приложение Службы приложений очень просто. Само приложение практически не нужно изменять. Его можно быстро развернуть в облаке, где веб-приложению доступны преимущества, обеспечиваемые множеством функций Службы приложений.

Помимо приложений, которые не оптимизированы для облака, веб-приложения Службы приложений Azure станут оптимальным решением для простых монолитных (нераспределенных) приложений, как многие приложения ASP.NET Core. При таком подходе требуется базовая архитектура, простая в понимании и управлении:

![Базовая архитектура Azure](./media/image1-5.png)

Небольшого количества ресурсов в одной группе ресурсов, как правило, достаточно для управления таким приложением. Приложения, которые обычно развертываются как единое целое (в отличие от приложений, состоящих из множества отдельных процессов), — хороший вариант для такого [подхода с базовой архитектурой](https://docs.microsoft.com/azure/architecture/reference-architectures/app-service-web-app/basic-web-app). Несмотря на простую архитектуру, такой подход позволяет масштабировать размещенное приложение как вертикально (добавляя ресурсы в узлах), так и горизонтально (увеличивая количество узлов) в соответствии с ростом спроса. Автоматическое масштабирование позволяет настроить приложение для автоматической регулировки количества узлов, на которых размещается приложение, на основе показателей спроса и средней нагрузки узлов.

### <a name="app-service-web-apps-for-containers"></a>Веб-приложения службы приложений для контейнеров

В дополнение к поддержке непосредственного размещения веб-приложений, можно использовать [веб-приложения службы приложений для контейнеров](https://azure.microsoft.com/services/app-service/containers/) для запуска контейнерных приложений в Windows и Linux. Эта служба позволяет без труда развертывать и запускать контейнерные приложения, которые можно масштабировать по мере развития вашего бизнеса. Для таких приложений доступны все возможности веб-приложений службы приложений, перечисленные выше. Кроме того, веб-приложения для контейнеров поддерживают оптимизированный конвейер CI/CD с использованием Docker Hub, Реестра контейнеров Azure и GitHub. Определять конвейеры сборки и развертывания с публикацией изменений в реестр можно с помощью Azure DevOps. Эти изменения затем можно тестировать в промежуточной среде и автоматически развертывать в рабочей среде с помощью слотов развертывания, которые обеспечивают обновление без простоя. Возврат к предыдущей версии выполняется так же просто.

Веб-приложения для контейнеров особенно полезны в описанных ниже сценариях. Если у вас есть приложения, которые можно упаковать в контейнеры Windows или Linux, вы можете легко их разместить с помощью этого набора инструментов. Просто опубликуйте контейнер, а затем настройте веб-приложения для контейнеров, чтобы извлечь последнюю версию этого образа из реестра по выбору. Этот подход предусматривает миграцию без прекращения оптимизации приложения и переход с классической модели размещения на модель с оптимизацией для облачных сред.

![Перенос контейнерного локального приложения .NET в службу "Веб-приложения Azure для контейнеров"](./media/image1-8.png)

Такой подход также эффективен, если ваша команда разработчиков способна освоить процесс разработки на основе контейнеров. "Внутренний цикл" разработки приложений с контейнерами включает в себя сборку приложений с контейнерами. Изменения, внесенные в код и в конфигурацию контейнера, передаются в систему управления версиями. После этого система автоматизированной сборки публикует новые образы контейнера в реестре, таком как Docker Hub или Реестр контейнеров Azure. Эти образы затем используются в качестве основы для дополнительной разработки, а также для развертываний в рабочей среде, как показано на следующей схеме:

![Сквозной рабочий процесс жизненного цикла DevOps — Docker](./media/image1-7.png)

Разработка с использованием контейнеров имеет множество преимуществ, особенно если контейнеры используются в рабочей среде. Одну и ту же конфигурацию контейнера используют для размещения приложения в каждой среде, в которой оно запущено, — от локального компьютера разработки для сборки и тестирования до рабочей среды. Это значительно снижает вероятность возникновения конфликтов из-за различий в конфигурациях компьютеров или в версиях программного обеспечения. Разработчики также могут использовать любые удобные для них средства, включая ОС, так как контейнеры можно запускать в любой операционной системе. Иногда распределенные приложения с большим числом контейнеров могут оказаться крайне ресурсоемкими для запуска на одиночном компьютере разработки. В таком случае целесообразно воспользоваться Kubernetes и Azure Dev Spaces (см. следующий раздел).

Так как части больших приложений разделены на небольшие независимые *микрослужбы*, можно использовать другие модели организации разработки для улучшения работы приложения. Можно не работать непосредственно с отдельными службами, а использовать *шлюз API*, который упрощает доступ и позволяет размежевать клиент и его серверную часть. Наличие у службы отдельных серверных частей для разных внешних интерфейсов также позволяет службе развиваться вместе с ее пользователями. Доступ к стандартным службам можно обеспечить с помощью *сцепленного* контейнера, в котором могут находиться общие библиотеки подключения пользователей, и с использованием модели "*посол*".

![Пример архитектуры с микрослужбами и несколькими распространенными моделями организации разработки](./media/image1-10.png)

[Ознакомьтесь с дополнительными сведениями о моделях разработки, которые следует учитывать при создании систем на базе микрослужб.](https://docs.microsoft.com/azure/architecture/microservices/design/patterns)

### <a name="azure-kubernetes-service"></a>Служба контейнеров Azure

Служба контейнеров Azure (AKS) управляет размещенной средой Kubernetes, позволяя быстро и легко развертывать и администрировать контейнерные приложения даже без опыта оркестрации контейнеров. Также вам не нужно выполнять текущие операции и обслуживание, так как эта служба подготавливает, обновляет и масштабирует ресурсы по требованию, не отключая приложения от сети.

AKS снижает сложность и операционные затраты на управление кластером Kubernetes, перенося большую часть ответственности на Azure. Как размещенная служба, Kubernetes Azure отвечает за критические задачи, такие как мониторинг работоспособности и техническое обслуживание. Кроме того, вы платите только за узлы агентов в своих кластерах, а не за главные узлы. AKS как управляемая служба Kubernetes обеспечивает следующее:

- Автоматические обновления и исправления версий Kubernetes.
- Простое масштабирование кластеров.
- Самовосстанавливающуюся размещенную область управления (главные узлы).
- Сокращение затрат — вы платите только за выполняющиеся узлы пула агентов.

Так как за управление узлами в кластере AKS отвечает Azure, многие задачи больше не нужно выполнять вручную (например, обновление кластера). Так как Azure выполняет эти важные задачи обслуживания без вашего участия, AKS не предоставляет к кластеру прямой доступ (например, с помощью SSH).

Командам разработчиков, использующим AKS, также доступны преимущества, которые предоставляет Azure Dev Spaces. Azure Dev Spaces помогает командам сосредоточиться на разработке и быстрой последовательной доработке приложения для микрослужб, позволяя им работать непосредственно со всей архитектурой микрослужб или приложением в AKS. Azure Dev Spaces также обеспечивает независимое и изолированное обновление частей архитектуры микрослужб. При этом остальные части кластера AKS или направления других разработчиков не затрагиваются.

![Пример рабочего процесса Azure Dev Spaces](./media/image1-9.gif)

Azure Dev Spaces:

- минимизирует время настройки локального компьютера разработки и требования к ресурсам;
- ускоряет оптимизацию приложения;
- сокращает количество сред интеграции, необходимых разработчикам;
- устраняет необходимость в создании макетов определенных служб в распределенной системе при разработке или тестировании.

[Дополнительные сведения об Azure DevOps](https://docs.microsoft.com/azure/dev-spaces/about)

### <a name="azure-virtual-machines"></a>Виртуальные машины Azure

Если вам требуется внести серьезные изменения в существующее приложение для работы в службе приложений, вы можете упростить миграцию в облако с помощью виртуальных машин. Тем не менее для корректной настройки, защиты и обслуживания виртуальных машин требуется гораздо больше времени и опыта по сравнению со службой приложений Azure. Если вы планируете использовать виртуальные машины Azure, необходимо учитывать затраты времени и ресурсов на текущее обслуживание, установку исправлений и обновлений, а также на управление средой виртуальных машин. Виртуальные машины Azure реализуются на основе концепции "инфраструктура как услуга" (IaaS), тогда как служба приложений построена на основе модели "платформа как услуга" (PaaS). Также следует учесть, может ли развертывание приложения как контейнера Windows в веб-приложении для контейнеров быть приемлемым вариантом для вашего сценария.

## <a name="logical-processes"></a>Логические процессы

Отдельные логические процессы, которые могут быть отделены от остальной части приложения, могут развертываться независимо от функций Azure в режиме "без сервера". Благодаря функциям Azure вы можете просто написать код для решения возникшей проблемы, не беспокоясь о приложении или инфраструктуре, необходимых для его выполнения. Вы можете выбрать удобный для вас язык программирования, например C\#, F\#, Node.js, Python или PHP, который поможет наиболее эффективно решить задачу в вашей ситуации. Как и в случае с большинством облачных решений, вы платите только за время использования и при необходимости всегда можете рассчитывать на возможность масштабирования с использованием функций Azure.

## <a name="data"></a>Данные

Azure предлагает широкий спектр вариантов хранения данных, благодаря чему вы можете выбирать подходящий поставщик для вашего приложения.

Для работы с транзакционными и реляционными данными лучше всего подходят базы данных SQL Azure. Для данных, предназначенных преимущественно для высокопроизводительных операций чтения, эффективным решением будет кэш Redis на основе базы данных SQL Azure.

Неструктурированные данные JSON могут храниться разными способами, включая столбцы базы данных SQL, большие двоичные объекты, таблицы в службе хранилища Azure или Azure Cosmos DB. Среди этих вариантов лучшую производительность при обработке запросов обеспечивает служба Azure Cosmos DB. Это оптимальный вариант для работы с большим числом документов JSON, требующих поддержки запросов.

Для данных на основе промежуточных команд или событий, используемых для оркестрации поведения приложения, можно использовать служебную шину или очереди хранилища Azure. Служебная шина Azure обеспечивает большую гибкость и является оптимальным вариантом для нетривиального обмена сообщениями в рамках одного приложения или между приложениями.

## <a name="architecture-recommendations"></a>Рекомендации по выбору архитектуры

Архитектура приложения определяется предъявляемыми к нему требованиями. Существует множество различных служб Azure. Очень важно выбрать подходящую. Корпорация Майкрософт предлагает коллекцию эталонных образцов архитектуры, на основе которой можно определить типовые архитектуры, оптимизированные для распространенных сценариев. Вы сможете найти архитектуру, которая будет в точности соответствовать потребностям вашего приложения или, как минимум, может быть использована в качестве отправной точки.

Пример эталонного примера архитектуры показан на рис. 11-1. На этой схеме описывается рекомендуемый подход к выбору архитектуры для системы управления содержимым веб-сайта Sitecore, оптимизированного для маркетинговых задач.

![Рис. 11-1](./media/image11-2.png)

**Рис. 11-1.** Эталонный образец архитектуры маркетингового веб-сайта Sitecore.

**Ссылки — рекомендации по размещению в Azure**

- Архитектуры решений Azure\
  <https://azure.microsoft.com/solutions/architecture/>

- Базовая архитектура веб-приложения Azure\
  <https://docs.microsoft.com/azure/architecture/reference-architectures/app-service-web-app/basic-web-app>

- Модели организации разработки с использованием микрослужб\
  <https://docs.microsoft.com/azure/architecture/microservices/design/patterns>

- Руководство для разработчиков Azure\
  <https://azure.microsoft.com/campaigns/developer-guide/>

- Общие сведения об устройствах\
  <https://docs.microsoft.com/azure/app-service/app-service-web-overview>

- Веб-приложение для контейнеров\
  <https://azure.microsoft.com/services/app-service/containers/>

- Общие сведения о службе контейнеров Azure (AKS)\
  <https://docs.microsoft.com/azure/aks/intro-kubernetes>

>[!div class="step-by-step"]
>[Назад](development-process-for-azure.md)
