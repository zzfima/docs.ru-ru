---
title: Развертывание приложений .NET Core с помощью Visual Studio
description: Научитесь развертыванию приложений .NET Core с помощью Visual Studio
ms.date: 09/03/2018
dev_langs:
- csharp
- vb
ms.custom: vs-dotnet
ms.openlocfilehash: 6116b2322ed2071b78bcd77de7c38ad07c327aa6
ms.sourcegitcommit: 9a97c76e141333394676bc5d264c6624b6f45bcf
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2020
ms.locfileid: "75740837"
---
# <a name="deploy-net-core-apps-with-visual-studio"></a>Развертывание приложений .NET Core с помощью Visual Studio

Приложение .NET Core можно развернуть как *развертывание, зависящее от платформы*, которое содержит двоичные файлы приложений, но зависит от наличия .NET Core в целевой системе, или как *автономное развертывание*, которое содержит и приложение, и двоичные файлы .NET Core. Общие сведения о развертывании приложений .NET Core см. в разделе [Развертывание приложений .NET Core](index.md).

В разделах ниже содержатся сведения об использовании Microsoft Visual Studio для создания следующих типов развертывания:

- развертывание, зависящее от платформы;
- развертывание, зависящее от платформы, с зависимостями сторонних разработчиков;
- автономное развертывание;
- Автономное развертывание с зависимостями сторонних разработчиков

Сведения об использовании Visual Studio для разработки приложений .NET Core см. в статье [Зависимости и требования для .NET Core](../install/dependencies.md?tabs=netcore30&pivots=os-windows).

## <a name="framework-dependent-deployment"></a>развертывание, зависящее от платформы;

Если развертывание, зависящее от платформы, не содержит зависимостей сторонних разработчиков, то необходимо просто выполнить сборку, протестировать и опубликовать приложение. Проиллюстрируем этот процесс на примере простого приложения, написанного на языке C#.  

1. Создание проекта.

   Выберите **Файл** > **Создать** > **Проект**. В диалоговом окне **Создать проект** разверните категории проекта своего языка (C# или Visual Basic) на панели типов проектов **Установлено**, выберите **.NET Core**, а затем выберите шаблон **Консольное приложение (.NET Core)** на центральной панели. В поле **Имя** введите имя проекта, например "FDD". Нажмите кнопку **OK**.

1. Добавление исходного кода приложения.

   Откройте файл *Program.cs* или *Program.vb* в редакторе и замените автоматически созданный код приведенным ниже кодом. Он выводит запрос на ввод текста и отображает отдельные слова, введенные пользователем. Для разделения слов во введенном тексте в нем используется регулярное выражение `\w+`.

   [!code-csharp[deployment#1](~/samples/snippets/core/deploying/cs/deployment-example.cs)]
   [!code-vb[deployment#1](~/samples/snippets/core/deploying/vb/deployment-example.vb)]

1. Создание отладочной сборки приложения.

   Выберите **Сборка** > **Собрать решение**. Также можно скомпилировать и выполнить отладочную сборку приложения, выбрав **Отладка** > **Начать отладку**.

1. Разверните приложение.

   Отладив и протестировав программу, создайте файлы, которые будут развертываться с приложением. Для публикации из Visual Studio выполните следующие действия.

      1. На панели инструментов измените конфигурацию решения с **Отладка** на **Выпуск**, чтобы собрать версию выпуска (а не отладочную версию) приложения.

      1. Щелкните правой кнопкой мыши проект (не решение) в **обозревателе решений** и выберите **Опубликовать**.

      1. На вкладке **Публикация** выберите **Опубликовать**. Visual Studio записывает файлы, которые составляют приложение, в локальную файловую систему.

      1. Теперь на вкладке **Публикация** отображается один профиль — **FolderProfile**. Параметры конфигурации профиля отображаются на вкладке в разделе **Сводка**.

   Итоговые файлы помещаются в каталог с именем `Publish` в Windows и `publish` в системах Unix, который находится в подкаталоге каталога проекта *.\bin\release\netcoreapp2.1*.

Помимо файлов приложения, процесс публикации создает файл базы данных программы (PDB), который содержит отладочную информацию о приложении. Файл используется в основном для отладки исключений. Его можно не упаковывать вместе с файлами приложения. Однако его следует сохранить на случай, если потребуется выполнить отладку сборки выпуска приложения.

Любым способом разверните полный набор файлов приложения. Например, их можно упаковать в ZIP-файл, использовать простую команду `copy` или развернуть их с помощью любого установочного пакета на ваш выбор. После установки пользователи могут выполнять приложение с помощью команды `dotnet`, указав имя файла приложения, например `dotnet fdd.dll`.

Помимо двоичных файлов приложения, установщик должен либо включать в себя установщик общей платформы, либо проверять наличие платформы в процессе установки приложения.  Установка общей платформы требует наличия прав администратор или root, так как она производится на уровне всего компьютера.

## <a name="framework-dependent-deployment-with-third-party-dependencies"></a>Развертывание, зависящее от платформы, с зависимостями сторонних разработчиков

Для зависящего от платформы развертывания с одной или более зависимостями сторонних разработчиков требуется, чтобы зависимости были доступны в проекте. Перед сборкой приложения следует выполнить два дополнительных действия.

1. С помощью **диспетчера пакетов NuGet** добавьте ссылку на пакет NuGet в проект, а если пакет еще недоступен в системе, установите его. Чтобы открыть диспетчер пакетов, последовательно выберите **Сервис** > **Диспетчер пакетов NuGet** > **Управление пакетами NuGet для решения**.

1. Убедитесь, что в вашей системе установлены зависимости от сторонних разработчиков (например, `Newtonsoft.Json`), если это не так, установите их. На вкладке **Установленные** перечислены пакеты NuGet, установленные в системе. Если `Newtonsoft.Json` отсутствует в списке, откройте вкладку **Обзор** и введите "Newtonsoft.Json" в поле поиска. Выберите `Newtonsoft.Json` и в области справа выберите проект, прежде чем нажать кнопку **Установить**.

1. Если `Newtonsoft.Json` уже установлен в системе, добавьте его в проект, выбрав проект в правой области на вкладке **Управление пакетами для решения**.

Переносимость зависящего от платформы развертывания с зависимостями сторонних разработчиков напрямую зависит от переносимости этих зависимостей. Например, если библиотека стороннего разработчика поддерживает только Mac OS, приложение нельзя перенести в системы Windows. Это происходит, если зависимость стороннего разработчика сама зависит от машинного кода. Хорошим примером является [сервер Kestrel](https://docs.microsoft.com/aspnet/core/fundamentals/servers/kestrel), требующий собственной зависимости от [libuv](https://github.com/libuv/libuv). Когда зависящее от платформы развертывание создается для приложения с таким типом зависимости стороннего разработчика, опубликованные выходные данные содержат папку для каждого [идентификатора среды выполнения (RID)](../rid-catalog.md), поддерживаемого зависимостью (и имеющегося в ее пакете NuGet).

## <a name="simpleSelf"></a> Автономное развертывание без зависимостей сторонних разработчиков

Выполнение автономного развертывания без зависимостей сторонних разработчиков предполагает создание проекта, изменение файла *csproj*, сборку, тестирование и публикацию приложения. Проиллюстрируем этот процесс на примере простого приложения, написанного на языке C#. Вы начнете с создания, программирования и тестирования проекта, как и при развертывании, зависимом от платформы.

1. Создание проекта.

   Выберите **Файл** > **Создать** > **Проект**. В диалоговом окне **Создать проект** разверните категории проекта своего языка (C# или Visual Basic) на панели типов проектов **Установлено**, выберите **.NET Core**, а затем выберите шаблон **Консольное приложение (.NET Core)** на центральной панели. В поле **Имя** введите имя проекта, например "SCD", а затем нажмите кнопку **ОК**.

1. Добавление исходного кода приложения.

   Откройте файл *Program.cs* или *Program.vb* в редакторе и замените автоматически созданный код приведенным ниже кодом. Он выводит запрос на ввод текста и отображает отдельные слова, введенные пользователем. Для разделения слов во введенном тексте в нем используется регулярное выражение `\w+`.

   [!code-csharp[deployment#1](~/samples/snippets/core/deploying/cs/deployment-example.cs)]
   [!code-vb[deployment#1](~/samples/snippets/core/deploying/vb/deployment-example.vb)]

1. Определите, хотите ли вы использовать инвариантный режим глобализации.

   Особенно в том случае, если приложение предназначено для Linux, вы можете уменьшить размер развертывания, используя преимущества [инвариантного режима глобализации](https://github.com/dotnet/runtime/blob/master/docs/design/features/globalization-invariant-mode.md). Инвариантный режим глобализации подходит для приложений, которые не имеют глобальных параметров и могут использовать соглашения о форматировании, соглашения о регистре, сравнение строк и порядок сортировки для [инвариантного языка и региональных параметров](xref:System.Globalization.CultureInfo.InvariantCulture).

   Чтобы включить инвариантный режим, щелкните правой кнопкой мыши проект (не решение) в **обозревателе решений** и выберите **Изменить SCD.csproj** или **Изменить SCD.vbproj**. Затем добавьте следующие выделенные строки в файл:

   [!code-xml[globalization-invariant-mode](~/samples/snippets/core/deploying/xml/invariant.csproj?highlight=6-8)]

1. Создание отладочной сборки приложения.

   Выберите **Сборка** > **Собрать решение**. Также можно скомпилировать и выполнить отладочную сборку приложения, выбрав **Отладка** > **Начать отладку**. Этот шаг отладки позволяет выявить проблемы в приложении, когда оно выполняется на вашей платформе. Его все равно придется тестировать на каждой целевой платформе.

   Если вы включили инвариантный режим глобализации, обязательно проверьте, подходит ли отсутствие данных, зависящих от языка и региональных параметров, для вашего приложения.

Когда вы закончите отладку, вы можете опубликовать автономное развертывание.

<!-- markdownlint-disable MD025 -->

# <a name="visual-studio-156-and-earliertabvs156"></a>[Visual Studio 15.6 и более ранние версии](#tab/vs156)

Создание после отладки и тестирования программы файлов, которые будут развертываться с приложением, для каждой целевой платформы.

Для публикации приложения из Visual Studio выполните следующие действия.

1. Определение платформ, для которых будет предназначено приложение.

   1. Щелкните правой кнопкой мыши проект (не решение) в **обозревателе решений** и выберите **Изменить SCD.csproj**.

   1. В разделе `<PropertyGroup>` файла *csproj* создайте тег `<RuntimeIdentifiers>`, определяющий платформы, для которых предназначено приложение, и укажите идентификатор среды выполнения (RID) каждой целевой платформы. Для разделения идентификаторов RID необходимо добавлять точку с запятой. Список идентификаторов сред выполнения см. в [каталоге идентификаторов сред выполнения](../rid-catalog.md).

   Например, приведенный ниже пример указывает, что приложение выполняется в 64-разрядной операционной системе Windows 10 и в 64-разрядной операционной системе OS X 10.11.

   ```xml
   <PropertyGroup>
      <RuntimeIdentifiers>win10-x64;osx.10.11-x64</RuntimeIdentifiers>
   </PropertyGroup>
   ```

   Элемент `<RuntimeIdentifiers>` можно переносить в другие группы `<PropertyGroup>` в пределах файла *csproj*. Полный пример файла *csproj* будет приведен далее в этом разделе.

1. Опубликуйте приложение.

   Создание после отладки и тестирования программы файлов, которые будут развертываться с приложением, для каждой целевой платформы.

   Для публикации приложения из Visual Studio выполните следующие действия.

      1. На панели инструментов измените конфигурацию решения с **Отладка** на **Выпуск**, чтобы собрать версию выпуска (а не отладочную версию) приложения.

      1. Щелкните правой кнопкой мыши проект (не решение) в **обозревателе решений** и выберите **Опубликовать**.

      1. На вкладке **Публикация** выберите **Опубликовать**. Visual Studio записывает файлы, которые составляют приложение, в локальную файловую систему.

      1. Теперь на вкладке **Публикация** отображается один профиль — **FolderProfile**. Параметры конфигурации профиля отображаются на вкладке в разделе **Сводка**. Параметр **Целевая среда выполнения** определяет, какая среда выполнения была опубликована, а параметр **Целевое расположение** определяет, куда были записаны файлы автономного развертывания.

      1. По умолчанию Visual Studio записывает все опубликованные файлы в один каталог. Для удобства рекомендуется создать отдельные профили для каждой целевой среды выполнения и размещать опубликованные файлы в каталоге для определенной платформы. Это предполагает создание отдельного профиля публикации для каждой целевой платформы. Теперь выполните повторную сборку приложения для каждой платформы следующим образом.

         1. Выберите **Создать новый профиль** в диалоговом окне **Публикация**.

         1. В диалоговом окне **Выберите целевой объект публикации** измените расположение в поле **Выберите папку** на *bin\Release\PublishOutput\win10-x64*. Нажмите кнопку **ОК**.

         1. В списке профилей выберите новый профиль (**FolderProfile1**) и убедитесь, что параметр **Целевая среда выполнения** имеет значение `win10-x64`. В противном случае выберите **Параметры**. В диалоговом окне **Параметры профиля** измените значение параметра **Целевая среда выполнения** на `win10-x64`, а затем нажмите кнопку **Сохранить**. В противном случае нажмите кнопку **Отмена**.

         1. Выберите **Опубликовать**, чтобы опубликовать приложение для 64-разрядных платформ Windows 10.

         1. Выполните приведенные выше шаги еще раз, чтобы создать профиль для платформы `osx.10.11-x64`. Параметр **Целевое расположение** имеет значение *bin\Release\PublishOutput\osx.10.11-x64*, а параметр **Целевая среда выполнения** — `osx.10.11-x64`. Visual Studio присваивает этому профилю имя **FolderProfile2**.

      Каждое целевое расположение содержит полный набор файлов (как файлов приложения, так и всех файлов .NET Core), необходимых для запуска приложения.

Помимо файлов приложения, процесс публикации создает файл базы данных программы (PDB), который содержит отладочную информацию о приложении. Файл используется в основном для отладки исключений. Его можно не упаковывать вместе с файлами приложения. Однако его следует сохранить на случай, если потребуется выполнить отладку сборки выпуска приложения.

Разверните опубликованные файлы любым способом. Например, их можно упаковать в ZIP-файл, использовать простую команду `copy` или развернуть их с помощью любого установочного пакета на ваш выбор.

Ниже приведено полное содержимое файла *csproj* для этого проекта.

```xml
<Project Sdk="Microsoft.NET.Sdk">
  <PropertyGroup>
    <OutputType>Exe</OutputType>
    <TargetFramework>netcoreapp2.1</TargetFramework>
    <RuntimeIdentifiers>win10-x64;osx.10.11-x64</RuntimeIdentifiers>
  </PropertyGroup>
</Project>
```

# <a name="visual-studio-157-and-latertabvs157"></a>[Visual Studio 15.7 и более поздние версии](#tab/vs157)

Создание после отладки и тестирования программы файлов, которые будут развертываться с приложением, для каждой целевой платформы. Это предполагает создание отдельного профиля для каждой целевой платформы.

Для каждой платформы, для которой предназначено приложение, выполните следующие действия.

1. Создайте профиль для целевой платформы.

   Если это первый созданный профиль, щелкните правой кнопкой мыши проект (не решение) в **обозревателе решений** и выберите **Опубликовать**.

   Если вы уже создали профиль, щелкните правой кнопкой мыши проект, чтобы открыть диалоговое окно **Опубликовать**, если оно еще не открыто. Затем выберите **Создать профиль**.

   Откроется диалоговое окно **Выбрать целевой объект для публикации**.
  
1. Выберите расположение, где Visual Studio опубликует приложение.

   Если вы публикуете приложение только на одной платформе, можно принять значение по умолчанию в текстовом поле **Выбрать папку**. Вы опубликуете зависимое от платформы развертывание приложения в каталоге *\<каталог-проекта>\bin\Release\netcoreapp2.1\publish*.

   Если публикация выполняется для нескольких платформ, добавьте строку, которая указывает целевую платформу. Например, если добавить строку "linux" в путь к файлу, Visual Studio опубликует развертывание приложения, зависимое от платформы, в каталоге *\<project-directory>\bin\Release\netcoreapp2.1\publish\linux*.

1. Создайте профиль, щелкнув значок раскрывающегося списка рядом с полем **Опубликовать** и нажав **Создать профиль**. Затем нажмите на кнопку **Создать профиль**, чтобы создать профиль.

1. Укажите, что вы публикуете автономное развертывание, и определите платформу, для которой будет предназначено приложение.

   1. В диалоговом окне **Опубликовать** нажмите на ссылку **Настройка**, чтобы открыть диалоговое окно **Параметры профиля**.

   1. Выберите **Автономное** в списке **Режим развертывания**.

   1. В списке **Целевая среда выполнения** выберите одну из платформ, для которой предназначено приложение.

   1. Нажмите **Сохранить**, чтобы принять изменения и закрыть диалоговое окно.

1. Укажите имя профиля.

   1. Выберите **Действия** > **Переименовать профиль**, чтобы указать имя профиля.

   2. Выберите для профиля имя, которое указывает на целевую платформу, а затем нажмите **Сохранить*.

Повторите эти шаги, чтобы определить любые дополнительные целевые платформы, для которых предназначено приложение.

Вы настроили профили и готовы опубликовать приложение. Выполните указанные ниже действия.

   1. Если диалоговое окно **Опубликовать** еще не открыто, щелкните правой кнопкой мыши проект (не решение) в **обозревателе решений** и выберите **Опубликовать**.

   2. Выберите профиль, который вы хотите опубликовать, а затем нажмите **Опубликовать**. Повторите это действие для каждого профиля.

   Каждое целевое расположение (в нашем примере это bin\release\netcoreapp2.1\publish\\*profile-name*) содержит полный набор файлов (как файлов приложения, так и всех файлов .NET Core), необходимых для запуска приложения.

Помимо файлов приложения, процесс публикации создает файл базы данных программы (PDB), который содержит отладочную информацию о приложении. Файл используется в основном для отладки исключений. Его можно не упаковывать вместе с файлами приложения. Однако его следует сохранить на случай, если потребуется выполнить отладку сборки выпуска приложения.

Разверните опубликованные файлы любым способом. Например, их можно упаковать в ZIP-файл, использовать простую команду `copy` или развернуть их с помощью любого установочного пакета на ваш выбор.

Ниже приведено полное содержимое файла *csproj* для этого проекта.

```xml
<Project Sdk="Microsoft.NET.Sdk">
  <PropertyGroup>
    <OutputType>Exe</OutputType>
    <TargetFramework>netcoreapp2.1</TargetFramework>
  </PropertyGroup>
</Project>
```

Кроме того, Visual Studio создает отдельный профиль публикации (\*.pubxml) для каждой целевой платформы. Например, файл для профиля linux (linux.pubxml) выглядит следующим образом:

```xml
<?xml version="1.0" encoding="utf-8"?>
<!--
https://go.microsoft.com/fwlink/?LinkID=208121. 
-->
<Project ToolsVersion="4.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <PropertyGroup>
    <PublishProtocol>FileSystem</PublishProtocol>
    <Configuration>Release</Configuration>
    <Platform>Any CPU</Platform>
    <TargetFramework>netcoreapp2.1</TargetFramework>
    <PublishDir>bin\Release\netcoreapp2.1\publish\linux</PublishDir>
    <RuntimeIdentifier>win-x86</RuntimeIdentifier>
    <SelfContained>true</SelfContained>
    <_IsPortable>false</_IsPortable>
  </PropertyGroup>
</Project>
```

---

## <a name="self-contained-deployment-with-third-party-dependencies"></a>Автономное развертывание с зависимостями сторонних разработчиков

Выполнение автономного развертывания с одной или несколькими зависимостями сторонних разработчиков предполагает добавление этих зависимостей. Перед сборкой приложения следует выполнить два дополнительных действия.

1. С помощью **диспетчера пакетов NuGet** добавьте ссылку на пакет NuGet в проект, а если пакет еще недоступен в системе, установите его. Чтобы открыть диспетчер пакетов, последовательно выберите **Сервис** > **Диспетчер пакетов NuGet** > **Управление пакетами NuGet для решения**.

1. Убедитесь, что в вашей системе установлены зависимости от сторонних разработчиков (например, `Newtonsoft.Json`), если это не так, установите их. На вкладке **Установленные** перечислены пакеты NuGet, установленные в системе. Если `Newtonsoft.Json` отсутствует в списке, откройте вкладку **Обзор** и введите "Newtonsoft.Json" в поле поиска. Выберите `Newtonsoft.Json` и в области справа выберите проект, прежде чем нажать кнопку **Установить**.

1. Если `Newtonsoft.Json` уже установлен в системе, добавьте его в проект, выбрав проект в правой области на вкладке **Управление пакетами для решения**.

Ниже приведено полное содержимое файла *csproj* для этого проекта:

# <a name="visual-studio-156-and-earliertabvs156"></a>[Visual Studio 15.6 и более ранние версии](#tab/vs156)

```xml
<Project Sdk="Microsoft.NET.Sdk">
  <PropertyGroup>
    <OutputType>Exe</OutputType>
    <TargetFramework>netcoreapp2.1</TargetFramework>
    <RuntimeIdentifiers>win10-x64;osx.10.11-x64</RuntimeIdentifiers>
  </PropertyGroup>
  <ItemGroup>
    <PackageReference Include="Newtonsoft.Json" Version="10.0.2" />
  </ItemGroup>
</Project>
```

# <a name="visual-studio-157-and-latertabvs157"></a>[Visual Studio 15.7 и более поздние версии](#tab/vs157)

```xml
<Project Sdk="Microsoft.NET.Sdk">
  <PropertyGroup>
    <OutputType>Exe</OutputType>
    <TargetFramework>netcoreapp2.1</TargetFramework>
  </PropertyGroup>
  <ItemGroup>
    <PackageReference Include="Newtonsoft.Json" Version="10.0.2" />
  </ItemGroup>
</Project>
```

---

При развертывании приложения все зависимости сторонних разработчиков, используемые в нем, также содержатся в файлах приложения. Библиотеки сторонних разработчиков не требуются в системе, в которой выполняется приложение.

Автономное развертывание с библиотекой стороннего разработчика возможно только на платформах, которые поддерживаются этой библиотекой. Это похоже на наличие сторонних зависимостей с собственными зависимостями в развертывании, зависящем от платформы, где собственные зависимости существуют в целевой платформе, только если они были установлены в ней ранее.

## <a name="see-also"></a>См. также

- [Развертывание приложений .NET Core](index.md)
- [Каталог идентификаторов сред выполнения (RID) в .NET Core](../rid-catalog.md)
