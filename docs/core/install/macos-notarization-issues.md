---
title: Работа с заверением macOS Catalina
description: Способы решения проблем с заверением и сертификатами в macOS при установке среды выполнения .NET Core, пакета SDK и приложений, созданных с помощью .NET Core.
author: thraka
ms.author: adegeo
ms.date: 02/14/2020
ms.openlocfilehash: b16ef4074f829246df0aedebf7ffe4df75faed51
ms.sourcegitcommit: 00aa62e2f469c2272a457b04e66b4cc3c97a800b
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/28/2020
ms.locfileid: "78165353"
---
# <a name="macos-catalina-notarization-and-the-impact-on-net-core-downloads-and-projects"></a>Заверение macOS Catalina и влияние на скачиваемые файлы и проекты .NET Core

Начиная с macOS Catalina (версия 10.15) все программное обеспечение, созданное после 1 июня 2019 года и распространяемое с идентификатором разработчика, должно быть заверено. Это требование относится к среде выполнения .NET Core, пакету SDK для .NET Core и программному обеспечению, созданному с помощью .NET Core. Эта статья описывает распространенные сценарии, с которыми вы можете столкнуться при заверении .NET Core и macOS.

## <a name="installing-net-core"></a>Установка .NET Core

Установщики для .NET Core (среда выполнения и пакет SDK) версии 3.1, 3.0 и 2.1 были заверены с 18 февраля 2020 г. Более ранние версии не заверены. Вы можете вручную установить незаверенную версию .NET Core, скачав установщик и выполнив команду `sudo installer`. Дополнительные сведения см. в разделе [Скачивание и установка вручную для macOS](sdk.md?pivots=os-macos#download-and-manually-install).

Начиная со следующих версий, установщики .NET Core являются заверенными:

- Среда выполнения .NET Core
  - 2.1.16
  - 3.0.3
  - 3.1.2

- Пакет SDK для .NET Core
  - 2.1.512
  - 3.0.103
  - 3.1.102

## <a name="apphost-is-disabled-by-default"></a>appHost отключен по умолчанию

По умолчанию незаверенные версии пакета SDK для .NET Core 3.0 и выше создают собственный исполняемый файл Mach-O (известный как **appHost**) при компиляции, публикации или запуске проекта. Этот исполняемый файл удобно использовать для запуска приложения. В противном случае для запуска приложения нужно выполнить команду `dotnet <filename.dll>`. Когда appHost включен, команда `dotnet run` вызывается в контексте appHost. Дополнительные сведения см. в разделе [Контекст appHost](#context-of-the-apphost).

Начиная с заверенных версий пакета SDK для .NET Core 3.0 и выше исполняемый файл appHost не создается по умолчанию. Вы можете включить создание appHost с помощью логического параметра [`UseAppHost`](../project-sdk/msbuild-props.md#useapphost) в файле проекта. Кроме того, можно переключить использование appHost с помощью параметра `-p:UseAppHost` в командной строке для определенной команды `dotnet`:

- Файл проекта

  ```xml
  <PropertyGroup>
    <UseAppHost>true</UseAppHost>
  </PropertyGroup>
  ```

- Параметр командной строки

  ```dotnetcli
  dotnet run -p:UseAppHost=true
  ```

AppHost всегда создается при публикации приложения в [автономном виде](../deploying/index.md#publish-self-contained).

Дополнительные сведения о параметре `UseAppHost` см. в разделе [Свойства MSBuild для Microsoft.NET.Sdk](../project-sdk/msbuild-props.md#useapphost).

### <a name="context-of-the-apphost"></a>Контекст appHost

Когда appHost включен в проекте и вы используете команду `dotnet run` для запуска приложения, оно вызывается в контексте appHost, а не узла по умолчанию (узлом по умолчанию является команда `dotnet`). Если appHost отключен в проекте, команда `dotnet run` запускает приложение в контексте узла по умолчанию. Даже если appHost отключен, публикация приложения в качестве автономного приводит к созданию исполняемого файла appHost, который применяется пользователями для запуска приложения. При запуске приложения с помощью `dotnet <filename.dll>` оно вызывается на узле по умолчанию — в общей среде выполнения.

При вызове приложения, использующего appHost, раздел сертификата, к которому обращается приложение, отличается от заверенного узла по умолчанию. Если приложение должно обращаться к сертификатам, установленным через узел по умолчанию, используйте команду `dotnet run` для запуска приложения из файла проекта или команду `dotnet <filename.dll>` для запуска приложения напрямую.

Дополнительные сведения об этом сценарии см. в разделе [ASP.NET Core, macOS и сертификаты](#aspnet-core-and-macos-and-certificates).

## <a name="aspnet-core-and-macos-and-certificates"></a>ASP.NET Core, macOS и сертификаты

.NET Core позволяет управлять сертификатами в цепочке ключей macOS с помощью класса <xref:System.Security.Cryptography.X509Certificates>. В рамках обращения к цепочке ключей macOS удостоверение приложения используется в качестве первичного ключа при принятии решения о том, какой раздел следует рассматривать. Например, неподписанные приложения хранят секреты в неподписанном разделе, а подписанные приложения хранят свои секреты в разделах, доступ к которым есть только у них. Источник выполнения, вызывающий ваше приложение, решает, какой раздел следует использовать.

.NET Core предоставляет три источника выполнения: [appHost](#apphost-is-disabled-by-default), узел по умолчанию (команда `dotnet`) и пользовательский узел. Каждая модель выполнения может использовать разные удостоверения, подписанные или нет, а также имеет доступ к разным разделам в цепочке ключей. Сертификаты, импортированные в одном режиме, могут быть недоступны в другом. Например, заверенные версии .NET Core имеют подписанный узел по умолчанию. Сертификаты импортируются в защищенный раздел на основе его удостоверения. Эти сертификаты недоступны из созданного appHost, так как appHost не подписан.

Другой пример: по умолчанию ASP.NET Core импортирует SSL-сертификат по умолчанию через узел по умолчанию. Приложения ASP.NET Core, использующие appHost, не будут иметь доступ к этому сертификату и получат сообщение об ошибке, когда .NET Core обнаружит, что сертификат недоступен. Это сообщение об ошибке содержит инструкции по устранению данной проблемы.

Если требуется общий доступ к сертификату, macOS предоставляет параметры конфигурации с помощью служебной программы `security`.

Дополнительные сведения об устранении неполадок, связанных с сертификатами ASP.NET Core, см. в разделе [Применение протокола HTTPS в ASP.NET Core](/aspnet/core/security/enforcing-ssl?view=aspnetcore-3.1&tabs=visual-studio#troubleshoot-certificate-problems).

## <a name="default-entitlements"></a>Права по умолчанию

Узел по умолчанию .NET Core (команда `dotnet`) имеет набор прав по умолчанию. Эти права необходимы для правильной работы .NET Core. Приложению могут понадобиться дополнительные права. В этом случае потребуется создать и использовать [appHost](#apphost-is-disabled-by-default), а затем добавить необходимые права локально.
 
Набор прав по умолчанию для .NET Core:

- `com.apple.security.cs.allow-jit`
- `com.apple.security.cs.allow-unsigned-executable-memory`
- `com.apple.security.cs.allow-dyld-environment-variables`
- `com.apple.security.cs.disable-library-validation`

## <a name="notarize-a-net-core-app"></a>Заверение приложения .NET Core

Если вы хотите, чтобы приложение выполнялось в macOS Catalina (версия 10.15) или более поздней версии, рекомендуется заверить его. Файл appHost, отправляемый вместе с приложением для заверения, должен использоваться по крайней мере с теми же [правами по умолчанию](#default-entitlements) для .NET Core.

## <a name="next-steps"></a>Следующие шаги

- [Зависимости и требования для .NET Core](dependencies.md).
- [Установка пакета SDK для .NET Core](sdk.md).
- [Установка среды выполнения .NET Core](runtime.md).
