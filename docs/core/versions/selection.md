---
title: Выбор версии .NET Core для использования
description: Узнайте, как .NET Core автоматически находит и выбирает версии среды выполнения для вашей программы. Кроме того, в этой статье объясняется, как принудительно применить определенную версию.
author: thraka
ms.author: adegeo
ms.date: 06/26/2019
ms.openlocfilehash: 546725db907937dea6fe0739656fb585a8855644
ms.sourcegitcommit: 5f236cd78cf09593c8945a7d753e0850e96a0b80
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2020
ms.locfileid: "75713975"
---
# <a name="select-the-net-core-version-to-use"></a>Выбор версии .NET Core для использования

В этой статье описаны политики, используемые средствами .NET Core, пакетом SDK и средой выполнения для выбора версии. Эти политики обеспечивают баланс между запуском приложений с помощью указанных версий и упрощенным процессом обновления компьютеров разработчика и конечного пользователя. Эти политики выполняют следующие действия:

- Простое и эффективное развертывание .NET Core, включая обновления безопасности и надежности.
- Использование новейших средств и команд независимо от целевой среды выполнения.

Ситуации выбора версии:

- При выполнении команды SDK [пакет SDK использует последнюю установленную версию](#the-sdk-uses-the-latest-installed-version).
- При создании сборки [моникеры целевой платформы определяют API во время сборки](#target-framework-monikers-define-build-time-apis).
- При запуске приложения .NET Core [накатываются приложения, зависимые от целевой платформы](#framework-dependent-apps-roll-forward).
- При публикации автономного приложения [автономные развертывания включают выбранную среду выполнения](#self-contained-deployments-include-the-selected-runtime).

В остальной части этой статьи рассматриваются эти четыре сценария.

## <a name="the-sdk-uses-the-latest-installed-version"></a>Пакет SDK использует последнюю установленную версию

Команды пакета SDK включают `dotnet new` и `dotnet run`. В .NET Core CLI нужно выбрать версию пакета SDK для каждой команды `dotnet`. В CLI используется пакет SDK последней версии, установленный на компьютере по умолчанию, даже если:

- проект предназначен для более ранней версии среды выполнения .NET Core;
- последняя версия пакета SDK для .NET Core доступна в виде предварительной версии.

Вы можете воспользоваться последними преимуществами и улучшениями пакета SDK при работе с более ранними версиями среды выполнения .NET Core. Вы можете выбирать несколько версий среды выполнения .NET Core в разных проектах, используя одинаковые средства пакета SDK для всех проектов.

В редких случаях вам потребуется использовать более раннюю версию пакета SDK. Укажите эту версию в [файле *global.json*](../tools/global-json.md). Политика использования последней версии означает, что вам придется использовать файл *global.json*, чтобы указать версию пакета SDK для .NET Core, если она раньше последней установленной версии.

Файл *global.json* можно поместить в любое место в иерархии файлов. Интерфейс командной строки выполняет поиск, переходя вверх от каталога проекта до первого найденного файла *global.json*. Вы сами выбираете, на какие проекты распространяется конкретный файл *global.json*, когда размещаете его в файловой системе. .NET CLI ищет файл *global.json* последовательно, двигаясь вверх от текущего рабочего каталога. Первый найденный файл *global.json* задает используемую версию. Если эта версия пакета SDK установлена, она будет использоваться. Если пакет SDK, указанный в *global.json*, не найден, то .NET CLI выбирает совместимый пакет SDK с помощью [правил сопоставления](../tools/global-json.md#matching-rules). Если такой пакет не удается обнаружить, происходит сбой.

В следующем примере приводится синтаксис файла *global.json*.

``` json
{
  "sdk": {
    "version": "2.0.0"
  }
}
```

Процесс выбора версии пакета SDK выглядит следующим образом:

1. `dotnet` ищет файл *global.json* последовательно, двигаясь вверх от текущего рабочего каталога.
1. `dotnet` использует пакет SDK, указанный в первом найденном файле *global.json*.
1. `dotnet` использует последнюю установленную версию пакета SDK, если файл *global.json* не найден.

Дополнительные сведения о выборе версии пакета SDK см. в разделе о [правилах сопоставления](../tools/global-json.md#matching-rules) в статье о файле *global.json*.

## <a name="target-framework-monikers-define-build-time-apis"></a>Моникеры целевой платформы определяют API во время сборки

Вы создаете проект на основе API, определенных в **моникере целевой платформы** (TFM). Вы указываете [целевую платформу](../../standard/frameworks.md) в файле проекта. Укажите элемент `TargetFramework` в файле проекта, как показано в следующем примере:

``` xml
<TargetFramework>netcoreapp2.0</TargetFramework>
```

Вы можете создать проект на основе нескольких моникеров целевой платформы. Обычно несколько целевых платформ указываются для библиотек, но с приложениями это тоже возможно. Укажите свойство `TargetFrameworks` (множественное число от `TargetFramework`). Целевые платформы разделяются точкой с запятой, как показано в следующем примере:

``` xml
<TargetFrameworks>netcoreapp2.0;net47</TargetFrameworks>
```

Данный пакет SDK поддерживает фиксированный набор платформ, вплоть до целевой платформы среды выполнения, с которой он поставляется. Например, пакет SDK для .NET Core 2.0 включает среду выполнения .NET Core 2.0, которая представляет собой реализацию целевой платформы `netcoreapp2.0`. Пакет SDK для .NET Core 2.0 поддерживает `netcoreapp1.0`, `netcoreapp1.1` и `netcoreapp2.0`, но не `netcoreapp2.1` (или более поздней версии). Установите пакет SDK для .NET Core 2.1 для сборки `netcoreapp2.1`.

Целевая платформа .NET Standard также ограничена целевой платформой среды выполнения, с которой поставляется пакет SDK. Пакет SDK для .NET Core 2.0 ограничен версией `netstandard2.0`.

## <a name="framework-dependent-apps-roll-forward"></a>Накат платформозависимых приложений

Если вы запускаете приложение из источника с [`dotnet run`](../tools/dotnet-run.md) из [**зависящего от платформы развертывания**](../deploying/index.md#framework-dependent-deployments-fdd) с использованием [`dotnet myapp.dll`](../tools/dotnet.md#description) или из [**зависящего от платформы исполняемого файла**](../deploying/index.md#framework-dependent-executables-fde) с использованием`myapp.exe`, исполняемый файл `dotnet` будет **узлом** для приложения.

Узел выбирает версию с последними исправлениями, установленную на компьютере. Например, если вы указали `netcoreapp2.0` в файле проекта, а `2.0.4` является последней установленной версией среды выполнения .NET, будет использоваться среда выполнения `2.0.4`.

Если допустимая версия `2.0.*` не найдена, используется новая версия `2.*`. Например, если вы указали `netcoreapp2.0` и только `2.1.0` установлена, приложение будет работать в среде выполнения `2.1.0`. Это поведение называется накатом до дополнительной версии. Более ранние версии не будут рассматриваться. Если допустимая среда выполнения не установлена, приложение не будет работать.

Несколько примеров для демонстрации такого поведения, если вы используете версию 2.0:

- Указана версия 2.0. Последняя установленная версия с исправлениями — 2.0.5. Используется версия 2.0.5.
- Указана версия 2.0. Нет установленных версий 2.0.*. Последняя установленная версия среды выполнения — 1.1.1. Отображается сообщение об ошибке.
- Указана версия 2.0. Нет установленных версий 2.0.*. Последняя установленная версия среды выполнения 2.x — 2.2.2. Используется версия 2.2.2.
- Указана версия 2.0. Нет установленных версий 2.x. Установлена версия 3.0.0. Отображается сообщение об ошибке.

Накат до дополнительной версии имеет побочный эффект для конечных пользователей. Рассмотрим следующий сценарий.

1. Приложение требует установки версии 2.0.
2. При запуске версия 2.0.* не установлена, зато установлена версия 2.2.2. Будет использоваться версия 2.2.2.
3. Позже пользователь устанавливает 2.0.5 и запускает приложение еще раз, теперь будет использоваться 2.0.5.

Версии 2.0.5 и 2.2.2 могут вести себя по-разному, особенно в таких сценариях, как сериализация двоичных данных.

## <a name="self-contained-deployments-include-the-selected-runtime"></a>Автономные развертывания включают выбранную среду выполнения

Вы можете опубликовать приложение как [**автономный дистрибутив**](../deploying/index.md#self-contained-deployments-scd). При таком подходе среда выполнения .NET Core и библиотеки объединяются с вашим приложением. Автономные развертывания не зависят от среды выполнения. Выбор версии среды выполнения происходит во время публикации, а не запуска.

Процесс публикации выбирает последнюю версию исправления определенного семейства сред выполнения. Например, `dotnet publish` выберет .NET Core 2.0.4, если это последняя версия исправления семейства среды выполнения .NET Core 2.0. Целевая платформа (включая последние установленные обновления безопасности) упаковывается с приложением.

Возникает ошибка, если минимальная версия, указанная для приложения, не предоставляется. `dotnet publish` привязывает последнюю версию среды выполнения с исправлениями (без определенного семейства с основным и дополнительным номером версии). `dotnet publish` не поддерживает семантику наката `dotnet run`. Дополнительные сведения об исправлениях и автономных развертываниях см. в статье о [выборе версии среды выполнения с исправлениями](../deploying/runtime-patch-selection.md) при развертывании приложений .NET Core.

Для автономных развертываний может потребоваться определенная версия исправления. Минимальную версию среды выполнения с исправлениями можно переопределить (выбрав более позднюю или раннюю версию) в файле проекта, как показано в следующем примере:

``` xml
<RuntimeFrameworkVersion>2.0.4</RuntimeFrameworkVersion>
```

Элемент `RuntimeFrameworkVersion` переопределяет политику версии по умолчанию. Для автономных развертываний `RuntimeFrameworkVersion` указывает *точную* версию платформы среды выполнения. Для платформозависимых приложений `RuntimeFrameworkVersion` указывает *минимальную* требуемую версию платформы среды выполнения.
