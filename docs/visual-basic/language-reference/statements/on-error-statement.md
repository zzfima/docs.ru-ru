---
title: Оператор On Error (Visual Basic)
ms.date: 07/20/2015
f1_keywords:
- vb.OnError
helpviewer_keywords:
- Visual Basic code, control flow
- Resume Next statement [Visual Basic]
- errors [Visual Basic], trapping
- error handling, On Error statement
- Next statement [Visual Basic], On Error
- control flow [Visual Basic], branching
- Error keyword [Visual Basic]
- execution [Visual Basic], conditional
- Resume statement [Visual Basic], and On Error statement
- Error statement [Visual Basic], and On Error statement
- GoTo statement [Visual Basic], and On Error statement
- branching [Visual Basic], on error
- conditional statements [Visual Basic], On Error
- On Error statement [Visual Basic], syntax
- On keyword [Visual Basic]
- run-time errors [Visual Basic], handling
- On Error statement [Visual Basic]
ms.assetid: ff947930-fb84-40cf-bd66-1ea219561d5c
ms.openlocfilehash: 5dc432f8e62430d48954b2c049cab3ebae4d442e
ms.sourcegitcommit: 41c0637e894fbcd0713d46d6ef1866f08dc321a2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/01/2019
ms.locfileid: "57203747"
---
# <a name="on-error-statement-visual-basic"></a>Оператор On Error (Visual Basic)
Включает процедуру обработки ошибок и определяет местоположение этой подпрограммы в процедуре. Можно также отключить процедуру обработки ошибок.  
  
 Без обработки ошибок, любая ошибка во время выполнения, возникает неустранимая: отображается сообщение об ошибке, и выполнение будет остановлено.  
  
 По возможности рекомендуется использовать структурированных исключений в коде обработку, а не с помощью неструктурированной обработки исключений и `On Error` инструкции. Дополнительные сведения см. в разделе [Оператор Try...Catch...Finally](../../../visual-basic/language-reference/statements/try-catch-finally-statement.md).  
  
> [!NOTE]
>  `Error` Ключевое слово также используется в [оператор Error](../../../visual-basic/language-reference/statements/error-statement.md), которая поддерживается для обеспечения обратной совместимости.  
  
## <a name="syntax"></a>Синтаксис  
  
```  
On Error { GoTo [ line | 0 | -1 ] | Resume Next }  
```  
  
## <a name="parts"></a>Части  
  
|Термин|Определение|  
|---|---|  
|`GoTo` `line`|Включает подпрограмму обработки ошибок, которая начинается со строки, указанной в обязательном `line` аргумент. `line` Аргумент является любую метку или номер строки. Если возникает ошибка времени выполнения, управления указанную строку, сделать активным обработчика ошибок. Указанная строка должна быть в той же процедуре `On Error` инструкции или ошибка времени компиляции возникнет.|  
|`GoTo` 0|Отключает активированный обработчик ошибок в текущей процедуре и сбрасывающий его в `Nothing`.|  
|`GoTo` -1|Отключающий активированный обработчик исключений в текущей процедуре и сбрасывающий его в `Nothing`.|  
|`Resume Next`|Указывает, что при возникновении ошибки во время выполнения, элемент управления переходит в инструкции сразу после инструкции, где произошла ошибка, и выполнение продолжается с этой точки. Используйте эту форму, а не `On Error GoTo` при доступе к объектам.|  
  
## <a name="remarks"></a>Примечания  
  
> [!NOTE]
>  Мы рекомендуем использовать структурированной обработки исключений в коде, когда это возможно, а не с помощью неструктурированной обработки исключений и `On Error` инструкции. Дополнительные сведения см. в разделе [Оператор Try...Catch...Finally](../../../visual-basic/language-reference/statements/try-catch-finally-statement.md).  
  
 Обработчик ошибок «включено», которое включено по `On Error` инструкции. Обработчик ошибок «активный» является включенный обработчик, который находится в процессе обработки ошибки.  
  
 Если ошибка возникает при активном обработчик ошибок (между возникновением ошибки и `Resume`, `Exit Sub`, `Exit Function`, или `Exit Property` инструкции), обработчик ошибок в текущей процедуре не может обработать ошибку. Управление возвращается вызывающей процедуре.  
  
 Если у вызывающей процедуры есть включенный обработчик ошибок, он активируется для обработки ошибки. Если обработчик ошибок вызывающей процедуры уже активен, управление передается обратно через предыдущего вызова процедуры, пока не будет найден обработчик ошибок включено, но неактивный. Если такой обработчик ошибок обнаруживается, ошибка является неустранимой в точке, где она реально возникла.  
  
 Каждый раз, когда обработчик ошибок передает управление обратно вызывающей процедуре, эта процедура становится текущей процедуры. После обработки обработчиком ошибок в любой процедуре, выполнение возобновляется в текущей процедуре в точке, назначенному с помощью `Resume` инструкции.  
  
> [!NOTE]
>  Обработчик ошибок не `Sub` процедуры или `Function` процедуры. Это часть кода, отмеченной точкой метку строки или номер строки.  
  
## <a name="number-property"></a>Свойство номера  
 Процедуры обработки ошибок зависят от значения в `Number` свойство `Err` объекта, чтобы определить причину ошибки. Подпрограммы, следует проверить или сохранить соответствующие значения свойства в `Err` прежде, чем любая другая ошибка может произойти или до процедуры, которая может вызвать ошибку вызова. Значения свойств в `Err` объекта отражают только самую последнюю ошибку. Сообщение об ошибке связанные с `Err.Number` содержится в `Err.Description`.  
  
## <a name="throw-statement"></a>Оператор Throw  
 Ошибка, вызвавшая с `Err.Raise` метода задает `Exception` свойства в только что созданный экземпляр <xref:System.Exception> класса. Для поддержки вызова исключений, производных типов, `Throw` поддерживается оператор на языке. Это принимает один параметр, являющийся экземпляром исключение. Следующий пример показывает, как эти функции можно использовать с существующей поддержку обработки исключений:  
  
 [!code-vb[VbVbalrErrorHandling#17](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrErrorHandling/VB/Class1.vb#17)]  
  
 Обратите внимание, что `On Error GoTo` оператор перехватывает все ошибки, независимо от того, класс исключений.  
  
## <a name="on-error-resume-next"></a>On Error Resume Next  
 `On Error Resume Next` прерывает выполнение продолжения с помощью инструкции сразу после инструкции, которая вызвала ошибку во время выполнения, или с помощью инструкции сразу после последнего вызовом к процедуре, содержащей `On Error Resume Next` инструкции. Эта инструкция позволяет продолжить выполнение несмотря на ошибку времени выполнения. Можно поместить процедуру обработки ошибок, где возникала ошибка, не передавая управление в другое расположение в рамках процедуры. `On Error Resume Next` Оператор становится неактивным при вызове другой процедуры, поэтому следует выполнять `On Error Resume Next` вызваны оператором, в каждом подпрограммы, если вы хотите встроить в которую обработку ошибок.  
  
> [!NOTE]
>  `On Error Resume Next` Конструкция может оказаться предпочтительнее `On Error GoTo` при обработке ошибок, возникших во время доступа к другим объектам. Проверка `Err` после каждого взаимодействия с объектом устраняет неоднозначность, о том, какие обращения к объекту с помощью кода. Вы можете быть уверены, какой объект поместил код ошибки в `Err.Number`, а также какой объект вызвавшего ошибку (объект, указанный в `Err.Source`).  
  
## <a name="on-error-goto-0"></a>На Error GoTo 0  
 `On Error GoTo 0` отключает обработку ошибок в текущей процедуре. Он не определяет строку 0 как начало кода обработки ошибок, даже если процедура содержит строку с номером 0. Без `On Error GoTo 0` инструкции, обработчик ошибок автоматически отключается при выходе из процедуры.  
  
## <a name="on-error-goto--1"></a>На Error GoTo -1  
 `On Error GoTo -1` Отключает исключение в текущей процедуре. Он не содержит строки -1 как начало кода обработки ошибок, даже если процедура содержит строку с номером -1. Без `On Error GoTo -1` инструкции, исключение автоматически отключается при выходе из процедуры.  
  
 Чтобы предотвратить код обработки ошибок при отсутствии ошибок, поместите `Exit Sub`, `Exit Function`, или `Exit Property` инструкции непосредственно перед процедуру обработки ошибок, как в следующем фрагменте:  
  
 [!code-vb[VbVbalrErrorHandling#18](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrErrorHandling/VB/Class1.vb#18)]  
  
 Ниже, код обработки ошибок следует `Exit Sub` инструкции и предшествует `End Sub` инструкцию, чтобы отделить его от процедуры. Код обработки ошибок можно поместить в любом месте в процедуре.  
  
## <a name="untrapped-errors"></a>Не перехваченные ошибки  
 Не перехваченные ошибки в объектах возвращаются управляющее приложение, если объект выполняется как исполняемый файл. В среде разработки не перехваченные ошибки возвращаются в управляющее приложение только в том случае, если установлены соответствующие параметры. См. в разделе документации ведущего приложения, описание которой параметры должны быть установлены во время отладки, об их настройке и ли узел можно создавать классы.  
  
 При создании объекта, который обращается к другим объектам, можно попытаться обработать любые необработанные ошибки, возвращаемые. Если не удается сопоставить коды ошибок в `Err.Number` на один из собственных ошибок, а затем передавать их обратно в вызывающий объект. Следует определить свою ошибку, добавив код ошибки для `VbObjectError` константы. Например если код ошибки 1052, присвойте ее следующим образом:  
  
 [!code-vb[VbVbalrErrorHandling#19](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrErrorHandling/VB/Class1.vb#19)]  
  
> [!CAUTION]
>  Системные ошибки во время вызовов Windows библиотеки динамической компоновки (DLL), не вызывайте исключения и не может перехватить с перехват ошибок в Visual Basic. При вызове функций DLL, необходимо проверять каждое возвращаемое значение успех или неудачу (в соответствии со спецификациями API) и в случае сбоя, проверьте значение `Err` объекта `LastDLLError` свойство.  
  
## <a name="example"></a>Пример  
 В этом примере сначала используется `On Error GoTo` инструкцию, чтобы указать расположение подпрограммы обработки ошибок в процедуре. В примере попытка деления на ноль приводит к возникновению ошибки номер ошибки 6. Ошибка будет обработана в процедуру обработки ошибок, а затем управление возвращается в инструкцию, которая вызвала ошибку. `On Error GoTo 0` Инструкция приводит к отключению перехват ошибок. Затем `On Error Resume Next` отложить перехват ошибок, таким образом, для некоторых может быть известен контекст для ошибки, сформированной с помощью следующей инструкции используется инструкция. Обратите внимание, что `Err.Clear` используется для очистки `Err` свойств объекта после завершения обработки ошибки.  
  
 [!code-vb[VbVbalrErrorHandling#20](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrErrorHandling/VB/Class1.vb#20)]  
  
## <a name="requirements"></a>Требования  
 **Пространство имен:** [Microsoft.VisualBasic](../../../visual-basic/language-reference/runtime-library-members.md)  
  
 **Сборка:** Visual Basic (библиотека времени выполнения, в Microsoft.VisualBasic.dll)  
  
## <a name="see-also"></a>См. также
- <xref:Microsoft.VisualBasic.Information.Err%2A>
- <xref:Microsoft.VisualBasic.ErrObject.Number%2A>
- <xref:Microsoft.VisualBasic.ErrObject.Description%2A>
- <xref:Microsoft.VisualBasic.ErrObject.LastDllError%2A>
- [Оператор End](../../../visual-basic/language-reference/statements/end-statement.md)
- [Оператор Exit](../../../visual-basic/language-reference/statements/exit-statement.md)
- [Оператор Resume](../../../visual-basic/language-reference/statements/resume-statement.md)
- [Сообщения об ошибках](../../../visual-basic/language-reference/error-messages/index.md)
- [Оператор Try...Catch...Finally](../../../visual-basic/language-reference/statements/try-catch-finally-statement.md)
