---
title: Пошаговое руководство. Реализация наследования с использованием COM-объектов
ms.date: 07/20/2015
helpviewer_keywords:
- inheritance [Visual Basic], COM reusability
- base classes [Visual Basic], COM reusability
- inheritance [Visual Basic], walkthroughs
- derived classes [Visual Basic], COM reusability
ms.assetid: f8e7263a-de13-48d1-b67c-ca1adf3544d9
ms.openlocfilehash: 209e1005b9f944bf4883e8406031fb17d4d60df1
ms.sourcegitcommit: 17ee6605e01ef32506f8fdc686954244ba6911de
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/22/2019
ms.locfileid: "74347986"
---
# <a name="walkthrough-implementing-inheritance-with-com-objects-visual-basic"></a>Пошаговое руководство. Реализация наследования с использованием COM-объектов (Visual Basic)

Visual Basic классы можно наследовать от классов `Public` в COM-объектах, даже тех, которые созданы в более ранних версиях Visual Basic. Свойства и методы классов, унаследованных от COM-объектов, могут быть переопределены или перегружены точно так же, как свойства и методы любого другого базового класса могут быть переопределены или перегружены. Наследование от COM-объектов полезно при наличии существующей библиотеки классов, которую не нужно перекомпилировать.

В следующей процедуре показано, как использовать Visual Basic 6,0 для создания COM-объекта, содержащего класс, а затем использовать его в качестве базового класса.

[!INCLUDE[note_settings_general](~/includes/note-settings-general-md.md)]

## <a name="to-build-the-com-object-that-is-used-in-this-walkthrough"></a>Построение COM-объекта, используемого в этом пошаговом руководстве

1. В Visual Basic 6,0 откройте новый проект ActiveX DLL. Создается проект с именем `Project1`. Он имеет класс с именем `Class1`.

2. В **обозревателе проектов**щелкните правой кнопкой мыши **проект1**и выберите **Свойства проект1**. Откроется диалоговое окно **Свойства проекта** .

3. На вкладке **Общие** диалогового окна **Свойства проекта** измените имя проекта, введя `ComObject1` в поле **имя проекта** .

4. В **обозревателе проектов**щелкните правой кнопкой мыши `Class1`и выберите пункт **свойства**. Откроется окно **свойств** класса.

5. Измените свойство `Name` на `MathFunctions`.

6. В **обозревателе проектов**щелкните правой кнопкой мыши `MathFunctions`и выберите пункт **Просмотреть код**. Откроется **Редактор кода** .

7. Добавьте локальную переменную для хранения значения свойства:

    ```vb
    ' Local variable to hold property value
    Private mvarProp1 As Integer
    ```

8. Добавьте свойства `Let` свойств и `Get` свойств:

    ```vb
    Public Property Let Prop1(ByVal vData As Integer)
       'Used when assigning a value to the property.
       mvarProp1 = vData
    End Property
    Public Property Get Prop1() As Integer
       'Used when retrieving a property's value.
       Prop1 = mvarProp1
    End Property
    ```

9. Добавьте функцию:

    ```vb
    Function AddNumbers(
       ByVal SomeNumber As Integer,
       ByVal AnotherNumber As Integer) As Integer

       AddNumbers = SomeNumber + AnotherNumber
    End Function
    ```

10. Создайте и зарегистрируйте COM-объект, выбрав в меню **файл** команду **make ComObject1. dll** .

    > [!NOTE]
    > Хотя можно также предоставить класс, созданный с помощью Visual Basic, в качестве COM-объекта, он не является настоящим COM-объектом и не может использоваться в этом пошаговом руководстве. Дополнительные сведения см. [в разделе COM-взаимодействие в приложениях .NET Framework](../../../visual-basic/programming-guide/com-interop/com-interoperability-in-net-framework-applications.md).

## <a name="interop-assemblies"></a>Сборки взаимодействия

В следующей процедуре будет создана сборка взаимодействия, которая выступает в качестве моста между неуправляемым кодом (например, COM-объектом) и управляемым кодом, используемым Visual Studio. Сборка взаимодействия, которую Visual Basic создает, обрабатывает множество деталей работы с COM-объектами, например *Маршалинг взаимодействия*, процесс упаковки параметров и возвращаемые значения в эквивалентные типы данных при их перемещении в COM-объекты и из них. Ссылка в приложении Visual Basic указывает на сборку взаимодействия, а не на фактический COM-объект.

### <a name="to-use-a-com-object-with-visual-basic-2005-and-later-versions"></a>Использование COM-объекта с Visual Basic 2005 и более поздними версиями

1. Откройте новый проект приложения Windows на Visual Basic.

2. В меню **Проект** щелкните команду **Добавить ссылку**.

     Появится диалоговое окно **Добавление ссылки**.

3. На вкладке **com** дважды щелкните `ComObject1` в списке **имя компонента** и нажмите кнопку **ОК**.

4. В меню **Проект** выберите пункт **Добавить новый элемент**.

     Откроется диалоговое окно **Добавление нового элемента**.

5. В области **шаблоны** щелкните **класс**.

     Имя файла по умолчанию, `Class1.vb`, отображается в поле **имя** . Измените это поле на MathClass. vb и нажмите кнопку **Добавить**. При этом создается класс с именем `MathClass`и отображается его код.

6. Добавьте следующий код в начало `MathClass` для наследования от класса COM.

     [!code-vb[VbVbalrInterop#31](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrInterop/VB/Class1.vb#31)]

7. Перегрузите открытый метод базового класса, добавив следующий код для `MathClass`:

     [!code-vb[VbVbalrInterop#32](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrInterop/VB/Class1.vb#32)]

8. Расширьте унаследованный класс, добавив следующий код для `MathClass`:

     [!code-vb[VbVbalrInterop#33](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrInterop/VB/Class1.vb#33)]

Новый класс наследует свойства базового класса в COM-объекте, перегружает метод и определяет новый метод для расширения класса.

### <a name="to-test-the-inherited-class"></a>Тестирование наследуемого класса

1. Добавьте кнопку в форму запуска, а затем дважды щелкните ее, чтобы просмотреть ее код.

2. В процедуре обработчика событий `Click` кнопки добавьте следующий код, чтобы создать экземпляр `MathClass` и вызвать перегруженные методы:

     [!code-vb[VbVbalrInterop#34](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrInterop/VB/Class1.vb#34)]

3. Запустите проект, нажав клавишу F5.

При нажатии кнопки в форме метод `AddNumbers` сначала вызывается с `Short`ными номерами типов данных, а Visual Basic выбирает соответствующий метод из базового класса. Второй вызов `AddNumbers` направляется в метод перегрузки из `MathClass`. Третий вызов вызывает метод `SubtractNumbers`, который расширяет класс. Свойство в базовом классе задается, и отображается значение.

## <a name="next-steps"></a>Дальнейшие шаги

Возможно, вы заметили, что перегруженная функция `AddNumbers` имеет тот же тип данных, что и метод, унаследованный от базового класса COM-объекта. Это обусловлено тем, что аргументы и параметры метода базового класса определяются как 16-разрядные целые числа в Visual Basic 6,0, но они предоставляются как 16-разрядные целые числа типа `Short` в более поздних версиях Visual Basic. Новая функция принимает 32-разрядные целые числа и перегружает функцию базового класса.

При работе с COM-объектами убедитесь, что вы проверите размер и типы данных параметров. Например, при использовании объекта COM, который принимает объект коллекции Visual Basic 6,0 в качестве аргумента, вы не можете предоставить коллекцию из более поздней версии Visual Basic.

Свойства и методы, унаследованные от классов COM, можно переопределить, то есть можно объявить локальное свойство или метод, который заменяет свойство или метод, наследуемые от базового класса COM. Правила переопределения унаследованных COM-свойств похожи на правила переопределения других свойств и методов, за исключением следующих.

- При переопределении любого свойства или метода, унаследованного от класса COM, необходимо переопределить все остальные унаследованные свойства и методы.

- Свойства, использующие параметры `ByRef`, не могут быть переопределены.

## <a name="see-also"></a>См. также

- [COM-взаимодействие в приложениях .NET Framework](../../../visual-basic/programming-guide/com-interop/com-interoperability-in-net-framework-applications.md)
- [Оператор Inherits](../../../visual-basic/language-reference/statements/inherits-statement.md)
- [Тип данных Short](../../../visual-basic/language-reference/data-types/short-data-type.md)
