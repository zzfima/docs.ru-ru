---
title: Учебник. Классификация санитарных нарушений с помощью построителя моделей
description: В этом руководстве показано, как с помощью построителя моделей ML.NET создать модель многоклассовой классификации, которая классифицирует серьезность санитарных нарушений в ресторанах Сан-Франциско.
author: luisquintanilla
ms.author: luquinta
ms.date: 11/21/2019
ms.topic: tutorial
ms.custom: mvc
ms.openlocfilehash: 07729e1667f8aa3aba74576943d79eaa3bcd14d8
ms.sourcegitcommit: 93762e1a0dae1b5f64d82eebb7b705a6d566d839
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/27/2019
ms.locfileid: "74552885"
---
# <a name="tutorial-classify-the-severity-of-restaurant-health-violations-with-model-builder"></a>Учебник. Классификация серьезности санитарных нарушений в ресторанах с помощью построителя моделей

Сведения о том, как с помощью построителя моделей создать модель многоклассовой классификации, чтобы определять категорию уровня риска для нарушений, обнаруженных во время санитарных проверок ресторанов.

В этом руководстве вы узнаете, как:

> [!div class="checklist"]
>
> - Подготовка и анализ данных
> - Выбор сценария
> - Загрузка данных из базы данных
> - Обучение модели
> - Оценка модели
> - Использование модели для прогнозирования

> [!NOTE]
> Построитель моделей в настоящее время находится на этапе предварительной версии.

## <a name="prerequisites"></a>Предварительные требования

Список необходимых компонентов и инструкции по установке см. в [руководстве по установке построителя моделей](../how-to-guides/install-model-builder.md).

## <a name="model-builder-multiclass-classification-overview"></a>Обзор многоклассовой классификации в построителе моделей

В этом примере создается консольное приложение .NET Core на языке C#, которое классифицирует риск санитарных нарушений с помощью модели машинного обучения, созданной в построителе моделей. Исходный код примера из этого руководства можно найти в репозитории [dotnet/machinelearning-samples](https://github.com/dotnet/machinelearning-samples/tree/master/samples/modelbuilder/MulticlassClassification_RestaurantViolations) на сайте GitHub.

## <a name="create-a-console-application"></a>Создание консольного приложения

1. Создайте **консольное приложение .NET Core на C#** с именем RestaurantViolations. Убедитесь, что флажок **Поместить решение и проект в одной папке** **снят** (VS 2019) или флажок **Создать каталог для решения** **установлен** (VS 2017).

## <a name="prepare-and-understand-the-data"></a>Подготовка и анализ данных

> Набор данных для обучения и оценки модели машинного обучения создан на основе [данных о санитарной безопасности ресторанов от Департамента здравоохранения Сан-Франциско](https://www.sfdph.org/dph/EH/Food/score/default.asp). Для удобства этот набор данных был уплотнен и теперь включает только столбцы, имеющее прямое отношение к обучению модели и прогнозированию. Чтобы узнать больше об этом [наборе данных](https://data.sfgov.org/Health-and-Social-Services/Restaurant-Scores-LIVES-Standard/pyih-qa8i?row_index=0), посетите следующий веб-сайт.

[Скачайте набор данных об оценке безопасности ресторанов](https://github.com/luisquintanilla/machinelearning-samples/raw/AB1608219/samples/modelbuilder/MulticlassClassification_RestaurantViolations/RestaurantScores.zip) и распакуйте его.

Каждая строка в наборе данных содержит сведения о нарушениях, обнаруженных при проверке Департаментом здравоохранения, и оценку рисков для общественного здоровья и безопасности, которые связаны с этими нарушениями.

| InspectionType | ViolationDescription | RiskCategory |
| --- | --- | --- |
| Routine (плановые) — Unscheduled (внеплановые) | Недостаточно очищены или продезинфицированы поверхности, взаимодействующие с продуктами | Средний риск |
| Новый владелец | Высокий риск распространения паразитов | Высокий риск |
| Routine (плановые) — Unscheduled (внеплановые) | Тряпки для протирки грязные или неправильно хранятся, или недостаточно чистящего средства | Низкий риск |

- **InspectionType**: обозначает тип проверки. Это может быть первичная проверка для нового заведения, плановая проверка, изучение жалобы и многое другое.
- **ViolationDescription**: описание нарушения, обнаруженного во время проверки.
- **RiskCategory**: серьезность рисков для общественного здоровья и безопасности, которые влечет за собой это нарушение.

`label` — это столбец для прогнозирования. При выполнении задачи классификации целью является назначение категории (текстовое или числовое значение). В нашем сценарии классификации серьезность (риск) нарушения может быть низкой, средней или высокой. Для этих целей поле **RiskCategory** имеет формат метки. Признаки (`features`) содержат входные данные, которые вы передаете в модель для прогнозирования метки (`label`). В нашем примере признаками (входными данными) выступают **InspectionType** и **ViolationDescription**, на основе которых прогнозируется значение **RiskCategory**.

## <a name="choose-a-scenario"></a>Выбор сценария

![Мастер построителя моделей в Visual Studio](./media/sentiment-analysis-model-builder/model-builder-screen.png)

Чтобы обучить модель, выберите один из доступных сценариев машинного обучения в построителе моделей. В нашем примере используется сценарий *Issue Classification* (Классификация проблем).

1. В **обозревателе решений** щелкните правой кнопкой мыши проект *RestaurantViolations* и выберите **Добавить** > **Машинное обучение**.
1. В нашем примере применяется многоклассовая классификация. На этапе *Сценарий* в построителе моделей выберите сценарий **Issue Classification** (Классификация проблем).

## <a name="load-the-data"></a>Загрузка данных

Построитель моделей принимает данные из базы данных SQL Server или локального файла в формате `csv` или `tsv`.

1. На этапе добавления данных в средстве построителя моделей выберите в раскрывающемся списке источников данных пункт **SQL Server**.
1. Нажмите кнопку рядом с текстовым полем **Connect to SQL Server database** (Подключение к базе данных SQL Server).
    1. В диалоговом окне **Choose Data** (Выбор данных) выберите **Файл базы данных Microsoft SQL Server**.
    1. Снимите флажок **Всегда использовать этот вариант** и щелкните **Продолжить**.
    1. В диалоговом окне **Свойства подключения** щелкните **Обзор** и выберите скачанный файл *RestaurantScores.mdf*.
    1. Нажмите кнопку **ОК**.
1. Выберите **Violations** (Нарушения) из раскрывающегося списка **Имя таблицы**.
1. Выберите вариант **RiskCategory** в раскрывающемся списке **Прогнозируемые столбцы** (метка).
1. Сохраните выбранные по умолчанию столбцы **InspectionType** и **ViolationDescription**, в раскрывающемся списке **Входные столбцы** (признаки).
1. Щелкните ссылку **Обучение**, чтобы перейти к следующему шагу в построителе моделей.

## <a name="train-the-model"></a>Обучение модели

Задачей машинного обучения, используемой в этом руководстве для обучения модели классификации проблем, является многоклассовая классификация. В процессе обучения моделей построитель моделей обучает отдельные модели по разным алгоритмам многоклассовой классификации, используя разные параметры, и выбирает среди них оптимальную модель для предоставленного набора данных.

Время, требуемое для обучения модели, пропорционально объему данных. Построитель моделей автоматически выбирает значение по умолчанию для параметра **Time to train (seconds)** (Время обучения в секундах) в зависимости от размера источника данных.

1. Хотя построитель моделей задает для параметра **Время обучения (в секундах)** значение 10 секунд, увеличьте его до 30 секунд. Обучение в течение более длительного периода времени позволяет построителю моделей исследовать большее количество алгоритмов и комбинаций параметров, чтобы определить наилучшую модель.
1. Выберите **Начать обучение**.

    В процессе обучения сведения о ходе выполнения отображаются в разделе `Progress` шага обучения.

    - В области **Состояние** отображается текущее состояние процесса обучения.
    - **Best accuracy** (Наибольшая точность) — это точность модели, которую построитель моделей на текущий момент считает лучшей. Точность зависит от того, насколько правильный прогноз был сделан моделью на основе тестовых данных.
    - **Best algorithm** (Лучший алгоритм) отображает название алгоритма, который построитель моделей на текущий момент считает лучшим.
    - **Last algorithm** (Последний алгоритм) отображает название алгоритма, который построителем моделей для обучения модели последним.

1. Когда обучение завершится, щелкните ссылку **Оценить**, чтобы перейти к следующему шагу.

## <a name="evaluate-the-model"></a>Оценка модели

Результатом шага обучения является одна модель с наивысшей точностью. На шаге оценки построитель моделей выводит в поле **Лучшая модель** алгоритм, который используется в наиболее оптимальной модели, а в поле **Качество лучшей модели** — метрики оценки. Кроме того, отображается сводная таблица с пятью лучшими из рассмотренных моделей и их метриками.

Если вас не удовлетворяют метрики точности, самые простые способы повысить точность модели — увеличить длительность обучения или использовать больше данных. В противном случае щелкните ссылку **Код**, чтобы перейти к завершающему шагу построителя моделей.

## <a name="add-the-code-to-make-predictions"></a>Добавление кода для прогнозирования

В результате процесса обучения создаются два проекта.

- RestaurantViolationsML.ConsoleApp: консольное приложение .NET Core на C# с кодом для обучения и использования модели.
- RestaurantViolationsML.Model: библиотека классов .NET Standard с моделями данных, которые определяют схему входных и выходных данных модели, а также хранимую версию оптимальной модели во время обучения и вспомогательный класс с именем `ConsumeModel` для формирования прогнозов.

1. На шаге кода в построителе моделей щелкните **Добавить проекты**, чтобы добавить автоматически созданные проекты в решение.
1. Откройте файл *Program.cs* в проекте *RestaurantViolations*.
1. Добавьте следующее содержимое, используя оператор для ссылки на проект *RestaurantViolationsML.Model*:

    [!code-csharp [ProgramUsings](~/machinelearning-samples/samples/modelbuilder/MulticlassClassification_RestaurantViolations/RestaurantViolations/Program.cs#L2)]

1. Чтобы сделать прогноз на основе новых данных с помощью модели, создайте новый экземпляр класса `ModelInput` внутри метода `Main` приложения. Обратите внимание, что категория риска не входит в набор входных данных. Это сделано для того, чтобы модель сама спрогнозировала ее.

    [!code-csharp [TestData](~/machinelearning-samples/samples/modelbuilder/MulticlassClassification_RestaurantViolations/RestaurantViolations/Program.cs#L11-L15)]

1. Используйте метод `Predict` из класса `ConsumeModel`. Метод `Predict` загружает обученную модель, создает [`PredictionEngine`](xref:Microsoft.ML.PredictionEngine%602) для модели и использует эту подсистему для создания прогнозов на основе новых данных.

    [!code-csharp [Prediction](~/machinelearning-samples/samples/modelbuilder/MulticlassClassification_RestaurantViolations/RestaurantViolations/Program.cs#L17-L24)]

1. Запустите приложение.

    Выходные данные программы должны выглядеть примерно так:

    ```bash
    Inspection Type: Complaint
    Violation Description: Inadequate sewage or wastewater disposal
    Risk Category: Moderate Risk
    ```

Если на созданные проекты нужно будет сослаться позднее в другом решении, их можно найти в каталоге `C:\Users\%USERNAME%\AppData\Local\Temp\MLVSTools`.

Поздравляем! Вы успешно создали модель машинного обучения для классификации риска санитарных нарушений с помощью построителя моделей. Исходный код примера из этого руководства можно найти в репозитории [dotnet/machinelearning-samples](https://github.com/dotnet/machinelearning-samples/tree/master/samples/modelbuilder/MulticlassClassification_RestaurantViolations) на сайте GitHub.

## <a name="additional-resources"></a>Дополнительные ресурсы

Дополнительные сведения см. в следующих статьях:

- [Сценарии для построителя моделей](../automate-training-with-model-builder.md#scenarios)
- [Многоклассовая классификация](../resources/glossary.md#multiclass-classification)
- [Метрики модели многоклассовой классификации](../resources/metrics.md#metrics-for-multi-class-classification)
