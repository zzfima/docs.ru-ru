---
title: Концепции пакета SDK для .NET Compiler Platform и объектная модель
description: Этот обзор содержит сведения, необходимые для эффективной работы с пакетом SDK компилятора .NET. Вы узнаете о слоях API, основных используемых типах и общей объектной модели.
ms.date: 10/10/2017
ms.custom: mvc
ms.openlocfilehash: e563260e21fb8807017db90ff63e30fec0415a48
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/14/2020
ms.locfileid: "79156965"
---
# <a name="understand-the-net-compiler-platform-sdk-model"></a><span data-ttu-id="99bd6-104">Общие сведения о модели пакета SDK для .NET Compiler Platform</span><span class="sxs-lookup"><span data-stu-id="99bd6-104">Understand the .NET Compiler Platform SDK model</span></span>

<span data-ttu-id="99bd6-105">Компиляторы обрабатывают код, который вы пишете, следуя структурированным правилам, которые часто отличаются от того, как читают и воспринимают код люди.</span><span class="sxs-lookup"><span data-stu-id="99bd6-105">Compilers process the code you write following structured rules that often differ from the way humans read and understand code.</span></span> <span data-ttu-id="99bd6-106">Понимание принципов работы модели, используемой компиляторами, важно для изучения API, используемых при создании средств на основе Roslyn.</span><span class="sxs-lookup"><span data-stu-id="99bd6-106">A basic understanding of the model used by compilers is essential to understanding the APIs you use when building Roslyn-based tools.</span></span>

## <a name="compiler-pipeline-functional-areas"></a><span data-ttu-id="99bd6-107">Функциональные области конвейера компилятора</span><span class="sxs-lookup"><span data-stu-id="99bd6-107">Compiler pipeline functional areas</span></span>

<span data-ttu-id="99bd6-108">Пакет SDK для .NET Compiler Platform реализует функции анализа кода в компиляторах C# и Visual Basic, предоставляя слой API, отражающий традиционный конвейер компилятора.</span><span class="sxs-lookup"><span data-stu-id="99bd6-108">The .NET Compiler Platform SDK exposes the C# and Visual Basic compilers' code analysis to you as a consumer by providing an API layer that mirrors a traditional compiler pipeline.</span></span>

![Этапы обработки исходного кода на конвейере компилятора для получения объектного кода](media/compiler-api-model/compiler-pipeline.png)

<span data-ttu-id="99bd6-110">Каждый этап конвейера — это отдельный компонент.</span><span class="sxs-lookup"><span data-stu-id="99bd6-110">Each phase of this pipeline is a separate component.</span></span> <span data-ttu-id="99bd6-111">Сначала на этапе синтаксического анализа выполняется расстановка токенов и анализ текста исходного кода с учетом синтаксиса, а затем и грамматики языка.</span><span class="sxs-lookup"><span data-stu-id="99bd6-111">First, the parse phase tokenizes and parses source text into syntax that follows the language grammar.</span></span> <span data-ttu-id="99bd6-112">Потом на этапе объявления анализируется источник и импортированные метаданные для формирования именованных символов.</span><span class="sxs-lookup"><span data-stu-id="99bd6-112">Second, the declaration phase analyzes source and imported metadata to form named symbols.</span></span> <span data-ttu-id="99bd6-113">Далее на этапе привязки идентификаторы в коде сопоставляются с символами.</span><span class="sxs-lookup"><span data-stu-id="99bd6-113">Next, the bind phase matches identifiers in the code to symbols.</span></span> <span data-ttu-id="99bd6-114">Наконец, на этапе порождения создается сборка со всеми сведениями, сформированными компилятором.</span><span class="sxs-lookup"><span data-stu-id="99bd6-114">Finally, the emit phase emits an assembly with all the information built up by the compiler.</span></span>

![API конвейера компилятора предоставляет доступ к каждому шагу, который является частью конвейера компилятора.](media/compiler-api-model/compiler-pipeline-api.png)

<span data-ttu-id="99bd6-116">В соответствии с каждым из этих этапов пакет SDK для .NET Compiler Platform предоставляет объектную модель, обеспечивающую доступ к информации на этом этапе.</span><span class="sxs-lookup"><span data-stu-id="99bd6-116">Corresponding to each of those phases, the .NET Compiler Platform SDK exposes an object model that allows access to the information at that phase.</span></span> <span data-ttu-id="99bd6-117">Этап анализа предоставляет дерево синтаксиса, этап объявления предоставляет таблицу иерархических символов, этап привязки предоставляет результат семантического анализа компилятора, а этап порождения — это API, создающий коды байтов IL.</span><span class="sxs-lookup"><span data-stu-id="99bd6-117">The parsing phase exposes a syntax tree, the declaration phase exposes a hierarchical symbol table, the binding phase exposes the result of the compiler’s semantic analysis, and the emit phase is an API that produces IL byte codes.</span></span>

![Языковые службы, доступные из API компилятора на каждом этапе конвейера компилятора](media/compiler-api-model/compiler-pipeline-lang-svc.png)

<span data-ttu-id="99bd6-119">Каждой компилятор сочетает в себе эти компоненты, образуя единый процесс.</span><span class="sxs-lookup"><span data-stu-id="99bd6-119">Each compiler combines these components together as a single end-to-end whole.</span></span>

<span data-ttu-id="99bd6-120">Эти API также используются в Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="99bd6-120">These APIs are the same ones used by Visual Studio.</span></span> <span data-ttu-id="99bd6-121">Например, функции структурирования и форматирования кода используют деревья синтаксиса, обозреватель объектов и функции навигации — таблицу символов, рефакторинг и операции "Перейти к определению" — семантическую модель, а операция "Изменить и продолжить" использует их все, включая API порождения.</span><span class="sxs-lookup"><span data-stu-id="99bd6-121">For instance, the code outlining and formatting features use the syntax trees, the Object Browser and navigation features use the symbol table, refactorings and Go to Definition use the semantic model, and Edit and Continue uses all of these, including the Emit API.</span></span>

## <a name="api-layers"></a><span data-ttu-id="99bd6-122">Слои API</span><span class="sxs-lookup"><span data-stu-id="99bd6-122">API layers</span></span>

<span data-ttu-id="99bd6-123">Пакет SDK компилятора .NET состоит из двух основных слоев API: API компиляторов и API рабочих областей.</span><span class="sxs-lookup"><span data-stu-id="99bd6-123">The .NET compiler SDK consists of two main layers of APIs: compiler APIs and workspaces APIs.</span></span>

![Слои API, представленные API конвейера компилятора](media/compiler-api-model/api-layers.png)

### <a name="compiler-apis"></a><span data-ttu-id="99bd6-125">API компилятора</span><span class="sxs-lookup"><span data-stu-id="99bd6-125">Compiler APIs</span></span>

<span data-ttu-id="99bd6-126">Слой компилятора содержит объектные модели, которые соответствуют сведениям, представляемым на каждом этапе конвейера компилятора, как синтаксическим, так и семантическим.</span><span class="sxs-lookup"><span data-stu-id="99bd6-126">The compiler layer contains the object models that correspond to information exposed at each phase of the compiler pipeline, both syntactic and semantic.</span></span> <span data-ttu-id="99bd6-127">Слой компилятора также содержит неизменяемый моментальный снимок однократного вызова компилятора, включая ссылки на сборки, параметры компилятора и файлы исходного кода.</span><span class="sxs-lookup"><span data-stu-id="99bd6-127">The compiler layer also contains an immutable snapshot of a single invocation of a compiler, including assembly references, compiler options, and source code files.</span></span> <span data-ttu-id="99bd6-128">Существует два отдельных API, представляющих язык C# и Visual Basic.</span><span class="sxs-lookup"><span data-stu-id="99bd6-128">There are two distinct APIs that represent the C# language and the Visual Basic language.</span></span> <span data-ttu-id="99bd6-129">Эти два API похожи по форме, но для обеспечения высокой точности привязаны к конкретному языку.</span><span class="sxs-lookup"><span data-stu-id="99bd6-129">These two APIs are similar in shape but tailored for high-fidelity to each individual language.</span></span> <span data-ttu-id="99bd6-130">Этот слой не имеет зависимостей от компонентов Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="99bd6-130">This layer has no dependencies on Visual Studio components.</span></span>

### <a name="diagnostic-apis"></a><span data-ttu-id="99bd6-131">API диагностики</span><span class="sxs-lookup"><span data-stu-id="99bd6-131">Diagnostic APIs</span></span>

<span data-ttu-id="99bd6-132">В процессе анализа компилятор может создать набор данных диагностики, охватывающий все — от синтаксиса, семантики и явных ошибок присваивания до различных предупреждений и информационных диагностических сообщений.</span><span class="sxs-lookup"><span data-stu-id="99bd6-132">As part of its analysis the compiler may produce a set of diagnostics covering everything from syntax, semantic, and definite assignment errors to various warnings and informational diagnostics.</span></span> <span data-ttu-id="99bd6-133">Слой API компилятора предоставляет диагностику посредством расширяемого API, который разрешает подключать пользовательские анализаторы к процессу компиляции.</span><span class="sxs-lookup"><span data-stu-id="99bd6-133">The Compiler API layer exposes diagnostics through an extensible API that allows user-defined analyzers to be plugged into the compilation process.</span></span> <span data-ttu-id="99bd6-134">Она позволяет создавать заданные пользователем диагностические данные, например, формируемые такими программами, как StyleCop или FxCop, параллельно с диагностическими данными, определенными компилятором.</span><span class="sxs-lookup"><span data-stu-id="99bd6-134">It allows user-defined diagnostics, such as those produced by tools like StyleCop or FxCop, to be produced alongside compiler-defined diagnostics.</span></span> <span data-ttu-id="99bd6-135">Такое формирование данных диагностики дает преимущество естественной интеграции со средствами, такими как MSBuild и Visual Studio, которые зависят от диагностики при применении таких процедур, как прерывание сборки на основе политики, отображение динамических волнистых линий в редакторе и предложение исправлений кода.</span><span class="sxs-lookup"><span data-stu-id="99bd6-135">Producing diagnostics in this way has the benefit of integrating naturally with tools such as MSBuild and Visual Studio which depend on diagnostics for experiences such as halting a build based on policy and showing live squiggles in the editor and suggesting code fixes.</span></span>

### <a name="scripting-apis"></a><span data-ttu-id="99bd6-136">API скриптов</span><span class="sxs-lookup"><span data-stu-id="99bd6-136">Scripting APIs</span></span>

<span data-ttu-id="99bd6-137">API размещения и скриптов являются частью слоя компилятора.</span><span class="sxs-lookup"><span data-stu-id="99bd6-137">Hosting and scripting APIs are part of the compiler layer.</span></span> <span data-ttu-id="99bd6-138">Их можно использовать для выполнения фрагментов кода и накопления контекста выполнения во время выполнения.</span><span class="sxs-lookup"><span data-stu-id="99bd6-138">You can use them for executing code snippets and accumulating a runtime execution context.</span></span>
<span data-ttu-id="99bd6-139">Интерактивная среда REPL (read-evaluate-print loop) C# использует эти API.</span><span class="sxs-lookup"><span data-stu-id="99bd6-139">The C# interactive REPL (Read-Evaluate-Print Loop) uses these APIs.</span></span> <span data-ttu-id="99bd6-140">REPL позволяет использовать C# в качестве скриптового языка C#, выполняя код в интерактивном режиме по мере его написания.</span><span class="sxs-lookup"><span data-stu-id="99bd6-140">The REPL enables you to use C# as a scripting language, executing the code interactively as you write it.</span></span>

### <a name="workspaces-apis"></a><span data-ttu-id="99bd6-141">API рабочих областей</span><span class="sxs-lookup"><span data-stu-id="99bd6-141">Workspaces APIs</span></span>

<span data-ttu-id="99bd6-142">Слой рабочих областей содержит соответствующий API, который является отправной точкой для анализа кода и рефакторинга в рамках целых решений.</span><span class="sxs-lookup"><span data-stu-id="99bd6-142">The Workspaces layer contains the Workspace API, which is the starting point for doing code analysis and refactoring over entire solutions.</span></span> <span data-ttu-id="99bd6-143">Он помогает упорядочить всю информацию о проектах в решении в рамках одной объектной модели, предоставляя вам прямой доступ к объектным моделям слоя компилятора без необходимости анализировать файлы, настраивать параметры или управлять зависимостями между проектами.</span><span class="sxs-lookup"><span data-stu-id="99bd6-143">It assists you in organizing all the information about the projects in a solution into single object model, offering you direct access to the compiler layer object models without needing to parse files, configure options, or manage project-to-project dependencies.</span></span>

<span data-ttu-id="99bd6-144">Кроме того, слой рабочих областей предоставляет набор API, используемый реализацией средств анализа кода и рефакторинга, которые работают в среде размещения, таких как Visual Studio IDE.</span><span class="sxs-lookup"><span data-stu-id="99bd6-144">In addition, the Workspaces layer surfaces a set of APIs used when implementing code analysis and refactoring tools that function within a host environment like the Visual Studio IDE.</span></span> <span data-ttu-id="99bd6-145">В качестве примеров можно привести API "Найти все ссылки", "Форматирование" и "Создание кода".</span><span class="sxs-lookup"><span data-stu-id="99bd6-145">Examples include the Find All References, Formatting, and Code Generation APIs.</span></span>

<span data-ttu-id="99bd6-146">Этот слой не имеет зависимостей от компонентов Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="99bd6-146">This layer has no dependencies on Visual Studio components.</span></span>
