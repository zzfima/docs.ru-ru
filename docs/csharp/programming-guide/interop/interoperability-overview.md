---
title: "Общие сведения о взаимодействии. (Руководство по программированию в C#) | Microsoft Docs"
ms.date: "2015-07-20"
ms.prod: ".net"
ms.technology: 
  - "devlang-csharp"
ms.topic: "article"
dev_langs: 
  - "CSharp"
helpviewer_keywords: 
  - "C# - язык, взаимодействие"
  - "взаимодействие C++"
  - "COM-взаимодействие"
  - "взаимодействие, о взаимодействии"
  - "вызов неуправляемого кода"
ms.assetid: c025b2e0-2357-4c27-8461-118f0090aeff
caps.latest.revision: 43
author: "BillWagner"
ms.author: "wiwagn"
caps.handback.revision: 43
---
# Общие сведения о взаимодействии. (Руководство по программированию в C#)
В разделе описываются методы для разрешения взаимодействия между управляемым кодом C\# и неуправляемым кодом.  
  
## Вызов неуправляемого кода  
 *Вызов неуправляемого кода* — это служба, которая позволяет управляемому программному коду вызывать неуправляемые функции, реализуемые в библиотеках динамической компоновки \(DLL\), например, функции библиотек Microsoft Win32 API.  Вызов неуправляемого кода обнаруживает и вызывает экспортируемую функцию и при необходимости выполняет маршалинг ее аргументов \(целых чисел, строк, массивов, структур и так далее\) через границы взаимодействия.  
  
 Дополнительные сведения см. в разделах [Consuming Unmanaged DLL Functions](../Topic/Consuming%20Unmanaged%20DLL%20Functions.md) и [Практическое руководство. Использование вызова неуправляемого кода для воспроизведения звукового файла](../../../csharp/programming-guide/interop/how-to-use-platform-invoke-to-play-a-wave-file.md).  
  
> [!NOTE]
>  За управление доступом к ресурсам системы отвечает среда CLR \([Среда CLR](../Topic/Common%20Language%20Runtime%20\(CLR\).md)\).  При вызове неуправляемого кода вне среды CLR этот механизм защиты не задействуется, в связи с чем возникает угроза безопасности.  Например, неуправляемый код может напрямую обращаться к ресурсам неуправляемого кода, не используя механизмы обеспечения безопасности среды CLR.  Дополнительные сведения см. в разделе [Безопасность .NET Framework](http://go.microsoft.com/fwlink/?LinkId=37122).  
  
## Взаимодействие C\+\+  
 Можно использовать взаимодействие C\+\+, также известное как механизм "It Just Works" \(IJW\), чтобы создать программу\-оболочку для собственного класса C\+\+, чтобы он мог использоваться в коде, созданном в C\# или на другом языке .NET Framework.  Чтобы это сделать, необходимо написать код C\+\+, чтобы создать программу\-оболочку для собственного компонента DLL или COM.  В отличие от других языков .NET Framework, [!INCLUDE[vcprvc](../../../csharp/programming-guide/interop/includes/vcprvc-md.md)] поддерживает функцию взаимодействия, которая позволяет управляемому и неуправляемому коду находиться в одном приложении и даже в одном файле.  Затем выполняется построение кода C\+\+ с помощью переключателя компилятора **\/clr**, чтобы получить управляемую сборку.  Наконец, добавляется ссылка на сборку в проекте С\# и используются объекты с оболочкой, так же как при использовании других управляемых классов.  
  
## Предоставление компонентов COM для C\#  
 Компонент COM можно получить из проекта C\#.  Для этого необходимо выполнить следующие шаги:  
  
1.  Найдите компонент COM для использования и зарегистрируйте его.  Используйте файл regsvr32.exe для регистрации или отмены регистрации COM DLL.  
  
2.  Добавьте к проекту ссылку на компонент COM или библиотеку типов.  
  
     При добавлении ссылки [!INCLUDE[vsprvs](../../../csharp/includes/vsprvs-md.md)] использует [Tlbimp.exe \(Type Library Importer\)](../Topic/Tlbimp.exe%20\(Type%20Library%20Importer\).md), принимающее библиотеку типов в качетстве входных данных, для вывода сборки взаимодействия .NET Framework.  Сборка, также называемая "вызываемая оболочка времени выполнения" \(RCW\) содержит управляемые классы и интерфейсы, которые являются оболочкой для COM\-классов и интерфейсов, находящихся в библиотеке типов.  [!INCLUDE[vsprvs](../../../csharp/includes/vsprvs-md.md)] добавляет к проекту ссылку на созданную сборку.  
  
3.  Создайте экземпляр класса, определенного в вызываемой оболочке времени выполнения.  Это, в свою очередь, приведет к созданию экземпляра объекта COM.  
  
4.  Используйте объект так же, как используются другие управляемые объекты.  Когда объект удаляется сборкой мусора, экземпляр объекта COM также удаляется из памяти.  
  
 Дополнительные сведения см. в разделе [Exposing COM Components to the .NET Framework](../Topic/Exposing%20COM%20Components%20to%20the%20.NET%20Framework.md).  
  
## Предоставление C\# для COM  
 Клиенты COM могут получить типы C\#, которые были предоставлены должным образом.  Основные шаги для предоставления типов C\# следующие:  
  
1.  Добавьте в проект C\# атрибуты взаимодействия.  
  
     Сборку COM можно сделать видимой, изменив свойства проекта [!INCLUDE[csprcs](../../../csharp/includes/csprcs-md.md)].  Дополнительные сведения см. в разделе [Диалоговое окно "Сведения о сборке"](/visual-studio/ide/reference/assembly-information-dialog-box).  
  
2.  Создайте библиотеку типов COM и зарегистрируйте ее для использования COM.  
  
     Можно изменить свойства проекта [!INCLUDE[csprcs](../../../csharp/includes/csprcs-md.md)], чтобы автоматически зарегистрировать сборку C\# для COM\-взаимодействия.  [!INCLUDE[vsprvs](../../../csharp/includes/vsprvs-md.md)] использует [Regasm.exe \(Assembly Registration Tool\)](../Topic/Regasm.exe%20\(Assembly%20Registration%20Tool\).md), используя параметр командной строки `/tlb`, который принимает управляемую сборку в качестве входных данных, для создания библиотеки типов.  Эта библиотека типов описывает типы `public` в сборке и добавляет в реестр параметры, чтобы клиенты COM могли создавать управляемые классы.  
  
 Дополнительные сведения см. в разделах [Exposing .NET Framework Components to COM](../Topic/Exposing%20.NET%20Framework%20Components%20to%20COM.md) и [Пример COM\-класса](../../../csharp/programming-guide/interop/example-com-class.md).  
  
## См. также  
 [Повышение производительности Взаимодействия](http://go.microsoft.com/fwlink/?LinkId=99564)   
 [Знакомство с com\-взаимодействием](http://go.microsoft.com/fwlink/?LinkId=112406)   
 [Маршалинг между управляемым и неуправляемым кодом](http://go.microsoft.com/fwlink/?LinkId=112398)   
 [Interoperating with Unmanaged Code](../Topic/Interoperating%20with%20Unmanaged%20Code.md)   
 [Advanced COM Interoperability](http://msdn.microsoft.com/ru-ru/3ada36e5-2390-4d70-b490-6ad8de92f2fb)   
 [Руководство по программированию на C\#](../../../csharp/programming-guide/index.md)