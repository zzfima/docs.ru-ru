---
title: "Практическое руководство. Выполнение пользовательских операций соединения (Руководство по программированию на C#) | Microsoft Docs"
ms.custom: ""
ms.date: "12/15/2016"
ms.prod: "visual-studio-dev14"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "devlang-csharp"
ms.tgt_pltfrm: ""
ms.topic: "article"
dev_langs: 
  - "CSharp"
helpviewer_keywords: 
  - "настраиваемые соединения [C#]"
  - "соединения [C#], пользовательский"
  - "запросы [LINQ в C#], соединения"
  - "выражения запросов [LINQ в C#], соединения"
ms.assetid: a05e2ab1-410d-4a1d-8ada-af93539682c9
caps.latest.revision: 13
caps.handback.revision: 13
author: "BillWagner"
ms.author: "wiwagn"
manager: "wpickett"
---
# Практическое руководство. Выполнение пользовательских операций соединения (Руководство по программированию на C#)
[!INCLUDE[vs2017banner](../../../csharp/includes/vs2017banner.md)]

В этом примере показано, как выполнить операции соединения, которые нельзя осуществить с предложением `join`.  В выражении запроса предложение `join` ограничено уравнивающими соединениями и оптимизировано для них; они соединения являются самым общим типом операции соединения.  При выполнении уравнивающего соединения использование предложения `join`, возможно поможет обеспечить наилучшую производительность.  
  
 Однако предложение `join` нельзя использовать в следующих случаях:  
  
-   Соединение объявлено в выражении неравенства.  
  
-   Соединение объявлено в нескольких выражениях равенства или неравенства.  
  
-   Необходимость создания временной переменной диапазона для правосторонней \(внутренней\) последовательности перед операцией соединения.  
  
 Чтобы независимо представить каждый источник данных, при выполнении соединений, не являющихся уравнивающими, можно использовать несколько предложений `from`.  Затем переменной диапазона для каждого источника можно применить выражение предиката в предложении `where`.  Выражение также может принимать форму вызова метода.  
  
> [!NOTE]
>  Не путайте данный вид пользовательской операции соединения с использованием нескольких предложений `from` для доступа к внутренним коллекциям.  Дополнительные сведения см. в разделе [Предложение join](../../../csharp/language-reference/keywords/join-clause.md).  
  
## Пример  
 Первый метод в следующем примере показывает простое перекрестное соединение.  Перекрестные соединения следует использовать с осторожностью, поскольку они могут вернуть очень большие наборы результатов.  Однако такие соединения могут быть полезны при создании исходных последовательностей, относительно которых выполняются дополнительные запросы.  
  
 Результатом второго метода является последовательность всех продуктов, идентификатор категории которых находится в списке категорий с правой стороны.  Учтите необходимость использование предложения `let` и метода `Contains` для создания временного массива.  Также можно создать массив перед запросом и удалить первое предложение `from`.  
  
 [!code-cs[csProgGuideLINQ#64](../../../csharp/programming-guide/arrays/codesnippet/CSharp/how-to-perform-custom-join-operations_1.cs)]  
  
## Пример  
 В следующем примере запрос должен соединять две последовательности на основе сопоставления ключей, который в случае с внутренней \(правосторонней\) последовательностью не может быть получен до предложения соединения.  Если соединение было выполнено с предложением `join`, для каждого элемента требуется вызвать метод `Split`.  Использование нескольких предложений `from` позволяет запросу избежать издержек, связанных с повторным вызовом метода.  Однако поскольку `join` оптимизировано, в данном случае его использование может быть эффективнее нескольких предложений `from`.  Результаты будут зависеть в основном от затрат на вызов метода.  
  
 [!code-cs[csProgGuideLINQ#13](../../../csharp/programming-guide/arrays/codesnippet/CSharp/how-to-perform-custom-join-operations_2.cs)]  
  
## Компиляция кода  
  
-   Создайте проект консольного приложения [!INCLUDE[vs_current_short](../../../csharp/programming-guide/classes-and-structs/includes/vs_current_short_md.md)], который предназначен для [!INCLUDE[dnprdnshort](../../../csharp/getting-started/includes/dnprdnshort_md.md)] версии 3.5 или более поздней версии.  По умолчанию в проекте имеются ссылка на файл System.Core.dll и директива `using` \(C\#\) для пространства имен System.Linq.  
  
-   Замените класс `Program` кодом из предыдущего примера.  
  
-   Следуйте инструкциям в [How to: Join Content from Dissimilar Files \(LINQ\)](../Topic/How%20to:%20Join%20Content%20from%20Dissimilar%20Files%20\(LINQ\).md) для настройки файлов данных scores.csv и names.csv.  
  
-   Нажмите клавишу F5, чтобы скомпилировать и выполнить программу.  
  
-   Нажмите любую клавишу для выхода из окна консоли.  
  
## См. также  
 [Выражения запросов LINQ](../../../csharp/programming-guide/linq-query-expressions/index.md)   
 [Предложение join](../../../csharp/language-reference/keywords/join-clause.md)   
 [Join Operations](../../../visual-basic/programming-guide/concepts/linq/join-operations.md)   
 [Практическое руководство. Упорядочение результатов предложения соединения](../../../csharp/programming-guide/linq-query-expressions/how-to-order-the-results-of-a-join-clause.md)