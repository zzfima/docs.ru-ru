---
title: Практическое руководство. Безопасное приведение с помощью сопоставления шаблонов, а также операторов is и as
description: Узнайте, как использовать сопоставление шаблонов для безопасного приведения переменных в другой тип. Вы можете использовать сопоставление шаблонов, а также операторы as и is для безопасного преобразования типов.
ms.date: 09/05/2018
helpviewer_keywords:
- cast operators [C#], as and is operators
- as operator [C#]
- is operator [C#]
ms.openlocfilehash: 34c34865a2feece5fe037daeb035292aafd015b9
ms.sourcegitcommit: 99b153b93bf94d0fecf7c7bcecb58ac424dfa47c
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/25/2020
ms.locfileid: "80249361"
---
# <a name="how-to-safely-cast-by-using-pattern-matching-and-the-is-and-as-operators"></a>Практическое руководство. Безопасное приведение с помощью сопоставления шаблонов, а также операторов is и as

В связи с полиморфизмом объектов переменная типа базового класса может содержать производный [тип](../programming-guide/types/index.md). Для доступа к членам экземпляра производного типа необходимо [привести](../programming-guide/types/casting-and-type-conversions.md) значение обратно к производному типу. Однако приведение создает риск возникновения исключения <xref:System.InvalidCastException>. C# предоставляет операторы [сопоставления шаблонов](../pattern-matching.md), которые выполняют приведение условно только в случае успеха. C# также предоставляет операторы [is](../language-reference/operators/type-testing-and-cast.md#is-operator) и [as](../language-reference/operators/type-testing-and-cast.md#as-operator) для проверки определенного типа значения.

В следующем примере показано, как использовать сопоставление шаблонов `is`:

[!code-csharp[Pattern matching is statement](../../../samples/snippets/csharp/how-to/safelycast/patternmatching/Program.cs#PatternMatchingIs)]

В предыдущем примере показано несколько возможностей синтаксиса сопоставления шаблонов. Оператор `if (a is Mammal m)` объединяет проверку с назначением инициализации. Назначение происходит, только если проверка пройдет успешно. Переменная `m` действует только во внедренном операторе `if`, где она назначена. Вы не сможете получить доступ к `m` позже в этом же методе. В предыдущем примере также показано, как использовать [ оператора`as`](../language-reference/operators/type-testing-and-cast.md#as-operator) для преобразования объекта в указанный тип.

Вы можете использовать тот же синтаксис для проверки наличия значения у [типа значений, допускающего значение NULL](../language-reference/builtin-types/nullable-value-types.md), как показано в следующем примере:

[!code-csharp[Pattern matching with nullable types](../../../samples/snippets/csharp/how-to/safelycast/nullablepatternmatching/Program.cs#PatternMatchingNullable)]

В предыдущем примере показаны другие возможности сопоставления шаблонов для использования с преобразованиями. Вы можете проверить переменную для шаблона со значением NULL путем проверки конкретно значения `null`. Если значение переменной в среде выполнения равно `null`, оператор `is`, проверяющий тип, всегда возвращает `false`. Оператор сопоставления шаблонов `is` не принимает тип, допускающий значение NULL, например `int?` или `Nullable<int>`, но вы можете выполнить проверку для любого другого типа значения. Шаблоны `is` из предыдущего примера не ограничиваются типами значений, допускающими значение NULL. Эти шаблоны также можно использовать для проверки того, имеет ли переменная ссылочного типа значение или `null`.

Предыдущий пример также показывает, как использовать шаблон типа в операторе `switch`, где переменная может принимать один из множества различных типов.

Если вы хотите проверить, принадлежит ли переменная определенному типу, но не хотите назначать новую переменную, используйте операторы `is` и `as` для ссылочных типов и значений типов, допускающих значение NULL. Ниже показано, как использовать операторы `is` и `as`, которые были частью языка C# до того, как было введено сопоставление шаблонов для проверки принадлежности переменной к определенному типу.

[!code-csharp[testing variable types with the is and as statements](../../../samples/snippets/csharp/how-to/safelycast/asandis/Program.cs#IsAndAs)]

Как видно при сравнении этого кода с кодом сопоставления шаблонов, синтаксис сопоставления шаблонов предоставляет более надежные функции, поскольку сочетает в себе проверку и назначение в одном операторе. Используйте синтаксис сопоставления шаблонов во всех подходящих случаях.

Вы можете оценить эти примеры, просмотрев код в нашем [репозитории GitHub](https://github.com/dotnet/samples/tree/master/snippets/csharp/how-to/safelycast). Или можете загрузить образцы [в ZIP-файле](https://github.com/dotnet/samples/raw/master/snippets/csharp/how-to/safelycast.zip).
