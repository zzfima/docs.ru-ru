---
title: Обработка и вызов событий
ms.date: 03/30/2017
ms.technology: dotnet-standard
dev_langs:
- csharp
- vb
helpviewer_keywords:
- delegate model for events
- application development [.NET], events
- application development [.NET Framework], events
- application development [.NET Core], events
- events [.NET]
- events [.NET Core]
- events [.NET Framework]
ms.assetid: b6f65241-e0ad-4590-a99f-200ce741bb1f
ms.openlocfilehash: b8ed028bc1edabf14d7b2dd67d94b28d574d2eb4
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/15/2020
ms.locfileid: "78159628"
---
# <a name="handling-and-raising-events"></a>Обработка и создание событий

События в .NET основаны на модели делегата. Модель делегата соответствует [шаблону разработки наблюдателя](observer-design-pattern.md), который позволяет подписчику зарегистрироваться у поставщика и получать от него уведомления. Отправитель события отправляет уведомление о событии, а приемник событий получает уведомление и определяет ответ на него. В этом разделе описываются основные компоненты модели делегата, использование событий в приложениях и реализация событий в коде.  
  
 Дополнительные сведения об обработке событий в приложениях Магазина Windows 8.x см. в разделе [Общие сведения о событиях и перенаправленных событиях](https://docs.microsoft.com/previous-versions/windows/apps/hh758286(v=win.10)).  
  
## <a name="events"></a>События

Событие — это сообщение, посланное объектом, чтобы сообщить о совершении действия. Это действие может быть вызвано взаимодействием с пользователем, например при нажатии кнопки, или другой логикой программы, например изменением значения свойства. Объект, вызывающий событие, называется *отправителем событий*. Отправителю событий не известен объект или метод, который будет получать (обрабатывать) созданные им события. Обычно событие является членом отправителя событий; например, событие <xref:System.Web.UI.WebControls.Button.Click> — член класса <xref:System.Web.UI.WebControls.Button>, а событие <xref:System.ComponentModel.INotifyPropertyChanged.PropertyChanged> — член класса, реализующего интерфейс <xref:System.ComponentModel.INotifyPropertyChanged>.  
  
Чтобы определить событие, необходимо использовать ключевое слово [`event`](../../csharp/language-reference/keywords/event.md) в C# или [`Event`](../../visual-basic/language-reference/statements/event-statement.md) в Visual Basic в сигнатуре класса события и задать тип делегата для события. Делегаты описаны в следующем разделе.  
  
Как правило, для вызова события добавляется метод, помеченный как `protected` и `virtual` (в C#) или `Protected` и `Overridable` (в Visual Basic). Назовите этот метод `On`*EventName*; например, `OnDataReceived`. Метод должен принимать один параметр, который определяет объект данных события, являющийся объектом типа <xref:System.EventArgs> или производного типа. Этот метод предоставляется, чтобы производные классы могли переопределять логику для вызова события. Производный класс должен вызывать метод `On`*EventName* базового класса, чтобы зарегистрированные делегаты получили событие.  

В следующем примере показан способ объявления события `ThresholdReached`. Событие связано с делегатом <xref:System.EventHandler> и возникает в методе `OnThresholdReached`.  
  
 [!code-csharp[EventsOverview#1](~/samples/snippets/csharp/VS_Snippets_CLR/eventsoverview/cs/programtruncated.cs#1)]
 [!code-vb[EventsOverview#1](~/samples/snippets/visualbasic/VS_Snippets_CLR/eventsoverview/vb/module1truncated.vb#1)]  
  
## <a name="delegates"></a>Делегаты

Делегат — это тип, содержащий ссылку на метод. Делегат объявляется с сигнатурой, указывающей тип возвращаемого значения и параметры для методов, на которые он ссылается, и может содержать ссылки только на методы, соответствующие его сигнатуре. Таким образом, делегат эквивалентен указателю на строго типизированную функцию или обратному вызову. Объявления делегата достаточно для определения класса делегата.  
  
У делегатов широкая область применения в .NET. В контексте событий делегат — это посредник (или механизм, подобный указателю) между источником события и кодом, обрабатывающим событие. Делегат связывается с событием за счет включения типа делегата в объявление события, как показано в примере в предыдущем разделе. Дополнительные сведения о делегатах см. в разделе, посвященном классу <xref:System.Delegate>.  
  
.NET предоставляет делегаты <xref:System.EventHandler> и <xref:System.EventHandler%601> для поддержки большинства сценариев событий. Используйте делегат <xref:System.EventHandler> для всех событий, не содержащих данных. Используйте делегат <xref:System.EventHandler%601> для событий, содержащих данные о событии. У этих делегатов нет типа возвращаемого значения. Они принимают два параметра (объект для источника события и объект для данных события).  
  
Эти делегаты являются [многоадресными](xref:System.MulticastDelegate), то есть в них могут храниться ссылки на несколько методов обработки событий. Дополнительные сведения см. на справочной странице класса <xref:System.Delegate>. Делегаты позволяют гибко и точно управлять обработкой событий. Делегат выступает как диспетчер событий для класса, вызывающий событие за счет ведения списка зарегистрированных обработчиков для события.  
  
Для сценариев, в которых делегаты <xref:System.EventHandler> и <xref:System.EventHandler%601> не работают, можно определить собственный делегат. Сценарии, для которых необходимо определять собственные делегаты, очень редки. Это бывает, например, при работе с кодом, не распознающим универсальные типы. При объявлении делегат необходимо пометить ключевым словом [`delegate`](../../csharp/language-reference/builtin-types/reference-types.md#the-delegate-type) в C# или [`Delegate`](../../visual-basic/language-reference/statements/delegate-statement.md) в Visual Basic. В следующем примере показано, как объявить делегат с именем `ThresholdReachedEventHandler`.  
  
[!code-csharp[EventsOverview#4](~/samples/snippets/csharp/VS_Snippets_CLR/eventsoverview/cs/programtruncated.cs#4)]
[!code-vb[EventsOverview#4](~/samples/snippets/visualbasic/VS_Snippets_CLR/eventsoverview/vb/module1truncated.vb#4)]  
  
## <a name="event-data"></a>Данные событий

Данные, связанные с событием, могут быть предоставлены с помощью класса данных события. .NET предоставляет множество классов данных событий, которые можно использовать в приложениях. Например, класс <xref:System.IO.Ports.SerialDataReceivedEventArgs> — класс данных события <xref:System.IO.Ports.SerialPort.DataReceived?displayProperty=nameWithType>. В .NET имена всех классов данных событий оканчиваются ключевым словом `EventArgs`. Определить, какой класс данных события связан с событием, можно по делегату этого события. Например, делегат <xref:System.IO.Ports.SerialDataReceivedEventHandler> содержит класс <xref:System.IO.Ports.SerialDataReceivedEventArgs> в качестве одного из своих параметров.  
  
Класс <xref:System.EventArgs> является базовым типом для всех классов данных событий. Класс <xref:System.EventArgs> используется также, если событие не содержит связанных данных. При создании события, которое лишь уведомляет другие классы о том, что что-то произошло, и не передает никаких данных, используйте класс <xref:System.EventArgs> в качестве второго параметра в делегате. Если данные не предоставляются, можно передать значение <xref:System.EventArgs.Empty?displayProperty=nameWithType>. Делегат <xref:System.EventHandler> содержит класс <xref:System.EventArgs> в качестве параметра.  
  
Если требуется создать пользовательский класс данных события, создайте класс, производный от класса <xref:System.EventArgs>, а затем укажите все члены, необходимые для передачи данных, связанных с событием. В большинстве случаев следует использовать схему именования .NET и завершать имя класса данных события ключевым словом `EventArgs`.  
  
В следующем примере показан класс данных события с именем `ThresholdReachedEventArgs`. Он содержит свойства, относящиеся только к вызываемому событию.  
  
[!code-csharp[EventsOverview#3](~/samples/snippets/csharp/VS_Snippets_CLR/eventsoverview/cs/programtruncated.cs#3)]
[!code-vb[EventsOverview#3](~/samples/snippets/visualbasic/VS_Snippets_CLR/eventsoverview/vb/module1truncated.vb#3)]  
  
## <a name="event-handlers"></a>Обработчики событий

Для обработки события в приемнике события необходимо определить метод обработчика события. Этот метод должен соответствовать сигнатуре делегата обрабатываемого события. В обработчике событий выполняются действия, необходимые при возникновении события, например сбор данных, введенных пользователем при нажатии кнопки. Чтобы получать уведомления при возникновении события, метод обработчика события должен быть подписан на событие.  
  
В следующем примере показан метод обработчика события `c_ThresholdReached`, который соответствует сигнатуре делегата <xref:System.EventHandler>. Метод подписывается на событие `ThresholdReached`.  
  
[!code-csharp[EventsOverview#2](~/samples/snippets/csharp/VS_Snippets_CLR/eventsoverview/cs/programtruncated.cs#2)]
[!code-vb[EventsOverview#2](~/samples/snippets/visualbasic/VS_Snippets_CLR/eventsoverview/vb/module1truncated.vb#2)]  
  
## <a name="static-and-dynamic-event-handlers"></a>Обработчики статических и динамических событий  

.NET позволяет подписчикам регистрироваться для получения уведомлений о событиях как статически, так и динамически. Обработчики статических событий действуют в течение всего жизненного цикла класса, события которого они обрабатывают. Обработчики динамических событий активируются и деактивируются во время выполнения программы, обычно в ответ на определенную условную логику программы. Например, они могут использоваться, если уведомления о событиях требуются только в определенных условиях, либо приложение предоставляет несколько обработчиков событий и выбор конкретного обработчика зависит от условий среды выполнения. В примере в предыдущем разделе показано, как динамически добавлять обработчик события. Дополнительные сведения см. в разделах [события](../../visual-basic/programming-guide/language-features/events/index.md) (в Visual Basic) и [события](../../csharp/programming-guide/events/index.md) (в C#).  
  
## <a name="raising-multiple-events"></a>Создание нескольких событий  
 Если класс создает несколько событий, компилятор создает одно поле для каждого экземпляра делегата события. При большом количестве событий стоимость хранения одного поля на делегата может оказаться неприемлемой. Для таких случаев .NET предоставляет свойства события, которые можно использовать вместе с другой структурой данных для хранения делегатов события.  
  
 Свойства событий состоят из объявлений событий и методов доступа к событиям. Методы доступа к событиям — это определяемые пользователем методы, добавляющие или удаляющие экземпляры делегата события из структуры данных хранения. Обратите внимание, что использование свойств события снижает быстродействие по сравнению с полями события, поскольку перед вызовом каждого делегата события его необходимо извлечь. Необходимо найти компромисс между памятью и скоростью. Если ваш класс определяет много событий, которые вызываются нечасто, необходимо реализовать свойства событий. Дополнительные сведения см. в разделе [Практическое руководство. Обработка нескольких событий с помощью их свойств](how-to-handle-multiple-events-using-event-properties.md).  
  
## <a name="related-topics"></a>Связанные разделы  
  
|Название|Описание:|  
|-----------|-----------------|  
|[Практическое руководство. Вызов и прием событий](how-to-raise-and-consume-events.md)|Содержит примеры вызова и приема событий.|  
|[Практическое руководство. Обработка нескольких событий с помощью их свойств](how-to-handle-multiple-events-using-event-properties.md)|Показывает, как использовать свойства событий для обработки нескольких событий.|  
|[Шаблон разработки наблюдателя](observer-design-pattern.md)|Описывает шаблон разработки, позволяющий подписчику зарегистрироваться у поставщика и получать от него уведомления.|  
|[Практическое руководство. Прием событий в приложениях Web Forms](how-to-consume-events-in-a-web-forms-application.md)|Описывает способы обработки событий, вызванных элементом управления веб-форм (Web Forms).|  
  
## <a name="see-also"></a>См. также раздел

- <xref:System.EventHandler>
- <xref:System.EventHandler%601>
- <xref:System.EventArgs>
- <xref:System.Delegate>
- [События (Visual Basic)](../../visual-basic/programming-guide/language-features/events/index.md)
- [События (Руководство по программированию в C#)](../../csharp/programming-guide/events/index.md)
- [Общие сведения о событиях и перенаправленных событиях (приложения для UWP)](/windows/uwp/xaml-platform/events-and-routed-events-overview)
