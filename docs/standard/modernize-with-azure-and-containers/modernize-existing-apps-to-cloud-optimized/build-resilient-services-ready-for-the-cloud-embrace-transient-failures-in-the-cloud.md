---
title: Создание гибких служб, готовых для облака. Принятие временных сбоев в облаке
description: Модернизация существующих приложений .NET с помощью облака Azure и Windows контейнерах | Создание гибких служб, готовых для облака. Принятие временных сбоев в облаке
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 04/30/2018
ms.openlocfilehash: 801d017457d1cdc3c8a495c8127b203380cb1d9e
ms.sourcegitcommit: 40364ded04fa6cdcb2b6beca7f68412e2e12f633
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/28/2019
ms.locfileid: "56971836"
---
# <a name="build-resilient-services-ready-for-the-cloud-embrace-transient-failures-in-the-cloud"></a>Создание гибких служб, которые готовы к использованию облака: Принятие временных сбоев в облаке

Устойчивость — это возможность восстановления после сбоев и продолжение работы. Устойчивость не о избежать сбоев, но исходить следует из того, что происходит сбой и последующего ответа на них способом, который позволяет избежать простоев или потери данных. Цель устойчивости — вернуть приложение в полностью функционирующее состояние после сбоя.

Приложение будет готово для облака, когда и как минимум, он реализует модель на основе программного обеспечения устойчивости, а не модель на основе оборудования. Облачного приложения должна быть предусмотрена обработка частичных сбоев, которые наверняка будут происходить. Создание или частично рефакторинг приложения для обеспечения отказоустойчивости ожидаемый частичных сбоев. Оно должно уметь справляться с частичными сбоями, таких как временные сети и узлы или виртуальные машины, аварийно завершается в облаке. Даже контейнеры, перемещается на другой узел в кластере оркестратора может привести к кратковременным сбоям в приложении.

## <a name="handling-partial-failure"></a>Обработка частичного сбоя

В приложении облачных имеется постоянно присутствующей риск частичного сбоя. К примеру экземпляр одного веб-сайта или контейнер может произойти сбой, или оно может быть недоступна или не отвечает в течение некоторого времени. Кроме того, одна виртуальная машина или сервер могут завершаться со сбоем.

Так, как клиенты и службы являются отдельными процессами, служба может не иметь возможность своевременно реагировать на запрос клиента. Служба может быть перегружена и медленно отвечать на запросы, или он может быть недоступен в течение короткого времени из-за проблемы с сетью.

Например рассмотрим монолитного приложения .NET, которое обращается к базе данных в базе данных SQL Azure. Если базы данных Azure SQL или сторонняя служба не отвечает для кратких времени (к базе данных Azure SQL может быть перемещен на другой узел или сервер и не отвечать в течение нескольких секунд), когда пользователь пытается выполнить любое действие, приложения могут завершаться со сбоем и показывать w исключение одновременно.

Схожая ситуация может возникнуть в приложении, которое использует службы HTTP. Сети или самой службы могут оказаться недоступными в облаке во время короткий, это временная ошибка.

Надежное приложение, как показано на рисунке 4-9 следует реализовать методы, такие как «повторных попыток с экспоненциальной выдержкой» для предоставления возможности для обработки временных сбоев в ресурсы приложения. «Размыкатели цепи» также следует использовать в приложениях. Размыкатель цепи останавливает приложение из-за попытки доступа к ресурсу, когда это действительно длительный сбой. Используя Размыкатель цепи, приложение позволяет избежать подстегивающих мысль отказ в обслуживании на самого себя.

![Частичные сбои, обрабатывать повторные попытки с экспоненциальной выдержкой](./media/image9.png)

> **Рис. 4-9.** Частичные сбои, обрабатывать повторные попытки с экспоненциальной выдержкой

Эти методы можно использовать в HTTP-ресурсов и ресурсов базы данных. На рисунке 4-9, приложение основано на 3-уровневой архитектуре, поэтому необходимо, чтобы эти методы на уровне служб (HTTP) и на уровне данных уровня (TCP). В монолитном приложении, которое использует только одно приложение уровень, кроме базы данных (без дополнительных служб или микрослужбы) обработка временных ошибок на уровне подключения базы данных может оказаться достаточно. В этом случае необходим только конкретной конфигурации подключения к базе данных.

При реализации устойчивой обмена данными, доступ к базе данных, в зависимости от версии .NET, вы используете, может быть простым (например, [с Entity Framework 6 или более поздней версии](/ef/ef6/fundamentals/connection-resiliency/retry-logic). Это просто настройки подключения к базе данных). Или, может потребоваться использовать дополнительные библиотеки, такие как [временных Fault Handling Application Block](https://docs.microsoft.com/previous-versions/msp-n-p/hh680934(v=pandp.50)) (для более ранних версий платформы .NET), или даже реализовать свою собственную библиотеку.

При реализации повторных попыток HTTP и размыкателей цепи, для .NET рекомендуется использовать [Polly](https://github.com/App-vNext/Polly) библиотеку, предназначенную .NET Framework 4.0, .NET Framework 4.5 и .NET Standard 1.1, которая включает поддержку .NET Core.

Чтобы узнать, как для реализации стратегии для обработки частичных сбоев в облаке, см. следующие ссылки.

### <a name="additional-resources"></a>Дополнительные ресурсы

-   **Реализация устойчивых взаимодействия для обработки частичного сбоя**

    [https://docs.microsoft.com/dotnet/standard/microservices-architecture/implement-resilient-applications/partial-failure-strategies](../../microservices-architecture/implement-resilient-applications/partial-failure-strategies.md)

-   **Entity Framework подключения устойчивости и повторного выполнения логики (версия 6 и более поздние версии)**

    [https://docs.microsoft.com/ef/ef6/fundamentals/connection-resiliency/retry-logic](/ef/ef6/fundamentals/connection-resiliency/retry-logic)

-   **Блок приложения обработки временных сбоев**

-   <https://docs.microsoft.com/previous-versions/msp-n-p/hh680934(v=pandp.50)>

-   **Библиотека Polly для устойчивой связью HTTP**

    https://github.com/App-vNext/Polly

>[!div class="step-by-step"]
>[Назад](when-to-deploy-windows-containers-to-azure-container-service-kubernetes.md)
>[Вперед](modernize-your-apps-with-monitoring-and-telemetry.md)
