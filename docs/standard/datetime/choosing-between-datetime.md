---
title: Выбор между типами DateTime, DateTimeOffset, TimeSpan и TimeZoneInfo
ms.date: 04/10/2017
ms.technology: dotnet-standard
dev_langs:
- csharp
- vb
helpviewer_keywords:
- DateTimeOffset structure
- TimeZoneInfo class
- time zones [.NET Framework], common uses
- date and time classes [.NET Framework]
- time zones [.NET Framework], type options
- DateTime structure
ms.assetid: 07f17aad-3571-4014-9ef3-b695a86f3800
ms.openlocfilehash: 5425d94daf8ab023bef4a1a68f06d5c276499825
ms.sourcegitcommit: 559fcfbe4871636494870a8b716bf7325df34ac5
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/30/2019
ms.locfileid: "73132580"
---
# <a name="choosing-between-datetime-datetimeoffset-timespan-and-timezoneinfo"></a>Выбор между типами DateTime, DateTimeOffset, TimeSpan и TimeZoneInfo

Приложения .NET, использующие сведения о дате и времени, очень разнообразны и могут применять эти сведения различными способами. Чаще всего сведения о дате и времени используются в следующих целях:

- для представления только даты; сведения о времени не имеют значения;

- для представления только времени; сведения о дате не имеют значения;

- для представления абстрактных даты и времени, не привязанных к определенному времени и месту (например, большинство магазинов международных сетей открываются по рабочим дням в 9:00);

- Для получения сведений о дате и времени из источников, находящихся за пределами .NET, обычно данные о дате и времени хранятся в простом типе данных.

- для однозначной идентификации конкретного момента времени: некоторые приложения требуют, чтобы дата и время были однозначными только в основной системе; другие требуют, чтобы они были однозначным в разных системах (то есть дату, сериализованную в одной системе, можно достоверно десериализовать и использовать в другой системе в любой точке мира);

- для сохранения нескольких связанных значений времени (например, местного времени запрашивающей системы и серверного времени получения веб-запроса);

- для выполнения арифметических операций с датой и временем, возможно, с результатом, однозначно определяющим момент времени.

.NET включает типы <xref:System.DateTime>, <xref:System.DateTimeOffset>, <xref:System.TimeSpan>и <xref:System.TimeZoneInfo>, которые можно использовать для создания приложений, работающих с датами и временем.

> [!NOTE]
> В этом разделе не рассматривается <xref:System.TimeZone>, поскольку его функциональные возможности практически полностью включены в класс <xref:System.TimeZoneInfo>. Везде, где это возможно, используйте класс <xref:System.TimeZoneInfo>, а не класс <xref:System.TimeZone>.

## <a name="the-datetime-structure"></a>Структура DateTime

Значение <xref:System.DateTime> определяет конкретную дату и время. Он включает свойство <xref:System.DateTime.Kind%2A>, которое предоставляет ограниченные сведения о часовом поясе, к которому относится эта дата и время. Значение <xref:System.DateTimeKind> , возвращаемое свойством <xref:System.DateTime.Kind%2A> , указывает, представляет ли значение <xref:System.DateTime> местное время (<xref:System.DateTimeKind.Local?displayProperty=nameWithType>), время в формате UTC (<xref:System.DateTimeKind.Utc?displayProperty=nameWithType>) или неопределенное время (<xref:System.DateTimeKind.Unspecified?displayProperty=nameWithType>).

Структура <xref:System.DateTime> подходит для приложений, которые:

- работают только с датами;

- работают только со временем;

- работают с абстрактными датами и временем;

- работают с датами и временем, для которых отсутствуют сведения о часовом поясе;

- работают только с датами и временем в формате UTC;

- Получение сведений о дате и времени из источников за пределами .NET, таких как базы данных SQL. (как правило, информация о дате и времени хранится в этих источниках в простом формате, который совместим со структурой <xref:System.DateTime> );

- выполняют арифметические операции с датой и временем, но учитывают только общие результаты. Например, в операции сложения, которая добавляет шесть месяцев к определенным дате и времени, часто не важно, корректируется ли результат с учетом перехода на летнее время.

Кроме случая, когда определенное значение <xref:System.DateTime> представляет время в формате UTC, значение даты и времени часто является неоднозначным или ограниченным в плане возможности переноса. Например, если значение <xref:System.DateTime> представляет местное время, оно является переносимым внутри местного часового пояса (то есть если значение десериализуется в другой системе в том же часовом поясе, оно по-прежнему однозначно определяет конкретный момент времени). За пределами местного часового пояса значение <xref:System.DateTime> может иметь несколько интерпретаций. Если свойство <xref:System.DateTime.Kind%2A> имеет значение <xref:System.DateTimeKind.Unspecified?displayProperty=nameWithType>, значение даты и времени становится еще менее переносимым: в этом случае оно неоднозначно даже в том же часовом поясе и, возможно, даже на том же компьютере, на котором оно было впервые сериализовано. Значение <xref:System.DateTime> однозначно идентифицирует момент времени независимо от времени системы или часового пояса, в котором оно используется, только если это значение представляет время в формате UTC.

> [!IMPORTANT]
> При сохранении или совместном использовании данных <xref:System.DateTime> следует использовать формат UTC, а для свойства <xref:System.DateTime> значения <xref:System.DateTime.Kind%2A> должно быть задано значение <xref:System.DateTimeKind.Utc?displayProperty=nameWithType>.

## <a name="the-datetimeoffset-structure"></a>Структура DateTimeOffset

Структура <xref:System.DateTimeOffset> представляет значение даты и времени, а также смещение, которое указывает, насколько это значение отличается от времени в формате UTC. Таким образом, значение всегда однозначно идентифицирует единственный момент времени.

Тип <xref:System.DateTimeOffset> включает все функциональные возможности типа <xref:System.DateTime> , а также сведения о часовом поясе. Это делает его пригодным для приложений, выполняющих следующие действия:

- однозначно идентифицируют единственный момент времени; тип <xref:System.DateTimeOffset> можно использовать для однозначного определения текущего момента времени, для ведения журнала времени транзакций, ведения журнала времени событий системы или приложений, а также для записи времени создания и изменения файлов;

- выполняют общие арифметические операции с датами и временем;

- сохраняют несколько связанных значений времени, если они хранятся как два отдельных значения или два члена структуры.

> [!NOTE]
> Эти варианты использования значений <xref:System.DateTimeOffset> более распространены, чем варианты использования значений <xref:System.DateTime> . Соответственно, <xref:System.DateTimeOffset> следует рассматривать как тип даты и времени по умолчанию для разработки приложений.

Значение <xref:System.DateTimeOffset> не привязано к определенному часовому поясу, но может быть создано из любого часового пояса. Чтобы проиллюстрировать это, в примере ниже перечисляются часовые пояса, к которым может принадлежать ряд значений <xref:System.DateTimeOffset> (включая местное тихоокеанское время США).

[!code-csharp[System.DateTimeOffset.Conceptual#1](../../../samples/snippets/csharp/VS_Snippets_CLR_System/system.DateTimeOffset.Conceptual/cs/Conceptual1.cs#1)]
[!code-vb[System.DateTimeOffset.Conceptual#1](../../../samples/snippets/visualbasic/VS_Snippets_CLR_System/system.DateTimeOffset.Conceptual/vb/Conceptual1.vb#1)]

Выходные данные показывают, что все значения даты и времени в этом примере могут принадлежать по крайней мере трем разным часовым поясам. Значение <xref:System.DateTimeOffset> 6/10/2007 показывает, что если значение даты и времени представляет летнее время, его смещение от времени UTC необязательно соответствует базовому смещению UTC исходного часового пояса или смещению от времени UTC, указанному в его отображаемом имени. Это означает, что, так как одно значение <xref:System.DateTimeOffset> не является тесно связанным с его часовым поясом, оно не может отражать переход часового пояса с летнего на зимнее время и обратно. Это может быть особенно проблематичным, когда используются арифметические операции со значением <xref:System.DateTimeOffset> . Описание способов выполнения арифметических операций с датой и временем с учетом правил коррекции часового пояса см. в разделе [Выполнение арифметических операций с датами и временем](performing-arithmetic-operations.md).

## <a name="the-timespan-structure"></a>Структура TimeSpan

Структура <xref:System.TimeSpan> представляет интервал времени. Ее обычно используют двумя способами:

- для отражения интервала времени между двумя значениями даты и времени (например, при вычитании одного значения <xref:System.DateTime> из другого возвращается значение <xref:System.TimeSpan> );

- для измерения прошедшего времени. Например, свойство <xref:System.Diagnostics.Stopwatch.Elapsed%2A?displayProperty=nameWithType> возвращает <xref:System.TimeSpan> значение, отражающее интервал времени, прошедший с момента вызова одного из методов <xref:System.Diagnostics.Stopwatch>, которые начинают измерять прошедшее время.

Значение <xref:System.TimeSpan> может также использоваться в качестве замены для <xref:System.DateTime> значения, когда это значение отражает время без ссылки на конкретный день. Это использование аналогично свойствам <xref:System.DateTime.TimeOfDay%2A?displayProperty=nameWithType> и <xref:System.DateTimeOffset.TimeOfDay%2A?displayProperty=nameWithType>, которые возвращают значение <xref:System.TimeSpan>, представляющее время без ссылки на дату. Например, структуру <xref:System.TimeSpan> можно использовать для представления ежедневного времени открытия или закрытия магазина или времени, в которое происходит любое регулярное событие.

В примере ниже определяется структура `StoreInfo` , которая включает объекты <xref:System.TimeSpan> , представляющие время закрытия и открытия магазина, а также объект <xref:System.TimeZoneInfo> , представляющий часовой пояс магазина. Структура также включает два метода, `IsOpenNow` и `IsOpenAt`, указывающие, открыт ли магазин в то время, которое указал пользователь, предположительно находящийся в местном часовом поясе.

[!code-csharp[Conceptual.ChoosingDates#1](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.choosingdates/cs/datetimereplacement1.cs#1)]
[!code-vb[Conceptual.ChoosingDates#1](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.choosingdates/vb/datetimereplacement1.vb#1)]

Затем клиентский код может использовать структуру `StoreInfo` , как показано ниже.

[!code-csharp[Conceptual.ChoosingDates#2](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.choosingdates/cs/datetimereplacement1.cs#2)]
[!code-vb[Conceptual.ChoosingDates#2](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.choosingdates/vb/datetimereplacement1.vb#2)]

## <a name="the-timezoneinfo-class"></a>Класс TimeZoneInfo

Класс <xref:System.TimeZoneInfo> class represents any of the Earth's time zones, and enables the conversion of any date and time in one time zone to its equivalent in another time zone. Класс <xref:System.TimeZoneInfo> позволяет работать со значениями даты и времени, обеспечивая однозначную идентификацию единственного момента времени с помощью любого значения даты и времени. Класс <xref:System.TimeZoneInfo> также является расширяемым. Хотя он зависит от сведений о часовом поясе, предоставленных для систем Windows и определенных в реестре, он поддерживает создание настраиваемых часовых поясов. Кроме того, он поддерживает сериализацию и десериализацию сведений о часовом поясе.

В некоторых случаях использование всех преимуществ класса <xref:System.TimeZoneInfo> может потребовать дальнейших усилий по разработке. Если значения даты и времени не тесно связаны с часовыми поясами, к которым они относятся, требуется дополнительная работа. Если приложение не предоставляет какой-либо механизм для связывания даты и времени со связанным часовым поясом, то определенное значение даты и времени можно легко привязать к его часовому поясу. Одним из способов связывания этой информации является определение класса или структуры, содержащих значение даты и времени и связанный с ним часовой пояс.

Использование преимуществ поддержки часовых поясов в .NET возможно только в том случае, если часовой пояс, к которому относится значение даты и времени, известен при создании экземпляра объекта даты и времени. Как правило, это условие не выполняется, особенно в сетевых или веб-приложениях.

## <a name="see-also"></a>См. также

- [Даты, время и часовые пояса](../../../docs/standard/datetime/index.md)
