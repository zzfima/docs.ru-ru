---
title: Конструкции изменения в регулярных выражениях .NET
description: Узнайте, как использовать конструкции изменения для условного сопоставления в регулярных выражениях.
ms.date: 03/30/2017
ms.technology: dotnet-standard
dev_langs:
- csharp
- vb
helpviewer_keywords:
- either/or matching
- alternative matching patterns
- regular expressions, alternation constructs
- alternation constructs
- optional matching patterns
- constructs, alternation
- .NET Framework regular expressions, alternation constructs
ms.assetid: 071e22e9-fbb0-4ecf-add1-8d2424f9f2d1
ms.openlocfilehash: 8db9ef72415f148aca2c975fc4e8b70421e3adc3
ms.sourcegitcommit: 5f236cd78cf09593c8945a7d753e0850e96a0b80
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2020
ms.locfileid: "75711562"
---
# <a name="alternation-constructs-in-regular-expressions"></a>Конструкции изменения в регулярных выражениях

Конструкции изменения модифицируют регулярное выражение, включая сопоставление по принципу «либо/или» или условное сопоставление. Платформа .NET поддерживает три указанные далее конструкции изменения.

- [Сопоставление шаблонов с помощью |](#Either_Or)
- [Условное сопоставление (?(expression) yes|no)](#Conditional_Expr)
- [Условное сопоставление на основе действительной захватываемой группы](#Conditional_Group)

<a name="Either_Or"></a>
## <a name="pattern-matching-with-124"></a>Сопоставление шаблонов с помощью |

Вертикальную черту (`|`) можно использовать для сопоставления с любым набором шаблонов, в котором шаблоны разделяются с помощью символа `|`.

Как и класс положительных символов, символ `|` можно использовать для сопоставления с любым количеством отдельных символов. В следующем примере используется класс положительных символов и сопоставление с шаблоном либо/или с символом `|` для обнаружения в строке всех вхождений слов gray или grey. В этом случае символ `|` создает регулярное выражение, которое является более подробным.

[!code-csharp[RegularExpressions.Language.Alternation#1](~/samples/snippets/csharp/VS_Snippets_CLR/regularexpressions.language.alternation/cs/alternation1.cs#1)]
[!code-vb[RegularExpressions.Language.Alternation#1](~/samples/snippets/visualbasic/VS_Snippets_CLR/regularexpressions.language.alternation/vb/alternation1.vb#1)]

Возможные интерпретации регулярного выражения, использующего символ `|`, `\bgr(a|e)y\b`, показаны в следующей таблице:

|Шаблон|Описание|  
|-------------|-----------------|  
|`\b`|Начало на границе слова.|  
|`gr`|Соответствует символам gr.|  
|<code>(a&#124;e)</code>|Соответствует букве "a" или "e".|  
|`y\b`|Соответствует символу у на границе слова.|  

С помощью символа `|` также можно выполнить сопоставление "или/либо" с несколькими символами или частями выражения, которые могут включать любую комбинацию символьных литералов и элементов языка регулярных выражений. (Класс символов не предоставляет эту функцию). В следующем примере символ `|` используется для извлечения номера социального страхования США (SSN), который состоит из 9 цифр в формате *ddd*-*dd*-*dddd*, или номера идентификации работодателя США (EIN), который состоит из 9 цифр в формате *dd*-*ddddddd*.

[!code-csharp[RegularExpressions.Language.Alternation#2](~/samples/snippets/csharp/VS_Snippets_CLR/regularexpressions.language.alternation/cs/alternation2.cs#2)]
[!code-vb[RegularExpressions.Language.Alternation#2](~/samples/snippets/visualbasic/VS_Snippets_CLR/regularexpressions.language.alternation/vb/alternation2.vb#2)]  

Возможные интерпретации регулярного выражения `\b(\d{2}-\d{7}|\d{3}-\d{2}-\d{4})\b` показаны в следующей таблице:
  
|Шаблон|Описание|  
|-------------|-----------------|  
|`\b`|Начало на границе слова.|  
|<code>(\d{2}-\d{7}&#124;\d{3}-\d{2}-\d{4})</code>|Сопоставьте любые из следующих значений: два десятичных знака, за которыми следует дефис и еще семь десятичных знаков; или последовательность из трех десятичных знаков, дефиса, двух десятичных знаков, еще одного дефиса и четырех десятичных знаков.|  
|`\d`|Совпадение должно заканчиваться на границе слова.|  
  
<a name="Conditional_Expr"></a>   
## <a name="conditional-matching-with-an-expression"></a>Условное сопоставление с выражением

Этот элемент языка пытается сопоставить один из двух шаблонов в зависимости от того, может ли он сопоставить первоначальный шаблон. Он имеет следующий синтаксис:  

`(?(` *expression* `)` *yes* `|` *no* `)`

где *expression* — первый сопоставляемый шаблон, *yes* — шаблон, который необходимо сопоставить, если сопоставлен шаблон *expression* , а *no* — это дополнительный шаблон, который необходимо сопоставить, если *expression* не сопоставлен. Обработчик регулярных выражений рассматривает *expression* как утверждение нулевой ширины, то есть обработчик регулярных выражений не перемещается в потоке входных значений после оценки *expression*. Следовательно, эта конструкция эквивалентна следующему.

`(?(?=` *expression* `)` *yes* `|` *no* `)`

Где `(?=`*expression*`)` — это проверочное утверждение нулевой ширины. (Дополнительные сведения см. в разделе [Конструкции группировки](grouping-constructs-in-regular-expressions.md).) Поскольку обработчик регулярных выражений интерпретирует *expression* как привязку (утверждение нулевой ширины), *expression* должно представлять собой утверждение нулевой ширины (дополнительные сведения см. в статье [Привязки](anchors-in-regular-expressions.md)) или часть выражения, которая также содержится в *yes*. В противном случае шаблон *yes* сопоставить невозможно.  
  
> [!NOTE]
> Если *expression* является именованной или нумерованной захватываемой группой, конструкция изменения интерпретируется как тест захвата. Дополнительные сведения см. далее в подразделе [Условное сопоставление на основе действительной захватываемой группы](#Conditional_Group). Другими словами, обработчик регулярных выражений не пытается сопоставить захваченную часть строки, а вместо этого выполняет проверку на наличие или отсутствие группы.  
  
Следующий пример является вариантом примера, который описан в разделе [Сопоставление шаблонов «либо/или» с помощью |](#Either_Or). Условное сопоставление используется, чтобы определить, являются ли первые три символа после границы слова двумя цифрами и дефисом. Если да, предпринимается попытка сопоставить Идентификационный номер работодателя США (EIN). Если нет, предпринимается попытка сопоставить Номер социального страхования США (SSN).

[!code-csharp[RegularExpressions.Language.Alternation#3](~/samples/snippets/csharp/VS_Snippets_CLR/regularexpressions.language.alternation/cs/alternation3.cs#3)]
[!code-vb[RegularExpressions.Language.Alternation#3](~/samples/snippets/visualbasic/VS_Snippets_CLR/regularexpressions.language.alternation/vb/alternation3.vb#3)]

Возможные интерпретации шаблона регулярного выражения `\b(?(\d{2}-)\d{2}-\d{7}|\d{3}-\d{2}-\d{4})\b` показаны в следующей таблице:

|Шаблон|Описание|  
|-------------|-----------------|  
|`\b`|Начало на границе слова.|  
|`(?(\d{2}-)`|Определите, состоят ли следующие три символа из двух цифр, за которыми следуют дефис.|  
|`\d{2}-\d{7}`|Если предыдущий шаблон сопоставлен, сопоставьте две цифры с дефисом, за которыми следуют еще семь цифр.|  
|`\d{3}-\d{2}-\d{4}`|Если предыдущий шаблон не сопоставлен, сопоставьте три цифры, дефис, две цифры, еще один дефис и еще четыре цифры.|  
|`\b`|Соответствует границе слова.|  

<a name="Conditional_Group"></a>
## <a name="conditional-matching-based-on-a-valid-captured-group"></a>Условное сопоставление на основе действительной захватываемой группы.

Этот элемент языка пытается сопоставить один из двух шаблонов, в зависимости от того, соответствует ли он указанной группе записи. Он имеет следующий синтаксис:

`(?(` *name* `)` *yes* `|` *no* `)`

or

`(?(` *number* `)` *yes* `|` *no* `)`

где *name* — имя, а *number* — номер захватываемой группы, *yes* — сопоставляемое выражение, если для *name* или *number* имеется соответствие, а *no* — это дополнительное выражение для сопоставления при отсутствии соответствия.

Если *name* не соответствует имени захватываемой группы, которая используется в шаблоне регулярного выражения, конструкция изменения интерпретируется как проверка выражения, как было описано в предыдущем разделе. Как правило, это означает, что *expression* имеет значение `false`. Если *number* не соответствует нумерованной группе захвата, используемой в шаблоне регулярного выражения, обработчик регулярных выражений создает исключение <xref:System.ArgumentException>.

Следующий пример является вариантом примера, который описан в разделе [Сопоставление шаблонов «либо/или» с помощью |](#Either_Or). В нем используется захватываемая группа с именем `n2` , которая состоит из двух цифр и дефиса. Конструкция изменения проверяет, сопоставлена ли эта группа захвата в строке ввода. Если да, конструкция изменения пытается сопоставить последние семь цифр девятизначного Идентификационный номер работодателя США (EIN). В противном случае она пытается сопоставить девятизначный Номер социального страхования США (SSN).

[!code-csharp[RegularExpressions.Language.Alternation#4](~/samples/snippets/csharp/VS_Snippets_CLR/regularexpressions.language.alternation/cs/alternation4.cs#4)]
[!code-vb[RegularExpressions.Language.Alternation#4](~/samples/snippets/visualbasic/VS_Snippets_CLR/regularexpressions.language.alternation/vb/alternation4.vb#4)]

Возможные интерпретации шаблона регулярного выражения `\b(?<n2>\d{2}-)?(?(n2)\d{7}|\d{3}-\d{2}-\d{4})\b` показаны в следующей таблице:

|Шаблон|Описание|  
|-------------|-----------------|  
|`\b`|Начало на границе слова.|  
|`(?<n2>\d{2}-)?`|Сопоставьте нулевое или единичное вхождение двух цифр с дефисом. Установка для группы имени `n2`.|  
|`(?(n2)`|Проверка наличия сопоставления `n2` во входной строке.|  
|`\d{7}`|Если есть сопоставление `n2` , сопоставляются семь десятичных цифр.|  
|<code>&#124;\d{3}-\d{2}-\d{4}</code>|Если сопоставления нет `n2` , сопоставляются три десятичных цифры, дефис, две десятичных цифры, еще один дефис и четыре десятичных цифры.|  
|`\b`|Соответствует границе слова.|  

В следующем примере показана вариация этого примера, в котором вместо именованной группы используется нумерованная. Шаблон регулярного выражения выглядит следующим образом: `\b(\d{2}-)?(?(1)\d{7}|\d{3}-\d{2}-\d{4})\b`

[!code-csharp[RegularExpressions.Language.Alternation#5](~/samples/snippets/csharp/VS_Snippets_CLR/regularexpressions.language.alternation/cs/alternation5.cs#5)]
[!code-vb[RegularExpressions.Language.Alternation#5](~/samples/snippets/visualbasic/VS_Snippets_CLR/regularexpressions.language.alternation/vb/alternation5.vb#5)]

## <a name="see-also"></a>См. также

- [Элементы языка регулярных выражений — краткий справочник](regular-expression-language-quick-reference.md)
