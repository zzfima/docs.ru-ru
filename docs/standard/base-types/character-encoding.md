---
title: Кодировка символов в .NET
description: Сведения о кодировании и декодировании символов в .NET.
ms.date: 12/22/2017
ms.technology: dotnet-standard
dev_langs:
- csharp
- vb
helpviewer_keywords:
- encoding, understanding
- encoding, choosing
- encoding, fallback strategy
ms.assetid: bf6d9823-4c2d-48af-b280-919c5af66ae9
ms.custom: seodec18
ms.openlocfilehash: 3ac5602c32ce0dcfe21e913868faa7ab356e4194
ms.sourcegitcommit: 559fcfbe4871636494870a8b716bf7325df34ac5
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/30/2019
ms.locfileid: "73120592"
---
# <a name="character-encoding-in-net"></a><span data-ttu-id="3cbce-103">Кодировка символов в .NET</span><span class="sxs-lookup"><span data-stu-id="3cbce-103">Character Encoding in .NET</span></span>

<span data-ttu-id="3cbce-104">Символы — это абстрактные сущности, которые могут быть представлены различными способами.</span><span class="sxs-lookup"><span data-stu-id="3cbce-104">Characters are abstract entities that can be represented in many different ways.</span></span> <span data-ttu-id="3cbce-105">Кодировка — это система, где с каждым символом поддерживаемого набора символов сопоставляется значение, представляющее этот символ.</span><span class="sxs-lookup"><span data-stu-id="3cbce-105">A character encoding is a system that pairs each character in a supported character set with some value that represents that character.</span></span> <span data-ttu-id="3cbce-106">Например, азбука Морзе — это кодировка, в которой каждому символу латинского алфавита соответствует набор точек и тире, которые можно передавать с помощью телеграфа.</span><span class="sxs-lookup"><span data-stu-id="3cbce-106">For example, Morse code is a character encoding that pairs each character in the Roman alphabet with a pattern of dots and dashes that are suitable for transmission over telegraph lines.</span></span> <span data-ttu-id="3cbce-107">Компьютерная кодировка — это система, где с каждым символом поддерживаемого набора символов сопоставлено числовое значение, представляющее этот символ.</span><span class="sxs-lookup"><span data-stu-id="3cbce-107">A character encoding for computers pairs each character in a supported character set with a numeric value that represents that character.</span></span> <span data-ttu-id="3cbce-108">Кодировка состоит из двух компонентов:</span><span class="sxs-lookup"><span data-stu-id="3cbce-108">A character encoding has two distinct components:</span></span>

- <span data-ttu-id="3cbce-109">кодировщик, преобразующий последовательность символов в последовательность числовых значений (байтов);</span><span class="sxs-lookup"><span data-stu-id="3cbce-109">An encoder, which translates a sequence of characters into a sequence of numeric values (bytes).</span></span>

- <span data-ttu-id="3cbce-110">декодер, преобразующий последовательность байтов в последовательность символов.</span><span class="sxs-lookup"><span data-stu-id="3cbce-110">A decoder, which translates a sequence of bytes into a sequence of characters.</span></span>

<span data-ttu-id="3cbce-111">Кодировка описывает правила, по которым работают кодировщик и декодер.</span><span class="sxs-lookup"><span data-stu-id="3cbce-111">Character encoding describes the rules by which an encoder and a decoder operate.</span></span> <span data-ttu-id="3cbce-112">Например, класс <xref:System.Text.UTF8Encoding> описывает правила кодирования и декодирования для формата UTF-8, в котором используется от одного до четырех байтов для представления одного символа Юникода.</span><span class="sxs-lookup"><span data-stu-id="3cbce-112">For example, the <xref:System.Text.UTF8Encoding> class describes the rules for encoding to, and decoding from, 8-bit Unicode Transformation Format (UTF-8), which uses one to four bytes to represent a single Unicode character.</span></span> <span data-ttu-id="3cbce-113">В процессе кодирования и декодирования также может выполняться проверка.</span><span class="sxs-lookup"><span data-stu-id="3cbce-113">Encoding and decoding can also include validation.</span></span> <span data-ttu-id="3cbce-114">Например, класс <xref:System.Text.UnicodeEncoding> предназначен для проверки допустимости пар, составляемых всеми символами-заместителями.</span><span class="sxs-lookup"><span data-stu-id="3cbce-114">For example, the <xref:System.Text.UnicodeEncoding> class checks all surrogates  to make sure they constitute valid surrogate pairs.</span></span> <span data-ttu-id="3cbce-115">(Пара символов-заместителей состоит из символа с кодовой точкой в диапазоне от U+D800 до U+DBFF и символа с кодовой точкой в диапазоне от U+DC00 до U+DFFF.)  Резервная стратегия определяет, как кодировщик обрабатывает недопустимые символы или как декодер обрабатывает недопустимые байты.</span><span class="sxs-lookup"><span data-stu-id="3cbce-115">(A surrogate pair consists of a character with a code point that ranges from U+D800 to U+DBFF followed by a character with a code point that ranges from U+DC00 to U+DFFF.)  A fallback strategy determines how an encoder handles invalid characters or how a decoder handles invalid bytes.</span></span>

> [!WARNING]
> <span data-ttu-id="3cbce-116">Классы кодировок .NET позволяют хранить и преобразовывать символьные данные.</span><span class="sxs-lookup"><span data-stu-id="3cbce-116">.NET encoding classes provide a way to store and convert character data.</span></span> <span data-ttu-id="3cbce-117">Их не следует использовать для хранения двоичных данных в строковом виде.</span><span class="sxs-lookup"><span data-stu-id="3cbce-117">They should not be used to store binary data in string form.</span></span> <span data-ttu-id="3cbce-118">В зависимости от используемой кодировки преобразование двоичных данных в строковый формат с использованием классов кодировок может привести к неожиданному результату и неточным или поврежденным данным.</span><span class="sxs-lookup"><span data-stu-id="3cbce-118">Depending on the encoding used, converting binary data to string format with the encoding classes can introduce unexpected behavior and produce inaccurate or corrupted data.</span></span> <span data-ttu-id="3cbce-119">Для преобразования двоичных данных в строковый формат используйте метод <xref:System.Convert.ToBase64String%2A?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="3cbce-119">To convert binary data to a string form, use the <xref:System.Convert.ToBase64String%2A?displayProperty=nameWithType> method.</span></span>

<span data-ttu-id="3cbce-120">.NET использует для представления символов и строк кодировку UTF-16 (представленную классом <xref:System.Text.UnicodeEncoding>).</span><span class="sxs-lookup"><span data-stu-id="3cbce-120">.NET uses the UTF-16 encoding (represented by the <xref:System.Text.UnicodeEncoding> class) to represent characters and strings.</span></span> <span data-ttu-id="3cbce-121">В приложениях, предназначенных для среды CLR, кодировщики используются для сопоставления представлений символов Юникода, поддерживаемых средой CLR, с другими схемами кодирования.</span><span class="sxs-lookup"><span data-stu-id="3cbce-121">Applications that target the common language runtime use encoders to map Unicode character representations supported by the common language runtime to other encoding schemes.</span></span> <span data-ttu-id="3cbce-122">Декодеры служат для сопоставления символов различных кодировок с Юникодом.</span><span class="sxs-lookup"><span data-stu-id="3cbce-122">They use decoders to map characters from non-Unicode encodings to Unicode.</span></span>

<span data-ttu-id="3cbce-123">В этом разделе:</span><span class="sxs-lookup"><span data-stu-id="3cbce-123">This topic consists of the following sections:</span></span>

- [<span data-ttu-id="3cbce-124">Кодировки в .NET</span><span class="sxs-lookup"><span data-stu-id="3cbce-124">Encodings in .NET</span></span>](../../../docs/standard/base-types/character-encoding.md#Encodings)

- [<span data-ttu-id="3cbce-125">Выбор класса кодировки</span><span class="sxs-lookup"><span data-stu-id="3cbce-125">Selecting an Encoding Class</span></span>](../../../docs/standard/base-types/character-encoding.md#Selecting)

- [<span data-ttu-id="3cbce-126">Использование объекта кодировки</span><span class="sxs-lookup"><span data-stu-id="3cbce-126">Using an Encoding Object</span></span>](../../../docs/standard/base-types/character-encoding.md#Using)

- [<span data-ttu-id="3cbce-127">Выбор резервной стратегии</span><span class="sxs-lookup"><span data-stu-id="3cbce-127">Choosing a Fallback Strategy</span></span>](../../../docs/standard/base-types/character-encoding.md#FallbackStrategy)

- [<span data-ttu-id="3cbce-128">Implementing a Custom Fallback Strategy</span><span class="sxs-lookup"><span data-stu-id="3cbce-128">Implementing a Custom Fallback Strategy</span></span>](../../../docs/standard/base-types/character-encoding.md#Custom)

<a name="Encodings"></a>

## <a name="encodings-in-net"></a><span data-ttu-id="3cbce-129">Кодировки в .NET</span><span class="sxs-lookup"><span data-stu-id="3cbce-129">Encodings in .NET</span></span>

<span data-ttu-id="3cbce-130">Все классы кодировок в .NET наследуют от абстрактного класса <xref:System.Text.Encoding?displayProperty=nameWithType>, который определяет общую для всех кодировок функциональность.</span><span class="sxs-lookup"><span data-stu-id="3cbce-130">All character encoding classes in .NET inherit from the <xref:System.Text.Encoding?displayProperty=nameWithType> class, which is an abstract class that defines the functionality common to all character encodings.</span></span> <span data-ttu-id="3cbce-131">Для доступа к отдельным объектам кодировок, реализованным в .NET, можно сделать следующее:</span><span class="sxs-lookup"><span data-stu-id="3cbce-131">To access the individual encoding objects implemented in .NET, do the following:</span></span>

- <span data-ttu-id="3cbce-132">Используйте статические свойства класса <xref:System.Text.Encoding>, которые возвращают объекты, представляющие стандартные кодировки символов .NET (ASCII, UTF-7, UTF-8, UTF-16 и UTF-32).</span><span class="sxs-lookup"><span data-stu-id="3cbce-132">Use the static properties of the <xref:System.Text.Encoding> class, which return objects that represent the standard character encodings available in .NET (ASCII, UTF-7, UTF-8, UTF-16, and UTF-32).</span></span> <span data-ttu-id="3cbce-133">Например, свойство <xref:System.Text.Encoding.Unicode%2A?displayProperty=nameWithType> возвращает объект <xref:System.Text.UnicodeEncoding> .</span><span class="sxs-lookup"><span data-stu-id="3cbce-133">For example, the <xref:System.Text.Encoding.Unicode%2A?displayProperty=nameWithType> property returns a <xref:System.Text.UnicodeEncoding> object.</span></span> <span data-ttu-id="3cbce-134">Каждый объект использует резервную стратегию замены для обработки строк, которые он не может закодировать, и байтов, которые не может декодировать.</span><span class="sxs-lookup"><span data-stu-id="3cbce-134">Each object uses replacement fallback to handle strings that it cannot encode and bytes that it cannot decode.</span></span> <span data-ttu-id="3cbce-135">(Дополнительные сведения см. в разделе [Replacement Fallback](../../../docs/standard/base-types/character-encoding.md#Replacement) .)</span><span class="sxs-lookup"><span data-stu-id="3cbce-135">(For more information, see the [Replacement Fallback](../../../docs/standard/base-types/character-encoding.md#Replacement) section.)</span></span>

- <span data-ttu-id="3cbce-136">Вызвать конструктор класса кодировки.</span><span class="sxs-lookup"><span data-stu-id="3cbce-136">Call the encoding's class constructor.</span></span> <span data-ttu-id="3cbce-137">Таким образом могут быть созданы объекты для кодировок ASCII, UTF-7, UTF-8, UTF-16 и UTF-32.</span><span class="sxs-lookup"><span data-stu-id="3cbce-137">Objects for the ASCII, UTF-7, UTF-8, UTF-16, and UTF-32 encodings can be instantiated in this way.</span></span> <span data-ttu-id="3cbce-138">По умолчанию каждый объект использует резервную стратегию замены для обработки строк, которые он не может закодировать, и байтов, которые он не может декодировать, но вы можете указать, чтобы вместо этого создавалось исключение.</span><span class="sxs-lookup"><span data-stu-id="3cbce-138">By default, each object uses replacement fallback to handle strings that it cannot encode and bytes that it cannot decode, but you can specify that an exception should be thrown instead.</span></span> <span data-ttu-id="3cbce-139">(Дополнительные сведения см. в разделах [Replacement Fallback](../../../docs/standard/base-types/character-encoding.md#Replacement) и [Exception Fallback](../../../docs/standard/base-types/character-encoding.md#Exception) .)</span><span class="sxs-lookup"><span data-stu-id="3cbce-139">(For more information, see the [Replacement Fallback](../../../docs/standard/base-types/character-encoding.md#Replacement) and [Exception Fallback](../../../docs/standard/base-types/character-encoding.md#Exception) sections.)</span></span>

- <span data-ttu-id="3cbce-140">Вызвать конструктор <xref:System.Text.Encoding.%23ctor%28System.Int32%29?displayProperty=nameWithType> и передать ему целое число, представляющее кодировку.</span><span class="sxs-lookup"><span data-stu-id="3cbce-140">Call the <xref:System.Text.Encoding.%23ctor%28System.Int32%29?displayProperty=nameWithType> constructor and pass it an integer that represents the encoding.</span></span> <span data-ttu-id="3cbce-141">Объекты стандартных кодировок используют резервные стратегии замены, а объекты кодовых страниц и двухбайтовых кодировок (DBCS) используют резервную стратегию наилучшего соответствия для обработки строк, которые не удается закодировать, или байтов, которые не удается декодировать.</span><span class="sxs-lookup"><span data-stu-id="3cbce-141">Standard encoding objects use replacement fallback, and code page and double-byte character set (DBCS) encoding objects use best-fit fallback to handle strings that they cannot encode and bytes that they cannot decode.</span></span> <span data-ttu-id="3cbce-142">(Дополнительные сведения см. в разделе [Best-Fit Fallback](../../../docs/standard/base-types/character-encoding.md#BestFit) .)</span><span class="sxs-lookup"><span data-stu-id="3cbce-142">(For more information, see the [Best-Fit Fallback](../../../docs/standard/base-types/character-encoding.md#BestFit) section.)</span></span>

- <span data-ttu-id="3cbce-143">Вызовите метод <xref:System.Text.Encoding.GetEncoding%2A?displayProperty=nameWithType>, возвращающий любую стандартную кодировку, кодовую страницу или кодировку DBCS, доступную в .NET.</span><span class="sxs-lookup"><span data-stu-id="3cbce-143">Call the <xref:System.Text.Encoding.GetEncoding%2A?displayProperty=nameWithType> method, which returns any standard, code page, or DBCS encoding available in .NET.</span></span> <span data-ttu-id="3cbce-144">Перегрузки позволяют задать резервный объект как для кодировщика, так и для декодера.</span><span class="sxs-lookup"><span data-stu-id="3cbce-144">Overloads let you specify a fallback object for both the encoder and the decoder.</span></span>

> [!NOTE]
> <span data-ttu-id="3cbce-145">В стандарте Юникода каждому символу в каждом поддерживаемом символьном наборе присваивается кодовая точка (номер) и имя.</span><span class="sxs-lookup"><span data-stu-id="3cbce-145">The Unicode Standard assigns a code point (a number) and a name to each character in every supported script.</span></span> <span data-ttu-id="3cbce-146">Например, символ "A" представляется кодовой точкой U+0041 и именем LATIN CAPITAL LETTER A.</span><span class="sxs-lookup"><span data-stu-id="3cbce-146">For example, the character "A" is represented by the code point U+0041 and the name "LATIN CAPITAL LETTER A".</span></span> <span data-ttu-id="3cbce-147">Кодировки UTF определяют способы кодирования кодовой точки в виде последовательности из одного или нескольких байтов.</span><span class="sxs-lookup"><span data-stu-id="3cbce-147">The Unicode Transformation Format (UTF) encodings define ways to encode that code point into a sequence of one or more bytes.</span></span> <span data-ttu-id="3cbce-148">Схема кодировки Юникод упрощает разработку международных приложений, так как позволяет представлять символы любых наборов символов в единой кодировке.</span><span class="sxs-lookup"><span data-stu-id="3cbce-148">A Unicode encoding scheme simplifies world-ready application development because it allows characters from any character set to be represented in a single encoding.</span></span> <span data-ttu-id="3cbce-149">Разработчикам приложений больше не нужно сохранять данные о схеме кодировки, которая использовалась для представления символов конкретного языка или системы письма. Передача данных между системами, использующими различные языки, может происходить без искажений.</span><span class="sxs-lookup"><span data-stu-id="3cbce-149">Application developers no longer have to keep track of the encoding scheme that was used to produce characters for a specific language or writing system, and data can be shared among systems internationally without being corrupted.</span></span>
>
> <span data-ttu-id="3cbce-150">Платформа .NET поддерживает три кодировки, определенные стандартом Юникод: UTF-8, UTF-16 и UTF-32.</span><span class="sxs-lookup"><span data-stu-id="3cbce-150">.NET supports three encodings defined by the Unicode standard: UTF-8, UTF-16, and UTF-32.</span></span> <span data-ttu-id="3cbce-151">Дополнительные сведения см. в описании стандарта Юникод на [домашней странице Юникода](https://www.unicode.org/).</span><span class="sxs-lookup"><span data-stu-id="3cbce-151">For more information, see The Unicode Standard at the [Unicode home page](https://www.unicode.org/).</span></span>

<span data-ttu-id="3cbce-152">Информацию обо всех доступных в .NET кодировках можно получить, вызвав метод <xref:System.Text.Encoding.GetEncodings%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="3cbce-152">You can retrieve information about all the encodings available in .NET by calling the <xref:System.Text.Encoding.GetEncodings%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="3cbce-153">Платформа .NET поддерживает системы кодирования символов, перечисленные в таблице ниже.</span><span class="sxs-lookup"><span data-stu-id="3cbce-153">.NET supports the character encoding systems listed in the following table.</span></span>

|<span data-ttu-id="3cbce-154">кодировка</span><span class="sxs-lookup"><span data-stu-id="3cbce-154">Encoding</span></span>|<span data-ttu-id="3cbce-155">Класс</span><span class="sxs-lookup"><span data-stu-id="3cbce-155">Class</span></span>|<span data-ttu-id="3cbce-156">ОПИСАНИЕ</span><span class="sxs-lookup"><span data-stu-id="3cbce-156">Description</span></span>|<span data-ttu-id="3cbce-157">Преимущества и недостатки</span><span class="sxs-lookup"><span data-stu-id="3cbce-157">Advantages/disadvantages</span></span>|
|--------------|-----------|-----------------|-------------------------------|
|<span data-ttu-id="3cbce-158">ASCII</span><span class="sxs-lookup"><span data-stu-id="3cbce-158">ASCII</span></span>|<xref:System.Text.ASCIIEncoding>|<span data-ttu-id="3cbce-159">Кодирует ограниченный диапазон символов, используя семь младших битов байта.</span><span class="sxs-lookup"><span data-stu-id="3cbce-159">Encodes a limited range of characters by using the lower seven bits of a byte.</span></span>|<span data-ttu-id="3cbce-160">Так как эта кодировка поддерживает только значения символов от U+0000 до U+007F, то в большинстве случаев она не отвечает требованиям международных приложений.</span><span class="sxs-lookup"><span data-stu-id="3cbce-160">Because this encoding only supports character values from U+0000 through U+007F, in most cases it is inadequate for internationalized applications.</span></span>|
|<span data-ttu-id="3cbce-161">UTF-7</span><span class="sxs-lookup"><span data-stu-id="3cbce-161">UTF-7</span></span>|<xref:System.Text.UTF7Encoding>|<span data-ttu-id="3cbce-162">Представляет символы в виде последовательностей 7-разрядных символов ASCII.</span><span class="sxs-lookup"><span data-stu-id="3cbce-162">Represents characters as sequences of 7-bit ASCII characters.</span></span> <span data-ttu-id="3cbce-163">Символы Юникода, не относящиеся к ASCII, представляются в виде escape-последовательности символов ASCII.</span><span class="sxs-lookup"><span data-stu-id="3cbce-163">Non-ASCII Unicode characters are represented by an escape sequence of ASCII characters.</span></span>|<span data-ttu-id="3cbce-164">UTF-7 поддерживает протоколы, например протоколы электронной почты и группы новостей.</span><span class="sxs-lookup"><span data-stu-id="3cbce-164">UTF-7 supports protocols such as email and newsgroup protocols.</span></span> <span data-ttu-id="3cbce-165">Однако формат UTF-7 недостаточно безопасен и надежен.</span><span class="sxs-lookup"><span data-stu-id="3cbce-165">However, UTF-7 is not particularly secure or robust.</span></span> <span data-ttu-id="3cbce-166">В некоторых случаях изменение одного бита может привести к существенному изменению интерпретации всей строки UTF-7.</span><span class="sxs-lookup"><span data-stu-id="3cbce-166">In some cases, changing one bit can radically alter the interpretation of an entire UTF-7 string.</span></span> <span data-ttu-id="3cbce-167">В других случаях для кодировки одного и того же текста могут использоваться разные строки UTF-7.</span><span class="sxs-lookup"><span data-stu-id="3cbce-167">In other cases, different UTF-7 strings can encode the same text.</span></span> <span data-ttu-id="3cbce-168">В последовательностях, содержащих отличные от ASCII символы, формат UTF-7 требует больше места, чем UTF-8, а кодирование и декодирование выполняются медленнее.</span><span class="sxs-lookup"><span data-stu-id="3cbce-168">For sequences that include non-ASCII characters, UTF-7 requires more space than UTF-8, and encoding/decoding is slower.</span></span> <span data-ttu-id="3cbce-169">Поэтому по возможности лучше использовать UTF-8 вместо UTF-7.</span><span class="sxs-lookup"><span data-stu-id="3cbce-169">Consequently, you should use UTF-8 instead of UTF-7 if possible.</span></span>|
|<span data-ttu-id="3cbce-170">UTF-8</span><span class="sxs-lookup"><span data-stu-id="3cbce-170">UTF-8</span></span>|<xref:System.Text.UTF8Encoding>|<span data-ttu-id="3cbce-171">Представляет каждую кодовую точку Юникода в виде последовательности от одного до четырех байтов.</span><span class="sxs-lookup"><span data-stu-id="3cbce-171">Represents each Unicode code point as a sequence of one to four bytes.</span></span>|<span data-ttu-id="3cbce-172">UTF-8 поддерживает 8-разрядный размер данных и хорошо работает со многими операционными системами.</span><span class="sxs-lookup"><span data-stu-id="3cbce-172">UTF-8 supports 8-bit data sizes and works well with many existing operating systems.</span></span> <span data-ttu-id="3cbce-173">Для диапазона символов ASCII кодировка UTF-8 идентична кодировке ASCII и предоставляет более широкий набор символов.</span><span class="sxs-lookup"><span data-stu-id="3cbce-173">For the ASCII range of characters, UTF-8 is identical to ASCII encoding and allows a broader set of characters.</span></span> <span data-ttu-id="3cbce-174">Однако для китайской, японской и корейской письменности UTF-8 может потребовать три байта для каждого символа, что может привести к большему объему данных по сравнению с UTF-16.</span><span class="sxs-lookup"><span data-stu-id="3cbce-174">However, for Chinese-Japanese-Korean (CJK) scripts, UTF-8 can require three bytes for each character, and can potentially cause larger data sizes than UTF-16.</span></span> <span data-ttu-id="3cbce-175">Обратите внимание, что иногда увеличение размера данных для китайской, японской и корейской письменности объясняется объемом данных ASCII, например тегами HTML.</span><span class="sxs-lookup"><span data-stu-id="3cbce-175">Note that sometimes the amount of ASCII data, such as HTML tags, justifies the increased size for the CJK range.</span></span>|
|<span data-ttu-id="3cbce-176">UTF-16</span><span class="sxs-lookup"><span data-stu-id="3cbce-176">UTF-16</span></span>|<xref:System.Text.UnicodeEncoding>|<span data-ttu-id="3cbce-177">Представляет каждую кодовую точку Юникода в виде последовательности одного или двух 16-разрядных целых чисел.</span><span class="sxs-lookup"><span data-stu-id="3cbce-177">Represents each Unicode code point as a sequence of one or two 16-bit integers.</span></span> <span data-ttu-id="3cbce-178">Наиболее распространенные символы Юникода требуют только одной кодовой точки UTF-16, хотя дополнительные символы Юникода (U+10000 и далее) требуют двух замещающих кодовых точек UTF-16.</span><span class="sxs-lookup"><span data-stu-id="3cbce-178">Most common Unicode characters require only one UTF-16 code point, although Unicode supplementary characters (U+10000 and greater) require two UTF-16 surrogate code points.</span></span> <span data-ttu-id="3cbce-179">Поддерживаются оба порядка байтов: прямой и обратный.</span><span class="sxs-lookup"><span data-stu-id="3cbce-179">Both little-endian and big-endian byte orders are supported.</span></span>|<span data-ttu-id="3cbce-180">Кодировка UTF-16 используется средой CLR для представления значений <xref:System.Char> и <xref:System.String> , а операционной системой Windows — для представления значений `WCHAR` .</span><span class="sxs-lookup"><span data-stu-id="3cbce-180">UTF-16 encoding is used by the common language runtime to represent <xref:System.Char> and <xref:System.String> values, and it is used by the Windows operating system to represent `WCHAR` values.</span></span>|
|<span data-ttu-id="3cbce-181">UTF-32</span><span class="sxs-lookup"><span data-stu-id="3cbce-181">UTF-32</span></span>|<xref:System.Text.UTF32Encoding>|<span data-ttu-id="3cbce-182">Представляет каждую кодовую точку Юникода в виде 32-разрядного целого числа.</span><span class="sxs-lookup"><span data-stu-id="3cbce-182">Represents each Unicode code point as a 32-bit integer.</span></span> <span data-ttu-id="3cbce-183">Поддерживаются оба порядка байтов: прямой и обратный.</span><span class="sxs-lookup"><span data-stu-id="3cbce-183">Both little-endian and big-endian byte orders are supported.</span></span>|<span data-ttu-id="3cbce-184">Кодировка UTF-32 используется в случае, когда приложению требуется избежать поведения замещающей кодовой точки кодировки UTF-16 в операционных системах, в которых закодированное пространство имеет большое значение.</span><span class="sxs-lookup"><span data-stu-id="3cbce-184">UTF-32 encoding is used when applications want to avoid the surrogate code point behavior of UTF-16 encoding on operating systems for which encoded space is too important.</span></span> <span data-ttu-id="3cbce-185">Для кодирования отдельных отображаемых глифов может использоваться несколько символов UTF-32.</span><span class="sxs-lookup"><span data-stu-id="3cbce-185">Single glyphs rendered on a display can still be encoded with more than one UTF-32 character.</span></span>|
|<span data-ttu-id="3cbce-186">Кодировки ANSI и ISO</span><span class="sxs-lookup"><span data-stu-id="3cbce-186">ANSI/ISO encodings</span></span>||<span data-ttu-id="3cbce-187">Предоставляет поддержку ряда кодовых страниц.</span><span class="sxs-lookup"><span data-stu-id="3cbce-187">Provides support for a variety of code pages.</span></span> <span data-ttu-id="3cbce-188">В операционных системах Windows кодовые страницы используются для поддержки конкретного языка или группы языков.</span><span class="sxs-lookup"><span data-stu-id="3cbce-188">On Windows operating systems, code pages are used to support a specific language or group of languages.</span></span> <span data-ttu-id="3cbce-189">Таблицу кодовых страниц, поддерживаемых платформой .NET, можно найти в описании класса <xref:System.Text.Encoding>.</span><span class="sxs-lookup"><span data-stu-id="3cbce-189">For a table that lists the code pages supported by .NET, see the <xref:System.Text.Encoding> class.</span></span> <span data-ttu-id="3cbce-190">Чтобы получить объект кодировки для конкретной кодовой страницы, можно вызвать метод <xref:System.Text.Encoding.GetEncoding%28System.Int32%29?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="3cbce-190">You can retrieve an encoding object for a particular code page by calling the <xref:System.Text.Encoding.GetEncoding%28System.Int32%29?displayProperty=nameWithType> method.</span></span>|<span data-ttu-id="3cbce-191">Кодовая страница содержит 256 кодовых точек с отсчетом от нуля.</span><span class="sxs-lookup"><span data-stu-id="3cbce-191">A code page contains 256 code points and is zero-based.</span></span> <span data-ttu-id="3cbce-192">В большинстве кодовых страниц кодовые точки от 0 до 127 представляют набор символов ASCII, а кодовые точки от 128 до 255 существенно отличаются у разных кодовых страниц.</span><span class="sxs-lookup"><span data-stu-id="3cbce-192">In most code pages, code points 0 through 127 represent the ASCII character set, and code points 128 through 255 differ significantly between code pages.</span></span> <span data-ttu-id="3cbce-193">Например, кодовая страница 1252 предоставляет символы для латинских систем письма, включая английский, немецкий и французский языки.</span><span class="sxs-lookup"><span data-stu-id="3cbce-193">For example, code page 1252 provides the characters for Latin writing systems, including English, German, and French.</span></span> <span data-ttu-id="3cbce-194">Последние 128 кодовых точек на кодовой странице 1252 содержат диакритические знаки.</span><span class="sxs-lookup"><span data-stu-id="3cbce-194">The last 128 code points in code page 1252 contain the accent characters.</span></span> <span data-ttu-id="3cbce-195">Кодовая страница 1253 содержит коды символов, которые требуются в греческой системе письма.</span><span class="sxs-lookup"><span data-stu-id="3cbce-195">Code page 1253 provides character codes that are required in the Greek writing system.</span></span> <span data-ttu-id="3cbce-196">Последние 128 кодовых точек на кодовой странице 1253 содержат символы греческого языка.</span><span class="sxs-lookup"><span data-stu-id="3cbce-196">The last 128 code points in code page 1253 contain the Greek characters.</span></span> <span data-ttu-id="3cbce-197">Таким образом, в приложении, использующем кодовые страницы ANSI, нельзя хранить греческий и немецкий тексты в одном потоке, если он не содержит идентификатор, указывающий соответствующую кодовую страницу.</span><span class="sxs-lookup"><span data-stu-id="3cbce-197">As a result, an application that relies on ANSI code pages cannot store Greek and German in the same text stream unless it includes an identifier that indicates the referenced code page.</span></span>|
|<span data-ttu-id="3cbce-198">Двухбайтовые кодировки (DBCS)</span><span class="sxs-lookup"><span data-stu-id="3cbce-198">Double-byte character set (DBCS) encodings</span></span>||<span data-ttu-id="3cbce-199">Поддерживают языки, такие как китайский, японский и корейский, содержащие более 256 символов.</span><span class="sxs-lookup"><span data-stu-id="3cbce-199">Supports languages, such as Chinese, Japanese, and Korean, that contain more than 256 characters.</span></span> <span data-ttu-id="3cbce-200">В кодировке DBCS каждый символ представлен парой кодовых точек (два байта).</span><span class="sxs-lookup"><span data-stu-id="3cbce-200">In a DBCS, a pair of code points (a double byte) represents each character.</span></span> <span data-ttu-id="3cbce-201">Свойство <xref:System.Text.Encoding.IsSingleByte%2A?displayProperty=nameWithType> возвращает значение `false` для двухбайтовых кодировок.</span><span class="sxs-lookup"><span data-stu-id="3cbce-201">The <xref:System.Text.Encoding.IsSingleByte%2A?displayProperty=nameWithType> property returns `false` for DBCS encodings.</span></span> <span data-ttu-id="3cbce-202">Чтобы получить объект кодировки для конкретной кодировки DBCS, можно вызвать метод <xref:System.Text.Encoding.GetEncoding%28System.Int32%29?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="3cbce-202">You can retrieve an encoding object for a particular DBCS by calling the <xref:System.Text.Encoding.GetEncoding%28System.Int32%29?displayProperty=nameWithType> method.</span></span>|<span data-ttu-id="3cbce-203">В кодировке DBCS каждый символ представлен парой кодовых точек (два байта).</span><span class="sxs-lookup"><span data-stu-id="3cbce-203">In a DBCS, a pair of code points (a double byte) represents each character.</span></span> <span data-ttu-id="3cbce-204">Когда приложение обрабатывает данные DBCS, первый байт символа DBCS (старший байт) обрабатывается в сочетании со вторым байтом, следующим непосредственно за ним.</span><span class="sxs-lookup"><span data-stu-id="3cbce-204">When an application handles DBCS data, the first byte of a DBCS character (the lead byte) is processed in combination with the trail byte that immediately follows it.</span></span> <span data-ttu-id="3cbce-205">Так как одна пара двухбайтовых кодовых точек может представлять различные символы в зависимости от кодовой страницы, эта схема также не позволяет использовать в одном потоке данных два языка, например японский и китайский.</span><span class="sxs-lookup"><span data-stu-id="3cbce-205">Because a single pair of double-byte code points can represent different characters depending on the code page, this scheme still does not allow for the combination of two languages, such as Japanese and Chinese, in the same data stream.</span></span>|

<span data-ttu-id="3cbce-206">Эти кодировки позволяют работать с символами Юникода, а также с кодировками, которые часто используются в приложениях прежних версий.</span><span class="sxs-lookup"><span data-stu-id="3cbce-206">These encodings enable you to work with Unicode characters as well as with encodings that are most commonly used in legacy applications.</span></span> <span data-ttu-id="3cbce-207">Кроме того, можно создать настраиваемую кодировку, определив класс, производный от <xref:System.Text.Encoding> , и переопределив его члены.</span><span class="sxs-lookup"><span data-stu-id="3cbce-207">In addition, you can create a custom encoding by defining a class that derives from <xref:System.Text.Encoding> and overriding its members.</span></span>

### <a name="platform-notes-net-core"></a><span data-ttu-id="3cbce-208">Заметки о платформе: .NET Core</span><span class="sxs-lookup"><span data-stu-id="3cbce-208">Platform Notes: .NET Core</span></span>

<span data-ttu-id="3cbce-209">По умолчанию .NET Core не предоставляет доступ к кодировкам кодовых страниц, кроме кодовой страницы 28591 и кодировок Юникода, например UTF-8 и UTF-16.</span><span class="sxs-lookup"><span data-stu-id="3cbce-209">By default, .NET Core does not make available any code page encodings other than code page 28591 and the Unicode encodings, such as UTF-8 and UTF-16.</span></span> <span data-ttu-id="3cbce-210">Но вы можете добавить в свое приложение кодировки кодовых страниц из стандартных приложений Windows, ориентированных на .NET.</span><span class="sxs-lookup"><span data-stu-id="3cbce-210">However, you can add the code page encodings found in standard Windows apps that target .NET to your app.</span></span> <span data-ttu-id="3cbce-211">Подробнее см. в разделе <xref:System.Text.CodePagesEncodingProvider> .</span><span class="sxs-lookup"><span data-stu-id="3cbce-211">For complete information, see the <xref:System.Text.CodePagesEncodingProvider> topic.</span></span>

<a name="Selecting"></a>

## <a name="selecting-an-encoding-class"></a><span data-ttu-id="3cbce-212">Выбор класса кодировки</span><span class="sxs-lookup"><span data-stu-id="3cbce-212">Selecting an Encoding Class</span></span>

<span data-ttu-id="3cbce-213">Если у вас есть возможность выбрать кодировку для использования в приложении, следует использовать Юникод, предпочтительно <xref:System.Text.UTF8Encoding> или <xref:System.Text.UnicodeEncoding>.</span><span class="sxs-lookup"><span data-stu-id="3cbce-213">If you have the opportunity to choose the encoding to be used by your application, you should use a Unicode encoding, preferably either <xref:System.Text.UTF8Encoding> or <xref:System.Text.UnicodeEncoding>.</span></span> <span data-ttu-id="3cbce-214">(Также .NET поддерживает третью кодировку Юникода: <xref:System.Text.UTF32Encoding>.)</span><span class="sxs-lookup"><span data-stu-id="3cbce-214">(.NET also supports a third Unicode encoding, <xref:System.Text.UTF32Encoding>.)</span></span>

<span data-ttu-id="3cbce-215">Если вы планируете использовать кодировку ASCII (<xref:System.Text.ASCIIEncoding>), выберите вместо нее <xref:System.Text.UTF8Encoding> .</span><span class="sxs-lookup"><span data-stu-id="3cbce-215">If you are planning to use an ASCII encoding (<xref:System.Text.ASCIIEncoding>), choose <xref:System.Text.UTF8Encoding> instead.</span></span> <span data-ttu-id="3cbce-216">Эти две кодировки идентичны для набора символов ASCII, но <xref:System.Text.UTF8Encoding> имеет указанные ниже преимущества.</span><span class="sxs-lookup"><span data-stu-id="3cbce-216">The two encodings are identical for the ASCII character set, but <xref:System.Text.UTF8Encoding> has the following advantages:</span></span>

- <span data-ttu-id="3cbce-217">Она может представлять любой символ Юникода, тогда как <xref:System.Text.ASCIIEncoding> поддерживает только символы Юникода в диапазоне от U+0000 до U+007F.</span><span class="sxs-lookup"><span data-stu-id="3cbce-217">It can represent every Unicode character, whereas <xref:System.Text.ASCIIEncoding> supports only the Unicode character values between U+0000 and U+007F.</span></span>

- <span data-ttu-id="3cbce-218">Она обеспечивает обнаружение ошибок и более высокий уровень безопасности.</span><span class="sxs-lookup"><span data-stu-id="3cbce-218">It provides error detection and better security.</span></span>

- <span data-ttu-id="3cbce-219">Она настроена для максимально быстрой работы и должна быть быстрее любых других кодировок.</span><span class="sxs-lookup"><span data-stu-id="3cbce-219">It has been tuned to be as fast as possible and should be faster than any other encoding.</span></span> <span data-ttu-id="3cbce-220">Даже для содержимого, имеющего только формат ASCII, выполнение операций с помощью <xref:System.Text.UTF8Encoding> происходит быстрее, чем с помощью <xref:System.Text.ASCIIEncoding>.</span><span class="sxs-lookup"><span data-stu-id="3cbce-220">Even for content that is entirely ASCII, operations performed with <xref:System.Text.UTF8Encoding> are faster than operations performed with <xref:System.Text.ASCIIEncoding>.</span></span>

<span data-ttu-id="3cbce-221">Кодировку <xref:System.Text.ASCIIEncoding> рекомендуется использовать только для приложений прежних версий.</span><span class="sxs-lookup"><span data-stu-id="3cbce-221">You should consider using <xref:System.Text.ASCIIEncoding> only for legacy applications.</span></span> <span data-ttu-id="3cbce-222">Однако даже для приложений прежних версий <xref:System.Text.UTF8Encoding> может быть предпочтительнее по указанным ниже причинам (при параметрах по умолчанию).</span><span class="sxs-lookup"><span data-stu-id="3cbce-222">However, even for legacy applications, <xref:System.Text.UTF8Encoding> might be a better choice for the following reasons (assuming default settings):</span></span>

- <span data-ttu-id="3cbce-223">Если содержимое приложения включает символы не только в формате ASCII, при кодировании с помощью <xref:System.Text.ASCIIEncoding>каждый символ, не относящийся к ASCII, кодируется как знак вопроса (?).</span><span class="sxs-lookup"><span data-stu-id="3cbce-223">If your application has content that is not strictly ASCII and encodes it with <xref:System.Text.ASCIIEncoding>, each non-ASCII character encodes as a question mark (?).</span></span> <span data-ttu-id="3cbce-224">При последующем декодировании эти данные утрачиваются.</span><span class="sxs-lookup"><span data-stu-id="3cbce-224">If the application then decodes this data, the information is lost.</span></span>

- <span data-ttu-id="3cbce-225">Если содержимое приложения включает символы не только в формате ASCII, при кодировании с помощью <xref:System.Text.UTF8Encoding>представление символов в формате ASCII дает непригодный для чтения результат.</span><span class="sxs-lookup"><span data-stu-id="3cbce-225">If your application has content that is not strictly ASCII and encodes it with <xref:System.Text.UTF8Encoding>, the result seems unintelligible if interpreted as ASCII.</span></span> <span data-ttu-id="3cbce-226">Однако при последующем декодировании данных с помощью декодера UTF-8 обработка данных выполняется успешно.</span><span class="sxs-lookup"><span data-stu-id="3cbce-226">However, if the application then uses a UTF-8 decoder to decode this data, the data performs a round trip successfully.</span></span>

<span data-ttu-id="3cbce-227">В веб-приложении символы, отправленные клиенту в ответ на веб-запрос, должны отражать кодировку, используемую в клиенте.</span><span class="sxs-lookup"><span data-stu-id="3cbce-227">In a web application, characters sent to the client in response to a web request should reflect the encoding used on the client.</span></span> <span data-ttu-id="3cbce-228">Как правило, требуется задать для свойства <xref:System.Web.HttpResponse.ContentEncoding%2A?displayProperty=nameWithType> значение, возвращаемое свойством <xref:System.Web.HttpRequest.ContentEncoding%2A?displayProperty=nameWithType> , для отображения текста в той кодировке, которую ожидает пользователь.</span><span class="sxs-lookup"><span data-stu-id="3cbce-228">In most cases, you should set the <xref:System.Web.HttpResponse.ContentEncoding%2A?displayProperty=nameWithType> property to the value returned by the <xref:System.Web.HttpRequest.ContentEncoding%2A?displayProperty=nameWithType> property to display text in the encoding that the user expects.</span></span>

<a name="Using"></a>

## <a name="using-an-encoding-object"></a><span data-ttu-id="3cbce-229">Использование объекта кодировки</span><span class="sxs-lookup"><span data-stu-id="3cbce-229">Using an Encoding Object</span></span>

<span data-ttu-id="3cbce-230">Кодировщик преобразует строку символов (чаще всего символов Юникода) в их числовой (байтовый) эквивалент.</span><span class="sxs-lookup"><span data-stu-id="3cbce-230">An encoder converts a string of characters (most commonly, Unicode characters) to its numeric (byte) equivalent.</span></span> <span data-ttu-id="3cbce-231">Например, кодировщик ASCII можно использовать для преобразования символов Юникода в ASCII, чтобы они могли отображаться на консоли.</span><span class="sxs-lookup"><span data-stu-id="3cbce-231">For example, you might use an ASCII encoder to convert Unicode characters to ASCII so that they can be displayed at the console.</span></span> <span data-ttu-id="3cbce-232">Чтобы выполнить преобразование, вызовите метод <xref:System.Text.Encoding.GetBytes%2A?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="3cbce-232">To perform the conversion, you call the <xref:System.Text.Encoding.GetBytes%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="3cbce-233">Если перед выполнением кодирования нужно определить, сколько байтов потребуется для хранения закодированных символов, можно вызвать метод <xref:System.Text.Encoding.GetByteCount%2A> .</span><span class="sxs-lookup"><span data-stu-id="3cbce-233">If you want to determine how many bytes are needed to store the encoded characters before performing the encoding, you can call the <xref:System.Text.Encoding.GetByteCount%2A> method.</span></span>

<span data-ttu-id="3cbce-234">В примере ниже один массив байтов используется для кодирования строк в двух отдельных операциях.</span><span class="sxs-lookup"><span data-stu-id="3cbce-234">The following example uses a single byte array to encode strings in two separate operations.</span></span> <span data-ttu-id="3cbce-235">Имеется индекс, указывающий начальную позицию в массиве байтов для следующего набора байтов, закодированных с использованием ASCII.</span><span class="sxs-lookup"><span data-stu-id="3cbce-235">It maintains an index that indicates the starting position in the byte array for the next set of ASCII-encoded bytes.</span></span> <span data-ttu-id="3cbce-236">Вызывается метод <xref:System.Text.ASCIIEncoding.GetByteCount%28System.String%29?displayProperty=nameWithType> для проверки того, что массив байтов достаточно велик для хранения закодированной строки.</span><span class="sxs-lookup"><span data-stu-id="3cbce-236">It calls the <xref:System.Text.ASCIIEncoding.GetByteCount%28System.String%29?displayProperty=nameWithType> method to ensure that the byte array is large enough to accommodate the encoded string.</span></span> <span data-ttu-id="3cbce-237">Затем вызывается метод <xref:System.Text.ASCIIEncoding.GetBytes%28System.String%2CSystem.Int32%2CSystem.Int32%2CSystem.Byte%5B%5D%2CSystem.Int32%29?displayProperty=nameWithType> для кодирования символов в строке.</span><span class="sxs-lookup"><span data-stu-id="3cbce-237">It then calls the <xref:System.Text.ASCIIEncoding.GetBytes%28System.String%2CSystem.Int32%2CSystem.Int32%2CSystem.Byte%5B%5D%2CSystem.Int32%29?displayProperty=nameWithType> method to encode the characters in the string.</span></span>

[!code-csharp[Conceptual.Encoding#8](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.encoding/cs/getbytes1.cs#8)]
[!code-vb[Conceptual.Encoding#8](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.encoding/vb/getbytes1.vb#8)]

<span data-ttu-id="3cbce-238">Декодер преобразует массив байтов, отражающий конкретную кодировку символов, в набор символов в массиве символов или в строке.</span><span class="sxs-lookup"><span data-stu-id="3cbce-238">A decoder converts a byte array that reflects a particular character encoding into a set of characters, either in a character array or in a string.</span></span> <span data-ttu-id="3cbce-239">Чтобы декодировать массив байтов в массив символов, вызовите метод <xref:System.Text.Encoding.GetChars%2A?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="3cbce-239">To decode a byte array into a character array, you call the <xref:System.Text.Encoding.GetChars%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="3cbce-240">Чтобы декодировать массив байтов в строку, вызовите метод <xref:System.Text.Encoding.GetString%2A> .</span><span class="sxs-lookup"><span data-stu-id="3cbce-240">To decode a byte array into a string, you call the <xref:System.Text.Encoding.GetString%2A> method.</span></span> <span data-ttu-id="3cbce-241">Если перед декодированием нужно определить, сколько символов требуется для хранения раскодированных байтов, можно вызвать метод <xref:System.Text.Encoding.GetCharCount%2A> .</span><span class="sxs-lookup"><span data-stu-id="3cbce-241">If you want to determine how many characters are needed to store the decoded bytes before performing the decoding, you can call the <xref:System.Text.Encoding.GetCharCount%2A> method.</span></span>

<span data-ttu-id="3cbce-242">В примере ниже три строки кодируются, а затем декодируются в один массив символов.</span><span class="sxs-lookup"><span data-stu-id="3cbce-242">The following example encodes three strings and then decodes them into a single array of characters.</span></span> <span data-ttu-id="3cbce-243">Имеется индекс, указывающий начальную позицию в массиве символов для следующего набора декодированных символов.</span><span class="sxs-lookup"><span data-stu-id="3cbce-243">It maintains an index that indicates the starting position in the character array for the next set of decoded characters.</span></span> <span data-ttu-id="3cbce-244">Вызывается метод <xref:System.Text.ASCIIEncoding.GetCharCount%2A> для проверки того, что массив символов достаточно велик для хранения всех декодированных символов.</span><span class="sxs-lookup"><span data-stu-id="3cbce-244">It calls the <xref:System.Text.ASCIIEncoding.GetCharCount%2A> method to ensure that the character array is large enough to accommodate all the decoded characters.</span></span> <span data-ttu-id="3cbce-245">Затем вызывается метод <xref:System.Text.ASCIIEncoding.GetChars%28System.Byte%5B%5D%2CSystem.Int32%2CSystem.Int32%2CSystem.Char%5B%5D%2CSystem.Int32%29?displayProperty=nameWithType> для декодирования массива байтов.</span><span class="sxs-lookup"><span data-stu-id="3cbce-245">It then calls the <xref:System.Text.ASCIIEncoding.GetChars%28System.Byte%5B%5D%2CSystem.Int32%2CSystem.Int32%2CSystem.Char%5B%5D%2CSystem.Int32%29?displayProperty=nameWithType> method to decode the byte array.</span></span>

[!code-csharp[Conceptual.Encoding#9](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.encoding/cs/getchars1.cs#9)]
[!code-vb[Conceptual.Encoding#9](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.encoding/vb/getchars1.vb#9)]

<span data-ttu-id="3cbce-246">Методы кодирования и декодирования класса, производного от класса <xref:System.Text.Encoding> , предназначены для работы с полным набором данных. Это значит, что все данные, подлежащие кодированию или декодированию, предоставляются в одном вызове метода.</span><span class="sxs-lookup"><span data-stu-id="3cbce-246">The encoding and decoding methods of a class derived from <xref:System.Text.Encoding> are designed to work on a complete set of data; that is, all the data to be encoded or decoded is supplied in a single method call.</span></span> <span data-ttu-id="3cbce-247">Однако в некоторых случаях данные предоставляются в потоке, тогда данные для кодирования и декодирования можно получить только с помощью нескольких операций чтения.</span><span class="sxs-lookup"><span data-stu-id="3cbce-247">However, in some cases, data is available in a stream, and the data to be encoded or decoded may be available only from separate read operations.</span></span> <span data-ttu-id="3cbce-248">В таком случае необходимо, чтобы операция кодирования или декодирования "помнила" сохраненное после предыдущего вызова состояние.</span><span class="sxs-lookup"><span data-stu-id="3cbce-248">This requires the encoding or decoding operation to remember any saved state from its previous invocation.</span></span> <span data-ttu-id="3cbce-249">Методы классов, производных от <xref:System.Text.Encoder> и <xref:System.Text.Decoder> , могут обрабатывать операции кодирования и декодирования, охватывающие несколько вызовов методов.</span><span class="sxs-lookup"><span data-stu-id="3cbce-249">Methods of classes derived from <xref:System.Text.Encoder> and <xref:System.Text.Decoder> are able to handle encoding and decoding operations that span multiple method calls.</span></span>

<span data-ttu-id="3cbce-250">Объект <xref:System.Text.Encoder> для конкретной кодировки доступен в ее свойстве <xref:System.Text.Encoding.GetEncoder%2A?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="3cbce-250">An <xref:System.Text.Encoder> object for a particular encoding is available from that encoding's <xref:System.Text.Encoding.GetEncoder%2A?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="3cbce-251">Объект <xref:System.Text.Decoder> для конкретной кодировки доступен в ее свойстве <xref:System.Text.Encoding.GetDecoder%2A?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="3cbce-251">A <xref:System.Text.Decoder> object for a particular encoding is available from that encoding's <xref:System.Text.Encoding.GetDecoder%2A?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="3cbce-252">Что касается операций декодирования, обратите внимание, что классы, производные от <xref:System.Text.Decoder> , включают метод <xref:System.Text.Decoder.GetChars%2A?displayProperty=nameWithType> , но не имеют метода, соответствующего <xref:System.Text.Encoding.GetString%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="3cbce-252">For decoding operations, note that classes derived from <xref:System.Text.Decoder> include a <xref:System.Text.Decoder.GetChars%2A?displayProperty=nameWithType> method, but they do not have a method that corresponds to <xref:System.Text.Encoding.GetString%2A?displayProperty=nameWithType>.</span></span>

<span data-ttu-id="3cbce-253">В примере ниже показано различие между использованием методов <xref:System.Text.Encoding.GetChars%2A?displayProperty=nameWithType> и <xref:System.Text.Decoder.GetChars%2A?displayProperty=nameWithType> для декодирования массива байтов Юникода.</span><span class="sxs-lookup"><span data-stu-id="3cbce-253">The following example illustrates the difference between using the <xref:System.Text.Encoding.GetChars%2A?displayProperty=nameWithType> and <xref:System.Text.Decoder.GetChars%2A?displayProperty=nameWithType> methods for decoding a Unicode byte array.</span></span> <span data-ttu-id="3cbce-254">В этом примере строка, содержащая несколько символов Юникода, кодируется в файл, а затем два метода декодирования используются для декодирования по десять байтов за раз.</span><span class="sxs-lookup"><span data-stu-id="3cbce-254">The example encodes a string that contains some Unicode characters to a file, and then uses the two decoding methods to decode them ten bytes at a time.</span></span> <span data-ttu-id="3cbce-255">Так как замещающая пара оказывается в десятом и одиннадцатом байтах, она декодируется в отдельных вызовах метода.</span><span class="sxs-lookup"><span data-stu-id="3cbce-255">Because a surrogate pair occurs in the tenth and eleventh bytes, it is decoded in separate method calls.</span></span> <span data-ttu-id="3cbce-256">Как видно из выходных данных, метод <xref:System.Text.Encoding.GetChars%2A?displayProperty=nameWithType> не может правильно декодировать байты и заменяет их символом U+FFFD (замещающим символом).</span><span class="sxs-lookup"><span data-stu-id="3cbce-256">As the output shows, the <xref:System.Text.Encoding.GetChars%2A?displayProperty=nameWithType> method is not able to correctly decode the bytes and instead replaces them with U+FFFD (REPLACEMENT CHARACTER).</span></span> <span data-ttu-id="3cbce-257">С другой стороны, метод <xref:System.Text.Decoder.GetChars%2A?displayProperty=nameWithType> может успешно декодировать массив байтов для получения исходной строки.</span><span class="sxs-lookup"><span data-stu-id="3cbce-257">On the other hand, the <xref:System.Text.Decoder.GetChars%2A?displayProperty=nameWithType> method is able to successfully decode the byte array to get the original string.</span></span>

[!code-csharp[Conceptual.Encoding#10](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.encoding/cs/stream1.cs#10)]
[!code-vb[Conceptual.Encoding#10](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.encoding/vb/stream1.vb#10)]

<a name="FallbackStrategy"></a>

## <a name="choosing-a-fallback-strategy"></a><span data-ttu-id="3cbce-258">Выбор резервной стратегии</span><span class="sxs-lookup"><span data-stu-id="3cbce-258">Choosing a Fallback Strategy</span></span>

<span data-ttu-id="3cbce-259">Когда метод пытается закодировать или декодировать символ, но не находит сопоставления, он должен использовать резервную стратегию, определяющую, как должно обрабатываться отсутствие сопоставления.</span><span class="sxs-lookup"><span data-stu-id="3cbce-259">When a method tries to encode or decode a character but no mapping exists, it must implement a fallback strategy that determines how the failed mapping should be handled.</span></span> <span data-ttu-id="3cbce-260">Существует три типа резервных стратегий:</span><span class="sxs-lookup"><span data-stu-id="3cbce-260">There are three types of fallback strategies:</span></span>

- <span data-ttu-id="3cbce-261">Best-Fit Fallback</span><span class="sxs-lookup"><span data-stu-id="3cbce-261">Best-fit fallback</span></span>

- <span data-ttu-id="3cbce-262">Replacement Fallback</span><span class="sxs-lookup"><span data-stu-id="3cbce-262">Replacement fallback</span></span>

- <span data-ttu-id="3cbce-263">Exception Fallback</span><span class="sxs-lookup"><span data-stu-id="3cbce-263">Exception fallback</span></span>

> [!IMPORTANT]
> <span data-ttu-id="3cbce-264">При операциях кодирования наиболее часто проблемы возникают, когда символ Юникода не удается сопоставить с определенной кодировкой кодовой страницы.</span><span class="sxs-lookup"><span data-stu-id="3cbce-264">The most common problems in encoding operations occur when a Unicode character cannot be mapped to a particular code page encoding.</span></span> <span data-ttu-id="3cbce-265">При операциях декодирования наиболее часто проблемы возникают, когда недопустимую последовательность байтов не удается преобразовать в допустимые символы Юникода.</span><span class="sxs-lookup"><span data-stu-id="3cbce-265">The most common problems in decoding operations occur when invalid byte sequences cannot be translated into valid Unicode characters.</span></span> <span data-ttu-id="3cbce-266">Поэтому необходимо знать, какую резервную стратегию использует определенный объект кодировки.</span><span class="sxs-lookup"><span data-stu-id="3cbce-266">For these reasons, you should know which fallback strategy a particular encoding object uses.</span></span> <span data-ttu-id="3cbce-267">По возможности при создании экземпляра объекта следует указывать резервную стратегию, используемую объектом кодировки.</span><span class="sxs-lookup"><span data-stu-id="3cbce-267">Whenever possible, you should specify the fallback strategy used by an encoding object when you instantiate the object.</span></span>

<a name="BestFit"></a>

### <a name="best-fit-fallback"></a><span data-ttu-id="3cbce-268">Best-Fit Fallback</span><span class="sxs-lookup"><span data-stu-id="3cbce-268">Best-Fit Fallback</span></span>

<span data-ttu-id="3cbce-269">Если символ не имеет точного соответствия в целевой кодировке, кодировщик может попытаться сопоставить его с похожим символом.</span><span class="sxs-lookup"><span data-stu-id="3cbce-269">When a character does not have an exact match in the target encoding, the encoder can try to map it to a similar character.</span></span> <span data-ttu-id="3cbce-270">(Стратегия наилучшего соответствия связана с проблемами, возникающими скорее при кодировании, чем при декодировании.</span><span class="sxs-lookup"><span data-stu-id="3cbce-270">(Best-fit fallback is mostly an encoding rather than a decoding issue.</span></span> <span data-ttu-id="3cbce-271">Существует лишь небольшое число кодовых страниц, символы которых нельзя сопоставить с Юникодом.) Стратегия наилучшего соответствия является стратегией по умолчанию для кодовых страниц и двухбайтовых кодировок, извлекаемых перегрузками <xref:System.Text.Encoding.GetEncoding%28System.Int32%29?displayProperty=nameWithType> и <xref:System.Text.Encoding.GetEncoding%28System.String%29?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="3cbce-271">There are very few code pages that contain characters that cannot be successfully mapped to Unicode.) Best-fit fallback is the default for code page and double-byte character set encodings that are retrieved by the <xref:System.Text.Encoding.GetEncoding%28System.Int32%29?displayProperty=nameWithType> and <xref:System.Text.Encoding.GetEncoding%28System.String%29?displayProperty=nameWithType> overloads.</span></span>

> [!NOTE]
> <span data-ttu-id="3cbce-272">Теоретически все классы кодировок Юникода, доступные в .NET (<xref:System.Text.UTF8Encoding>, <xref:System.Text.UnicodeEncoding> и <xref:System.Text.UTF32Encoding>), поддерживают все символы всех наборов символов, поэтому при их использовании не возникает проблем со стратегией наилучшего соответствия.</span><span class="sxs-lookup"><span data-stu-id="3cbce-272">In theory, the Unicode encoding classes provided in .NET (<xref:System.Text.UTF8Encoding>, <xref:System.Text.UnicodeEncoding>, and <xref:System.Text.UTF32Encoding>) support every character in every character set, so they can be used to eliminate best-fit fallback issues.</span></span>

<span data-ttu-id="3cbce-273">Для разных кодовых страниц применяются разные стратегии наилучшего соответствия.</span><span class="sxs-lookup"><span data-stu-id="3cbce-273">Best-fit strategies vary for different code pages.</span></span> <span data-ttu-id="3cbce-274">Например, для некоторых кодовых страниц полноширинные латинские символы сопоставляются с более распространенными полуширинными символами.</span><span class="sxs-lookup"><span data-stu-id="3cbce-274">For example, for some code pages, full-width Latin characters map to the more common half-width Latin characters.</span></span> <span data-ttu-id="3cbce-275">Для других кодовых страниц такое сопоставление не выполняется.</span><span class="sxs-lookup"><span data-stu-id="3cbce-275">For other code pages, this mapping is not made.</span></span> <span data-ttu-id="3cbce-276">Даже в случае применения активной стратегии наилучшего соответствия для некоторых символов некоторых кодировок отсутствует возможное сопоставление.</span><span class="sxs-lookup"><span data-stu-id="3cbce-276">Even under an aggressive best-fit strategy, there is no imaginable fit for some characters in some encodings.</span></span> <span data-ttu-id="3cbce-277">Например, для идеографических символов китайского алфавита отсутствуют корректные сопоставления с символами кодовой страницы 1252.</span><span class="sxs-lookup"><span data-stu-id="3cbce-277">For example, a Chinese ideograph has no reasonable mapping to code page 1252.</span></span> <span data-ttu-id="3cbce-278">В этом случае используются замещающие строки.</span><span class="sxs-lookup"><span data-stu-id="3cbce-278">In this case, a replacement string is used.</span></span> <span data-ttu-id="3cbce-279">По умолчанию в качестве замещающей строки используется знак вопроса (U+003F).</span><span class="sxs-lookup"><span data-stu-id="3cbce-279">By default, this string is just a single QUESTION MARK (U+003F).</span></span>

> [!NOTE]
> <span data-ttu-id="3cbce-280">Стратегии наилучшего соответствия не документированы подробно.</span><span class="sxs-lookup"><span data-stu-id="3cbce-280">Best-fit strategies are not documented in detail.</span></span> <span data-ttu-id="3cbce-281">Но для некоторых кодовых страниц их можно найти на веб-сайте [Unicode Consortium](https://www.unicode.org/Public/MAPPINGS/VENDORS/MICSFT/WindowsBestFit/).</span><span class="sxs-lookup"><span data-stu-id="3cbce-281">However, several code pages are documented at the [Unicode Consortium's](https://www.unicode.org/Public/MAPPINGS/VENDORS/MICSFT/WindowsBestFit/) website.</span></span> <span data-ttu-id="3cbce-282">Изучите файл **readme.txt** в предоставленной папке, где описаны правила интерпретации для файлов сопоставления.</span><span class="sxs-lookup"><span data-stu-id="3cbce-282">Please review the **readme.txt** file in that folder for a description of how to interpret the mapping files.</span></span>

<span data-ttu-id="3cbce-283">В примере ниже используется кодовая страница 1252 (кодовая страница Windows для западноевропейских языков) для иллюстрации стратегии наилучшего соответствия и ее недостатков.</span><span class="sxs-lookup"><span data-stu-id="3cbce-283">The following example uses code page 1252 (the Windows code page for Western European languages) to illustrate best-fit mapping and its drawbacks.</span></span> <span data-ttu-id="3cbce-284">Метод <xref:System.Text.Encoding.GetEncoding%28System.Int32%29?displayProperty=nameWithType> используется для получения объекта кодировки для кодовой страницы 1252.</span><span class="sxs-lookup"><span data-stu-id="3cbce-284">The <xref:System.Text.Encoding.GetEncoding%28System.Int32%29?displayProperty=nameWithType> method is used to retrieve an encoding object for code page 1252.</span></span> <span data-ttu-id="3cbce-285">По умолчанию для неподдерживаемых символов Юникода используется стратегия наилучшего соответствия.</span><span class="sxs-lookup"><span data-stu-id="3cbce-285">By default, it uses a best-fit mapping for Unicode characters that it does not support.</span></span> <span data-ttu-id="3cbce-286">В примере создается экземпляр строки, содержащий три символа, не относящихся к ASCII (прописная латинская буква S в кружке (U+24C8), надстрочный индекс 5 (U+2075) и знак бесконечности (U+221E)), разделенные пробелами.</span><span class="sxs-lookup"><span data-stu-id="3cbce-286">The example instantiates a string that contains three non-ASCII characters - CIRCLED LATIN CAPITAL LETTER S (U+24C8), SUPERSCRIPT FIVE (U+2075), and INFINITY (U+221E) - separated by spaces.</span></span> <span data-ttu-id="3cbce-287">Как видно из выходных данных примера, при кодировке строки три исходных отличных от пробела символа заменяются вопросительным знаком (U+003F), цифрой пять (U+0035) и цифрой восемь (U+0038).</span><span class="sxs-lookup"><span data-stu-id="3cbce-287">As the output from the example shows, when the string is encoded, the three original non-space characters are replaced by QUESTION MARK (U+003F), DIGIT FIVE (U+0035), and DIGIT EIGHT (U+0038).</span></span> <span data-ttu-id="3cbce-288">Цифра восемь — особенно неудачная замена неподдерживаемого знака бесконечности, а вопросительный знак показывает, что для исходного символа сопоставление не найдено.</span><span class="sxs-lookup"><span data-stu-id="3cbce-288">DIGIT EIGHT is a particularly poor replacement for the unsupported INFINITY character, and QUESTION MARK indicates that no mapping was available for the original character.</span></span>

[!code-csharp[Conceptual.Encoding#1](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.encoding/cs/bestfit1.cs#1)]
[!code-vb[Conceptual.Encoding#1](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.encoding/vb/bestfit1.vb#1)]

<span data-ttu-id="3cbce-289">По умолчанию для объекта <xref:System.Text.Encoding> применяется стратегия наилучшего соответствия, при которой данные в формате Юникод кодируются в формат кодовой страницы. Ряд приложений предыдущих версий построен с учетом этой стратегии.</span><span class="sxs-lookup"><span data-stu-id="3cbce-289">Best-fit mapping is the default behavior for an <xref:System.Text.Encoding> object that encodes Unicode data into code page data, and there are legacy applications that rely on this behavior.</span></span> <span data-ttu-id="3cbce-290">Однако в целях безопасности в большинстве новых приложений не рекомендуется применять эту стратегию.</span><span class="sxs-lookup"><span data-stu-id="3cbce-290">However, most new applications should avoid best-fit behavior for security reasons.</span></span> <span data-ttu-id="3cbce-291">Например, приложениям не следует выполнять кодировку доменного имени в режиме наилучшего соответствия.</span><span class="sxs-lookup"><span data-stu-id="3cbce-291">For example, applications should not put a domain name through a best-fit encoding.</span></span>

> [!NOTE]
> <span data-ttu-id="3cbce-292">Вы также можете реализовать пользовательскую стратегию наилучшего соответствия для кодировки.</span><span class="sxs-lookup"><span data-stu-id="3cbce-292">You can also implement a custom best-fit fallback mapping for an encoding.</span></span> <span data-ttu-id="3cbce-293">Дополнительные сведения см. в разделе [Implementing a Custom Fallback Strategy](../../../docs/standard/base-types/character-encoding.md#Custom) .</span><span class="sxs-lookup"><span data-stu-id="3cbce-293">For more information, see the [Implementing a Custom Fallback Strategy](../../../docs/standard/base-types/character-encoding.md#Custom) section.</span></span>

<span data-ttu-id="3cbce-294">Если стратегия наилучшего соответствия задана по умолчанию для объекта кодировки, вы можете выбрать другую резервную стратегию при извлечении объекта <xref:System.Text.Encoding> с помощью вызова перегрузки <xref:System.Text.Encoding.GetEncoding%28System.Int32%2CSystem.Text.EncoderFallback%2CSystem.Text.DecoderFallback%29?displayProperty=nameWithType> или <xref:System.Text.Encoding.GetEncoding%28System.String%2CSystem.Text.EncoderFallback%2CSystem.Text.DecoderFallback%29?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="3cbce-294">If best-fit fallback is the default for an encoding object, you can choose another fallback strategy when you retrieve an <xref:System.Text.Encoding> object by calling the <xref:System.Text.Encoding.GetEncoding%28System.Int32%2CSystem.Text.EncoderFallback%2CSystem.Text.DecoderFallback%29?displayProperty=nameWithType> or <xref:System.Text.Encoding.GetEncoding%28System.String%2CSystem.Text.EncoderFallback%2CSystem.Text.DecoderFallback%29?displayProperty=nameWithType> overload.</span></span> <span data-ttu-id="3cbce-295">В следующем разделе приводится пример, в котором каждый символ, который не удается сопоставить с кодовой страницей 1252, заменяется звездочкой (\*).</span><span class="sxs-lookup"><span data-stu-id="3cbce-295">The following section includes an example that replaces each character that cannot be mapped to code page 1252 with an asterisk (\*).</span></span>

[!code-csharp[Conceptual.Encoding#3](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.encoding/cs/bestfit1a.cs#3)]
[!code-vb[Conceptual.Encoding#3](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.encoding/vb/bestfit1a.vb#3)]

<a name="Replacement"></a>

### <a name="replacement-fallback"></a><span data-ttu-id="3cbce-296">Replacement Fallback</span><span class="sxs-lookup"><span data-stu-id="3cbce-296">Replacement Fallback</span></span>

<span data-ttu-id="3cbce-297">Когда символ не имеет точного соответствия в целевой схеме и нет подходящего символа, с которым его можно сопоставить, приложение может использовать замещающий символ или строку.</span><span class="sxs-lookup"><span data-stu-id="3cbce-297">When a character does not have an exact match in the target scheme, but there is no appropriate character that it can be mapped to, the application can specify a replacement character or string.</span></span> <span data-ttu-id="3cbce-298">Так по умолчанию поступает декодер Юникода, заменяющий любую двухбайтовую последовательность, которую он не может декодировать, замещающим символом (U+FFFD).</span><span class="sxs-lookup"><span data-stu-id="3cbce-298">This is the default behavior for the Unicode decoder, which replaces any two-byte sequence that it cannot decode with REPLACEMENT_CHARACTER (U+FFFD).</span></span> <span data-ttu-id="3cbce-299">Кроме того, это поведение по умолчанию класса <xref:System.Text.ASCIIEncoding> , который заменяет каждый символ, который не удается кодировать или декодировать, вопросительным знаком.</span><span class="sxs-lookup"><span data-stu-id="3cbce-299">It is also the default behavior of the <xref:System.Text.ASCIIEncoding> class, which replaces each character that it cannot encode or decode with a question mark.</span></span> <span data-ttu-id="3cbce-300">В примере ниже показана замена символов для строки Юникода из предыдущего примера.</span><span class="sxs-lookup"><span data-stu-id="3cbce-300">The following example illustrates character replacement for the Unicode string from the previous example.</span></span> <span data-ttu-id="3cbce-301">Как видно из выходных данных, каждый символ, который не удается декодировать в байтовое значение ASCII, заменяется 0x3F, то есть кодом ASCII для вопросительного знака.</span><span class="sxs-lookup"><span data-stu-id="3cbce-301">As the output shows, each character that cannot be decoded into an ASCII byte value is replaced by 0x3F, which is the ASCII code for a question mark.</span></span>

[!code-csharp[Conceptual.Encoding#2](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.encoding/cs/replacementascii.cs#2)]
[!code-vb[Conceptual.Encoding#2](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.encoding/vb/replacementascii.vb#2)]

<span data-ttu-id="3cbce-302">В .NET есть классы <xref:System.Text.EncoderReplacementFallback> и <xref:System.Text.DecoderReplacementFallback>, которые подставляют замещающую строку, если не удается точно сопоставить символ при кодировании или декодировании.</span><span class="sxs-lookup"><span data-stu-id="3cbce-302">.NET includes the <xref:System.Text.EncoderReplacementFallback> and <xref:System.Text.DecoderReplacementFallback> classes, which substitute a replacement string if a character does not map exactly in an encoding or decoding operation.</span></span> <span data-ttu-id="3cbce-303">По умолчанию эта замещающая строка — вопросительный знак, но вы можете вызвать перегрузку конструктора класса, чтобы выбрать другую строку.</span><span class="sxs-lookup"><span data-stu-id="3cbce-303">By default, this replacement string is a question mark, but you can call a class constructor overload to choose a different string.</span></span> <span data-ttu-id="3cbce-304">Как правило, замещающая строка — это отдельный символ, хотя это необязательно.</span><span class="sxs-lookup"><span data-stu-id="3cbce-304">Typically, the replacement string is a single character, although this is not a requirement.</span></span> <span data-ttu-id="3cbce-305">В примере ниже поведение кодировщика кодовой страницы 1252 изменяется путем создания экземпляра объекта <xref:System.Text.EncoderReplacementFallback> , который использует символ звездочки (\*) в качестве замещающей строки.</span><span class="sxs-lookup"><span data-stu-id="3cbce-305">The following example changes the behavior of the code page 1252 encoder by instantiating an <xref:System.Text.EncoderReplacementFallback> object that uses an asterisk (\*) as a replacement string.</span></span>

[!code-csharp[Conceptual.Encoding#3](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.encoding/cs/bestfit1a.cs#3)]
[!code-vb[Conceptual.Encoding#3](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.encoding/vb/bestfit1a.vb#3)]

> [!NOTE]
> <span data-ttu-id="3cbce-306">Также можно реализовать класс замены для кодировки.</span><span class="sxs-lookup"><span data-stu-id="3cbce-306">You can also implement a replacement class for an encoding.</span></span> <span data-ttu-id="3cbce-307">Дополнительные сведения см. в разделе [Implementing a Custom Fallback Strategy](../../../docs/standard/base-types/character-encoding.md#Custom) .</span><span class="sxs-lookup"><span data-stu-id="3cbce-307">For more information, see the [Implementing a Custom Fallback Strategy](../../../docs/standard/base-types/character-encoding.md#Custom) section.</span></span>

<span data-ttu-id="3cbce-308">Помимо вопросительного знака (U+003F) в качестве замещающей строки часто используется замещающий символ Юникода (U+FFFD), особенно при декодировании последовательностей байтов, которые не удается преобразовать в символы Юникода.</span><span class="sxs-lookup"><span data-stu-id="3cbce-308">In addition to QUESTION MARK (U+003F), the Unicode REPLACEMENT CHARACTER (U+FFFD) is commonly used as a replacement string, particularly when decoding byte sequences that cannot be successfully translated into Unicode characters.</span></span> <span data-ttu-id="3cbce-309">Однако вы можете выбрать любую замещающую строку, в том числе из нескольких символов.</span><span class="sxs-lookup"><span data-stu-id="3cbce-309">However, you are free to choose any replacement string, and it can contain multiple characters.</span></span>

<a name="Exception"></a>

### <a name="exception-fallback"></a><span data-ttu-id="3cbce-310">Exception Fallback</span><span class="sxs-lookup"><span data-stu-id="3cbce-310">Exception Fallback</span></span>

<span data-ttu-id="3cbce-311">Вместо подстановки наиболее подходящей или замещающей строки кодировщик может создавать исключение <xref:System.Text.EncoderFallbackException> , если не удается закодировать набор символов, а декодер — создавать исключение <xref:System.Text.DecoderFallbackException> , если не удается декодировать массив байтов.</span><span class="sxs-lookup"><span data-stu-id="3cbce-311">Instead of providing a best-fit fallback or a replacement string, an encoder can throw an <xref:System.Text.EncoderFallbackException> if it is unable to encode a set of characters, and a decoder can throw a <xref:System.Text.DecoderFallbackException> if it is unable to decode a byte array.</span></span> <span data-ttu-id="3cbce-312">Для создания исключения в операциях кодирования и декодирования методу <xref:System.Text.EncoderExceptionFallback> необходимо предоставить объект <xref:System.Text.DecoderExceptionFallback> или <xref:System.Text.Encoding.GetEncoding%28System.String%2CSystem.Text.EncoderFallback%2CSystem.Text.DecoderFallback%29?displayProperty=nameWithType> соответственно.</span><span class="sxs-lookup"><span data-stu-id="3cbce-312">To throw an exception in encoding and decoding operations, you supply an <xref:System.Text.EncoderExceptionFallback> object and a <xref:System.Text.DecoderExceptionFallback> object, respectively, to the <xref:System.Text.Encoding.GetEncoding%28System.String%2CSystem.Text.EncoderFallback%2CSystem.Text.DecoderFallback%29?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="3cbce-313">В примере ниже иллюстрируется резервная стратегия исключения с классом <xref:System.Text.ASCIIEncoding> .</span><span class="sxs-lookup"><span data-stu-id="3cbce-313">The following example illustrates exception fallback with the <xref:System.Text.ASCIIEncoding> class.</span></span>

[!code-csharp[Conceptual.Encoding#4](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.encoding/cs/exceptionascii.cs#4)]
[!code-vb[Conceptual.Encoding#4](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.encoding/vb/exceptionascii.vb#4)]

> [!NOTE]
> <span data-ttu-id="3cbce-314">Вы также можете реализовать пользовательский обработчик исключений для операции кодирования.</span><span class="sxs-lookup"><span data-stu-id="3cbce-314">You can also implement a custom exception handler for an encoding operation.</span></span> <span data-ttu-id="3cbce-315">Дополнительные сведения см. в разделе [Implementing a Custom Fallback Strategy](../../../docs/standard/base-types/character-encoding.md#Custom) .</span><span class="sxs-lookup"><span data-stu-id="3cbce-315">For more information, see the [Implementing a Custom Fallback Strategy](../../../docs/standard/base-types/character-encoding.md#Custom) section.</span></span>

<span data-ttu-id="3cbce-316">Объекты <xref:System.Text.EncoderFallbackException> и <xref:System.Text.DecoderFallbackException> предоставляют следующую информацию о состоянии, вызвавшем исключение:</span><span class="sxs-lookup"><span data-stu-id="3cbce-316">The <xref:System.Text.EncoderFallbackException> and <xref:System.Text.DecoderFallbackException> objects provide the following information about the condition that caused the exception:</span></span>

- <span data-ttu-id="3cbce-317">Объект <xref:System.Text.EncoderFallbackException> включает метод <xref:System.Text.EncoderFallbackException.IsUnknownSurrogate%2A> , указывающий, представляют ли символы (или символ), которые не удается закодировать, неизвестную замещающую пару (тогда метод возвращает значение `true`) или неизвестный отдельный символ (тогда метод возвращает значение `false`).</span><span class="sxs-lookup"><span data-stu-id="3cbce-317">The <xref:System.Text.EncoderFallbackException> object includes an <xref:System.Text.EncoderFallbackException.IsUnknownSurrogate%2A> method, which indicates whether the character or characters that cannot be encoded represent an unknown surrogate pair (in which case, the method returns `true`) or an unknown single character (in which case, the method returns `false`).</span></span> <span data-ttu-id="3cbce-318">Символы замещающей пары доступны в свойствах <xref:System.Text.EncoderFallbackException.CharUnknownHigh%2A?displayProperty=nameWithType> и <xref:System.Text.EncoderFallbackException.CharUnknownLow%2A?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="3cbce-318">The characters in the surrogate pair are available from the <xref:System.Text.EncoderFallbackException.CharUnknownHigh%2A?displayProperty=nameWithType> and <xref:System.Text.EncoderFallbackException.CharUnknownLow%2A?displayProperty=nameWithType> properties.</span></span> <span data-ttu-id="3cbce-319">Неизвестный отдельный символ доступен в свойстве <xref:System.Text.EncoderFallbackException.CharUnknown%2A?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="3cbce-319">The unknown single character is available from the <xref:System.Text.EncoderFallbackException.CharUnknown%2A?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="3cbce-320">Свойство <xref:System.Text.EncoderFallbackException.Index%2A?displayProperty=nameWithType> указывает позицию первого символа, который не удалось закодировать, в строке.</span><span class="sxs-lookup"><span data-stu-id="3cbce-320">The <xref:System.Text.EncoderFallbackException.Index%2A?displayProperty=nameWithType> property indicates the position in the string at which the first character that could not be encoded was found.</span></span>

- <span data-ttu-id="3cbce-321">Объект <xref:System.Text.DecoderFallbackException> включает свойство <xref:System.Text.DecoderFallbackException.BytesUnknown%2A> , возвращающее массив байтов, которые не удается декодировать.</span><span class="sxs-lookup"><span data-stu-id="3cbce-321">The <xref:System.Text.DecoderFallbackException> object includes a <xref:System.Text.DecoderFallbackException.BytesUnknown%2A> property that returns an array of bytes that cannot be decoded.</span></span> <span data-ttu-id="3cbce-322">Свойство <xref:System.Text.DecoderFallbackException.Index%2A?displayProperty=nameWithType> указывает начальную позицию неизвестных байтов.</span><span class="sxs-lookup"><span data-stu-id="3cbce-322">The <xref:System.Text.DecoderFallbackException.Index%2A?displayProperty=nameWithType> property indicates the starting position of the unknown bytes.</span></span>

<span data-ttu-id="3cbce-323">Несмотря на то что объекты <xref:System.Text.EncoderFallbackException> и <xref:System.Text.DecoderFallbackException> предоставляют достаточно подробную диагностическую информацию об исключении, они не предоставляют доступ к буферу кодирования или декодирования.</span><span class="sxs-lookup"><span data-stu-id="3cbce-323">Although the <xref:System.Text.EncoderFallbackException> and <xref:System.Text.DecoderFallbackException> objects provide adequate diagnostic information about the exception, they do not provide access to the encoding or decoding buffer.</span></span> <span data-ttu-id="3cbce-324">Поэтому они не позволяют заменять или исправлять недопустимые данные в методе кодирования или декодирования.</span><span class="sxs-lookup"><span data-stu-id="3cbce-324">Therefore, they do not allow invalid data to be replaced or corrected within the encoding or decoding method.</span></span>

<a name="Custom"></a>

## <a name="implementing-a-custom-fallback-strategy"></a><span data-ttu-id="3cbce-325">Implementing a Custom Fallback Strategy</span><span class="sxs-lookup"><span data-stu-id="3cbce-325">Implementing a Custom Fallback Strategy</span></span>

<span data-ttu-id="3cbce-326">Помимо встроенной стратегии наилучшего соответствия, реализованной кодовыми страницами, платформа .NET содержит следующие классы для реализации резервной стратегии:</span><span class="sxs-lookup"><span data-stu-id="3cbce-326">In addition to the best-fit mapping that is implemented internally by code pages, .NET includes the following classes for implementing a fallback strategy:</span></span>

- <span data-ttu-id="3cbce-327">— классы <xref:System.Text.EncoderReplacementFallback> и <xref:System.Text.EncoderReplacementFallbackBuffer> можно использовать для замены символов в операциях кодирования;</span><span class="sxs-lookup"><span data-stu-id="3cbce-327">Use <xref:System.Text.EncoderReplacementFallback> and <xref:System.Text.EncoderReplacementFallbackBuffer> to replace characters in encoding operations.</span></span>

- <span data-ttu-id="3cbce-328">— классы <xref:System.Text.DecoderReplacementFallback> и <xref:System.Text.DecoderReplacementFallbackBuffer> можно использовать для замены символов в операциях декодирования;</span><span class="sxs-lookup"><span data-stu-id="3cbce-328">Use <xref:System.Text.DecoderReplacementFallback> and <xref:System.Text.DecoderReplacementFallbackBuffer> to replace characters in decoding operations.</span></span>

- <span data-ttu-id="3cbce-329">— классы <xref:System.Text.EncoderExceptionFallback> и <xref:System.Text.EncoderExceptionFallbackBuffer> можно использовать для создания исключения <xref:System.Text.EncoderFallbackException> , когда символ не удается закодировать;</span><span class="sxs-lookup"><span data-stu-id="3cbce-329">Use <xref:System.Text.EncoderExceptionFallback> and <xref:System.Text.EncoderExceptionFallbackBuffer> to throw an <xref:System.Text.EncoderFallbackException> when a character cannot be encoded.</span></span>

- <span data-ttu-id="3cbce-330">— классы <xref:System.Text.DecoderExceptionFallback> и <xref:System.Text.DecoderExceptionFallbackBuffer> можно использовать для создания исключения <xref:System.Text.DecoderFallbackException> , когда символ не удается декодировать.</span><span class="sxs-lookup"><span data-stu-id="3cbce-330">Use <xref:System.Text.DecoderExceptionFallback> and <xref:System.Text.DecoderExceptionFallbackBuffer> to throw a <xref:System.Text.DecoderFallbackException> when a character cannot be decoded.</span></span>

<span data-ttu-id="3cbce-331">Кроме того, можно реализовать пользовательское решение, использующее резервную стратегию наилучшего соответствия или стратегию исключения, выполнив указанные ниже действия.</span><span class="sxs-lookup"><span data-stu-id="3cbce-331">In addition, you can implement a custom solution that uses best-fit fallback, replacement fallback, or exception fallback, by following these steps:</span></span>

1. <span data-ttu-id="3cbce-332">Создайте класс, производный от <xref:System.Text.EncoderFallback> , для операций кодирования и класс, производный от <xref:System.Text.DecoderFallback> , для операций декодирования.</span><span class="sxs-lookup"><span data-stu-id="3cbce-332">Derive a class from <xref:System.Text.EncoderFallback> for encoding operations, and from <xref:System.Text.DecoderFallback> for decoding operations.</span></span>

2. <span data-ttu-id="3cbce-333">Создайте класс, производный от <xref:System.Text.EncoderFallbackBuffer> , для операций кодирования и класс, производный от <xref:System.Text.DecoderFallbackBuffer> , для операций декодирования.</span><span class="sxs-lookup"><span data-stu-id="3cbce-333">Derive a class from <xref:System.Text.EncoderFallbackBuffer> for encoding operations, and from <xref:System.Text.DecoderFallbackBuffer> for decoding operations.</span></span>

3. <span data-ttu-id="3cbce-334">Для задания резервной стратегии исключения, если классы <xref:System.Text.EncoderFallbackException> и <xref:System.Text.DecoderFallbackException> не отвечают вашим требованиям, следует наследовать класс от объекта исключения, например <xref:System.Exception> или <xref:System.ArgumentException>.</span><span class="sxs-lookup"><span data-stu-id="3cbce-334">For exception fallback, if the predefined <xref:System.Text.EncoderFallbackException> and <xref:System.Text.DecoderFallbackException> classes do not meet your needs, derive a class from an exception object such as <xref:System.Exception> or <xref:System.ArgumentException>.</span></span>

### <a name="deriving-from-encoderfallback-or-decoderfallback"></a><span data-ttu-id="3cbce-335">Наследование от класса EncoderFallback или класса DecoderFallback</span><span class="sxs-lookup"><span data-stu-id="3cbce-335">Deriving from EncoderFallback or DecoderFallback</span></span>

<span data-ttu-id="3cbce-336">Для реализации пользовательской резервной стратегии необходимо создать класс, наследующий от <xref:System.Text.EncoderFallback> для операций кодирования и от класса <xref:System.Text.DecoderFallback> для операций декодирования.</span><span class="sxs-lookup"><span data-stu-id="3cbce-336">To implement a custom fallback solution, you must create a class that inherits from <xref:System.Text.EncoderFallback> for encoding operations, and from <xref:System.Text.DecoderFallback> for decoding operations.</span></span> <span data-ttu-id="3cbce-337">Экземпляры этих классов передаются в метод <xref:System.Text.Encoding.GetEncoding%28System.String%2CSystem.Text.EncoderFallback%2CSystem.Text.DecoderFallback%29?displayProperty=nameWithType> и служат посредниками между классом кодировки и реализацией резервной стратегии.</span><span class="sxs-lookup"><span data-stu-id="3cbce-337">Instances of these classes are passed to the <xref:System.Text.Encoding.GetEncoding%28System.String%2CSystem.Text.EncoderFallback%2CSystem.Text.DecoderFallback%29?displayProperty=nameWithType> method and serve as the intermediary between the encoding class and the fallback implementation.</span></span>

<span data-ttu-id="3cbce-338">При создании пользовательской резервной стратегии для кодировщика или декодера необходимо реализовать следующие члены:</span><span class="sxs-lookup"><span data-stu-id="3cbce-338">When you create a custom fallback solution for an encoder or decoder, you must implement the following members:</span></span>

- <span data-ttu-id="3cbce-339">— свойство <xref:System.Text.EncoderFallback.MaxCharCount%2A?displayProperty=nameWithType> или <xref:System.Text.DecoderFallback.MaxCharCount%2A?displayProperty=nameWithType> , возвращающее максимально возможное число символов, которое может использоваться для замены одного символа в стратегиях наилучшего соответствия, замены или исключения.</span><span class="sxs-lookup"><span data-stu-id="3cbce-339">The <xref:System.Text.EncoderFallback.MaxCharCount%2A?displayProperty=nameWithType> or <xref:System.Text.DecoderFallback.MaxCharCount%2A?displayProperty=nameWithType> property, which returns the maximum possible number of characters that the best-fit, replacement, or exception fallback can return to replace a single character.</span></span> <span data-ttu-id="3cbce-340">Для пользовательской резервной стратегии исключения его значение равно нулю.</span><span class="sxs-lookup"><span data-stu-id="3cbce-340">For a custom exception fallback, its value is zero.</span></span>

- <span data-ttu-id="3cbce-341">Метод <xref:System.Text.EncoderFallback.CreateFallbackBuffer%2A?displayProperty=nameWithType> или <xref:System.Text.DecoderFallback.CreateFallbackBuffer%2A?displayProperty=nameWithType> , возвращающий пользовательскую реализацию <xref:System.Text.EncoderFallbackBuffer> или <xref:System.Text.DecoderFallbackBuffer> .</span><span class="sxs-lookup"><span data-stu-id="3cbce-341">The <xref:System.Text.EncoderFallback.CreateFallbackBuffer%2A?displayProperty=nameWithType> or <xref:System.Text.DecoderFallback.CreateFallbackBuffer%2A?displayProperty=nameWithType> method, which returns your custom <xref:System.Text.EncoderFallbackBuffer> or <xref:System.Text.DecoderFallbackBuffer> implementation.</span></span> <span data-ttu-id="3cbce-342">Метод вызывается кодировщиком, когда он встречает первый символ, который не удается закодировать, или декодером, когда он встречает первый байт, который не удается декодировать.</span><span class="sxs-lookup"><span data-stu-id="3cbce-342">The method is called by the encoder when it encounters the first character that it is unable to successfully encode, or by the decoder when it encounters the first byte that it is unable to successfully decode.</span></span>

### <a name="deriving-from-encoderfallbackbuffer-or-decoderfallbackbuffer"></a><span data-ttu-id="3cbce-343">Наследование от класса EncoderFallbackBuffer или класса DecoderFallbackBuffer</span><span class="sxs-lookup"><span data-stu-id="3cbce-343">Deriving from EncoderFallbackBuffer or DecoderFallbackBuffer</span></span>

<span data-ttu-id="3cbce-344">Для реализации пользовательской резервной стратегии необходимо также создать класс, наследующий от <xref:System.Text.EncoderFallbackBuffer> для операций кодирования и от класса <xref:System.Text.DecoderFallbackBuffer> для операций декодирования.</span><span class="sxs-lookup"><span data-stu-id="3cbce-344">To implement a custom fallback solution, you must also create a class that inherits from <xref:System.Text.EncoderFallbackBuffer> for encoding operations, and from <xref:System.Text.DecoderFallbackBuffer> for decoding operations.</span></span> <span data-ttu-id="3cbce-345">Экземпляры этих классов возвращаются методом <xref:System.Text.EncoderFallback.CreateFallbackBuffer%2A> классов <xref:System.Text.EncoderFallback> и <xref:System.Text.DecoderFallback> .</span><span class="sxs-lookup"><span data-stu-id="3cbce-345">Instances of these classes are returned by the <xref:System.Text.EncoderFallback.CreateFallbackBuffer%2A> method  of the <xref:System.Text.EncoderFallback> and <xref:System.Text.DecoderFallback> classes.</span></span> <span data-ttu-id="3cbce-346">Метод <xref:System.Text.EncoderFallback.CreateFallbackBuffer%2A?displayProperty=nameWithType> вызывается кодировщиком, когда он встречает первый символ, который не удается закодировать, а метод <xref:System.Text.DecoderFallback.CreateFallbackBuffer%2A?displayProperty=nameWithType> вызывается декодером, когда он встречает один или несколько байтов, которые не удается декодировать.</span><span class="sxs-lookup"><span data-stu-id="3cbce-346">The <xref:System.Text.EncoderFallback.CreateFallbackBuffer%2A?displayProperty=nameWithType> method is called by the encoder when it encounters the first character that it is not able to encode, and the <xref:System.Text.DecoderFallback.CreateFallbackBuffer%2A?displayProperty=nameWithType> method is called by the decoder when it encounters one or more bytes that it is not able to decode.</span></span> <span data-ttu-id="3cbce-347">Классы <xref:System.Text.EncoderFallbackBuffer> и <xref:System.Text.DecoderFallbackBuffer> предоставляют реализацию резервной стратегии.</span><span class="sxs-lookup"><span data-stu-id="3cbce-347">The <xref:System.Text.EncoderFallbackBuffer> and <xref:System.Text.DecoderFallbackBuffer> classes provide the fallback implementation.</span></span> <span data-ttu-id="3cbce-348">Каждый экземпляр представляет буфер, содержащий символы резервной стратегии, которые заменят символ, который не удалось закодировать, или последовательность байтов, которую не удалось декодировать.</span><span class="sxs-lookup"><span data-stu-id="3cbce-348">Each instance represents a buffer that contains the fallback characters that will replace the character that cannot be encoded or the byte sequence that cannot be decoded.</span></span>

<span data-ttu-id="3cbce-349">При создании пользовательской резервной стратегии для кодировщика или декодера необходимо реализовать следующие члены:</span><span class="sxs-lookup"><span data-stu-id="3cbce-349">When you create a custom fallback solution for an encoder or decoder, you must implement the following members:</span></span>

- <span data-ttu-id="3cbce-350">метод <xref:System.Text.EncoderFallbackBuffer.Fallback%2A?displayProperty=nameWithType> или <xref:System.Text.DecoderFallbackBuffer.Fallback%2A?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="3cbce-350">The <xref:System.Text.EncoderFallbackBuffer.Fallback%2A?displayProperty=nameWithType> or <xref:System.Text.DecoderFallbackBuffer.Fallback%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="3cbce-351">Метод<xref:System.Text.EncoderFallbackBuffer.Fallback%2A?displayProperty=nameWithType> вызывается кодировщиком, чтобы предоставить резервный буфер со сведениями о символе, который не удается кодировать.</span><span class="sxs-lookup"><span data-stu-id="3cbce-351"><xref:System.Text.EncoderFallbackBuffer.Fallback%2A?displayProperty=nameWithType> is called by the encoder to provide the fallback buffer with information about the character that it cannot encode.</span></span> <span data-ttu-id="3cbce-352">Так как символ, который требуется закодировать, может быть замещающей парой, этот метод перегружается.</span><span class="sxs-lookup"><span data-stu-id="3cbce-352">Because the character to be encoded may be a surrogate pair, this method is overloaded.</span></span> <span data-ttu-id="3cbce-353">Одной перегрузке передается символ, который нужно закодировать, и его индекс в строке.</span><span class="sxs-lookup"><span data-stu-id="3cbce-353">One overload is passed the character to be encoded and its index in the string.</span></span> <span data-ttu-id="3cbce-354">Второй перегрузке передаются верхний и нижний замещающий знаки и их индекс в строке.</span><span class="sxs-lookup"><span data-stu-id="3cbce-354">The second overload is passed the high and low surrogate along with its index in the string.</span></span> <span data-ttu-id="3cbce-355">Метод <xref:System.Text.DecoderFallbackBuffer.Fallback%2A?displayProperty=nameWithType> вызывается декодером, чтобы предоставить резервный буфер со сведениями о байтах, которые не удается декодировать.</span><span class="sxs-lookup"><span data-stu-id="3cbce-355">The <xref:System.Text.DecoderFallbackBuffer.Fallback%2A?displayProperty=nameWithType> method is called by the decoder to provide the fallback buffer with information about the bytes that it cannot decode.</span></span> <span data-ttu-id="3cbce-356">Этому методу передается массив байтов, которые не удалось декодировать, а также индекс первого байта.</span><span class="sxs-lookup"><span data-stu-id="3cbce-356">This method is passed an array of bytes that it cannot decode, along with the index of the first byte.</span></span> <span data-ttu-id="3cbce-357">Метод резервной стратегии должен возвращать значение `true` , если резервный буфер может предоставить наилучшим образом соответствующий или замещающий символ (или символы); в противном случае он должен возвращать значение `false`.</span><span class="sxs-lookup"><span data-stu-id="3cbce-357">The fallback method should return `true` if the fallback buffer can supply a best-fit or replacement character or characters; otherwise, it should return `false`.</span></span> <span data-ttu-id="3cbce-358">При использовании стратегии исключения метод резервной стратегии должен создавать исключение.</span><span class="sxs-lookup"><span data-stu-id="3cbce-358">For an exception fallback, the fallback method should throw an exception.</span></span>

- <span data-ttu-id="3cbce-359">Метод <xref:System.Text.EncoderFallbackBuffer.GetNextChar%2A?displayProperty=nameWithType> или <xref:System.Text.DecoderFallbackBuffer.GetNextChar%2A?displayProperty=nameWithType> , который вызывается кодировщиком или декодером многократно для получения следующего символа из резервного буфера.</span><span class="sxs-lookup"><span data-stu-id="3cbce-359">The <xref:System.Text.EncoderFallbackBuffer.GetNextChar%2A?displayProperty=nameWithType> or <xref:System.Text.DecoderFallbackBuffer.GetNextChar%2A?displayProperty=nameWithType> method, which is called repeatedly by the encoder or decoder to get the next character from the fallback buffer.</span></span> <span data-ttu-id="3cbce-360">После возврата всех резервных символов метод должен вернуть символ U+0000.</span><span class="sxs-lookup"><span data-stu-id="3cbce-360">When all fallback characters have been returned, the method should return U+0000.</span></span>

- <span data-ttu-id="3cbce-361">Свойство <xref:System.Text.EncoderFallbackBuffer.Remaining%2A?displayProperty=nameWithType> или <xref:System.Text.DecoderFallbackBuffer.Remaining%2A?displayProperty=nameWithType> , которое возвращает количество символов, оставшихся в резервном буфере.</span><span class="sxs-lookup"><span data-stu-id="3cbce-361">The <xref:System.Text.EncoderFallbackBuffer.Remaining%2A?displayProperty=nameWithType> or <xref:System.Text.DecoderFallbackBuffer.Remaining%2A?displayProperty=nameWithType> property, which returns the number of characters remaining in the fallback buffer.</span></span>

- <span data-ttu-id="3cbce-362">Метод <xref:System.Text.EncoderFallbackBuffer.MovePrevious%2A?displayProperty=nameWithType> или <xref:System.Text.DecoderFallbackBuffer.MovePrevious%2A?displayProperty=nameWithType> , который перемещает текущую позицию в резервном буфере к предыдущему символу.</span><span class="sxs-lookup"><span data-stu-id="3cbce-362">The <xref:System.Text.EncoderFallbackBuffer.MovePrevious%2A?displayProperty=nameWithType> or <xref:System.Text.DecoderFallbackBuffer.MovePrevious%2A?displayProperty=nameWithType> method, which moves the current position in the fallback buffer to the previous character.</span></span>

- <span data-ttu-id="3cbce-363">Метод <xref:System.Text.EncoderFallbackBuffer.Reset%2A?displayProperty=nameWithType> или <xref:System.Text.DecoderFallbackBuffer.Reset%2A?displayProperty=nameWithType> , повторно инициализирующий резервный буфер.</span><span class="sxs-lookup"><span data-stu-id="3cbce-363">The <xref:System.Text.EncoderFallbackBuffer.Reset%2A?displayProperty=nameWithType> or <xref:System.Text.DecoderFallbackBuffer.Reset%2A?displayProperty=nameWithType> method, which reinitializes the fallback buffer.</span></span>

<span data-ttu-id="3cbce-364">Если реализована резервная стратегия наилучшего соответствия или замены, классы, унаследованные от <xref:System.Text.EncoderFallbackBuffer> и <xref:System.Text.DecoderFallbackBuffer> , также имеют два закрытых поля экземпляра: точное число символов в буфере и индекс в буфере следующего символа, который нужно вернуть.</span><span class="sxs-lookup"><span data-stu-id="3cbce-364">If the fallback implementation is a best-fit fallback or a replacement fallback, the classes derived from <xref:System.Text.EncoderFallbackBuffer> and <xref:System.Text.DecoderFallbackBuffer> also maintain two private instance fields: the exact number of characters in the buffer; and the index of the next character in the buffer to return.</span></span>

### <a name="an-encoderfallback-example"></a><span data-ttu-id="3cbce-365">Пример EncoderFallback</span><span class="sxs-lookup"><span data-stu-id="3cbce-365">An EncoderFallback Example</span></span>

<span data-ttu-id="3cbce-366">В примере выше использовалась стратегия замены для замены символов Юникода, не соответствующих символам ASCII, звездочкой (\*).</span><span class="sxs-lookup"><span data-stu-id="3cbce-366">An earlier example used replacement fallback to replace Unicode characters that did not correspond to ASCII characters with an asterisk (\*).</span></span> <span data-ttu-id="3cbce-367">В примере ниже используется пользовательская резервная стратегия наилучшего соответствия для получения более удачного сопоставления символов, отсутствующих в ASCII.</span><span class="sxs-lookup"><span data-stu-id="3cbce-367">The following example uses a custom best-fit fallback implementation instead to provide a better mapping of non-ASCII characters.</span></span>

<span data-ttu-id="3cbce-368">В приведенном коде определяется класс с именем `CustomMapper` , производный от <xref:System.Text.EncoderFallback> , для обработки наилучшего сопоставления символов, отсутствующих в ASCII.</span><span class="sxs-lookup"><span data-stu-id="3cbce-368">The following code defines a class named `CustomMapper` that is derived from <xref:System.Text.EncoderFallback> to handle the best-fit mapping of non-ASCII characters.</span></span> <span data-ttu-id="3cbce-369">Его метод `CreateFallbackBuffer` возвращает объект `CustomMapperFallbackBuffer` , предоставляющий реализацию <xref:System.Text.EncoderFallbackBuffer> .</span><span class="sxs-lookup"><span data-stu-id="3cbce-369">Its `CreateFallbackBuffer` method returns a `CustomMapperFallbackBuffer` object, which provides the <xref:System.Text.EncoderFallbackBuffer> implementation.</span></span> <span data-ttu-id="3cbce-370">Класс `CustomMapper` использует объект <xref:System.Collections.Generic.Dictionary%602> для хранения сопоставлений неподдерживаемых символов Юникода (значение ключа) и соответствующих им 8-битных символов (которые хранятся в двух последовательных байтах в виде 64-разрядного целого числа).</span><span class="sxs-lookup"><span data-stu-id="3cbce-370">The `CustomMapper` class uses a <xref:System.Collections.Generic.Dictionary%602> object to store the mappings of unsupported Unicode characters (the key value) and their corresponding 8-bit characters (which are stored in two consecutive bytes in a 64-bit integer).</span></span> <span data-ttu-id="3cbce-371">Чтобы это сопоставление было доступно резервному буферу, экземпляр `CustomMapper` передается в качестве параметра конструктору класса `CustomMapperFallbackBuffer` .</span><span class="sxs-lookup"><span data-stu-id="3cbce-371">To make this mapping available to the fallback buffer, the `CustomMapper` instance is passed as a parameter to the `CustomMapperFallbackBuffer` class constructor.</span></span> <span data-ttu-id="3cbce-372">Так как самое длинное сопоставление — это строка INF для символа Юникода с кодом U+221E, свойство `MaxCharCount` возвращает значение 3.</span><span class="sxs-lookup"><span data-stu-id="3cbce-372">Because the longest mapping is the string "INF" for the Unicode character U+221E, the `MaxCharCount` property returns 3.</span></span>

[!code-csharp[Conceptual.Encoding#5](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.encoding/cs/custom1.cs#5)]
[!code-vb[Conceptual.Encoding#5](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.encoding/vb/custom1.vb#5)]

<span data-ttu-id="3cbce-373">В примере кода ниже определяется класс `CustomMapperFallbackBuffer` , производный от <xref:System.Text.EncoderFallbackBuffer>.</span><span class="sxs-lookup"><span data-stu-id="3cbce-373">The following code defines the `CustomMapperFallbackBuffer` class, which is derived from <xref:System.Text.EncoderFallbackBuffer>.</span></span> <span data-ttu-id="3cbce-374">Словарь, содержащий сопоставления наилучшего соответствия и определенный в экземпляре класса `CustomMapper` , доступен из конструктора класса.</span><span class="sxs-lookup"><span data-stu-id="3cbce-374">The dictionary that contains best-fit mappings and that is defined in the `CustomMapper` instance is available from its class constructor.</span></span> <span data-ttu-id="3cbce-375">Его метод `Fallback` возвращает значение `true` , если какие-либо символы Юникода, которые не удается кодировать кодировщику ASCII, определены в словаре сопоставлений; в противном случае возвращается значение `false`.</span><span class="sxs-lookup"><span data-stu-id="3cbce-375">Its `Fallback` method returns `true` if any of the Unicode characters that the ASCII encoder cannot encode are defined in the mapping dictionary; otherwise, it returns `false`.</span></span> <span data-ttu-id="3cbce-376">Для каждого резервного действия закрытая переменная `count` указывает число символов, которые осталось вернуть, а закрытая переменная `index` указывает позицию в буфере строк (значение `charsToReturn`) следующего символа, который нужно вернуть.</span><span class="sxs-lookup"><span data-stu-id="3cbce-376">For each fallback, the private `count` variable indicates the number of characters that remain to be returned, and the private `index` variable indicates the position in the string buffer, `charsToReturn`, of the next character to return.</span></span>

[!code-csharp[Conceptual.Encoding#6](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.encoding/cs/custom1.cs#6)]
[!code-vb[Conceptual.Encoding#6](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.encoding/vb/custom1.vb#6)]

<span data-ttu-id="3cbce-377">В приведенном ниже коде создается экземпляр объекта `CustomMapper` , который передается в метод <xref:System.Text.Encoding.GetEncoding%28System.String%2CSystem.Text.EncoderFallback%2CSystem.Text.DecoderFallback%29?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="3cbce-377">The following code then instantiates the `CustomMapper` object and passes an instance of it to the <xref:System.Text.Encoding.GetEncoding%28System.String%2CSystem.Text.EncoderFallback%2CSystem.Text.DecoderFallback%29?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="3cbce-378">Выходные данные показывают, что реализация стратегии наилучшего соответствия успешно обрабатывает три символа исходной строки, отсутствующие в ASCII.</span><span class="sxs-lookup"><span data-stu-id="3cbce-378">The output indicates that the best-fit fallback implementation successfully handles the three non-ASCII characters in the original string.</span></span>

[!code-csharp[Conceptual.Encoding#7](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.encoding/cs/custom1.cs#7)]
[!code-vb[Conceptual.Encoding#7](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.encoding/vb/custom1.vb#7)]

## <a name="see-also"></a><span data-ttu-id="3cbce-379">См. также</span><span class="sxs-lookup"><span data-stu-id="3cbce-379">See also</span></span>

- <xref:System.Text.Encoder>
- <xref:System.Text.Decoder>
- <xref:System.Text.DecoderFallback>
- <xref:System.Text.Encoding>
- <xref:System.Text.EncoderFallback>
- [<span data-ttu-id="3cbce-380">Глобализация и локализация</span><span class="sxs-lookup"><span data-stu-id="3cbce-380">Globalization and Localization</span></span>](../../../docs/standard/globalization-localization/index.md)
