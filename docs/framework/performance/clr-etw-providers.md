---
title: Поставщики ETW среды CLR
ms.date: 03/30/2017
helpviewer_keywords:
- ETW, CLR providers
- CLR ETW providers
ms.assetid: 0beafad4-b2c8-47f4-b342-83411d57a51f
ms.openlocfilehash: 33ef7491c2bffeda4ef737ed8f826cdfbfbb119d
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/14/2020
ms.locfileid: "79401007"
---
# <a name="clr-etw-providers"></a>Поставщики ETW среды CLR
В общеязыковой среде выполнения (CLR) представлены два поставщика: поставщик среды выполнения и поставщик очистки.  
  
 Поставщик среды выполнения вызывает события в зависимости от того, какие ключевые слова (категории событий) активированы. Например, с помощью ключевого слова `LoaderKeyword` можно активировать сбор событий загрузчика.  
  
 Отслеживание событий для Windows (ETW) регистрируется в файле с расширением .etl, которое позже может быть обработано в файлах, разделенных запятой (.csv) по мере необходимости. Дополнительные сведения о преобразовании ETL-файлов в файлы с расширением CSV см. в разделе [Контроль ведения журнала .NET Framework](controlling-logging.md).  
  
## <a name="the-runtime-provider"></a>Поставщик среды выполнения  
 Поставщик среды выполнения является основным поставщиком трассировки событий Windows в среде CLR.  
  
 Поставщик среды выполнения CLR имеет GUID e13c0d23-ccbc-4e12-931b-d9cc2eee27e4.  
  
 Примеры записи в журнал и просмотра событий трассировки событий Windows в среде CLR с использованием общедоступных средств см. в разделе [Контроль ведения журнала .NET Framework](controlling-logging.md).  
  
 Помимо таких ключевых слов, как `LoaderKeyword`, вам может потребоваться включить ключевые слова для ведения журнала событий, которые могут возникать слишком часто. Такие события активируются с помощью ключевых слов `StartEnumerationKeyword` и `EndEnumerationKeyword`, описание которых приводится в разделе [Ключевые слова и уровни среды CLR (трассировка событий Windows)](clr-etw-keywords-and-levels.md).  
  
## <a name="the-rundown-provider"></a>Поставщик очистки  
 В некоторых особых ситуациях необходимо активировать поставщик очистки. Тем не менее в большинстве случаев достаточно использовать поставщик среды выполнения.  
  
 Поставщик очистки среды CLR имеет GUID A669021C-C450-4609-A035-5AF59AF4DF18.  
  
 Как правило, ведение журнала трассировки событий Windows активируется до запуска процесса и отключается после выхода из него. Тем не менее, если включить трассировку событий Windows во время выполнения процесса, потребуется дополнительная информация о процессе. Например, для разрешения символов требуется вести журнал событий для методов, которые были уже загружены до того, как было включено ведение журнала.  
  
 События `DCStart` и `DCEnd` захватывают состояние процесса на момент запуска и остановки сбора данных. (Государство относится к информации на высоком уровне, включая методы, которые уже были составлены точно в срок (JIT) и сборки, которые были загружены.) Эти два события могут предоставить информацию о том, что уже произошло в процессе; например, какие методы были составлены JIT- и так далее.  
  
 При использовании поставщика очистки возникают только события, в именах которых содержатся строки `DC`, `DCStart`, `DCEnd` или `DCInit`. Кроме того, эти события создаются только при использовании поставщика очистки.  
  
 В дополнение к фильтрам ключевых слов событий поставщик очистки также поддерживает ключевые слова `StartRundownKeyword` и `EndRundownKeyword`, обеспечивающие целевую фильтрацию.  
  
### <a name="start-rundown"></a>Начальная очистка  
 Начальная очистка инициируется в тот момент, когда с помощью ключевого слова `StartRundownKeyword` активируется ведение журнала для поставщика очистки. В результате этого возникает событие `DCStart`, в котором фиксируется состояние системы. Перед началом перечисления возникает событие `DCStartInit`. По окончании перечисления возникает событие `DCStartComplete`, которое уведомляет контроллер о нормальном завершении сбора данных.  
  
### <a name="end-rundown"></a>Завершающая очистка  
 Завершающая очистка инициируется в тот момент, когда с помощью ключевого слова `EndRundownKeyword` отключается ведение журнала для поставщика очистки. Завершающая очистка прекращает профилирование для процесса, выполнение которого продолжается. События `DCEnd` фиксируют состояние системы в момент остановки профилирования.  
  
 Перед началом перечисления возникает событие `DCEndInit`. По окончании перечисления возникает событие `DCEndComplete`, которое уведомляет потребителя о нормальном завершении сбора данных. Начальная и завершающая очистка используются преимущественно для управляемого разрешения символов. Начальная очистка может предоставить сведения о диапазоне адресов для методов, которые уже прошли JIT-компиляцию до начала сеанса профилирования. Завершающая очистка может предоставить сведения о диапазоне адресов для всех методов, которые уже прошли JIT-компиляцию непосредственно перед отключением профилирования.  
  
 Завершающая очистка не выполняется автоматически, если сеанс профилирования остановлен. Вместо этого средство, которое пытается выполнить управляемое разрешение символов, должно явно вызывать сеанс поставщика среды выполнения CLR с включенным ключевым словом `EndRundownKeyword` непосредственно перед остановкой профилирования.  
  
 Несмотря на то, что в ходе начальной и завершающей очистки методу могут предоставляться сведения о диапазоне адресов для управляемого разрешения символов, мы рекомендуем использовать ключевое слово `EndRundownKeyword` (предоставляет события `DCEnd`) вместо ключевого слова `StartRundownKeyword` (предоставляет события `DCStart`). Это связано с тем, что ключевое слово `StartRundownKeyword` запускает очистку во время сеанса профилирования, что может помешать выполнению профилируемого сценария.  
  
## <a name="etw-data-collection-using-runtime-and-rundown-providers"></a>Сбор данных трассировки событий Windows с помощью поставщиков среды выполнения и очистки  
 В следующем примере демонстрируется, как использовать поставщик очистки среды CLR, чтобы обеспечить разрешение символов для управляемых процессов с минимальными последствиями независимо от того, начинаются или завершаются процессы во время профилирования или за пределами этого периода.  
  
1. Включение ведения журнала трассировки событий Windows с использованием поставщика среды выполнения CLR:  
  
    ```console
    xperf -start clr -on e13c0d23-ccbc-4e12-931b-d9cc2eee27e4:0x1CCBD:0x5 -f clr1.etl
    ```  
  
     Журнал будет сохраняться в файле clr1.etl.  
  
2. Чтобы остановить профилирование во время выполнения процесса, запустите поставщик очистки для захвата событий `DCEnd`:  
  
    ```console
    xperf -start clrRundown -on A669021C-C450-4609-A035-5AF59AF4DF18:0xB8:0x5 -f clr2.etl
    ```  
  
     В результате включается сбор событий `DCEnd` для начала сеанса очистки. Сбор всех событий может занимать от 30 до 60 секунд. Журнал будет сохраняться в файле clr1.et2.  
  
3. Отключение профилирования трассировки всех событий Windows:  
  
    ```console
    xperf -stop clrRundown
    xperf -stop clr  
    ```  
  
4. Объединение профилей в один файл журнала:  
  
    ```console
    xperf -merge clr1.etl clr2.etl merged.etl  
    ```  
  
     В объединенном ETL-файле будут содержаться события из сеансов поставщиков среды выполнения и очистки.  
  
 Если пользователь запрашивает остановку профилирования, средство может выполнять шаги 2 и 3 (запуск сеанса очистки и завершение профилирования) вместо немедленного отключения профилирования. Кроме того, это средство может выполнить шаг 4.  
  
## <a name="see-also"></a>См. также раздел

- [События в среде CLR (трассировка событий Windows)](etw-events-in-the-common-language-runtime.md)
