---
title: Caspol.exe (средство настройки политики управления доступом для кода)
ms.date: 03/30/2017
helpviewer_keywords:
- permission sets, modifying security policy
- security policy [.NET Framework], Code Access Security Policy tool
- enterprise security policy
- referencing code groups and permission sets
- user security policy
- Caspol.exe
- Code Access Security Policy tool
- code groups, modifying security policy
- application development [.NET Framework], security
- machine security policy
- security policy [.NET Framework], modifying
- manually editing security configuration files
ms.assetid: d2bf6123-7b0c-4e60-87ad-a39a1c3eb2e0
ms.openlocfilehash: b5b5e1872af89417fbad6e95b7a8bee5e9b68925
ms.sourcegitcommit: 559fcfbe4871636494870a8b716bf7325df34ac5
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/30/2019
ms.locfileid: "73129895"
---
# <a name="caspolexe-code-access-security-policy-tool"></a>Caspol.exe (средство настройки политики управления доступом для кода)
Программа для настройки политики разграничения доступа кода (Caspol.exe) позволяет пользователям и администраторам изменять политику безопасности на уровне компьютера, пользователя и предприятия.  
  
> [!IMPORTANT]
> Начиная с .NET Framework 4, программа Caspol.exe не влияет на политику CAS, если для элемента [\<legacyCasPolicy>](../configure-apps/file-schema/runtime/netfx40-legacysecuritypolicy-element.md) не задано значение `true`. Все параметры, отображаемые или изменяемые программой CasPol.exe, будут влиять только на приложения, для которых явно задано использование политики CAS. Дополнительные сведения см. в разделе [Изменения системы безопасности](../security/security-changes.md).  
  
> [!NOTE]
> На 64-разрядных компьютерах присутствуют и 64-разрядная, и 32-разрядная версии политики безопасности. Чтобы проверить возможность применения политики к 32-разрядным и 64-разрядным приложениям, запустите 32-разрядную и 64-разрядную версии программы Caspol.exe.  
  
 Программа для настройки политики разграничения доступа кода автоматически устанавливается вместе с .NET Framework и Visual Studio. Программа Caspol.exe находится в каталоге %windir%\Microsoft.NET\Framework\\*версия* в 32-разрядных системах или в каталоге %windir%\Microsoft.NET\Framework64\\*версия* в 64-разрядных системах. (Например, в 64-разрядной системе программа будет находиться в каталоге %windir%\Microsoft.NET\Framework64\v4.030319\caspol.exe для .NET Framework 4.) Если на компьютере одновременно работает несколько версий .NET Framework, на нем могут быть установлены разные версии программы. Программу можно запустить из каталога установки. Однако [командная строка](developer-command-prompt-for-vs.md) является рекомендуемым способом запуска, поскольку для этого не требуется переходить в каталог установки.  
  
 В командной строке введите следующее.  
  
## <a name="syntax"></a>Синтаксис  
  
```console
caspol [options]  
```  
  
## <a name="parameters"></a>Параметры  
  
|Параметр|ОПИСАНИЕ|  
|------------|-----------------|  
|**-addfulltrust** *assembly_file*<br /><br /> или<br /><br /> **-af** *assembly_file*|Добавляет сборку, реализующую настраиваемый объект безопасности (например, настраиваемое разрешение или настраиваемое условие членства), в список сборок с полным доверием для заданного уровня политики. Аргумент *assembly_file* задает добавляемую сборку. Этот файл должен быть подписан [строгим именем](../../standard/assembly/strong-named.md). Для подписи сборки строгим именем используется [программа строгих имен (Sn.exe)](sn-exe-strong-name-tool.md).<br /><br /> При добавлении в политику набора разрешений, который содержит настраиваемое разрешение, сборка, реализующая настраиваемое разрешение, должна быть добавлена в список полного доверия этого уровня политики. Сборки, реализующие настраиваемые объекты безопасности (например, настраиваемые группы кодов или условия членства), применяемые в политике безопасности (например, политике компьютера), должны быть добавлены в список сборок с полным доверием. **Внимание!**  Если сборка, реализующая настраиваемый объект безопасности, ссылается на другие сборки, необходимо сначала добавить эти сборки в список сборок с полным доверием. Настраиваемые объекты безопасности, созданные с помощью Visual Basic, Visual C++ или JScript, ссылаются на "Microsoft.VisualBasic.dll", "Microsoft.VisualC.dll" и "Microsoft.JScript.dll" соответственно. Эти сборки по умолчанию не содержатся в списке полностью доверенных сборок. Нужно добавить соответствующую сборку в список полностью доверенных, прежде чем добавлять пользовательский объект безопасности. Невыполнение этого требования нарушит целостность системы безопасности, в результате чего ни одна из сборок не сможет быть загружена. В этой ситуации параметр Caspol.exe **-all -reset** не исправит систему безопасности. Для ее исправления необходимо вручную редактировать файлы безопасности для удаления объекта безопасности.|  
|**-addgroup** {*parent_label &#124; parent_name*} *mship pset_name* [*flags*]<br /><br /> или<br /><br /> **-ag** {*parent_label &#124; parent_name*} *mship pset_name* [*flags*]|Добавляет новую группу кода в иерархию групп кода. Можно задать *parent_label* или *parent_name*. Аргумент *parent_label* задает метку (например, 1. или 1.1.) группы кода, которая является родительской по отношению к добавляемой группе кода. Аргумент *parent_name* задает имя группы кода, являющейся родительской по отношению к добавляемой группе кода. Поскольку аргументы *parent_label* и *parent_name* взаимозаменяемы, программа Caspol.exe должна их различать. Поэтому аргумент *parent_name* не может начинаться с цифры. Кроме того, аргумент *parent_name* может состоять только из символов A–Z, 0–9 и символов подчеркивания.<br /><br /> Аргумент *mship* задает условие членства для новой группы кода. Дополнительные сведения см. в таблице аргументов *mship* ниже.<br /><br /> Аргумент *pset_name* задает имя набора разрешений, связанного с новой группой кода. Кроме того, для новой группы можно задать один или несколько аргументов *flags*. Дополнительные сведения см. в таблице аргументов *flags* ниже.|  
|**-addpset** {*psfile* &#124; *psfile* p*set_name*}<br /><br /> или<br /><br /> **-ap** {*named*_*psfile* &#124; *psfile* *pset_name*}|Добавляет в политику новый именованный набор разрешений. Набор разрешений должен быть создан на языке XML и храниться в XML-файле. Если XML-файл содержит имя набора разрешений, необходимо указать только имя файла (*psfile*). Если XML-файл не содержит имя набора разрешений, необходимо задать и имя XML-файла (*psfile*), и имя набора разрешений (*pset_name*).<br /><br /> Обратите внимание, что все разрешения, используемые в наборе разрешений, должны быть определены в сборках, находящихся в глобальном кэше сборок.|  
|**-a**[**ll**]|Указывает, что параметры, следующие за этим параметром, применяются к политикам компьютера, пользователя и предприятия. Параметр **-all** всегда относится к политике текущего пользователя, вошедшего в систему. Чтобы сослаться на политику пользователя, отличного от текущего, задайте параметр **-customall**.|  
|**-chggroup** {*label &#124;name*} {*mship* &#124; *pset_name* &#124;<br /><br /> *flags* `}`<br /><br /> или<br /><br /> **-cg** {*label &#124;name*} {*mship* &#124; *pset_name* &#124;<br /><br /> *flags* `}`|Изменяет условие членства в группе кода, набор разрешений или параметры флагов **exclusive**, **levelfinal**, **name** или **description**. Можно задать аргумент *label* или *name*. Аргумент *label* задает метку (например, 1. или 1.1.) группы кода. Аргумент *name* задает имя изменяемой группы кода. Поскольку аргументы *label* и *name* взаимозаменяемы, программа Caspol.exe должна их различать. Поэтому аргумент *name* не может начинаться с цифры. Кроме того, аргумент *name* может состоять только из символов A–Z, 0–9 и символов подчеркивания.<br /><br /> Аргумент *pset_name* задает имя набора разрешений, связываемого с группой кода. Сведения об аргументах *mship* и *flags* см. в таблицах ниже.|  
|**-chgpset** *psfile pset_name*<br /><br /> или<br /><br /> **-cp** *psfile pset_name*|Изменяет именованный набор разрешений. Аргумент *psfile* задает новое определение набора разрешений, то есть файл сериализованного набора разрешений в формате XML. Аргумент *pset_name* задает имя набора разрешений, который необходимо изменить.|  
|**-customall**  *path*<br /><br /> или<br /><br /> **-ca**  *path*|Указывает, что параметры, следующие за этим параметром, применяются к политикам компьютера, предприятия и настраиваемым политикам указанного пользователя. Требуется задать расположение файла конфигурации безопасности пользователя в аргументе *path*.|  
|**-cu**[**stomuser**] *path*|Разрешает администрирование настраиваемой политики пользователя, которая не принадлежит пользователю, от имени которого запущена программа Caspol.exe. Требуется задать расположение файла конфигурации безопасности пользователя в аргументе *path*.|  
|**-enterprise**<br /><br /> или<br /><br /> **-en**|Указывает, что все параметры, следующие за этим параметром, применяются к политике уровня предприятия. Пользователи, не являющиеся администраторами предприятия, не имеют достаточных прав на изменение политики предприятия, хотя и могут ее просматривать. По умолчанию в сценариях, не относящихся к предприятию, эта политика не влияет на политики компьютера и пользователя.|  
|**-e**[**xecution**] {**on** &#124; **off**}|Включает и отключает механизм проверки разрешений до выполнения кода. **Примечание.**  Этот параметр не поддерживается в .NET Framework 4 и более поздних версиях. Дополнительные сведения см. в разделе [Изменения системы безопасности](../security/security-changes.md).|  
|**-f**[**orce**]|Отключает проверку инструмента на самоуничтожение и изменяет политику в соответствии с заданными пользователем параметрами. В обычных условиях программа Caspol.exe проверяет, не помешают ли ее работе изменения, внесенные в политику, и если они нарушат ее работу, то изменения политики не сохраняются и выводится сообщение об ошибке. Чтобы принудительно внести изменения в политику, даже если они нарушат работу программы Caspol.exe, следует указать параметр **-force**.|  
|**-h**[**elp**]|Отображает синтаксис команд и параметров программы Caspol.exe.|  
|**-l**[**ist**]|Отображает иерархию групп кода и наборы разрешений для уровней указанного компьютера, пользователя, предприятия или для всех уровней политик. Программа Caspol.exe сначала отображает метку группы кода, а затем имя, если оно задано.|  
|**-listdescription**<br /><br /> или<br /><br /> **-ld**|Отображает список описаний всех групп кода для указанного уровня политики.|  
|**-listfulltrust**<br /><br /> или<br /><br /> **-lf**|Отображает список сборок с полным доверием для указанного уровня политики.|  
|**-listgroups**<br /><br /> или<br /><br /> **-lg**|Отображает группы кода для указанного уровня политики или всех уровней политики. Программа Caspol.exe сначала отображает метку группы кода, а затем имя, если оно задано.|  
|**-listpset** или **-lp**|Отображает наборы разрешений для указанного уровня политики или всех уровней политики.|  
|**-m**[**achine**]|Указывает, что все параметры, следующие за этим параметром, применяются к политике уровня компьютера. Пользователи, не являющиеся администраторами, не имеют достаточных прав на изменение политики компьютера, хотя могут просматривать ее. Для администраторов параметр **-machine** задан по умолчанию.|  
|**-polchgprompt** {**on** &#124; **off**}<br /><br /> или<br /><br /> **-pp** {**on** &#124; **off**}|Разрешает или запрещает выдачу запроса, появляющегося при запуске программы Caspol.exe с параметрами, которые могут изменить политику.|  
|**-quiet**<br /><br /> или<br /><br /> **-q**|Временно блокирует вывод запроса, отображаемого при выборе параметров, которые могут изменить политику. Это не влияет на вывод запроса при внесении глобальных изменений. Этот параметр следует использовать только для отдельных команд, чтобы не допустить вывод запроса для всех команд программы Caspol.exe.|  
|**-r**[**ecover**]|Восстанавливает политику из файла резервной копии. При изменении политики старая политика программы Caspol.exe сохраняется в файле резервной копии.|  
|**-remfulltrust** *assembly_file*<br /><br /> или<br /><br /> **-rf**  *assembly_file*|Удаляет сборку из списка сборок с полным доверием для уровня политики. Эту операцию следует выполнить, если политика больше не использует набор разрешений, содержащий настраиваемое разрешение. Тем не менее, сборки, реализующие настраиваемые разрешения, следует удалять из списка сборок с полным доверием, только если они не реализуют другие настраиваемые разрешения, которые еще используются. При удалении сборки из списка следует удалить все сборки, которые от нее зависят.|  
|**-remgroup** {*label &#124;name*}<br /><br /> или<br /><br /> **-rg** {l*abel &#124; name*}|Удаляет группу кода, заданную меткой или именем. Если указанная группа кода имеет дочерние группы кода, они также будут удалены.|  
|**-rempset** *pset_name*<br /><br /> или<br /><br /> **-rp** *pset_name*|Удаляет указанный набор разрешений из политики. Удаляемый набор разрешений задается аргументом *pset_name*. Набор разрешений удаляется только в том случае, если он не связан ни с одной группой кода. Наборы разрешений по умолчанию (встроенные) не могут быть удалены.|  
|**-reset**<br /><br /> или<br /><br /> **-rs**|Восстанавливает политику в состояние по умолчанию и сохраняет ее на диске. Этот параметр полезен, если измененную политику проще не исправлять, а создать заново из состояния по умолчанию. Возврат к политике по умолчанию также целесообразен при создании файлов конфигурации безопасности на основе файлов, используемых по умолчанию. Дополнительные сведения см. в разделе [Ручная настройка файлов конфигурации безопасности](#cpgrfcodeaccesssecuritypolicyutilitycaspolexeanchor1).|  
|**-resetlockdown**<br /><br /> или<br /><br /> **-rsld**|Возвращает политику к более строгой версии состояния по умолчанию и сохраняет ее на диске; создает резервную копию предыдущей политики компьютера и сохраняет ее в файле с именем `security.config.bac`.  Заблокированная политика похожа на политику по умолчанию за тем исключением, что эта политика не предоставляет разрешений коду из зон `Local Intranet`, `Trusted Sites` и `Internet`, а соответствующие группы кода не имеют дочерних групп кода.|  
|**-resolvegroup** *assembly_file*<br /><br /> или<br /><br /> **-rsg**  *assembly_file*|Отображает группы кодов, к которым принадлежит указанная сборка (*assembly_file*). По умолчанию отображаются политики уровня компьютера, пользователя и предприятия, к которым принадлежит сборка. Чтобы отобразить только один уровень политики, задайте параметр **-machine**, **-user** или **-enterprise**.|  
|**-resolveperm** *assembly_file*<br /><br /> или<br /><br /> **-rsp** *assembly_file*|Отображает все разрешения, которые будут предоставлены сборке при указанном уровне политики безопасности или уровне политики безопасности по умолчанию, если выполнение сборки будет разрешено. Сборка задается аргументом *assembly_file*. Если указан параметр **-all**, разрешения вычисляются на основе политики пользователя, компьютера и предприятия; в противном случае применяются правила поведения по умолчанию.|  
|**-s**[**ecurity**] {**on** &#124; **off**}|Включает и выключает управление доступом для кода. Параметр **-s off** не отключает безопасность на основе ролей. **Примечание.**  Этот параметр не поддерживается в .NET Framework 4 и более поздних версиях. Дополнительные сведения см. в разделе [Изменения системы безопасности](../security/security-changes.md). **Внимание!**  При выключенной системе управления доступом для кода все требования доступа для кода удовлетворяются. При выключении системы управления доступом для кода система становится уязвимой для атак таких вредоносных программ, как вирусы и "черви". Отключение безопасности повышает производительность, однако это допустимо только в том случае, если общая безопасность системы обеспечивается другими механизмами. К другим мерам предосторожности, связанным с безопасностью, относится отключение от общедоступных сетей, физическая защита компьютера и т.п.|  
|**-u**[**ser**]|Указывает, что все параметры, следующие за этим параметром, применяются к политике уровня пользователя для пользователя, от имени которого запущена программа Caspol.exe. Для пользователей, не являющихся администраторами, параметр **-user** задан по умолчанию.|  
|**-?**|Отображает синтаксис команд и параметров программы Caspol.exe.|  
  
 Аргумент *mship*, определяющий условия членства в группе кода, может применяться с параметрами **-addgroup** и **-chggroup**. Каждый аргумент *mship* реализуется как класс .NET Framework. Чтобы задать аргумент *mship*, следует использовать один из приведенных ниже аргументов.  
  
|Аргумент|ОПИСАНИЕ|  
|--------------|-----------------|  
|**-allcode**|Задает весь код. Дополнительные сведения об этом условии членства см. в разделе <xref:System.Security.Policy.AllMembershipCondition?displayProperty=nameWithType>.|  
|**-appdir**|Задает каталог приложения. Если в качестве условия членства задано **-appdir**, URL-свидетельство кода сравнивается со свидетельством каталога приложения этого кода. Если значения свидетельств совпадают, условие членства выполнено. Дополнительные сведения об этом условии членства см. в разделе <xref:System.Security.Policy.ApplicationDirectoryMembershipCondition?displayProperty=nameWithType>.|  
|**-custom**  *xmlfile*|Добавляет настраиваемое условие членства. Обязательный аргумент *xmlfile* задает XML-файл, содержащий XML-сериализацию настраиваемого условия членства.|  
|**-hash** *hashAlg* { **-hex** *hashValue* &#124; **-file** *assembly_file*}|Задает код с указанным хэшем сборки. Чтобы использовать хэш в качестве условия членства в группе кода, укажите значение хэша или файл сборки. Дополнительные сведения об этом условии членства см. в разделе <xref:System.Security.Policy.HashMembershipCondition?displayProperty=nameWithType>.|  
|**-pub** { **-cert** *cert_file_name* &#124;<br /><br /> **-file** *signed_file_name* &#124; **-hex**  *hex_string*}|Задает код указанного издателя программного обеспечения, определенного файлом сертификата, подписью файла или шестнадцатеричным представлением сертификата X509. Дополнительные сведения об этом условии членства см. в разделе <xref:System.Security.Policy.PublisherMembershipCondition?displayProperty=nameWithType>.|  
|**-site** *website*|Задает код с указанным исходным веб-сайтом. Например:<br /><br /> `-site** www.proseware.com`<br /><br /> Дополнительные сведения об этом условии членства см. в разделе <xref:System.Security.Policy.SiteMembershipCondition?displayProperty=nameWithType>.|  
|**-strong -file** *file_name* {*name* &#124; **-noname**} {*version* &#124; **-noversion**}|Задает код с указанным строгим именем (определяется по имени файла), имя сборки в виде строкового значения и версию сборки в формате *основная*.*вспомогательная*.*сборка*.*редакция*. Например:<br /><br /> **-strong -file** myAssembly.exe myAssembly 1.2.3.4<br /><br /> Дополнительные сведения об этом условии членства см. в разделе <xref:System.Security.Policy.StrongNameMembershipCondition?displayProperty=nameWithType>.|  
|**-url** *URL*|Задает код, полученный с указанного URL-адреса. URL-адрес должен включать протокол, например `http://` или `ftp://`. При необходимости задать несколько сборок с определенного URL-адреса используется подстановочный знак (\*). **Примечание.**  Так как URL-адрес можно указать с помощью разных имен, применение URL-адреса в качестве условия членства нельзя считать безопасным способом идентификации кода. Там, где это возможно, используйте условие членства строгого имени, условие членства издателя или условие членства хэша. <br /><br /> Дополнительные сведения об этом условии членства см. в разделе <xref:System.Security.Policy.UrlMembershipCondition?displayProperty=nameWithType>.|  
|**-zone** *zonename*|Задает код с указанной исходной зоной. Аргумент *zonename* может принимать одно из следующих значений: **MyComputer**, **Intranet**, **Trusted**, **Internet** или **Untrusted**. Дополнительные сведения об этом условии членства см. в разделе с описанием класса <xref:System.Security.Policy.ZoneMembershipCondition>.|  
  
 Аргумент *flags*, который может использоваться с параметрами **-addgroup** и **-chggroup**, определяется с использованием одного из следующих аргументов.  
  
|Аргумент|ОПИСАНИЕ|  
|--------------|-----------------|  
|**-description** "*description*"|В сочетании с параметром **-addgroup** задает описание добавляемой группы кода. В сочетании с параметром **-chggroup** задает описание редактируемой группы кода. Аргумент *description* должен быть заключен в двойные кавычки.|  
|**-exclusive** {**on**&#124;**off**}|С аргументом **on** указывает, что при выполнении для некоторого кода условий членства обрабатываются только те наборы разрешений, которые связаны с редактируемой или добавляемой группой кода. С аргументом **off** указывает, что должны обрабатываться наборы разрешений всех соответствующих групп кода на данном уровне политики.|  
|**-levelfinal** {**on**&#124;**off**}|С аргументом **on** исключает из рассмотрения все уровни политики ниже того, на котором расположена добавляемая или редактируемая группа кода. Этот параметр обычно используется на уровне политики компьютера. Например, если этот флаг указан для группы кода на уровне политики компьютера, политика уровня пользователя не будет вычислена и применена к коду, удовлетворяющему условию членства в этой группе.|  
|**-name** "*name*"|В сочетании с параметром **-addgroup** задает имя скрипта для добавляемой группы кода. В сочетании с параметром **-chggroup** задает имя скрипта для редактируемой группы кода. Аргумент *name* должен быть заключен в двойные кавычки. Аргумент *name* не может начинаться с цифры и должен состоять только из символов A–Z, 0–9 и символов подчеркивания. К группам кода можно обращаться по этому аргументу *name* вместо их цифровой метки. Кроме того, аргумент *name* очень удобен в работе со сценариями.|  
  
## <a name="remarks"></a>Примечания  
 Политика безопасности задается на трех уровнях: компьютера, пользователя и предприятия. Набор разрешений, получаемый сборкой, определяется пересечением наборов разрешений, предоставляемых этими тремя уровнями политики. Каждый уровень политики представлен иерархической структурой групп кода. У каждой группы кода имеется условие членства, по которому определяется принадлежность кода к группе. С каждой группой кода также связан именованный набор разрешений. Этот набор разрешений задает разрешения, предоставляемые исполняющей средой коду, который удовлетворяет условию членства. Иерархия групп кода и связанный с ней именованный набор разрешений определяют и поддерживают уровни политики безопасности. Чтобы задать уровень политики безопасности, используются параметры **-user**, **-customuser**, **-machine** и **-enterprise**.  
  
 Дополнительные сведения о политике безопасности и предоставлении коду разрешений исполняющей средой см. в разделе [Управление политикой безопасности](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/c1k0eed6(v=vs.100)).  
  
## <a name="referencing-code-groups-and-permission-sets"></a>Ссылки на группы кода и наборы разрешений  
 Параметр **-list**, отображающий список групп кода с цифровыми метками (1, 1.1, 1.1.1 и т. д.), упрощает создание ссылок на группы кода в иерархии. Другие функции командной строки, работающие с группами кода, также используют цифровые метки для ссылки на группы кода.  
  
 Ссылки на именованные наборы разрешений осуществляются по имени. Параметр **-list** отображает список групп кода и список именованных наборов разрешений, доступных в политике.  
  
## <a name="caspolexe-behavior"></a>Поведение программы Caspol.exe  
 Все параметры, за исключением **-s**[**ecurity**] {**on** &#124; **off**}, используют версию платформы .NET Framework, с которой была установлена программа Caspol.exe. Изменения, внесенные программой Caspol.exe, которая установлена с версией *X* среды выполнения, будут влиять только на эту версию. В другие параллельные установки среды выполнения, при их наличии, изменения вноситься не будут. Если программа Caspol.exe запущена из командной строки в каталоге, отличном от каталога среды выполнения требуемой версии, программа выполняется из каталога первой версии среды выполнения в пути (обычно это каталог последней установленной версии).  
  
 Параметр **-s**[**ecurity**] {**on** &#124; **off**} представляет собой операцию на уровне всего компьютера. При отключении управления доступом для кода отключается проверка безопасности для всего управляемого кода и всех пользователей компьютера. Проверки безопасности отключаются для всех установленных на компьютере параллельных версий .NET Framework, если они имеются. Хотя параметр **-list** и сообщает о том, что система безопасности отключена, никаких других признаков, по которым другие пользователи могли бы узнать об этом, не существует.  
  
 При запуске программы Caspol.exe пользователем без прав администратора все изменения вносятся в политику уровня пользователя, если не задан параметр **-machine**. При выполнении программы Caspol.exe администратором все изменения вносятся в политику уровня компьютера, если не задан параметр **-user**.  
  
 Для правильной работы программе Caspol.exe требуется набор разрешений, аналогичный **Everything**. Защитный механизм программы позволяет избежать внесения в политику изменений, препятствующих работе программы. При попытке внесения таких изменений будет выдано уведомление о том, что изменения не были внесены, так как они нарушат работу программы. Чтобы отключить этот защитный механизм для определенной команды, задайте параметр **-force**.  
  
<a name="cpgrfcodeaccesssecuritypolicyutilitycaspolexeanchor1"></a>   
## <a name="manually-editing-the-security-configuration-files"></a>Ручная настройка файлов конфигурации безопасности  
 Трем уровням политики безопасности (уровни пользователя, компьютера, предприятия), поддерживаемым программой Caspol.exe, соответствуют три файла конфигурации безопасности. Эти файлы создаются на диске только в том случае, если программа Caspol.exe изменяет политики уровня компьютера, пользователя или предприятия. С помощью параметра **-reset** можно сохранять установленную по умолчанию политику безопасности на диск, если это необходимо.  
  
 Ручное редактирование файлов конфигурации безопасности в большинстве случаев не рекомендуется. Однако в некоторых случаях ручное редактирование обязательно, например в том случае, если администратор желает изменить конфигурацию безопасности для конкретного пользователя.  
  
## <a name="examples"></a>Примеры  
 **-addfulltrust**  
  
 Допустим, что в политику компьютера был добавлен набор разрешений с настраиваемым разрешением. Настраиваемое разрешение реализовано в программе `MyPerm.exe`. Программа `MyPerm.exe` ссылается на классы программы `MyOther.exe`. Обе сборки должны быть добавлены в список сборок с полным доверием. Чтобы добавить сборку `MyPerm.exe` в список сборок с полным доверием политики компьютера, используется следующая команда.  
  
```console  
caspol -machine -addfulltrust MyPerm.exe  
```  
  
 Чтобы добавить сборку `MyOther.exe` в список сборок с полным доверием политики компьютера, используется следующая команда.  
  
```console  
caspol -machine -addfulltrust MyOther.exe  
```  
  
 **-addgroup**  
  
 Следующая команда добавляет дочернюю группу кода в корень иерархии групп кода политики компьютера. Новая группа кода является членом зоны **Internet** и связана с набором разрешений **Execution**.  
  
```console  
caspol -machine -addgroup 1.  -zone Internet Execution  
```  
  
 Следующая команда добавляет дочернюю группу кода, которая предоставляет разрешения локальной интрасети для действий share \\\netserver\netshare.  
  
```console  
caspol -machine -addgroup 1. -url \\netserver\netshare\* LocalIntranet  
```  
  
 **-addpset**  
  
 Следующая команда добавляет набор разрешений `Mypset` в политику пользователя.  
  
```console  
caspol -user -addpset Mypset.xml Mypset  
```  
  
 **-chggroup**  
  
 Следующая команда изменяет набор разрешений в политике пользователя группы кода с меткой 1.2. на набор разрешений **Execution**.  
  
```console  
caspol -user -chggroup 1.2. Execution  
```  
  
 Следующая команда изменяет условие членства в политике по умолчанию группы кода с меткой 1.2.1. и изменяет параметр флага **exclusive**. В качестве условия членства задано происхождение кода из зоны **Internet** и наличие включенного флага **exclusive**.  
  
```console  
caspol -chggroup 1.2.1. -zone Internet -exclusive on  
```  
  
 **-chgpset**  
  
 Следующая команда заменяет набор разрешений с именем `Mypset` на набор разрешений, содержащийся в файле `newpset.xml`. Обратите внимание, что в текущем выпуске не поддерживается замена наборов разрешений, используемых иерархией групп кода.  
  
```console  
caspol -chgpset Mypset newpset.xml  
```  
  
 **-force**  
  
 Следующая команда связывает корневую группу кода (метка 1) политики пользователя с набором разрешений **Nothing**. Выполнение этой команды препятствует работе программы Caspol.exe.  
  
```console  
caspol -force -user -chggroup 1 Nothing  
```  
  
 **-recover**  
  
 Следующая команда восстанавливает последнюю сохраненную политику уровня компьютера.  
  
```console  
caspol -machine -recover  
```  
  
 **-remgroup**  
  
 Следующая команда удаляет группу кода с меткой 1.1. Если у этой группы кода имеются дочерние группы кода, эти группы также будут удалены.  
  
```console  
caspol -remgroup 1.1.  
```  
  
 **-rempset**  
  
 Следующая команда удаляет набор разрешений **Execution** из политики пользователя.  
  
```console  
caspol -user -rempset Execution  
```  
  
 Следующая команда удаляет набор разрешений `Mypset` из политики уровня пользователя.  
  
```console  
caspol -rempset MyPset  
```  
  
 **-resolvegroup**  
  
 Следующая команда отображает все группы кода политики компьютера, в состав которых входит `myassembly`.  
  
```console  
caspol -machine -resolvegroup myassembly  
```  
  
 Следующая команда отображает все группы кода политики компьютера, предприятия и указанной настраиваемой политики пользователя, в состав которых входит `myassembly`.  
  
```console  
caspol -customall "c:\config_test\security.config" -resolvegroup myassembly  
```  
  
 **-resolveperm**  
  
 Следующая команда вычисляет разрешения для сборки `testassembly` на основе политик уровня компьютера и пользователя.  
  
```console  
caspol -all -resolveperm testassembly  
```  
  
## <a name="see-also"></a>См. также

- [Инструменты](index.md)
- [Командные строки](developer-command-prompt-for-vs.md)
