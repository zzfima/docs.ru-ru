---
title: Конечные точки служб и адресация очереди
ms.date: 03/30/2017
ms.assetid: 7d2d59d7-f08b-44ed-bd31-913908b83d97
ms.openlocfilehash: 6bdd3b0966f85ff456e0e2ed0b6da773046201dc
ms.sourcegitcommit: a4f9b754059f0210e29ae0578363a27b9ba84b64
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/05/2019
ms.locfileid: "74837991"
---
# <a name="service-endpoints-and-queue-addressing"></a><span data-ttu-id="79d2d-102">Конечные точки служб и адресация очереди</span><span class="sxs-lookup"><span data-stu-id="79d2d-102">Service Endpoints and Queue Addressing</span></span>
<span data-ttu-id="79d2d-103">В этом разделе рассматриваются принципы обращения клиентов к службам, выполняющим чтение из очередей, и сопоставления конечных точек служб с очередями.</span><span class="sxs-lookup"><span data-stu-id="79d2d-103">This topic discusses how clients address services that read from queues and how service endpoints map to queues.</span></span> <span data-ttu-id="79d2d-104">Как напоминание, на следующем рисунке показано классическое развертывание приложения, помещенного в очередь Windows Communication Foundation (WCF).</span><span class="sxs-lookup"><span data-stu-id="79d2d-104">As a reminder, the following illustration shows the classic Windows Communication Foundation (WCF) queued application deployment.</span></span>  
  
 <span data-ttu-id="79d2d-105">![Диаграмма приложений в очереди](../../../../docs/framework/wcf/feature-details/media/distributed-queue-figure.jpg "Схема распределенной очереди")</span><span class="sxs-lookup"><span data-stu-id="79d2d-105">![Queued Application Diagram](../../../../docs/framework/wcf/feature-details/media/distributed-queue-figure.jpg "Distributed-Queue-Figure")</span></span>  
  
 <span data-ttu-id="79d2d-106">Чтобы отправить службе сообщение, клиент адресует это сообщение целевой очереди.</span><span class="sxs-lookup"><span data-stu-id="79d2d-106">For the client to send the message to the service, the client addresses the message to the Target Queue.</span></span> <span data-ttu-id="79d2d-107">Чтобы прочитать сообщение из очереди, служба задает целевую очередь в качестве своего адреса прослушивания.</span><span class="sxs-lookup"><span data-stu-id="79d2d-107">For the service to read messages from the queue, it sets its listen address to the Target Queue.</span></span> <span data-ttu-id="79d2d-108">Адресация в WCF основана на универсальном коде ресурсов (URI), тогда как имена очередей сообщений (MSMQ) не основаны на универсальном коде ресурса (URI).</span><span class="sxs-lookup"><span data-stu-id="79d2d-108">Addressing in WCF is Uniform Resource Identifier (URI)-based while Message Queuing (MSMQ) queue names are not URI-based.</span></span> <span data-ttu-id="79d2d-109">Поэтому важно понимать, как обращаться к очередям, созданным в MSMQ, с помощью WCF.</span><span class="sxs-lookup"><span data-stu-id="79d2d-109">It is therefore essential to understand how to address queues created in MSMQ using WCF.</span></span>  
  
## <a name="msmq-addressing"></a><span data-ttu-id="79d2d-110">Адресация к очереди сообщений MSMQ</span><span class="sxs-lookup"><span data-stu-id="79d2d-110">MSMQ Addressing</span></span>  
 <span data-ttu-id="79d2d-111">В MSMQ очереди обозначаются с помощью путей и имен форматов.</span><span class="sxs-lookup"><span data-stu-id="79d2d-111">MSMQ uses paths and format names to identify a queue.</span></span> <span data-ttu-id="79d2d-112">Путь указывает имя узла и `QueueName`.</span><span class="sxs-lookup"><span data-stu-id="79d2d-112">Paths specify a host name and a `QueueName`.</span></span> <span data-ttu-id="79d2d-113">Также можно добавить `Private$` между именем узла и `QueueName`, чтобы указать частную очередь, не опубликованную в службе каталогов Active Directory.</span><span class="sxs-lookup"><span data-stu-id="79d2d-113">Optionally, there can be a `Private$` between the host name and the `QueueName` to indicate a private queue that is not published in the Active Directory directory service.</span></span>  
  
 <span data-ttu-id="79d2d-114">Пути сопоставляются с "Форматнамес" для определения дополнительных аспектов адреса, включая протокол маршрутизации и передачи диспетчера очереди.</span><span class="sxs-lookup"><span data-stu-id="79d2d-114">Path names are mapped to "FormatNames" to determine additional aspects of the address, including routing and queue manager transfer protocol.</span></span> <span data-ttu-id="79d2d-115">Диспетчер очередей поддерживает два протокола передачи данных: собственный протокол MSMQ и протокол SRMP.</span><span class="sxs-lookup"><span data-stu-id="79d2d-115">The Queue Manager supports two transfer protocols: native MSMQ protocol and SOAP Reliable Messaging Protocol (SRMP).</span></span>  
  
 <span data-ttu-id="79d2d-116">Дополнительные сведения о пути MSMQ и именах форматов см. в статье [об очередях сообщений](https://go.microsoft.com/fwlink/?LinkId=94837).</span><span class="sxs-lookup"><span data-stu-id="79d2d-116">For more information about MSMQ path and format names, see [About Message Queuing](https://go.microsoft.com/fwlink/?LinkId=94837).</span></span>  
  
## <a name="netmsmqbinding-and-service-addressing"></a><span data-ttu-id="79d2d-117">NetMsmqBinding и адресация к службе</span><span class="sxs-lookup"><span data-stu-id="79d2d-117">NetMsmqBinding and Service Addressing</span></span>  
 <span data-ttu-id="79d2d-118">При адресации сообщения службе выбирается схема из URI (в зависимости от транспорта, используемого для передачи данных).</span><span class="sxs-lookup"><span data-stu-id="79d2d-118">When addressing a message to a service, the scheme in the URI is chosen based on the transport used for communication.</span></span> <span data-ttu-id="79d2d-119">Каждый транспорт в WCF имеет уникальную схему.</span><span class="sxs-lookup"><span data-stu-id="79d2d-119">Each transport in WCF has a unique scheme.</span></span> <span data-ttu-id="79d2d-120">Схема должна отражать тип транспорта, используемого для передачи данных.</span><span class="sxs-lookup"><span data-stu-id="79d2d-120">The scheme must reflect the nature of transport used for communication.</span></span> <span data-ttu-id="79d2d-121">Например: net.tcp, net.pipe, HTTP и т. п.</span><span class="sxs-lookup"><span data-stu-id="79d2d-121">For example, net.tcp, net.pipe, HTTP, and so on.</span></span>  
  
 <span data-ttu-id="79d2d-122">Транспорт MSMQ в WCF предоставляет схему net. MSMQ.</span><span class="sxs-lookup"><span data-stu-id="79d2d-122">The MSMQ queued transport in WCF exposes a net.msmq scheme.</span></span> <span data-ttu-id="79d2d-123">Любое сообщение, адресованное с помощью схемы net.msmq, отправляется с помощью `NetMsmqBinding` через транспортный канал очередей MSMQ.</span><span class="sxs-lookup"><span data-stu-id="79d2d-123">Any message addressed using the net.msmq scheme is sent using the `NetMsmqBinding` over the MSMQ queued transport channel.</span></span>  
  
 <span data-ttu-id="79d2d-124">Адресация очереди в WCF основана на следующем шаблоне:</span><span class="sxs-lookup"><span data-stu-id="79d2d-124">The addressing of a queue in WCF is based on the following pattern:</span></span>  
  
 <span data-ttu-id="79d2d-125">NET. msmq://\<*имя узла*>/[частный/] \<*queue-Name*></span><span class="sxs-lookup"><span data-stu-id="79d2d-125">net.msmq: // \<*host-name*> / [private/] \<*queue-name*></span></span>  
  
 <span data-ttu-id="79d2d-126">Здесь:</span><span class="sxs-lookup"><span data-stu-id="79d2d-126">where:</span></span>  
  
- <span data-ttu-id="79d2d-127">\<*host-name*> — это имя компьютера, на котором размещена целевая очередь.</span><span class="sxs-lookup"><span data-stu-id="79d2d-127">\<*host-name*> is the name of the machine that hosts the Target Queue.</span></span>  
  
- <span data-ttu-id="79d2d-128">[private] - необязательный элемент.</span><span class="sxs-lookup"><span data-stu-id="79d2d-128">[private] is optional.</span></span> <span data-ttu-id="79d2d-129">Используется при адресации к целевой очереди, которая является частной.</span><span class="sxs-lookup"><span data-stu-id="79d2d-129">It is used when addressing a Target Queue that is a private queue.</span></span> <span data-ttu-id="79d2d-130">При адресации к общей очереди не допускается указывать «private».</span><span class="sxs-lookup"><span data-stu-id="79d2d-130">To address a public queue, you must not specify private.</span></span> <span data-ttu-id="79d2d-131">Обратите внимание, что, в отличие от путей MSMQ, в форме URI WCF отсутствует "$".</span><span class="sxs-lookup"><span data-stu-id="79d2d-131">Note that, unlike MSMQ paths, there is no "$" in the WCF URI form.</span></span>  
  
- <span data-ttu-id="79d2d-132">\<*Queue-name*> — это имя очереди.</span><span class="sxs-lookup"><span data-stu-id="79d2d-132">\<*queue-name*> is the name of the queue.</span></span> <span data-ttu-id="79d2d-133">Имя очереди также может относиться к вложенной очереди.</span><span class="sxs-lookup"><span data-stu-id="79d2d-133">The queue name can also refer to a subqueue.</span></span> <span data-ttu-id="79d2d-134">Таким словами, \<*Queue-name*> = \<*имя-очереди*> [; *вложенное имя очереди*].</span><span class="sxs-lookup"><span data-stu-id="79d2d-134">Thus, \<*queue-name*> = \<*name-of-queue*>[;*sub-queue-name*].</span></span>  
  
 <span data-ttu-id="79d2d-135">Пример 1. Для адресации к частной очереди PurchaseOrders, размещенной на компьютере abc.adatum.com, универсальный код ресурса (URI) будет таким: net.msmq://abc.adatum.com/private/PurchaseOrders.</span><span class="sxs-lookup"><span data-stu-id="79d2d-135">Example1: To address a private queue PurchaseOrders hosted on computer abc atadatum.com, the URI would be net.msmq://abc.adatum.com/private/PurchaseOrders.</span></span>  
  
 <span data-ttu-id="79d2d-136">Пример 2. Для адресации к общей очереди AccountsPayable, размещенной на компьютере def.adatum.com, универсальный код ресурса (URI) будет таким: net.msmq://def.adatum.com/AccountsPayable.</span><span class="sxs-lookup"><span data-stu-id="79d2d-136">Example2: To address a public queue AccountsPayable hosted on computer def atadatum.com, the URI would be net.msmq://def.adatum.com/AccountsPayable.</span></span>  
  
 <span data-ttu-id="79d2d-137">Адрес очереди используется прослушивателем как код URI прослушивания, из которого выполняется чтение сообщений.</span><span class="sxs-lookup"><span data-stu-id="79d2d-137">The queue address is used as the Listen URI by the Listener to read messages from.</span></span> <span data-ttu-id="79d2d-138">Другими словами, адрес очереди подобен порту прослушивания сокета TCP.</span><span class="sxs-lookup"><span data-stu-id="79d2d-138">In other words, the queue address is equivalent to the listen port of TCP socket.</span></span>  
  
 <span data-ttu-id="79d2d-139">Конечная точка, выполняющая чтение из очереди, должна указывать адрес очереди с помощью указанной выше схемы при открывании узла службы (ServiceHost).</span><span class="sxs-lookup"><span data-stu-id="79d2d-139">An endpoint that reads from a queue must specify the address of the queue using the same scheme specified previously when opening the ServiceHost.</span></span> <span data-ttu-id="79d2d-140">Примеры см. в разделе [Привязка к сети MSMQ](../../../../docs/framework/wcf/samples/net-msmq-binding.md).</span><span class="sxs-lookup"><span data-stu-id="79d2d-140">For examples, see [Net MSMQ Binding](../../../../docs/framework/wcf/samples/net-msmq-binding.md).</span></span>  
  
### <a name="multiple-contracts-in-a-queue"></a><span data-ttu-id="79d2d-141">Несколько контрактов в очереди</span><span class="sxs-lookup"><span data-stu-id="79d2d-141">Multiple Contracts in a Queue</span></span>  
 <span data-ttu-id="79d2d-142">Сообщения в очереди могут реализовывать различные контракты.</span><span class="sxs-lookup"><span data-stu-id="79d2d-142">Messages in a queue can implement different contracts.</span></span> <span data-ttu-id="79d2d-143">В данном случае для успешного чтения и обработки сообщений особенно важно, чтобы выполнялось одно из следующих требований:</span><span class="sxs-lookup"><span data-stu-id="79d2d-143">In this case, it is essential that one of the following is true to successfully read and process all messages:</span></span>  
  
- <span data-ttu-id="79d2d-144">Укажите конечную точку для службы, реализующей все контракты.</span><span class="sxs-lookup"><span data-stu-id="79d2d-144">Specify an endpoint for a service that implements all the contracts.</span></span> <span data-ttu-id="79d2d-145">Этот способ является рекомендуемым.</span><span class="sxs-lookup"><span data-stu-id="79d2d-145">This is the recommended approach.</span></span>  
  
- <span data-ttu-id="79d2d-146">Укажите несколько конечных точек с различными контрактами, но убедитесь, что во всех конечных точках используется один и тот же объект `NetMsmqBinding`.</span><span class="sxs-lookup"><span data-stu-id="79d2d-146">Specify multiple endpoints with different contracts, but ensure that all the endpoints use the same `NetMsmqBinding` object.</span></span> <span data-ttu-id="79d2d-147">Логика отправки сообщений в модели ServiceModel использует тот же цикл обработки сообщений, считывающий сообщения из транспортного канала для отправки, что в конечном итоге приводит к демультиплексированию сообщений на различные конечные точки на основе контракта.</span><span class="sxs-lookup"><span data-stu-id="79d2d-147">The dispatching logic in ServiceModel uses a message pump that reads messages out of the transport channel for dispatch, which eventually de-multiplexes messages based on the contract to different endpoints.</span></span> <span data-ttu-id="79d2d-148">Для пары «URI прослушивания/привязка» создается цикл обработки сообщений.</span><span class="sxs-lookup"><span data-stu-id="79d2d-148">A message pump is created for a listen URI/Binding pair.</span></span> <span data-ttu-id="79d2d-149">Адрес очереди используется прослушивателем в очереди как URI прослушивания.</span><span class="sxs-lookup"><span data-stu-id="79d2d-149">The queue address is used as the Listen URI by the queued listener.</span></span> <span data-ttu-id="79d2d-150">Использование одного объекта привязки всеми конечными точками обеспечивает использование одного цикла обработки сообщений для чтения сообщения и его демультиплексирования на соответствующие конечные точки на основе контракта.</span><span class="sxs-lookup"><span data-stu-id="79d2d-150">Having all the endpoints use the same binding object ensures that a single message pump is used to read the message and de-multiplex to relevant endpoints based on the contract.</span></span>  
  
### <a name="srmp-messaging"></a><span data-ttu-id="79d2d-151">Обмен сообщениями SRMP</span><span class="sxs-lookup"><span data-stu-id="79d2d-151">SRMP Messaging</span></span>  
 <span data-ttu-id="79d2d-152">Как указано выше, можно использовать протокол SRMP для передачи между очередями.</span><span class="sxs-lookup"><span data-stu-id="79d2d-152">As previously discussed, you can use the SRMP protocol for queue-to-queue transfers.</span></span> <span data-ttu-id="79d2d-153">Этот прием обычно используется, когда транспорт HTTP передает сообщения между очередью передачи и целевой очередью.</span><span class="sxs-lookup"><span data-stu-id="79d2d-153">This is commonly used when an HTTP transport transmits messages between the Transmission Queue and the Target Queue.</span></span>  
  
 <span data-ttu-id="79d2d-154">Чтобы воспользоваться протоколом SRMP, адресуйте сообщения с помощью схемы URI net.msmq, как указано выше, и укажите один из двух протоколов (SRMP или защищенный SRMP) в свойстве `QueueTransferProtocol` элемента `NetMsmqBinding`.</span><span class="sxs-lookup"><span data-stu-id="79d2d-154">To use the SRMP transfer protocol, address messages using the net.msmq URI scheme, as mentioned previously, and specify the choice of SRMP or Secured SRMP in the `QueueTransferProtocol` property of the `NetMsmqBinding`.</span></span>  
  
 <span data-ttu-id="79d2d-155">Указать свойство `QueueTransferProtocol` можно только при отправке.</span><span class="sxs-lookup"><span data-stu-id="79d2d-155">Specifying the `QueueTransferProtocol` property is a send-only feature.</span></span> <span data-ttu-id="79d2d-156">Оно указывает, какой именно протокол передачи между очередями используется клиентом.</span><span class="sxs-lookup"><span data-stu-id="79d2d-156">This is an indication by the client which kind of queue transfer protocol to use.</span></span>  
  
### <a name="using-active-directory"></a><span data-ttu-id="79d2d-157">Использование Active Directory</span><span class="sxs-lookup"><span data-stu-id="79d2d-157">Using Active Directory</span></span>  
 <span data-ttu-id="79d2d-158">В очереди сообщений MSMQ предусмотрена поддержка интеграции с Active Directory.</span><span class="sxs-lookup"><span data-stu-id="79d2d-158">MSMQ comes with support for Active Directory integration.</span></span> <span data-ttu-id="79d2d-159">Чтобы установить MSMQ с интеграцией с Active Directory, компьютер должен быть частью домена Windows.</span><span class="sxs-lookup"><span data-stu-id="79d2d-159">When MSMQ is installed with Active Directory integration, the machine must be part of a Windows domain.</span></span> <span data-ttu-id="79d2d-160">Active Directory используется для публикации очередей для обнаружения; Такие очереди называются *публичными очередями*.</span><span class="sxs-lookup"><span data-stu-id="79d2d-160">Active Directory is used to publish queues for discovery; such queues are called *public queues*.</span></span> <span data-ttu-id="79d2d-161">При адресации к очереди можно разрешить ее (т. е. узнать ее идентификатор) с помощью Active Directory.</span><span class="sxs-lookup"><span data-stu-id="79d2d-161">When addressing a queue, the queue can be resolved using Active Directory.</span></span> <span data-ttu-id="79d2d-162">Это похоже на разрешение IP-адреса сетевого имени с помощью службы доменных имен (DNS).</span><span class="sxs-lookup"><span data-stu-id="79d2d-162">This is similar to how Domain Name System (DNS) is used to resolve the IP address of a network name.</span></span> <span data-ttu-id="79d2d-163">Свойство `UseActiveDirectory` элемента `NetMsmqBinding` принадлежит к типу Boolean и указывает, должен ли канал в очереди использовать Active Directory для разрешения URI очереди.</span><span class="sxs-lookup"><span data-stu-id="79d2d-163">The `UseActiveDirectory` property in `NetMsmqBinding` is a Boolean that indicates whether the queued channel must use Active Directory to resolve the queue URI.</span></span> <span data-ttu-id="79d2d-164">По умолчанию для этого свойства установлено значение `false`.</span><span class="sxs-lookup"><span data-stu-id="79d2d-164">By default it is set to `false`.</span></span> <span data-ttu-id="79d2d-165">Если свойству `UseActiveDirectory` задано значение `true`, то канал в очереди преобразует URI вида net.msmq:// в имя формата с помощью Active Directory.</span><span class="sxs-lookup"><span data-stu-id="79d2d-165">If the `UseActiveDirectory` property is set to `true`, then the queued channel uses Active Directory to convert the net.msmq:// URI to format name.</span></span>  
  
 <span data-ttu-id="79d2d-166">Свойство `UseActiveDirectory` имеет значение только для клиента, отправляющего сообщение, поскольку оно используется для разрешения адреса очереди при отправке сообщений.</span><span class="sxs-lookup"><span data-stu-id="79d2d-166">The `UseActiveDirectory` property is meaningful only for the client that is sending the message because it is used to resolve the address of the queue when sending messages.</span></span>  
  
### <a name="mapping-netmsmq-uri-to-message-queuing-format-names"></a><span data-ttu-id="79d2d-167">Сопоставление URI net.msmq именам форматов MSMQ</span><span class="sxs-lookup"><span data-stu-id="79d2d-167">Mapping net.msmq URI to Message Queuing Format Names</span></span>  
 <span data-ttu-id="79d2d-168">Канал в очереди обрабатывает сопоставление предоставленного ему имени URI net.msmq именам форматов MSMQ.</span><span class="sxs-lookup"><span data-stu-id="79d2d-168">The queued channel handles mapping the net.msmq URI name provided to the channel to MSMQ format names.</span></span> <span data-ttu-id="79d2d-169">В следующей таблице приведены общие правила их сопоставления.</span><span class="sxs-lookup"><span data-stu-id="79d2d-169">The following table summarizes the rules used to map between them.</span></span>  
  
|<span data-ttu-id="79d2d-170">Адрес очереди WCF, основанный на URI</span><span class="sxs-lookup"><span data-stu-id="79d2d-170">WCF URI-based queue address</span></span>|<span data-ttu-id="79d2d-171">Используется свойство Active Directory</span><span class="sxs-lookup"><span data-stu-id="79d2d-171">Use Active Directory property</span></span>|<span data-ttu-id="79d2d-172">Свойство протокола передачи между очередями</span><span class="sxs-lookup"><span data-stu-id="79d2d-172">Queue Transfer Protocol property</span></span>|<span data-ttu-id="79d2d-173">Результирующие имена форматов MSMQ</span><span class="sxs-lookup"><span data-stu-id="79d2d-173">Resulting MSMQ format names</span></span>|  
|----------------------------------|-----------------------------------|--------------------------------------|---------------------------------|  
|<span data-ttu-id="79d2d-174">NET. msmq://\<Machine-Name >/привате/АБК</span><span class="sxs-lookup"><span data-stu-id="79d2d-174">Net.msmq://\<machine-name>/private/abc</span></span>|<span data-ttu-id="79d2d-175">False (по умолчанию)</span><span class="sxs-lookup"><span data-stu-id="79d2d-175">False (default)</span></span>|<span data-ttu-id="79d2d-176">Native (по умолчанию)</span><span class="sxs-lookup"><span data-stu-id="79d2d-176">Native (default)</span></span>|<span data-ttu-id="79d2d-177">DIRECT=OS:имя_компьютера\private$\abc</span><span class="sxs-lookup"><span data-stu-id="79d2d-177">DIRECT=OS:machine-name\private$\abc</span></span>|  
|<span data-ttu-id="79d2d-178">NET. msmq://\<Machine-Name >/привате/АБК</span><span class="sxs-lookup"><span data-stu-id="79d2d-178">Net.msmq://\<machine-name>/private/abc</span></span>|<span data-ttu-id="79d2d-179">False</span><span class="sxs-lookup"><span data-stu-id="79d2d-179">False</span></span>|<span data-ttu-id="79d2d-180">SRMP</span><span class="sxs-lookup"><span data-stu-id="79d2d-180">SRMP</span></span>|<span data-ttu-id="79d2d-181">DIRECT =http://machine/msmq/private $/АБК</span><span class="sxs-lookup"><span data-stu-id="79d2d-181">DIRECT=http://machine/msmq/private$/abc</span></span>|  
|<span data-ttu-id="79d2d-182">NET. msmq://\<Machine-Name >/привате/АБК</span><span class="sxs-lookup"><span data-stu-id="79d2d-182">Net.msmq://\<machine-name>/private/abc</span></span>|<span data-ttu-id="79d2d-183">Да</span><span class="sxs-lookup"><span data-stu-id="79d2d-183">True</span></span>|<span data-ttu-id="79d2d-184">машинный код;</span><span class="sxs-lookup"><span data-stu-id="79d2d-184">Native</span></span>|<span data-ttu-id="79d2d-185">PUBLIC=guid (идентификатор GUID очереди)</span><span class="sxs-lookup"><span data-stu-id="79d2d-185">PUBLIC=some-guid (the GUID of the queue)</span></span>|  
  
### <a name="reading-messages-from-the-dead-letter-queue-or-the-poison-message-queue"></a><span data-ttu-id="79d2d-186">Чтение сообщений из очереди недоставленных сообщений или из очереди подозрительных сообщений</span><span class="sxs-lookup"><span data-stu-id="79d2d-186">Reading Messages from the Dead-Letter Queue or the Poison-Message Queue</span></span>  
 <span data-ttu-id="79d2d-187">Для чтения сообщений из очереди подозрительных сообщений, являющейся вложенной очередью целевой очереди, откройте `ServiceHost`, указав адрес вложенной очереди.</span><span class="sxs-lookup"><span data-stu-id="79d2d-187">To read messages from a poison-message queue that is a subqueue of the target queue, open the `ServiceHost` with the address of the subqueue.</span></span>  
  
 <span data-ttu-id="79d2d-188">Пример. Служба, считывающая из очереди подозрительных сообщений частной очереди PurchaseOrders с локального компьютера обращается по адресу net.msmq://localhost/private/PurchaseOrders;poison.</span><span class="sxs-lookup"><span data-stu-id="79d2d-188">Example: A service that reads from the poison-message queue of the PurchaseOrders private queue from the local machine would address net.msmq://localhost/private/PurchaseOrders;poison.</span></span>  
  
 <span data-ttu-id="79d2d-189">Для чтения сообщений из системной очереди недоставленных транзакционных сообщений код URI должен иметь следующий вид: net.msmq://localhost/system$;DeadXact.</span><span class="sxs-lookup"><span data-stu-id="79d2d-189">To read messages from a system transactional dead-letter queue, the URI must be of the form: net.msmq://localhost/system$;DeadXact.</span></span>  
  
 <span data-ttu-id="79d2d-190">Для чтения сообщений из системной очереди недоставленных нетранзакционных сообщений код URI должен иметь следующий вид: net.msmq://localhost/system$;DeadLetter.</span><span class="sxs-lookup"><span data-stu-id="79d2d-190">To read messages from a system nontransactional dead-letter queue, the URI must be of the form: net.msmq://localhost/system$;DeadLetter.</span></span>  
  
 <span data-ttu-id="79d2d-191">При использовании пользовательской очереди недоставленных сообщений обратите внимание, что эта очередь должна находиться на локальном компьютере.</span><span class="sxs-lookup"><span data-stu-id="79d2d-191">When using a custom dead-letter queue, note that the dead-letter queue must reside on the local computer.</span></span> <span data-ttu-id="79d2d-192">Таким образом, код URI очереди недоставленных сообщений быть только таким:</span><span class="sxs-lookup"><span data-stu-id="79d2d-192">As such, the URI for the dead-letter queue is restricted to the form:</span></span>  
  
 <span data-ttu-id="79d2d-193">NET. msmq://ЛОКАЛХОСТ/[Private/] \<*пользовательской недоставленной > Queue-Name*.</span><span class="sxs-lookup"><span data-stu-id="79d2d-193">net.msmq: //localhost/ [private/]  \<*custom-dead-letter-queue-name*>.</span></span>  
  
 <span data-ttu-id="79d2d-194">Служба WCF проверяет, что все получаемые сообщения были адресованы в конкретную очередь, в которой она прослушивается.</span><span class="sxs-lookup"><span data-stu-id="79d2d-194">A WCF service verifies that all messages it receives were addressed to the particular queue it is listening on.</span></span> <span data-ttu-id="79d2d-195">Если очередь назначения сообщения не соответствует очереди, в которой оно содержится, служба не обрабатывает сообщение.</span><span class="sxs-lookup"><span data-stu-id="79d2d-195">If the message’s destination queue does not match the queue it is found in, the service does not process the message.</span></span> <span data-ttu-id="79d2d-196">Если служба прослушивает очередь недоставленных сообщений, эту проблему необходимо решить обязательно, поскольку сообщения в такой очереди всегда адресованы в другое расположение.</span><span class="sxs-lookup"><span data-stu-id="79d2d-196">This is an issue that services listening to a dead-letter queue must address because any message in the dead-letter queue was meant to be delivered elsewhere.</span></span> <span data-ttu-id="79d2d-197">Для чтения сообщений из очереди недоставленных или подозрительных сообщений необходимо использовать `ServiceBehavior` и параметр <xref:System.ServiceModel.AddressFilterMode.Any>.</span><span class="sxs-lookup"><span data-stu-id="79d2d-197">To read messages from a dead-letter queue, or from a poison queue, a `ServiceBehavior` with the <xref:System.ServiceModel.AddressFilterMode.Any> parameter must be used.</span></span> <span data-ttu-id="79d2d-198">Пример см. в разделе [очереди недоставленных сообщений](../../../../docs/framework/wcf/samples/dead-letter-queues.md).</span><span class="sxs-lookup"><span data-stu-id="79d2d-198">For an example, see [Dead Letter Queues](../../../../docs/framework/wcf/samples/dead-letter-queues.md).</span></span>  
  
## <a name="msmqintegrationbinding-and-service-addressing"></a><span data-ttu-id="79d2d-199">MsmqIntegrationBinding и адресация к службе</span><span class="sxs-lookup"><span data-stu-id="79d2d-199">MsmqIntegrationBinding and Service Addressing</span></span>  
 <span data-ttu-id="79d2d-200">`MsmqIntegrationBinding` используется для обмена информацией с традиционными приложениями MSMQ.</span><span class="sxs-lookup"><span data-stu-id="79d2d-200">The `MsmqIntegrationBinding` is used for communication with traditional MSMQ applications.</span></span> <span data-ttu-id="79d2d-201">Чтобы упростить взаимодействие с существующим приложением MSMQ, WCF поддерживает только адресацию имени формата.</span><span class="sxs-lookup"><span data-stu-id="79d2d-201">To ease interoperation with an existing MSMQ application, WCF supports only format name addressing.</span></span> <span data-ttu-id="79d2d-202">Таким образом, сообщения, отправленные с помощью этой привязки, должны соответствовать следующей схеме URI:</span><span class="sxs-lookup"><span data-stu-id="79d2d-202">Thus, messages sent using this binding must conform to the URI scheme:</span></span>  
  
 <span data-ttu-id="79d2d-203">msmq.formatname:\<*MSMQ-format-name*>></span><span class="sxs-lookup"><span data-stu-id="79d2d-203">msmq.formatname:\<*MSMQ-format-name*>></span></span>  
  
 <span data-ttu-id="79d2d-204">Имя MSMQ-format-name указывается в формате MSMQ в статье [об очереди сообщений](https://go.microsoft.com/fwlink/?LinkId=94837).</span><span class="sxs-lookup"><span data-stu-id="79d2d-204">The MSMQ-format-name is of the form specified by MSMQ in [About Message Queuing](https://go.microsoft.com/fwlink/?LinkId=94837).</span></span>  
  
 <span data-ttu-id="79d2d-205">Обратите внимание, что можно использовать только прямые имена форматов, а также открытые и закрытые имена форматов (требуется интеграция Active Directory) при получении сообщений из очереди с помощью `MsmqIntegrationBinding`.</span><span class="sxs-lookup"><span data-stu-id="79d2d-205">Note that you can only use direct format names, and public and private format names (requires Active Directory integration) when receiving messages from a queue using `MsmqIntegrationBinding`.</span></span> <span data-ttu-id="79d2d-206">Впрочем, рекомендуется использовать прямые имена форматов.</span><span class="sxs-lookup"><span data-stu-id="79d2d-206">However, it is advised that you use direct format names.</span></span> <span data-ttu-id="79d2d-207">Например, в Windows Vista использование любого другого имени формата вызывает ошибку, так как система пытается открыть подочередь, которую можно открыть только с помощью прямого имени формата.</span><span class="sxs-lookup"><span data-stu-id="79d2d-207">For example, on Windows Vista, using any other format name causes an error because the system attempts to open a subqueue, which can only be opened with direct format names.</span></span>  
  
 <span data-ttu-id="79d2d-208">При адресации к SRMP с помощью `MsmqIntegrationBinding` не требуется добавлять /msmq/ к прямому имени формата для отправки с помощью служб IIS.</span><span class="sxs-lookup"><span data-stu-id="79d2d-208">When addressing SRMP using `MsmqIntegrationBinding`, there is no requirement to add /msmq/ in the direct format name to help Internet Information Services (IIS) with dispatching.</span></span> <span data-ttu-id="79d2d-209">Например: при обращении к очереди ABC с помощью протокола SRMP вместо DIRECT =http://adatum.com/msmq/private $/АБК следует использовать DIRECT =http://adatum.com/private $/АБК.</span><span class="sxs-lookup"><span data-stu-id="79d2d-209">For example: When addressing a queue abc using the SRMP protocol, instead of DIRECT=http://adatum.com/msmq/private$/abc, you should use DIRECT=http://adatum.com/private$/abc.</span></span>  
  
 <span data-ttu-id="79d2d-210">Обратите внимание, что нельзя использовать адресацию net.msmq:// вместе с `MsmqIntegrationBinding`.</span><span class="sxs-lookup"><span data-stu-id="79d2d-210">Note that you cannot use net.msmq:// addressing with `MsmqIntegrationBinding`.</span></span> <span data-ttu-id="79d2d-211">Так как `MsmqIntegrationBinding` поддерживает адресацию имен в формате MSMQ в свободной форме, можно использовать службу WCF, которая использует эту привязку для использования функций многоадресной рассылки и списков рассылки в MSMQ.</span><span class="sxs-lookup"><span data-stu-id="79d2d-211">Because `MsmqIntegrationBinding` supports free-form MSMQ format name addressing, you can use a WCF service that uses this binding to use multicast and distribution list features in MSMQ.</span></span> <span data-ttu-id="79d2d-212">Единственное исключение: необходимо указать `CustomDeadLetterQueue` при использовании `MsmqIntegrationBinding`.</span><span class="sxs-lookup"><span data-stu-id="79d2d-212">One exception is specifying `CustomDeadLetterQueue` when using the `MsmqIntegrationBinding`.</span></span> <span data-ttu-id="79d2d-213">Требуемая форма: net.msmq://, как и при указании с помощью `NetMsmqBinding`.</span><span class="sxs-lookup"><span data-stu-id="79d2d-213">It must be of the form net.msmq://, similar to how it is specified using the `NetMsmqBinding`.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="79d2d-214">См. также:</span><span class="sxs-lookup"><span data-stu-id="79d2d-214">See also</span></span>

- [<span data-ttu-id="79d2d-215">Размещение веб-узлов в приложении, использующем очереди</span><span class="sxs-lookup"><span data-stu-id="79d2d-215">Web Hosting a Queued Application</span></span>](../../../../docs/framework/wcf/feature-details/web-hosting-a-queued-application.md)
