---
title: Размещение в приложении службы Windows
ms.date: 03/30/2017
ms.assetid: f4199998-27f3-4dd9-aee4-0a4addfa9f24
ms.openlocfilehash: a07aade4619b644dadd1d5acdcb5252b305b94d0
ms.sourcegitcommit: c01c18755bb7b0f82c7232314ccf7955ea7834db
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/15/2020
ms.locfileid: "75964489"
---
# <a name="hosting-in-a-windows-service-application"></a>Размещение в приложении службы Windows
Службы Windows (ранее называвшиеся службами Windows NT) обеспечивают модель процессов, особенно подходящую для приложений, которые должны существовать в длительно исполняемом файле и не отображают никакой формы пользовательского интерфейса. Временем существования процессов приложений служб Windows управляет диспетчер служб, который позволяет запускать, останавливать и приостанавливать приложения служб Windows. Можно настроить автоматический запуск процесса службы Windows при запуске компьютера, сделав его подходящей средой размещения для приложений Always on. Дополнительные сведения о приложениях служб Windows см. в разделе [приложения службы Windows](https://go.microsoft.com/fwlink/?LinkId=89450).  
  
 Приложения, на которых размещаются длительные службы Windows Communication Foundation (WCF), совместно используют многие характеристики со службами Windows. В частности, службы WCF — это длительно выполняемые серверные исполняемые файлы, которые не взаимодействуют напрямую с пользователем и поэтому не реализуют какой-либо формы пользовательского интерфейса. Таким образом, размещение служб WCF внутри приложения службы Windows — один вариант для создания надежных, долгосрочных приложений WCF.  
  
 Часто разработчики WCF должны решить, следует ли размещать свое приложение WCF в приложении службы Windows или в среде размещения служб службы IIS (IIS) или службы активации Windows (WAS). Рассмотреть возможность использования приложений служб Windows необходимо в следующих случаях.  
  
- Приложение требует явной активации. Например, службы Windows следует использовать, когда приложение должно запускаться автоматически при запуске сервера, а не динамически при поступлении первого входящего сообщения.  
  
- Процесс, в котором размещается приложение, после запуска должен оставаться работающим. После запуска процесс службы Windows остается работающим, если явно не завершается администратором сервера с помощью диспетчера служб. Приложения, размещенные в IIS или службе активации Windows, могут запускаться и останавливаться динамически для обеспечения оптимального использования системных ресурсов. Приложения, для которых требуется явное управление в течение времени существования их процесса размещения, должны использовать службы Windows, а не IIS или службу активации Windows.  
  
- Служба WCF должна работать на Windows Server 2003 и использовать транспорты, отличные от HTTP. В Windows Server 2003 среда размещения IIS 6,0 ограничена только связью по протоколу HTTP. Это ограничение не распространяется на приложения служб Windows и может использовать любой поддерживаемый транспортный протокол WCF, включая NET. TCP, net. pipe и net. MSMQ.  
  
### <a name="to-host-wcf-inside-of-a-windows-service-application"></a>Размещение WCF в приложении службы Windows  
  
1. Создайте приложение службы Windows. Приложения служб Windows можно создавать в управляемом коде, используя классы в пространстве имен <xref:System.ServiceProcess>. Это приложение должно включать один класс, наследуемый от <xref:System.ServiceProcess.ServiceBase>.  
  
2. Свяжите время существования служб WCF со временем существования приложения службы Windows. Как правило, службы WCF, размещенные в приложении службы Windows, становятся активными при запуске службы размещения, прекращают прослушивание сообщений при остановке службы размещения и завершают процесс размещения, когда служба WCF обнаруживает ошибку. Это можно обеспечить, выполнив следующие действия.  
  
    - Переопределите <xref:System.ServiceProcess.ServiceBase.OnStart%28System.String%5B%5D%29>, чтобы открыть один или несколько экземпляров <xref:System.ServiceModel.ServiceHost>. Одно приложение службы Windows может размещать несколько служб WCF, запускаемых и останавливаемых в качестве группы.  
  
    - Переопределите <xref:System.ServiceProcess.ServiceBase.OnStop%2A>, чтобы вызвать <xref:System.ServiceModel.Channels.CommunicationObject.Closed> в <xref:System.ServiceModel.ServiceHost> любых запущенных службах WCF, которые были запущены во время <xref:System.ServiceProcess.ServiceBase.OnStart%28System.String%5B%5D%29>.  
  
    - Подпишитесь на событие <xref:System.ServiceModel.Channels.CommunicationObject.Faulted> приложения <xref:System.ServiceModel.ServiceHost> и используйте класс <xref:System.ServiceProcess.ServiceController>, чтобы завершить работу приложения службы Windows в случае ошибки.  
  
     Приложения служб Windows, в которых размещаются службы WCF, развертываются и управляются так же, как приложения служб Windows, которые не используют WCF.  
  
## <a name="see-also"></a>См. также:

- <xref:System.ServiceProcess>
- [Пошаговое руководство. Создание приложения служб Windows в конструкторе компонентов](https://go.microsoft.com/fwlink/?LinkId=94875)
- [Практическое руководство. Размещение службы WCF в управляемой службе Windows](../../../../docs/framework/wcf/feature-details/how-to-host-a-wcf-service-in-a-managed-windows-service.md)
- [Узел службы Windows](../../../../docs/framework/wcf/samples/windows-service-host.md)
- [Программная архитектура приложений служб](https://go.microsoft.com/fwlink/?LinkId=94876)
- [Функции размещения Windows Server App Fabric](https://docs.microsoft.com/previous-versions/appfabric/ee677189(v=azure.10))
