---
title: Действия обмена сообщениями
ms.date: 03/30/2017
ms.assetid: 8498f215-1823-4aba-a6e1-391407f8c273
ms.openlocfilehash: 1e65a3ead9df4103fb270911e3bbb2cc03fcfcba
ms.sourcegitcommit: 30a558d23e3ac5a52071121a52c305c85fe15726
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/25/2019
ms.locfileid: "75347576"
---
# <a name="messaging-activities"></a><span data-ttu-id="aacbb-102">Действия обмена сообщениями</span><span class="sxs-lookup"><span data-stu-id="aacbb-102">Messaging activities</span></span>

<span data-ttu-id="aacbb-103">Действия обмена сообщениями позволяют рабочим процессам отправлять или получать сообщения WCF.</span><span class="sxs-lookup"><span data-stu-id="aacbb-103">Messaging activities allow workflows to send and receive WCF messages.</span></span> <span data-ttu-id="aacbb-104">Добавляя действия обмена сообщениями в рабочий процесс, можно моделировать шаблоны обмена сообщениями любого уровня сложности.</span><span class="sxs-lookup"><span data-stu-id="aacbb-104">By adding messaging activities to a workflow you can model any arbitrarily complex message exchange patterns (MEP).</span></span>

## <a name="message-exchange-patterns"></a><span data-ttu-id="aacbb-105">Шаблоны обмена сообщениями</span><span class="sxs-lookup"><span data-stu-id="aacbb-105">Message exchange patterns</span></span>

<span data-ttu-id="aacbb-106">Существует три основных шаблона обмена сообщениями.</span><span class="sxs-lookup"><span data-stu-id="aacbb-106">There are three basic message exchange patterns:</span></span>

- <span data-ttu-id="aacbb-107">**Датаграмма** . при использовании датаграммы MEP клиент отправляет службе сообщение, но служба не отвечает.</span><span class="sxs-lookup"><span data-stu-id="aacbb-107">**Datagram** - When using the datagram MEP the client sends a message to the service, but the service does not respond.</span></span> <span data-ttu-id="aacbb-108">Такой метод иногда называют «отправить и забыть».</span><span class="sxs-lookup"><span data-stu-id="aacbb-108">This is sometimes called "fire and forget".</span></span> <span data-ttu-id="aacbb-109">В этом случае требуется внешнее подтверждение успешной доставки.</span><span class="sxs-lookup"><span data-stu-id="aacbb-109">A fire and forget exchange is one that requires out-of-band confirmation of successful delivery.</span></span> <span data-ttu-id="aacbb-110">Сообщение может быть потеряно при передаче и может не достичь службы.</span><span class="sxs-lookup"><span data-stu-id="aacbb-110">The message might be lost in transit and never reach the service.</span></span> <span data-ttu-id="aacbb-111">Если клиент успешно отправил сообщение, это не гарантирует, что удаленная служба получила его.</span><span class="sxs-lookup"><span data-stu-id="aacbb-111">If the client successfully sends a message, it does not guarantee that the service has received the message.</span></span> <span data-ttu-id="aacbb-112">Датаграмма - это фундаментальный элемент обмена сообщениями, на основе которого можно строить собственные шаблоны обмена сообщениями.</span><span class="sxs-lookup"><span data-stu-id="aacbb-112">The datagram is a fundamental building block for messaging, as you can build your own MEPs on top of it.</span></span>

- <span data-ttu-id="aacbb-113">**Запрос-ответ** . при использовании запроса-Response MEP клиент отправляет сообщение в службу, служба выполняет необходимую обработку, а затем отправляет ответ обратно клиенту.</span><span class="sxs-lookup"><span data-stu-id="aacbb-113">**Request-Response** - When using the request-response MEP the client sends a message to the service, the service does the required processing, and then sends a response back to the client.</span></span> <span data-ttu-id="aacbb-114">Шаблон состоит из пар «запрос-ответ».</span><span class="sxs-lookup"><span data-stu-id="aacbb-114">The pattern consists of request-response pairs.</span></span> <span data-ttu-id="aacbb-115">Примерами вызовов "запрос-ответ" являются удаленные вызовы процедур (RPC) и запросы GET браузера.</span><span class="sxs-lookup"><span data-stu-id="aacbb-115">Examples of request-response calls are remote procedure calls (RPC) and browser GET requests.</span></span> <span data-ttu-id="aacbb-116">Этот шаблон также называют полудуплексным.</span><span class="sxs-lookup"><span data-stu-id="aacbb-116">This pattern is also known as half-duplex.</span></span>

- <span data-ttu-id="aacbb-117">**Дуплекс** — при использовании дуплексного MEP клиент и служба могут передавать сообщения друг другу в любом порядке.</span><span class="sxs-lookup"><span data-stu-id="aacbb-117">**Duplex** - When using the duplex MEP the client and service can send messages to each other in any order.</span></span> <span data-ttu-id="aacbb-118">Применение дуплексного шаблона похоже на разговор по телефону, когда каждое произносимое слово является сообщением.</span><span class="sxs-lookup"><span data-stu-id="aacbb-118">The duplex MEP is like a phone conversation, where each word being spoken is a message.</span></span>

<span data-ttu-id="aacbb-119">Действия обмена сообщениями позволяют реализовать любой из этих базовых шаблонов обмена сообщениями, а также любые другие шаблоны обмена сообщениями любого уровня сложности.</span><span class="sxs-lookup"><span data-stu-id="aacbb-119">The messaging activities allow you to implement any of these basic MEPs as well as any arbitrarily complex MEP.</span></span>

## <a name="messaging-activities"></a><span data-ttu-id="aacbb-120">Действия обмена сообщениями</span><span class="sxs-lookup"><span data-stu-id="aacbb-120">Messaging activities</span></span>

<span data-ttu-id="aacbb-121">Платформа [!INCLUDE[netfx_current_long](../../../../includes/netfx-current-long-md.md)] определяет следующие действия обмена сообщениями.</span><span class="sxs-lookup"><span data-stu-id="aacbb-121">The [!INCLUDE[netfx_current_long](../../../../includes/netfx-current-long-md.md)] defines the following messaging activities:</span></span>

- <span data-ttu-id="aacbb-122"><xref:System.ServiceModel.Activities.Send> — следует использовать <xref:System.ServiceModel.Activities.Send> для отправки сообщения.</span><span class="sxs-lookup"><span data-stu-id="aacbb-122"><xref:System.ServiceModel.Activities.Send>- Use the <xref:System.ServiceModel.Activities.Send> activity to send a message.</span></span>

- <span data-ttu-id="aacbb-123"><xref:System.ServiceModel.Activities.SendReply> — следует использовать действие <xref:System.ServiceModel.Activities.SendReply>для отправки ответа на полученное сообщение.</span><span class="sxs-lookup"><span data-stu-id="aacbb-123"><xref:System.ServiceModel.Activities.SendReply> - Use the <xref:System.ServiceModel.Activities.SendReply> activity to send a response to a received message.</span></span> <span data-ttu-id="aacbb-124">Это действие используется службами рабочего процесса при реализации шаблона обмена сообщениями «запрос-ответ».</span><span class="sxs-lookup"><span data-stu-id="aacbb-124">This activity is used by workflow services when implementing a request/reply MEP.</span></span>

- <span data-ttu-id="aacbb-125"><xref:System.ServiceModel.Activities.Receive> — следует использовать действие <xref:System.ServiceModel.Activities.Receive> для получения сообщения.</span><span class="sxs-lookup"><span data-stu-id="aacbb-125"><xref:System.ServiceModel.Activities.Receive>- Use the <xref:System.ServiceModel.Activities.Receive> activity to receive a message.</span></span>

- <span data-ttu-id="aacbb-126"><xref:System.ServiceModel.Activities.ReceiveReply> — следует использовать действие <xref:System.ServiceModel.Activities.ReceiveReply> для получения ответного сообщения.</span><span class="sxs-lookup"><span data-stu-id="aacbb-126"><xref:System.ServiceModel.Activities.ReceiveReply> - Use the <xref:System.ServiceModel.Activities.ReceiveReply> activity to receive a reply message.</span></span> <span data-ttu-id="aacbb-127">Это действие используется клиентами службы рабочего процесса при реализации шаблона обмена сообщениями «запрос-ответ».</span><span class="sxs-lookup"><span data-stu-id="aacbb-127">This activity is used by workflow service clients when implementing a request/reply MEP.</span></span>

## <a name="messaging-activities-and-message-exchange-patterns"></a><span data-ttu-id="aacbb-128">Действия обмена сообщениями и шаблоны обмена сообщениями</span><span class="sxs-lookup"><span data-stu-id="aacbb-128">Messaging activities and message exchange patterns</span></span>

<span data-ttu-id="aacbb-129">В шаблоне обмена сообщениями «датаграмма» участвуют клиент, отправляющий сообщение, и служба, получающая его.</span><span class="sxs-lookup"><span data-stu-id="aacbb-129">A datagram MEP involves a client sending a message and a service receiving the message.</span></span> <span data-ttu-id="aacbb-130">Если клиент - это рабочий процесс, то следует использовать действие <xref:System.ServiceModel.Activities.Send> для отправки сообщения.</span><span class="sxs-lookup"><span data-stu-id="aacbb-130">If the client is a workflow use a <xref:System.ServiceModel.Activities.Send> activity to send the message.</span></span> <span data-ttu-id="aacbb-131">Для получения этого сообщения в рабочем процессе следует использовать действие <xref:System.ServiceModel.Activities.Receive>.</span><span class="sxs-lookup"><span data-stu-id="aacbb-131">To receive that message in a workflow, use a <xref:System.ServiceModel.Activities.Receive> activity.</span></span> <span data-ttu-id="aacbb-132">Действия <xref:System.ServiceModel.Activities.Send> и <xref:System.ServiceModel.Activities.Receive> имеют свойство с именем `Content`.</span><span class="sxs-lookup"><span data-stu-id="aacbb-132">The <xref:System.ServiceModel.Activities.Send> and <xref:System.ServiceModel.Activities.Receive> activities each have a property named `Content`.</span></span> <span data-ttu-id="aacbb-133">Это свойство содержит отправляемые или получаемые данные.</span><span class="sxs-lookup"><span data-stu-id="aacbb-133">This property contains the data being sent or received.</span></span> <span data-ttu-id="aacbb-134">При реализации шаблона обмена сообщениями «запрос-ответ» клиент и службы используют пары действий.</span><span class="sxs-lookup"><span data-stu-id="aacbb-134">When implementing the request-response MEP both the client and the service use pairs of activities.</span></span> <span data-ttu-id="aacbb-135">Клиент использует действие <xref:System.ServiceModel.Activities.Send> для отправки сообщения и действие <xref:System.ServiceModel.Activities.ReceiveReply> для получения ответа от службы.</span><span class="sxs-lookup"><span data-stu-id="aacbb-135">The client uses a <xref:System.ServiceModel.Activities.Send> activity to send the message and a <xref:System.ServiceModel.Activities.ReceiveReply> activity to receive the response from the service.</span></span> <span data-ttu-id="aacbb-136">Эти два действия связаны друг с другом свойством <xref:System.ServiceModel.Activities.ReceiveReply.Request%2A>.</span><span class="sxs-lookup"><span data-stu-id="aacbb-136">These two activities are associated with each other by the <xref:System.ServiceModel.Activities.ReceiveReply.Request%2A> property.</span></span> <span data-ttu-id="aacbb-137">Значение этого свойства - действие <xref:System.ServiceModel.Activities.Send>, отправившее исходное сообщение.</span><span class="sxs-lookup"><span data-stu-id="aacbb-137">This property is set to the <xref:System.ServiceModel.Activities.Send> activity that sent the original message.</span></span> <span data-ttu-id="aacbb-138">Служба также использует пару связанных действий: <xref:System.ServiceModel.Activities.Receive> и <xref:System.ServiceModel.Activities.SendReply>.</span><span class="sxs-lookup"><span data-stu-id="aacbb-138">The service also uses a pair of associated activities: <xref:System.ServiceModel.Activities.Receive> and <xref:System.ServiceModel.Activities.SendReply>.</span></span> <span data-ttu-id="aacbb-139">Эти два действия связаны свойством <xref:System.ServiceModel.Activities.SendReply.Request%2A>.</span><span class="sxs-lookup"><span data-stu-id="aacbb-139">These two activities are associated by the <xref:System.ServiceModel.Activities.SendReply.Request%2A> property.</span></span> <span data-ttu-id="aacbb-140">Значение этого свойства - действие <xref:System.ServiceModel.Activities.Receive>, получившее исходное сообщение.</span><span class="sxs-lookup"><span data-stu-id="aacbb-140">This property is set to the <xref:System.ServiceModel.Activities.Receive> activity that received the original message.</span></span> <span data-ttu-id="aacbb-141">Действия <xref:System.ServiceModel.Activities.ReceiveReply> и <xref:System.ServiceModel.Activities.SendReply>, как и действия <xref:System.ServiceModel.Activities.Send> и <xref:System.ServiceModel.Activities.Receive>, позволяют отправить экземпляр <xref:System.ServiceModel.Channels.Message> или тип контракта сообщения.</span><span class="sxs-lookup"><span data-stu-id="aacbb-141">The <xref:System.ServiceModel.Activities.ReceiveReply> and <xref:System.ServiceModel.Activities.SendReply> activities, like <xref:System.ServiceModel.Activities.Send> and <xref:System.ServiceModel.Activities.Receive> allow you to send a <xref:System.ServiceModel.Channels.Message> instance or a message contract type.</span></span>

<span data-ttu-id="aacbb-142">Поскольку рабочие процессы выполняются в течении долгого времени, очень важно, чтобы шаблон обмена сообщениями «дуплекс» также поддерживал долговременные диалоги.</span><span class="sxs-lookup"><span data-stu-id="aacbb-142">Because of the long-running nature of workflows, it is important for the duplex pattern of communication to also support long-running conversations.</span></span> <span data-ttu-id="aacbb-143">Для поддержки долговременных диалогов клиенты, инициирующие диалоги, должны предоставлять службу с возможностью ее повторного вызова позднее, когда данные станут доступны.</span><span class="sxs-lookup"><span data-stu-id="aacbb-143">To support long-running conversations, clients who initiate the conversation must provide the service with an opportunity to call it back at a later time when the data becomes available.</span></span> <span data-ttu-id="aacbb-144">Например, заказ на покупку подается на одобрение менеджера, но он может быть обработан спустя день, неделю или даже год; рабочий процесс, управляющий заказом на покупку должен иметь возможность продолжить работу с ним после получения одобрения.</span><span class="sxs-lookup"><span data-stu-id="aacbb-144">For example, a purchase order request is submitted for manager approval, but it might not be processed for a day, a week, or even a year; the workflow that manages the purchase order approval must know to resume after the approval is given.</span></span> <span data-ttu-id="aacbb-145">Шаблон обмена сообщениями «дуплекс» поддерживается в рабочих процессах, использующих корреляцию.</span><span class="sxs-lookup"><span data-stu-id="aacbb-145">This pattern of duplex communication is supported in workflows using correlation.</span></span> <span data-ttu-id="aacbb-146">Для реализации шаблона «дуплекс» следует использовать действия <xref:System.ServiceModel.Activities.Send> и <xref:System.ServiceModel.Activities.Receive>.</span><span class="sxs-lookup"><span data-stu-id="aacbb-146">To implement a duplex pattern, use <xref:System.ServiceModel.Activities.Send> and <xref:System.ServiceModel.Activities.Receive> activities.</span></span> <span data-ttu-id="aacbb-147">В действии <xref:System.ServiceModel.Activities.Receive> инициализируйте корреляцию с помощью <xref:System.ServiceModel.Activities.CorrelationHandle>.</span><span class="sxs-lookup"><span data-stu-id="aacbb-147">On the <xref:System.ServiceModel.Activities.Receive> activity, initialize a correlation using <xref:System.ServiceModel.Activities.CorrelationHandle>.</span></span> <span data-ttu-id="aacbb-148">В действии <xref:System.ServiceModel.Activities.Send> задайте дескриптор взаимосвязи как значение свойства <xref:System.ServiceModel.Activities.Send.CorrelatesWith%2A>.</span><span class="sxs-lookup"><span data-stu-id="aacbb-148">On the <xref:System.ServiceModel.Activities.Send> activity set that correlation handle as the <xref:System.ServiceModel.Activities.Send.CorrelatesWith%2A> property value.</span></span> <span data-ttu-id="aacbb-149">Дополнительные сведения см. в разделе [устойчивый дуплекс](durable-duplex-correlation.md).</span><span class="sxs-lookup"><span data-stu-id="aacbb-149">For more information, see [Durable Duplex](durable-duplex-correlation.md).</span></span>

> [!NOTE]
> <span data-ttu-id="aacbb-150">Реализация дуплексного метода с использованием корреляции обратного вызова ("устойчивая дуплексная") предназначена для длительных диалогов.</span><span class="sxs-lookup"><span data-stu-id="aacbb-150">Workflow’s implementation of duplex using a callback correlation ("Durable Duplex") is intended for long-running conversations.</span></span> <span data-ttu-id="aacbb-151">Это не то же самое, что «дуплекс» WCF с контрактами обратного вызова, в которых диалоги являются кратковременными (на время существования канала).</span><span class="sxs-lookup"><span data-stu-id="aacbb-151">This is not the same as WCF duplex with callback contracts where the conversation is short-running (the lifetime of the channel).</span></span>

## <a name="message-formatting-and-messaging-activities"></a><span data-ttu-id="aacbb-152">Форматирование сообщений и действия по обмену сообщениями</span><span class="sxs-lookup"><span data-stu-id="aacbb-152">Message formatting and messaging activities</span></span>

<span data-ttu-id="aacbb-153">Действия <xref:System.ServiceModel.Activities.Receive> и <xref:System.ServiceModel.Activities.ReceiveReply> имеют свойство с именем `Content`.</span><span class="sxs-lookup"><span data-stu-id="aacbb-153">The <xref:System.ServiceModel.Activities.Receive> and <xref:System.ServiceModel.Activities.ReceiveReply> activities have a property named `Content`.</span></span> <span data-ttu-id="aacbb-154">Это свойство имеет тип <xref:System.ServiceModel.Activities.ReceiveContent> и представляет данные, получаемые действием <xref:System.ServiceModel.Activities.Receive> или <xref:System.ServiceModel.Activities.ReceiveReply>.</span><span class="sxs-lookup"><span data-stu-id="aacbb-154">This property is of type <xref:System.ServiceModel.Activities.ReceiveContent> and represents data the <xref:System.ServiceModel.Activities.Receive> or <xref:System.ServiceModel.Activities.ReceiveReply> activity receives.</span></span> <span data-ttu-id="aacbb-155">В платформе .NET Framework определены два связанных класса с именами <xref:System.ServiceModel.Activities.ReceiveMessageContent> и <xref:System.ServiceModel.Activities.ReceiveParametersContent>, которые являются производными от <xref:System.ServiceModel.Activities.ReceiveContent>.</span><span class="sxs-lookup"><span data-stu-id="aacbb-155">The .NET Framework defines two related classes called <xref:System.ServiceModel.Activities.ReceiveMessageContent> and <xref:System.ServiceModel.Activities.ReceiveParametersContent> both of which are derived from <xref:System.ServiceModel.Activities.ReceiveContent>.</span></span> <span data-ttu-id="aacbb-156">Задайте для свойства <xref:System.ServiceModel.Activities.Receive> действия <xref:System.ServiceModel.Activities.ReceiveReply> или `Content` значение экземпляра одного из этих типов для получения данных в службе рабочего процесса.</span><span class="sxs-lookup"><span data-stu-id="aacbb-156">Set the <xref:System.ServiceModel.Activities.Receive> or <xref:System.ServiceModel.Activities.ReceiveReply> activity’s `Content` property to an instance of one of these types to receive data into a workflow service.</span></span> <span data-ttu-id="aacbb-157">Используемые типы зависят от типа данных, получаемых действием.</span><span class="sxs-lookup"><span data-stu-id="aacbb-157">The type to use depends upon the type of data the activity receives.</span></span> <span data-ttu-id="aacbb-158">Если действие получает объект `Message` или тип контракта сообщения, следует использовать <xref:System.ServiceModel.Activities.ReceiveMessageContent>.</span><span class="sxs-lookup"><span data-stu-id="aacbb-158">If the activity receives a `Message` object or a message contract type, use <xref:System.ServiceModel.Activities.ReceiveMessageContent>.</span></span> <span data-ttu-id="aacbb-159">Если действие получает контракт набора данных или типы XML, которые могут быть сериализованы, используйте <xref:System.ServiceModel.Activities.ReceiveParametersContent>.</span><span class="sxs-lookup"><span data-stu-id="aacbb-159">If the activity receives a set of data contract or XML types that can be serialized, use <xref:System.ServiceModel.Activities.ReceiveParametersContent>.</span></span> <span data-ttu-id="aacbb-160"><xref:System.ServiceModel.Activities.ReceiveParametersContent> позволяет отправлять несколько параметров, <xref:System.ServiceModel.Activities.ReceiveMessageContent> позволяет отправлять только один объект - сообщение (или тип контракта сообщения).</span><span class="sxs-lookup"><span data-stu-id="aacbb-160"><xref:System.ServiceModel.Activities.ReceiveParametersContent> allows you to send multiple parameters, whereas <xref:System.ServiceModel.Activities.ReceiveMessageContent> only allows you to send one object, the message (or message contract type).</span></span>

> [!NOTE]
> <span data-ttu-id="aacbb-161"><xref:System.ServiceModel.Activities.ReceiveMessageContent> также можно использовать с одним контрактом данных или типом XML, который может быть сериализован.</span><span class="sxs-lookup"><span data-stu-id="aacbb-161"><xref:System.ServiceModel.Activities.ReceiveMessageContent> can also be used with a single data contract or XML type that can be serialized.</span></span> <span data-ttu-id="aacbb-162">Разница между использованием класса <xref:System.ServiceModel.Activities.ReceiveParametersContent> с одним параметром и передачей объекта напрямую классу <xref:System.ServiceModel.Activities.ReceiveMessageContent> заключается в формате сообщений.</span><span class="sxs-lookup"><span data-stu-id="aacbb-162">The difference between using <xref:System.ServiceModel.Activities.ReceiveParametersContent> with a single parameter and the object passed directly to <xref:System.ServiceModel.Activities.ReceiveMessageContent> is the wire-format.</span></span> <span data-ttu-id="aacbb-163">Содержимое параметра упаковывается в элемент XML, соответствующий имени операции, а сериализуемый объект упаковывается в элемент XML с использованием имени параметра (например, `<Echo><msg>Hello, World</msg></Echo>`).</span><span class="sxs-lookup"><span data-stu-id="aacbb-163">The parameter’s content is wrapped in an XML element that corresponds to the operation name and the serialized object is wrapped in an XML element using the parameter name (for example, `<Echo><msg>Hello, World</msg></Echo>`).</span></span> <span data-ttu-id="aacbb-164">Содержимое сообщения не упаковывается в имя операции.</span><span class="sxs-lookup"><span data-stu-id="aacbb-164">The message content is not wrapped by the operation name.</span></span> <span data-ttu-id="aacbb-165">Вместо этого сериализуемый объект размещается в элементе XML с использованием полного имени типа XML (например, `<string>Hello, World</string>`).</span><span class="sxs-lookup"><span data-stu-id="aacbb-165">Instead, the serialized object is placed within an XML element using the XML-qualified type name (for example, `<string>Hello, World</string>`).</span></span>

<span data-ttu-id="aacbb-166">Действия <xref:System.ServiceModel.Activities.Send> и <xref:System.ServiceModel.Activities.SendReply> также имеют свойство с именем `Content`.</span><span class="sxs-lookup"><span data-stu-id="aacbb-166">The <xref:System.ServiceModel.Activities.Send> and <xref:System.ServiceModel.Activities.SendReply> activities also have a property named `Content`.</span></span> <span data-ttu-id="aacbb-167">Это свойство имеет тип <xref:System.ServiceModel.Activities.SendContent> и представляет данные, отправляемые действием <xref:System.ServiceModel.Activities.Send> или <xref:System.ServiceModel.Activities.SendReply>.</span><span class="sxs-lookup"><span data-stu-id="aacbb-167">This property is of type <xref:System.ServiceModel.Activities.SendContent> and represents data the <xref:System.ServiceModel.Activities.Send> or <xref:System.ServiceModel.Activities.SendReply> activity sends.</span></span> <span data-ttu-id="aacbb-168">В платформе .NET Framework определены два связанных типа с именами <xref:System.ServiceModel.Activities.SendMessageContent> и <xref:System.ServiceModel.Activities.SendParametersContent>, которые являются производными от <xref:System.ServiceModel.Activities.SendContent>.</span><span class="sxs-lookup"><span data-stu-id="aacbb-168">The .NET Framework defines two related types called <xref:System.ServiceModel.Activities.SendMessageContent> and <xref:System.ServiceModel.Activities.SendParametersContent> both of which are derived from <xref:System.ServiceModel.Activities.SendContent>.</span></span> <span data-ttu-id="aacbb-169">Задайте для свойства <xref:System.ServiceModel.Activities.Send> действия <xref:System.ServiceModel.Activities.SendReply> или `Content` значение экземпляра одного из этих типов для отправки данных из службы рабочего процесса.</span><span class="sxs-lookup"><span data-stu-id="aacbb-169">Set the <xref:System.ServiceModel.Activities.Send> or <xref:System.ServiceModel.Activities.SendReply> activity’s `Content` property to an instance of one of these types to send data from a workflow service.</span></span> <span data-ttu-id="aacbb-170">Используемые типы зависят от типа данных, отправляемых действием.</span><span class="sxs-lookup"><span data-stu-id="aacbb-170">The type to use depends upon the type of data the activity sends.</span></span> <span data-ttu-id="aacbb-171">Если действие отправляет объект `Message` или тип контракта сообщения, следует использовать <xref:System.ServiceModel.Activities.SendMessageContent>.</span><span class="sxs-lookup"><span data-stu-id="aacbb-171">If the activity sends a `Message` object or a message contract type, use <xref:System.ServiceModel.Activities.SendMessageContent>.</span></span> <span data-ttu-id="aacbb-172">Если действие отправляет тип контракта, используйте <xref:System.ServiceModel.Activities.SendParametersContent>.</span><span class="sxs-lookup"><span data-stu-id="aacbb-172">If the activity sends a data contract type use <xref:System.ServiceModel.Activities.SendParametersContent>.</span></span> <span data-ttu-id="aacbb-173"><xref:System.ServiceModel.Activities.SendParametersContent> позволяет отправлять несколько параметров, <xref:System.ServiceModel.Activities.SendMessageContent> позволяет отправлять только один объект - сообщение (или тип контракта сообщения).</span><span class="sxs-lookup"><span data-stu-id="aacbb-173"><xref:System.ServiceModel.Activities.SendParametersContent> allows you to send multiple parameters, whereas <xref:System.ServiceModel.Activities.SendMessageContent> only allows you to send one object, the message (or the message contract type).</span></span>

<span data-ttu-id="aacbb-174">При императивном программировании действий обмена сообщениями следует использовать универсальные аргументы <xref:System.Activities.InArgument%601> и <xref:System.Activities.OutArgument%601> для упаковки объектов, назначенных для сообщения или свойств параметров для действий <xref:System.ServiceModel.Activities.Send>, <xref:System.ServiceModel.Activities.SendReply>, <xref:System.ServiceModel.Activities.Receive> и <xref:System.ServiceModel.Activities.ReceiveReply>.</span><span class="sxs-lookup"><span data-stu-id="aacbb-174">When programming imperatively with the messaging activities, you use the generic <xref:System.Activities.InArgument%601> and <xref:System.Activities.OutArgument%601> to wrap the objects you assign to the message or parameters properties of the <xref:System.ServiceModel.Activities.Send>, <xref:System.ServiceModel.Activities.SendReply>, <xref:System.ServiceModel.Activities.Receive>, and <xref:System.ServiceModel.Activities.ReceiveReply> activities.</span></span> <span data-ttu-id="aacbb-175">Используйте <xref:System.Activities.InArgument%601> для действий <xref:System.ServiceModel.Activities.Send> и <xref:System.ServiceModel.Activities.SendReply> и <xref:System.Activities.OutArgument%601> для <xref:System.ServiceModel.Activities.Receive> и <xref:System.ServiceModel.Activities.ReceiveReply> действий.</span><span class="sxs-lookup"><span data-stu-id="aacbb-175">Use <xref:System.Activities.InArgument%601> for the <xref:System.ServiceModel.Activities.Send> and <xref:System.ServiceModel.Activities.SendReply> activities and <xref:System.Activities.OutArgument%601> for <xref:System.ServiceModel.Activities.Receive> and <xref:System.ServiceModel.Activities.ReceiveReply> activities.</span></span> <span data-ttu-id="aacbb-176">С действиями по передаче сообщений используются аргументы `In`, поскольку в действия передаются данные.</span><span class="sxs-lookup"><span data-stu-id="aacbb-176">`In` arguments are used with the send activities because the data is being passed into the activities.</span></span> <span data-ttu-id="aacbb-177">С действиями по получению сообщений используются аргументы `Out`, поскольку данные принимаются от действий, как показано в следующем примере.</span><span class="sxs-lookup"><span data-stu-id="aacbb-177">`Out` arguments are used with the receive activities because data is being passed out of the activities, as shown in the following example.</span></span>

```csharp
Receive reserveSeat = new Receive
{
    ...
    Content = new ReceiveParametersContent
    {
        Parameters =
        {
            { "ReservationInfo", new OutArgument<ReservationRequest>(reservationInfo) }
        }
    }
};
SendReply reserveSeat = new SendReply
{
    ...
    Request = reserveSeat,
    Content = new SendParametersContent
    {
        Parameters =
        {
            { "ReservationId", new InArgument<string>(reservationId) }
        }
    },
};
```

<span data-ttu-id="aacbb-178">При реализации службы рабочего процесса, определяющей операцию «запрос-ответ», возвращающую пустое значение, необходимо создать экземпляр действия <xref:System.ServiceModel.Activities.SendReply> и задать для свойства <xref:System.ServiceModel.Activities.SendReply.Content%2A> значение пустого экземпляра одного из типов содержимого (<xref:System.ServiceModel.Activities.SendMessageContent> или <xref:System.ServiceModel.Activities.SendParametersContent>), как это показано в следующем примере.</span><span class="sxs-lookup"><span data-stu-id="aacbb-178">When implementing a workflow service that defines a request/response operation that returns void, you must instantiate a <xref:System.ServiceModel.Activities.SendReply> activity and set the <xref:System.ServiceModel.Activities.SendReply.Content%2A> property to an empty instance of one of the content types (<xref:System.ServiceModel.Activities.SendMessageContent> or <xref:System.ServiceModel.Activities.SendParametersContent>) as shown in the following example.</span></span>

```csharp
Receive rcv = new Receive()
{
ServiceContractName = "IService",
OperationName = "NullReturningContract",
Content = new ReceiveParametersContent( new Dictionary<string, OutArgument>() { { "message", new OutArgument<string>() } } )
};
SendReply sr = new SendReply()
{
Request = rcv
   Content = new SendParametersContent();
};
```

## <a name="add-service-reference"></a><span data-ttu-id="aacbb-179">Добавить ссылку на службу</span><span class="sxs-lookup"><span data-stu-id="aacbb-179">Add service reference</span></span>

<span data-ttu-id="aacbb-180">При вызове службы рабочего процесса из приложения рабочего процесса Visual Studio 2012 создает настраиваемые действия обмена сообщениями, которые инкапсулируют обычные <xref:System.ServiceModel.Activities.Send> и <xref:System.ServiceModel.Activities.ReceiveReply> действия, используемые в запросе или ответе MEP.</span><span class="sxs-lookup"><span data-stu-id="aacbb-180">When calling a workflow service from a workflow application, Visual Studio 2012 generates custom messaging activities that encapsulate the usual <xref:System.ServiceModel.Activities.Send> and <xref:System.ServiceModel.Activities.ReceiveReply> activities used in a request/reply MEP.</span></span> <span data-ttu-id="aacbb-181">Чтобы использовать эту функцию, щелкните правой кнопкой мыши клиентский проект в Visual Studio и выберите **добавить** > **ссылку на службу**.</span><span class="sxs-lookup"><span data-stu-id="aacbb-181">To use this feature, right-click the client project in Visual Studio and select **Add** > **Service Reference**.</span></span> <span data-ttu-id="aacbb-182">Введите базовый адрес службы в поле адреса и щелкните «Перейти».</span><span class="sxs-lookup"><span data-stu-id="aacbb-182">Type the base address of the service in the address box and click Go.</span></span> <span data-ttu-id="aacbb-183">Доступные службы отображаются в поле **Services:** .</span><span class="sxs-lookup"><span data-stu-id="aacbb-183">The available services are displayed in the **Services:** box.</span></span> <span data-ttu-id="aacbb-184">Разверните узел службы для отображения поддерживаемых контрактов.</span><span class="sxs-lookup"><span data-stu-id="aacbb-184">Expand the service node to display the contracts supported.</span></span> <span data-ttu-id="aacbb-185">Выберите контракт, который требуется вызвать, и список доступных операций отображается в поле **операции** .</span><span class="sxs-lookup"><span data-stu-id="aacbb-185">Select the contract you want to call and the list of available operations is displayed in the **Operations** box.</span></span> <span data-ttu-id="aacbb-186">Затем можно указать пространство имен для созданного действия и нажать кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="aacbb-186">You can then specify the namespace for the generated activity and click **OK**.</span></span> <span data-ttu-id="aacbb-187">Появится диалоговое окно с сообщением, что операция была завершена успешно, а созданные пользовательские действия появятся в области элементов после повторного построения проекта.</span><span class="sxs-lookup"><span data-stu-id="aacbb-187">You then see a dialog that says the operation completed successfully and that the generated custom activities are in the toolbox after you have rebuilt the project.</span></span> <span data-ttu-id="aacbb-188">Для каждой операции, определенной в контракте службы, существует одно действие.</span><span class="sxs-lookup"><span data-stu-id="aacbb-188">There is one activity for each operation defined on the service contract.</span></span> <span data-ttu-id="aacbb-189">После повторного построения проекта пользователь сможет перетаскивать пользовательские действия в рабочий процесс и задавать любые необходимые свойства в окне свойств.</span><span class="sxs-lookup"><span data-stu-id="aacbb-189">After rebuilding the project you can drag and drop the custom activities onto your workflow and set any required properties in the properties window.</span></span>

## <a name="messaging-activity-templates"></a><span data-ttu-id="aacbb-190">Шаблоны действий обмена сообщениями</span><span class="sxs-lookup"><span data-stu-id="aacbb-190">Messaging activity templates</span></span>

<span data-ttu-id="aacbb-191">Чтобы настроить запрос или ответ MEP на клиенте и службе проще, Visual Studio 2012 предоставляет два шаблона действий обмена сообщениями.</span><span class="sxs-lookup"><span data-stu-id="aacbb-191">To make setting up a request/response MEP on the client and service easier, Visual Studio 2012 provides two messaging activity templates.</span></span> <span data-ttu-id="aacbb-192">`System.ServiceModel.Activities.Design.ReceiveAndSendReply` используется в службе, а `System.ServiceModel.Activities.Design.SendAndReceiveReply` используется на клиенте.</span><span class="sxs-lookup"><span data-stu-id="aacbb-192">`System.ServiceModel.Activities.Design.ReceiveAndSendReply` is used on the service and `System.ServiceModel.Activities.Design.SendAndReceiveReply` is used on the client.</span></span> <span data-ttu-id="aacbb-193">В обоих случаях шаблоны добавят соответствующие действия обмена сообщениями в рабочий процесс.</span><span class="sxs-lookup"><span data-stu-id="aacbb-193">In both cases the templates add the appropriate messaging activities to your workflow.</span></span> <span data-ttu-id="aacbb-194">Для службы шаблон `System.ServiceModel.Activities.Design.ReceiveAndSendReply` добавит действие <xref:System.ServiceModel.Activities.Receive>, за которым следует действие <xref:System.ServiceModel.Activities.SendReply>.</span><span class="sxs-lookup"><span data-stu-id="aacbb-194">On the service, the `System.ServiceModel.Activities.Design.ReceiveAndSendReply` adds a <xref:System.ServiceModel.Activities.Receive> activity followed by a <xref:System.ServiceModel.Activities.SendReply> activity.</span></span> <span data-ttu-id="aacbb-195">Свойство <xref:System.ServiceModel.Activities.SendReply.Request> автоматически задается для действия <xref:System.ServiceModel.Activities.Receive>.</span><span class="sxs-lookup"><span data-stu-id="aacbb-195">The <xref:System.ServiceModel.Activities.SendReply.Request> property is automatically set to the <xref:System.ServiceModel.Activities.Receive> activity.</span></span> <span data-ttu-id="aacbb-196">Для клиента шаблон `System.ServiceModel.Activities.Design.SendAndReceiveReply` добавит действие <xref:System.ServiceModel.Activities.Send>, за которым следует действие <xref:System.ServiceModel.Activities.ReceiveReply>.</span><span class="sxs-lookup"><span data-stu-id="aacbb-196">On the client, the `System.ServiceModel.Activities.Design.SendAndReceiveReply` adds a <xref:System.ServiceModel.Activities.Send> activity followed by a <xref:System.ServiceModel.Activities.ReceiveReply>.</span></span> <span data-ttu-id="aacbb-197">Свойство <xref:System.ServiceModel.Activities.ReceiveReply.Request%2A> автоматически задается для действия <xref:System.ServiceModel.Activities.Send>.</span><span class="sxs-lookup"><span data-stu-id="aacbb-197">The <xref:System.ServiceModel.Activities.ReceiveReply.Request%2A> property is automatically set to the <xref:System.ServiceModel.Activities.Send> activity.</span></span> <span data-ttu-id="aacbb-198">Чтобы использовать эти шаблоны, перетащите соответствующий шаблон в рабочий процесс.</span><span class="sxs-lookup"><span data-stu-id="aacbb-198">To use these templates, just drag and drop the appropriate template onto your workflow.</span></span>

## <a name="messaging-activities-and-transactions"></a><span data-ttu-id="aacbb-199">Действия и транзакции обмена сообщениями</span><span class="sxs-lookup"><span data-stu-id="aacbb-199">Messaging activities and transactions</span></span>

<span data-ttu-id="aacbb-200">При вызове службы рабочего процесса может быть полезно выделить для операции службы транзакцию.</span><span class="sxs-lookup"><span data-stu-id="aacbb-200">When a call is made to a workflow service you may want to flow a transaction to the service operation.</span></span> <span data-ttu-id="aacbb-201">Чтобы сделать это, поместите действие <xref:System.ServiceModel.Activities.Receive> в действие <xref:System.ServiceModel.Activities.TransactedReceiveScope>.</span><span class="sxs-lookup"><span data-stu-id="aacbb-201">To do this place the <xref:System.ServiceModel.Activities.Receive> activity within a <xref:System.ServiceModel.Activities.TransactedReceiveScope> activity.</span></span> <span data-ttu-id="aacbb-202">Действие <xref:System.ServiceModel.Activities.TransactedReceiveScope> содержит действие `Receive` и текст.</span><span class="sxs-lookup"><span data-stu-id="aacbb-202">The <xref:System.ServiceModel.Activities.TransactedReceiveScope> activity contains a `Receive` activity and a body.</span></span> <span data-ttu-id="aacbb-203">Транзакция, выделяемая службе, остается внешней в течение выполнения текста <xref:System.ServiceModel.Activities.TransactedReceiveScope>.</span><span class="sxs-lookup"><span data-stu-id="aacbb-203">The transaction flowed to the service remains ambient throughout the execution of the body of the <xref:System.ServiceModel.Activities.TransactedReceiveScope>.</span></span> <span data-ttu-id="aacbb-204">Транзакция завершает работу, когда заканчивается выполнение основной части.</span><span class="sxs-lookup"><span data-stu-id="aacbb-204">The transaction is completed when the body finishes executing.</span></span> <span data-ttu-id="aacbb-205">Дополнительные сведения о рабочих процессах и транзакциях см. в разделе [транзакции рабочего процесса](../../../../docs/framework/windows-workflow-foundation/workflow-transactions.md).</span><span class="sxs-lookup"><span data-stu-id="aacbb-205">For more information about workflows and transactions see [Workflow Transactions](../../../../docs/framework/windows-workflow-foundation/workflow-transactions.md).</span></span>

## <a name="see-also"></a><span data-ttu-id="aacbb-206">См. также:</span><span class="sxs-lookup"><span data-stu-id="aacbb-206">See also</span></span>

- [<span data-ttu-id="aacbb-207">Как отправлять и получать ошибки в службах рабочих процессов</span><span class="sxs-lookup"><span data-stu-id="aacbb-207">How to Send and Receive Faults in Workflow Services</span></span>](https://go.microsoft.com/fwlink/?LinkId=189151)
- [<span data-ttu-id="aacbb-208">Создание службы долго выполняющегося рабочего процесса</span><span class="sxs-lookup"><span data-stu-id="aacbb-208">Creating a Long-running Workflow Service</span></span>](creating-a-long-running-workflow-service.md)
