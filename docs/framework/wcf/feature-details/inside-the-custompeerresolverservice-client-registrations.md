---
title: "Подробная информация о CustomPeerResolverService: регистрация клиентов"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 40236953-a916-4236-84a6-928859e1331a
caps.latest.revision: "7"
author: Erikre
ms.author: erikre
manager: erikre
ms.openlocfilehash: b157d177b238db655e98a4cbe1d5a86ae895afa1
ms.sourcegitcommit: bd1ef61f4bb794b25383d3d72e71041a5ced172e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/18/2017
---
# <a name="inside-the-custompeerresolverservice-client-registrations"></a>Подробная информация о CustomPeerResolverService: регистрация клиентов
Каждый узел в сетке публикует информацию о своей конечной точке в службе распознавателя с помощью функции `Register`. Служба распознавателя хранит эту информацию в виде регистрационной записи. Эта запись содержит уникальный идентификатор (RegistrationID) и информацию о конечной точке (PeerNodeAddress) для узла.  
  
## <a name="stale-records-and-expiration-time"></a>Устаревшие записи и срок действия  
 В идеальном случае, когда узел покидает сетку, он вызывает функцию `Unregister`, после чего служба распознавателя удаляет регистрационную запись. Иногда узлы закрываются или становятся недоступными перед вызовом функции `Unregister`, оставляя устаревшую регистрационную запись.  
  
 Устаревшие записи в службе распознавателя могут стать причиной сбоя подключения. Если узел, который пытается подключиться к сетке, получает информацию об устаревшем соединении от службы распознавателя, для успешного подключения к сетке может потребоваться больше времени. Устаревшие записи также занимают место в памяти. Без эффективного процесса очистки кэш, используемый для хранения регистрационных записей, может в конечном счете переполниться и вызвать сбой службы распознавателя.  
  
 Служба <xref:System.ServiceModel.PeerResolvers.CustomPeerResolverService> указывает срок действия (DateTime) для каждой записи и сохраняет эту информацию как часть записи. Служба использует срок действия для определения устаревших записей. Пользовательские реализации выполняются подобным же образом.  
  
## <a name="refreshinterval-and-cleanupinterval"></a>RefreshInterval и CleanupInterval  
 Свойство `RefreshInterval` службы <xref:System.ServiceModel.PeerResolvers.CustomPeerResolverService> определяет срок действия регистрационных записей в таблице подстановки регистрационных записей службы. По истечении срока действия, указанного в этом свойстве для определенной записи, она становится устаревшей и помечается для удаления.  
  
 Свойство `CleanupInterval` службы <xref:System.ServiceModel.PeerResolvers.CustomPeerResolverService> определяет периодичность поиска и удаления устаревших регистрационных записей. Срок, указанный в свойстве `CleanupInterval`, должен быть не менее указанного в свойстве `RefreshInterval` этой службы.  
  
 Чтобы реализовать собственную службу распознавателя, необходимо записать функцию обслуживания для удаления устаревших регистрационных записей. Для этого можно использовать следующие способы.  
  
-   **Периодическое обслуживание**: задать таймер на периодическое срабатывание и просмотр хранилища данных для удаления устаревших записей. Этот подход используется в службе <xref:System.ServiceModel.PeerResolvers.CustomPeerResolverService>.  
  
-   **Удаление пассивной**: вместо активного поиска устаревших записей через определенные интервалы, можно определить и удалить устаревшие записи, когда служба уже выполняется другой функции. Потенциально это может увеличить время отклика на запросы от клиентов распознавателя, но устраняет необходимость в таймере. Этот способ может быть более эффективным, если ожидается, что несколько узлов покинут сетку без вызова функции `Unregister`.  
  
## <a name="registrationlifetime-and-refresh"></a>RegistrationLifetime и Refresh  
 Когда узел регистрируется в службе распознавателя, он получает объект <xref:System.ServiceModel.PeerResolvers.RegisterResponseInfo> от службы. Этот объект имеет свойство `RegistrationLifetime`, в котором содержится информация о времени, оставшемся до истечения срока действия регистрации и удаления узла службой распознавателя. Если, например, срок действия регистрации `RegistrationLifetime` составляет 2 минуты, узел должен вызвать функцию `Refresh` в течение не более 2 минут, чтобы запись не перешла в разряд устаревших и не была удалена. Когда служба распознавателя получает запрос `Refresh`, она ищет запись и сбрасывает срок действия. Функция Refresh возвращает объект <xref:System.ServiceModel.PeerResolvers.RefreshResponseInfo> со свойством `RegistrationLifetime`.  
  
## <a name="see-also"></a>См. также  
 [Одноранговые распознаватели](../../../../docs/framework/wcf/feature-details/peer-resolvers.md)
