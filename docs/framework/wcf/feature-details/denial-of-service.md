---
title: Отказ в обслуживании
ms.date: 03/30/2017
helpviewer_keywords:
- denial of service [WCF]
ms.assetid: dfb150f3-d598-4697-a5e6-6779e4f9b600
ms.openlocfilehash: 55120430a9aaafe7d8bbf2b26f07806e4f1aa44a
ms.sourcegitcommit: c01c18755bb7b0f82c7232314ccf7955ea7834db
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/15/2020
ms.locfileid: "75964426"
---
# <a name="denial-of-service"></a>Отказ в обслуживании
Если система перегружена так, что не удается обрабатывать сообщения, или сообщения обрабатываются слишком медленно, происходит отказ в обслуживании.  
  
## <a name="excess-memory-consumption"></a>Чрезмерный расход памяти  
 Проблема может возникнуть при прочтении XML-документа с большим количеством уникальных локальных имен, пространств имен или префиксов. При использовании класса, который наследуется от <xref:System.Xml.XmlReader>, и вызове свойства <xref:System.Xml.XmlReader.LocalName%2A>, <xref:System.Xml.XmlReader.Prefix%2A> или <xref:System.Xml.XmlReader.NamespaceURI%2A> для каждого элемента, возвращаемая строка добавляется в таблицу <xref:System.Xml.NameTable>. Коллекция, содержащаяся в таблице <xref:System.Xml.NameTable>, никогда не уменьшается в размерах, что создает виртуальную «утечку памяти» в дескрипторах строк.  
  
 Возможны следующие решения:  
  
- Создайте класс, производный от <xref:System.Xml.NameTable>, и включите максимальную квоту по размеру. (Не существует способов предотвратить использование таблицы <xref:System.Xml.NameTable> или сменить таблицу <xref:System.Xml.NameTable> при ее заполнении.)  
  
- Не используйте упомянутые свойства, а использовать вместо них, если возможно, используйте метод <xref:System.Xml.XmlReader.MoveToAttribute%2A> вместе с методом <xref:System.Xml.XmlReader.IsStartElement%2A>; эти методы не возвращают строк и поэтому не возникает переполнение коллекции <xref:System.Xml.NameTable>.  
  
## <a name="malicious-client-sends-excessive-license-requests-to-service"></a>Вредоносный клиент отправляет службе слишком много запросов лицензий  
 Если вредоносный клиент направляет службе слишком много запросов лицензий, это может привести к излишнему использованию памяти на сервере.  
  
 Устранение рисков. Используйте следующие свойства класса <xref:System.ServiceModel.Channels.LocalServiceSecuritySettings>:  
  
- <xref:System.ServiceModel.Channels.LocalServiceSecuritySettings.MaxCachedCookies%2A>: определяет максимальное число привязанных ко времени объектов `SecurityContextToken`, которые сервер кэширует после согласования `SPNego` или `SSL`;  
  
- <xref:System.ServiceModel.Channels.LocalServiceSecuritySettings.IssuedCookieLifetime%2A>: определяет время существования объектов `SecurityContextTokens`, выдаваемых сервером после согласования `SPNego` и `SSL`. Сервер кэширует объекты `SecurityContextToken` на данный промежуток времени.  
  
- <xref:System.ServiceModel.Channels.LocalServiceSecuritySettings.MaxPendingSessions%2A> управляет максимальным числом безопасных диалогов, установленных на сервере, но для которых ни одно сообщение приложения не было обработано. Данная квота препятствует установлению клиентами безопасных диалогов в службе; таким образом, служба должна отслеживать состояние каждого из клиентов, но не использовать их.  
  
- <xref:System.ServiceModel.Channels.LocalServiceSecuritySettings.InactivityTimeout%2A>: определяет максимальный срок, в течение которого служба поддерживает безопасный диалог, не получая сообщений приложения от клиента. Данная квота препятствует установлению клиентами безопасных диалогов в службе; таким образом, служба должна отслеживать состояние каждого из клиентов, но не использовать их.  
  
## <a name="wsdualhttpbinding-or-dual-custom-bindings-require-client-authentication"></a>Привязки WSDualHttpBinding и Dual Custom Bindings требуют проверки подлинности клиента  
 По умолчанию для привязки <xref:System.ServiceModel.WSDualHttpBinding> включен режим безопасности. Однако существует возможность, что при отключении проверки подлинности клиента путем задания для свойства <xref:System.ServiceModel.MessageSecurityOverHttp.ClientCredentialType%2A> значения <xref:System.ServiceModel.MessageCredentialType.None> злоумышленник сможет вызвать атаку типа «отказ в обслуживании» на третьей службе. Это может произойти потому, что вредоносный клиент «заставит» службу отправить поток сообщений третьей службе.  
  
 Чтобы избежать этого, не присваивайте данному свойству значение `None`. Кроме того, помните о такой угрозе при создании пользовательской привязки, использующей шаблон двустороннего обмена сообщениями.  
  
## <a name="auditing-event-log-can-be-filled"></a>Возможно переполнение журнала событий аудита  
 Если злоумышленник знает о том, что включен аудит, он может отправлять недопустимые сообщения, приводящие к внесению записей аудита в журнал. Если это приводит к заполнению журнала аудита, система аудита дает сбой.  
  
 Для решения этой проблемы задайте свойству <xref:System.ServiceModel.Description.ServiceSecurityAuditBehavior.SuppressAuditFailure%2A> значение `true` и используйте свойства средства «Просмотр событий» для управления поведением аудита. Дополнительные сведения об использовании Просмотр событий для просмотра журналов событий и управления ими см. в разделе [Просмотр событий](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc766042(v=ws.11)). Дополнительные сведения см. в разделе [Audit](../../../../docs/framework/wcf/feature-details/auditing-security-events.md).  
  
## <a name="invalid-implementations-of-iauthorizationpolicy-can-cause-service-to-become-unresponsive"></a>Недопустимые реализации IAuthorizationPolicy могут привести к тому, что служба перестанет отвечать на запросы  
 Вызов метода <xref:System.IdentityModel.Policy.IAuthorizationPolicy.Evaluate%2A> для неисправной реализации интерфейса <xref:System.IdentityModel.Policy.IAuthorizationPolicy> может привести к тому, что служба перестанет отвечать на запросы.  
  
 Устранение рисков. Используйте только надежный код. Это значит, следует использовать только тот код, который вы написали и испытали сами, или код от надежного поставщика. Не следует разрешать подключение к коду ненадежных расширений <xref:System.IdentityModel.Policy.IAuthorizationPolicy> без их тщательной проверки. Это относится ко всем расширениям, используемым при реализации службы. WCF не делает различий между кодом приложения и внешним кодом, подключенным с помощью точек расширения.  
  
## <a name="kerberos-maximum-token-size-may-need-resizing"></a>Может потребоваться изменить максимальный размер маркера Kerberos  
 Если клиент принадлежит к большому числу групп (примерно 900, хотя реальное число может быть другим в зависимости от конкретных групп), может возникнуть проблема, если размер блока заголовка сообщения будет превышать 64 килобайта. В этом случае можно увеличить максимальный размер маркера Kerberos. Также может потребоваться увеличить максимальный размер сообщения WCF для размещения маркера Kerberos большего размера.  
  
## <a name="autoenrollment-results-in-multiple-certificates-with-same-subject-name-for-machine"></a>Результаты авторегистрации в нескольких сертификатах с одним именем субъекта для компьютера  
 Автоматическая *Регистрация* — это функция Windows Server 2003 для автоматической регистрации пользователей и компьютеров для сертификатов. Если компьютер входит в домен, в котором включена эта возможность, сертификат X.509, соответствующий цели проверки подлинности клиента, автоматически создается и вставляется в хранилище личных сертификатов локального компьютера, как только компьютер подключается к сети. Однако при авторегистрации одно и то же имя субъекта используется для всех сертификатов, которые создаются в кэше.  
  
 Это влияет на то, что службы WCF могут не открываться в доменах с автоматической регистрацией. Это связано с тем, что условия поиска учетных данных X.509 службы по умолчанию могут быть достаточно сложными, поскольку имеется несколько сертификатов с полным DNS-именем компьютера. Один сертификат связан с авторегистрацией, а другой сертификат может быть выданным самостоятельно.  
  
 Чтобы устранить эту эту проблемы, сослаться на точный сертификат для использования с более точным критерием поиска [\<serviceCredentials >](../../../../docs/framework/configure-apps/file-schema/wcf/servicecredentials.md). Например, используйте параметр <xref:System.Security.Cryptography.X509Certificates.X509FindType.FindByThumbprint> и задавайте сертификат по его уникальному отпечатку (хэшу).  
  
 Дополнительные сведения о функции автоматической подачи заявок см. в статье [Автоматическая регистрация сертификатов в Windows Server 2003](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2003/cc778954(v%3dws.10)).  
  
## <a name="last-of-multiple-alternative-subject-names-used-for-authorization"></a>Последнее из нескольких альтернативных имен субъекта, используемое для авторизации  
 В редком случае, когда сертификат X.509 содержит несколько альтернативных имен субъектов, и авторизация выполняется с использованием альтернативного имени субъекта, авторизация может завершиться сбоем.  
  
## <a name="protect-configuration-files-with-acls"></a>Защита файлов конфигурации с помощью списков управления доступом  
 В файлах кода и конфигурации для маркеров, выпущенных CardSpace, можно указать обязательные и необязательные утверждения. В результате в сообщениях `RequestSecurityToken`, отправляемых в службу маркеров безопасности, будут создаваться соответствующие элементы. Злоумышленник может изменить код или файл конфигурации, удалив обязательные или необязательные утверждения, в результате чего возникнет вероятность того, что служба маркеров безопасности выдаст маркер, который запрещает доступ к целевой службе.  
  
 Предотвращение. Проверяйте разрешение на доступ к компьютеру для изменения файла конфигурации. Используйте списки управления доступом к файлам (ACL) для защиты файлов конфигурации. WCF требует, чтобы код был в каталоге приложения или в глобальном кэше сборок, прежде чем он позволит загрузить такой код из конфигурации. Для обеспечения защиты каталогов используйте списки управления доступом к каталогам.  
  
## <a name="maximum-number-of-secure-sessions-for-a-service-is-reached"></a>Достигнуто максимальное число безопасных сеансов для службы  
 Когда клиент успешно проходит проверку подлинности на стороне службы и устанавливается безопасный сеанс для службы, служба отслеживает этот сеанс, пока клиент не отменит его, или пока срок действия сеанса не истечет. Каждый установленный сеанс учитывается службой относительно максимального числа одновременных активных сеансов. Когда будет достигнут этот предел, клиенты, пытающие создать сеансы для связи с этой службой, будут отклоняться, пока один или несколько активных сеансов не истекут или не будут отменены клиентом. У клиента может быть установлено несколько сеансов связи со службой, и все они учитываются при сравнении с предельным значением.  
  
> [!NOTE]
> При использовании сеансов с отслеживанием состояния предыдущий абзац неприменим. Дополнительные сведения о сеансах с отслеживанием состояния см. [в разделе инструкции. Создание маркера контекста безопасности для безопасного сеанса](../../../../docs/framework/wcf/feature-details/how-to-create-a-security-context-token-for-a-secure-session.md).  
  
 Чтобы избежать этого, задайте максимальное число активных сеансов и максимальное время существования сеанса с помощью свойства <xref:System.ServiceModel.Channels.SecurityBindingElement> класса <xref:System.ServiceModel.Channels.SecurityBindingElement>.  
  
## <a name="see-also"></a>См. также:

- [Вопросы безопасности](../../../../docs/framework/wcf/feature-details/security-considerations-in-wcf.md)
- [Раскрытие информации](../../../../docs/framework/wcf/feature-details/information-disclosure.md)
- [Повышение привилегий](../../../../docs/framework/wcf/feature-details/elevation-of-privilege.md)
- [Отказ в обслуживании](../../../../docs/framework/wcf/feature-details/denial-of-service.md)
- [Атаки с повторением](../../../../docs/framework/wcf/feature-details/replay-attacks.md)
- [Подделка](../../../../docs/framework/wcf/feature-details/tampering.md)
- [Неподдерживаемые сценарии](../../../../docs/framework/wcf/feature-details/unsupported-scenarios.md)
