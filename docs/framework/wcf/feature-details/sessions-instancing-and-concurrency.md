---
title: "Сеансы, экземпляры и параллелизм"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 50797a3b-7678-44ed-8138-49ac1602f35b
caps.latest.revision: "16"
author: Erikre
ms.author: erikre
manager: erikre
ms.openlocfilehash: f188bc85ae3c2601e98ad29b275c6bb8b698522f
ms.sourcegitcommit: 4f3fef493080a43e70e951223894768d36ce430a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/21/2017
---
# <a name="sessions-instancing-and-concurrency"></a><span data-ttu-id="16475-102">Сеансы, экземпляры и параллелизм</span><span class="sxs-lookup"><span data-stu-id="16475-102">Sessions, Instancing, and Concurrency</span></span>
<span data-ttu-id="16475-103">Под *сеансом* понимается скоррелированный набор всех сообщений, переданных между двумя конечными точками.</span><span class="sxs-lookup"><span data-stu-id="16475-103">A *session* is a correlation of all messages sent between two endpoints.</span></span> <span data-ttu-id="16475-104">*Создание экземпляров* означает управление временем жизни определенных пользователем объектов службы и связанных с ними объектов <xref:System.ServiceModel.InstanceContext> .</span><span class="sxs-lookup"><span data-stu-id="16475-104">*Instancing* refers to controlling the lifetime of user-defined service objects and their related <xref:System.ServiceModel.InstanceContext> objects.</span></span> <span data-ttu-id="16475-105">Термин*параллелизм* означает управление количеством потоков, одновременно выполняющихся в некотором контексте <xref:System.ServiceModel.InstanceContext> .</span><span class="sxs-lookup"><span data-stu-id="16475-105">*Concurrency* is the term given to the control of the number of threads executing in an <xref:System.ServiceModel.InstanceContext> at the same time.</span></span>  
  
 <span data-ttu-id="16475-106">В этом разделе описаны эти параметры, способы их использования и различные взаимодействия между ними.</span><span class="sxs-lookup"><span data-stu-id="16475-106">This topic describes these settings, how to use them, and the various interactions between them.</span></span>  
  
## <a name="sessions"></a><span data-ttu-id="16475-107">Сеансы</span><span class="sxs-lookup"><span data-stu-id="16475-107">Sessions</span></span>  
 <span data-ttu-id="16475-108">Если в контракте службы для свойства <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A?displayProperty=nameWithType> задано значение <xref:System.ServiceModel.SessionMode.Required?displayProperty=nameWithType>, такой контракт означает, что все вызовы (т. е. обмен сообщениями, на котором основана поддержка вызовов) должны быть частью одного диалога.</span><span class="sxs-lookup"><span data-stu-id="16475-108">When a service contract sets the <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A?displayProperty=nameWithType> property to <xref:System.ServiceModel.SessionMode.Required?displayProperty=nameWithType>, that contract is saying that all calls (that is, the underlying message exchanges that support the calls) must be part of the same conversation.</span></span> <span data-ttu-id="16475-109">Если в контракте указано, что сеансы для него разрешены, но не требуются, клиенты могут подключаться, создавая сеанс или не создавая его.</span><span class="sxs-lookup"><span data-stu-id="16475-109">If a contract specifies that it allows sessions but does not require one, clients can connect and either establish a session or not.</span></span> <span data-ttu-id="16475-110">Если сеанс завершен, но по этому же основанному на сеансе каналу отправляется сообщение, выдается исключение.</span><span class="sxs-lookup"><span data-stu-id="16475-110">If the session ends and a message is sent over the same session-based channel an exception is thrown.</span></span>  
  
 <span data-ttu-id="16475-111">Сеансы[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] имеют следующие основные особенности:</span><span class="sxs-lookup"><span data-stu-id="16475-111">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] sessions have the following main conceptual features:</span></span>  
  
-   <span data-ttu-id="16475-112">Они явным образом инициируются и завершаются вызвавшим приложением.</span><span class="sxs-lookup"><span data-stu-id="16475-112">They are explicitly initiated and terminated by the calling application.</span></span>  
  
-   <span data-ttu-id="16475-113">Сообщения, доставленные в ходе сеанса, обрабатываются в порядке их получения.</span><span class="sxs-lookup"><span data-stu-id="16475-113">Messages delivered during a session are processed in the order in which they are received.</span></span>  
  
-   <span data-ttu-id="16475-114">Сеанс коррелирует группу сообщений в диалог.</span><span class="sxs-lookup"><span data-stu-id="16475-114">Sessions correlate a group of messages into a conversation.</span></span> <span data-ttu-id="16475-115">Такая корреляция является абстракцией.</span><span class="sxs-lookup"><span data-stu-id="16475-115">The meaning of that correlation is an abstraction.</span></span> <span data-ttu-id="16475-116">Например, один основанный на сеансах канал может коррелировать сообщения, основываясь на общем сетевом подключении, а другой - основываясь на общем теге в тексте сообщения.</span><span class="sxs-lookup"><span data-stu-id="16475-116">For instance, one session-based channel may correlate messages based on a shared network connection while another session-based channel may correlate messages based on a shared tag in the message body.</span></span> <span data-ttu-id="16475-117">Функции, получаемые в результате сеанса, зависят от характера корреляции.</span><span class="sxs-lookup"><span data-stu-id="16475-117">The features that can be derived from the session depend on the nature of the correlation.</span></span>  
  
-   <span data-ttu-id="16475-118">Нет общего хранилища данных, связанного с сеансом [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="16475-118">There is no general data store associated with a [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] session.</span></span>  
  
 <span data-ttu-id="16475-119">Зная особенности класса <xref:System.Web.SessionState.HttpSessionState?displayProperty=nameWithType> в приложениях [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] и обеспечиваемые им функциональные возможности, можно отметить следующие различия между его сеансами и сеансами [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]:</span><span class="sxs-lookup"><span data-stu-id="16475-119">If you are familiar with the <xref:System.Web.SessionState.HttpSessionState?displayProperty=nameWithType> class in [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] applications and the functionality it provides, you might notice the following differences between that kind of session and [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] sessions:</span></span>  
  
-   <span data-ttu-id="16475-120">Сеансы[!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] всегда инициируются сервером.</span><span class="sxs-lookup"><span data-stu-id="16475-120">[!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] sessions are always server-initiated.</span></span>  
  
-   <span data-ttu-id="16475-121">Сеансы[!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] явным образом неупорядочены.</span><span class="sxs-lookup"><span data-stu-id="16475-121">[!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] sessions are implicitly unordered.</span></span>  
  
-   <span data-ttu-id="16475-122">Сеансы[!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] обеспечивают общий механизм хранения данных для запросов.</span><span class="sxs-lookup"><span data-stu-id="16475-122">[!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] sessions provide a general data storage mechanism across requests.</span></span>  
  
 <span data-ttu-id="16475-123">Клиентские приложения и приложения служб взаимодействуют с сеансами разными способами.</span><span class="sxs-lookup"><span data-stu-id="16475-123">Client applications and service applications interact with sessions in different ways.</span></span> <span data-ttu-id="16475-124">Клиентское приложение инициирует сеансы, а затем получает и обрабатывает сообщения, передаваемые в рамках этого сеанса.</span><span class="sxs-lookup"><span data-stu-id="16475-124">Client applications initiate sessions and then receive and process the messages sent within the session.</span></span> <span data-ttu-id="16475-125">Приложения служб могут использовать сеансы как точки расширяемости для добавления дополнительного поведения.</span><span class="sxs-lookup"><span data-stu-id="16475-125">Service applications can use sessions as an extensibility point to add additional behavior.</span></span> <span data-ttu-id="16475-126">Это можно сделать, работая непосредственно с контекстом <xref:System.ServiceModel.InstanceContext> , или реализовав пользовательский поставщик контекста экземпляров.</span><span class="sxs-lookup"><span data-stu-id="16475-126">This is done by working directly with the <xref:System.ServiceModel.InstanceContext> or implementing a custom instance context provider.</span></span>  
  
## <a name="instancing"></a><span data-ttu-id="16475-127">Создание экземпляров</span><span class="sxs-lookup"><span data-stu-id="16475-127">Instancing</span></span>  
 <span data-ttu-id="16475-128">Поведение при создании экземпляров (задаваемое с помощью свойства <xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A?displayProperty=nameWithType>) управляет способом создания контекста <xref:System.ServiceModel.InstanceContext> в ответ на входящие сообщения.</span><span class="sxs-lookup"><span data-stu-id="16475-128">The instancing behavior (set by using the <xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A?displayProperty=nameWithType> property) controls how the <xref:System.ServiceModel.InstanceContext> is created in response to incoming messages.</span></span> <span data-ttu-id="16475-129">По умолчанию каждый контекст <xref:System.ServiceModel.InstanceContext> связан с одним определенным пользователем объектом службы, поэтому (по умолчанию) задание свойства <xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A> также определяет создание экземпляров определенных пользователем объектов службы.</span><span class="sxs-lookup"><span data-stu-id="16475-129">By default, each <xref:System.ServiceModel.InstanceContext> is associated with one user-defined service object, so (in the default case) setting the <xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A> property also controls the instancing of user-defined service objects.</span></span> <span data-ttu-id="16475-130">Перечисление <xref:System.ServiceModel.InstanceContextMode> определяет режимы создания экземпляров.</span><span class="sxs-lookup"><span data-stu-id="16475-130">The <xref:System.ServiceModel.InstanceContextMode> enumeration defines the instancing modes.</span></span>  
  
 <span data-ttu-id="16475-131">Доступны следующие режимы создания экземпляров:</span><span class="sxs-lookup"><span data-stu-id="16475-131">The following instancing modes are available:</span></span>  
  
-   <span data-ttu-id="16475-132"><xref:System.ServiceModel.InstanceContextMode.PerCall>: для каждого запроса клиента создается новый контекст <xref:System.ServiceModel.InstanceContext> (и, следовательно, новый объект службы).</span><span class="sxs-lookup"><span data-stu-id="16475-132"><xref:System.ServiceModel.InstanceContextMode.PerCall>: A new <xref:System.ServiceModel.InstanceContext> (and therefore service object) is created for each client request.</span></span>  
  
-   <span data-ttu-id="16475-133"><xref:System.ServiceModel.InstanceContextMode.PerSession>: новый контекст <xref:System.ServiceModel.InstanceContext> (и, следовательно, новый объект службы) создается для каждого нового сеанса клиента и существует в течение времени существования этого сеанса (для этого требуется привязка, поддерживающая сеансы).</span><span class="sxs-lookup"><span data-stu-id="16475-133"><xref:System.ServiceModel.InstanceContextMode.PerSession>: A new <xref:System.ServiceModel.InstanceContext> (and therefore service object) is created for each new client session and maintained for the lifetime of that session (this requires a binding that supports sessions).</span></span>  
  
-   <span data-ttu-id="16475-134"><xref:System.ServiceModel.InstanceContextMode.Single>: все запросы клиентов за время существования приложения обрабатываются одним контекстом <xref:System.ServiceModel.InstanceContext> (и, следовательно, одним объектом службы).</span><span class="sxs-lookup"><span data-stu-id="16475-134"><xref:System.ServiceModel.InstanceContextMode.Single>: A single <xref:System.ServiceModel.InstanceContext> (and therefore service object) handles all client requests for the lifetime of the application.</span></span>  
  
 <span data-ttu-id="16475-135">В следующем примере кода показано явное задание для режима <xref:System.ServiceModel.InstanceContextMode> значения <xref:System.ServiceModel.InstanceContextMode.PerSession> в классе службы.</span><span class="sxs-lookup"><span data-stu-id="16475-135">The following code example shows the default <xref:System.ServiceModel.InstanceContextMode> value, <xref:System.ServiceModel.InstanceContextMode.PerSession> being explicitly set on a service class.</span></span>  
  
```  
[ServiceBehavior(InstanceContextMode=InstanceContextMode.PerSession)]   
public class CalculatorService : ICalculatorInstance   
{   
    ...  
}  
```  
  
 <span data-ttu-id="16475-136">Свойство <xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A?displayProperty=nameWithType> управляет частотой освобождения контекста <xref:System.ServiceModel.InstanceContext>, а свойства <xref:System.ServiceModel.OperationBehaviorAttribute.ReleaseInstanceMode%2A?displayProperty=nameWithType> и <xref:System.ServiceModel.ServiceBehaviorAttribute.ReleaseServiceInstanceOnTransactionComplete%2A?displayProperty=nameWithType> управляют частотой освобождения объекта службы.</span><span class="sxs-lookup"><span data-stu-id="16475-136">And while the <xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A?displayProperty=nameWithType> property controls how often the <xref:System.ServiceModel.InstanceContext> is released, the <xref:System.ServiceModel.OperationBehaviorAttribute.ReleaseInstanceMode%2A?displayProperty=nameWithType> and <xref:System.ServiceModel.ServiceBehaviorAttribute.ReleaseServiceInstanceOnTransactionComplete%2A?displayProperty=nameWithType> properties control when the service object is released.</span></span>  
  
### <a name="well-known-singleton-services"></a><span data-ttu-id="16475-137">Широко известные одноэлементные службы</span><span class="sxs-lookup"><span data-stu-id="16475-137">Well-Known Singleton Services</span></span>  
 <span data-ttu-id="16475-138">Иногда бывает полезен один из вариантов объектов службы с одним экземпляром: можно самому создать объект службы, а затем создать основное приложение службы, используя этот объект.</span><span class="sxs-lookup"><span data-stu-id="16475-138">One variation on single instance service objects is sometimes useful: you can create a service object yourself and create the service host using that object.</span></span> <span data-ttu-id="16475-139">Для этого необходимо задать для свойства <xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A?displayProperty=nameWithType> значение <xref:System.ServiceModel.InstanceContextMode.Single> - в противном случае при открытии основного приложения службы возникает исключение.</span><span class="sxs-lookup"><span data-stu-id="16475-139">To do so, you must also set the <xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A?displayProperty=nameWithType> property to <xref:System.ServiceModel.InstanceContextMode.Single> or an exception is thrown when the service host is opened.</span></span>  
  
 <span data-ttu-id="16475-140">Для создания такой службы используйте конструктор <xref:System.ServiceModel.ServiceHost.%23ctor%28System.Object%2CSystem.Uri%5B%5D%29?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="16475-140">Use the <xref:System.ServiceModel.ServiceHost.%23ctor%28System.Object%2CSystem.Uri%5B%5D%29?displayProperty=nameWithType> constructor to create such a service.</span></span> <span data-ttu-id="16475-141">Он обеспечивает альтернативу реализации пользовательского <xref:System.ServiceModel.Dispatcher.IInstanceContextInitializer?displayProperty=nameWithType>, если требуется предоставить определенный экземпляр объекта для использования одноэлементной службой.</span><span class="sxs-lookup"><span data-stu-id="16475-141">It provides an alternative to implementing a custom <xref:System.ServiceModel.Dispatcher.IInstanceContextInitializer?displayProperty=nameWithType> when you wish to provide a specific object instance for use by a singleton service.</span></span> <span data-ttu-id="16475-142">Этот перегружаемый метод можно использовать, когда тип реализации службы не позволяет легко использовать конструктор (например, если он не реализует открытый конструктор по умолчанию без параметров).</span><span class="sxs-lookup"><span data-stu-id="16475-142">You can use this overload when your service implementation type is difficult to construct (for example, if it does not implement a default parameterless public constructor).</span></span>  
  
 <span data-ttu-id="16475-143">Обратите внимание, что когда этому конструктору передается объект, некоторые функции [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] , связанные с созданием экземпляров, работают по-другому.</span><span class="sxs-lookup"><span data-stu-id="16475-143">Note that when an object is provided to this constructor, some features related to the [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] instancing behavior work differently.</span></span> <span data-ttu-id="16475-144">Например, вызов <xref:System.ServiceModel.InstanceContext.ReleaseServiceInstance%2A?displayProperty=nameWithType> не выполняет никаких действий, если предоставлен экземпляр одноэлементного объекта.</span><span class="sxs-lookup"><span data-stu-id="16475-144">For example, calling <xref:System.ServiceModel.InstanceContext.ReleaseServiceInstance%2A?displayProperty=nameWithType> has no effect when a singleton object instance is provided.</span></span> <span data-ttu-id="16475-145">Аналогичным образом пропускаются все другие механизмы освобождения экземпляров.</span><span class="sxs-lookup"><span data-stu-id="16475-145">Similarly, any other instance-release mechanism is ignored.</span></span> <span data-ttu-id="16475-146">Приложение <xref:System.ServiceModel.ServiceHost> всегда ведет себя таким образом, как если бы для свойства <xref:System.ServiceModel.OperationBehaviorAttribute.ReleaseInstanceMode%2A?displayProperty=nameWithType> было задано значение <xref:System.ServiceModel.ReleaseInstanceMode.None?displayProperty=nameWithType> для всех операций.</span><span class="sxs-lookup"><span data-stu-id="16475-146">The <xref:System.ServiceModel.ServiceHost> always behaves as if the <xref:System.ServiceModel.OperationBehaviorAttribute.ReleaseInstanceMode%2A?displayProperty=nameWithType> property is set to <xref:System.ServiceModel.ReleaseInstanceMode.None?displayProperty=nameWithType> for all operations.</span></span>  
  
### <a name="sharing-instancecontext-objects"></a><span data-ttu-id="16475-147">Совместное использование объектов InstanceContext</span><span class="sxs-lookup"><span data-stu-id="16475-147">Sharing InstanceContext Objects</span></span>  
 <span data-ttu-id="16475-148">Также для каждого сеансового канала или вызова можно задать объект <xref:System.ServiceModel.InstanceContext> , с которым он будет ассоциирован, самостоятельно назначив ассоциацию.</span><span class="sxs-lookup"><span data-stu-id="16475-148">You can also control which sessionful channel or call is associated with which <xref:System.ServiceModel.InstanceContext> object by performing that association yourself.</span></span>  
  
## <a name="concurrency"></a><span data-ttu-id="16475-149">параллелизм</span><span class="sxs-lookup"><span data-stu-id="16475-149">Concurrency</span></span>  
 <span data-ttu-id="16475-150">Параллелизм означает управление количеством потоков, одновременно активных в некотором контексте <xref:System.ServiceModel.InstanceContext> .</span><span class="sxs-lookup"><span data-stu-id="16475-150">Concurrency is the control of the number of threads active in an <xref:System.ServiceModel.InstanceContext> at any one time.</span></span> <span data-ttu-id="16475-151">Управление осуществляется с помощью <xref:System.ServiceModel.ServiceBehaviorAttribute.ConcurrencyMode%2A?displayProperty=nameWithType> с перечислением <xref:System.ServiceModel.ConcurrencyMode>.</span><span class="sxs-lookup"><span data-stu-id="16475-151">This is controlled by using the <xref:System.ServiceModel.ServiceBehaviorAttribute.ConcurrencyMode%2A?displayProperty=nameWithType> with the <xref:System.ServiceModel.ConcurrencyMode> enumeration.</span></span>  
  
 <span data-ttu-id="16475-152">Доступны следующие три режима параллелизма:</span><span class="sxs-lookup"><span data-stu-id="16475-152">The following three concurrency modes are available:</span></span>  
  
-   <span data-ttu-id="16475-153"><xref:System.ServiceModel.ConcurrencyMode.Single>: в каждом контексте экземпляра одновременно допускается максимум один поток, обрабатывающий сообщения в контексте экземпляра.</span><span class="sxs-lookup"><span data-stu-id="16475-153"><xref:System.ServiceModel.ConcurrencyMode.Single>: Each instance context is allowed to have a maximum of one thread processing messages in the instance context at a time.</span></span> <span data-ttu-id="16475-154">Другие потоки, которым требуется использовать этот же контекст экземпляра, должны оставаться блокированными, пока исходный поток не выйдет из контекста экземпляра.</span><span class="sxs-lookup"><span data-stu-id="16475-154">Other threads wishing to use the same instance context must block until the original thread exits the instance context.</span></span>  
  
-   <span data-ttu-id="16475-155"><xref:System.ServiceModel.ConcurrencyMode.Multiple>: каждый экземпляр службы может иметь несколько потоков, параллельно обрабатывающих сообщения.</span><span class="sxs-lookup"><span data-stu-id="16475-155"><xref:System.ServiceModel.ConcurrencyMode.Multiple>: Each service instance can have multiple threads processing messages concurrently.</span></span> <span data-ttu-id="16475-156">Чтобы использовать этот режим параллелизма, реализация службы должна быть потокобезопасной.</span><span class="sxs-lookup"><span data-stu-id="16475-156">The service implementation must be thread-safe to use this concurrency mode.</span></span>  
  
-   <span data-ttu-id="16475-157"><xref:System.ServiceModel.ConcurrencyMode.Reentrant>: каждый экземпляр службы одновременно обрабатывает одно сообщение, но принимает вызовы операций с повторным входом.</span><span class="sxs-lookup"><span data-stu-id="16475-157"><xref:System.ServiceModel.ConcurrencyMode.Reentrant>: Each service instance processes one message at a time, but accepts re-entrant operation calls.</span></span> <span data-ttu-id="16475-158">Служба принимает такие вызовы только при вызове через объект клиента [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="16475-158">The service only accepts these calls when it is calling out through a [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] client object.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="16475-159">Проектирование и разработка кода, который может безопасно использовать несколько потоков, может оказаться непростым делом.</span><span class="sxs-lookup"><span data-stu-id="16475-159">Understanding and developing code that safely uses more than one thread can be difficult to write successfully.</span></span> <span data-ttu-id="16475-160">Перед использованием значения <xref:System.ServiceModel.ConcurrencyMode.Multiple> или <xref:System.ServiceModel.ConcurrencyMode.Reentrant> убедитесь, что служба должным образом разработана для поддержки этих режимов.</span><span class="sxs-lookup"><span data-stu-id="16475-160">Before using <xref:System.ServiceModel.ConcurrencyMode.Multiple> or <xref:System.ServiceModel.ConcurrencyMode.Reentrant> values, ensure that your service is properly designed for these modes.</span></span> [!INCLUDE[crdefault](../../../../includes/crdefault-md.md)]<span data-ttu-id="16475-161"> <xref:System.ServiceModel.ServiceBehaviorAttribute.ConcurrencyMode%2A>.</span><span class="sxs-lookup"><span data-stu-id="16475-161"> <xref:System.ServiceModel.ServiceBehaviorAttribute.ConcurrencyMode%2A>.</span></span>  
  
 <span data-ttu-id="16475-162">Использование параллелизма связано с режимом создания экземпляров.</span><span class="sxs-lookup"><span data-stu-id="16475-162">The use of concurrency is related to the instancing mode.</span></span> <span data-ttu-id="16475-163">В <xref:System.ServiceModel.InstanceContextMode.PerCall> создание экземпляров, параллелизм не имеет значения, так как каждое сообщение обрабатывается новый <xref:System.ServiceModel.InstanceContext> и, таким образом, никогда не более одного потока активно <xref:System.ServiceModel.InstanceContext>.</span><span class="sxs-lookup"><span data-stu-id="16475-163">In <xref:System.ServiceModel.InstanceContextMode.PerCall> instancing, concurrency is not relevant, because each message is processed by a new <xref:System.ServiceModel.InstanceContext> and, therefore, never more than one thread is active in the <xref:System.ServiceModel.InstanceContext>.</span></span>  
  
 <span data-ttu-id="16475-164">В приведенном ниже коде представлен пример задания для свойства <xref:System.ServiceModel.ServiceBehaviorAttribute.ConcurrencyMode%2A> значения <xref:System.ServiceModel.ConcurrencyMode.Multiple>.</span><span class="sxs-lookup"><span data-stu-id="16475-164">The following code example demonstrates setting the <xref:System.ServiceModel.ServiceBehaviorAttribute.ConcurrencyMode%2A> property to <xref:System.ServiceModel.ConcurrencyMode.Multiple>.</span></span>  
  
```  
[ServiceBehavior(ConcurrencyMode=ConcurrencyMode.Multiple, InstanceContextMode = InstanceContextMode.Single)]   
public class CalculatorService : ICalculatorConcurrency   
{   
    ...  
}  
```  
  
## <a name="sessions-interact-with-instancecontext-settings"></a><span data-ttu-id="16475-165">Сеансы взаимодействуют с параметрами InstanceContext</span><span class="sxs-lookup"><span data-stu-id="16475-165">Sessions Interact with InstanceContext Settings</span></span>  
 <span data-ttu-id="16475-166">Взаимодействие сеансов и контекстов <xref:System.ServiceModel.InstanceContext> зависит от значений перечисления <xref:System.ServiceModel.SessionMode> в контракте и свойства <xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A?displayProperty=nameWithType> в реализации службы; сочетание этих значений определяет сопоставление каналов и конкретных объектов службы.</span><span class="sxs-lookup"><span data-stu-id="16475-166">Sessions and <xref:System.ServiceModel.InstanceContext> interact depending upon the combination of the value of the <xref:System.ServiceModel.SessionMode> enumeration in a contract and the <xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A?displayProperty=nameWithType> property on the service implementation, which controls the association between channels and specific service objects.</span></span>  
  
 <span data-ttu-id="16475-167">В приведенной ниже таблице показано, к какому результату приводит поддержка или отсутствие поддержки сеансов входящим каналом при заданном сочетании значений свойств <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A?displayProperty=nameWithType> и <xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A?displayProperty=nameWithType> в службе.</span><span class="sxs-lookup"><span data-stu-id="16475-167">The following table shows the result of an incoming channel either supporting sessions or not supporting sessions given a service's combination of the values of the <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A?displayProperty=nameWithType> property and the <xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A?displayProperty=nameWithType> property.</span></span>  
  
|<span data-ttu-id="16475-168">Значение InstanceContextMode</span><span class="sxs-lookup"><span data-stu-id="16475-168">InstanceContextMode value</span></span>|<xref:System.ServiceModel.SessionMode.Required>|<xref:System.ServiceModel.SessionMode.Allowed>|<xref:System.ServiceModel.SessionMode.NotAllowed>|  
|-------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------|  
|<span data-ttu-id="16475-169">PerCall</span><span class="sxs-lookup"><span data-stu-id="16475-169">PerCall</span></span>|<span data-ttu-id="16475-170">-Поведение с сеансовым каналом: сеанс и <xref:System.ServiceModel.InstanceContext> для каждого вызова.</span><span class="sxs-lookup"><span data-stu-id="16475-170">-   Behavior with sessionful channel: A session and <xref:System.ServiceModel.InstanceContext> for each call.</span></span><br /><span data-ttu-id="16475-171">-Поведение с каналом: возникает исключение.</span><span class="sxs-lookup"><span data-stu-id="16475-171">-   Behavior with sessionless channel: An exception is thrown.</span></span>|<span data-ttu-id="16475-172">-Поведение с сеансовым каналом: сеанс и <xref:System.ServiceModel.InstanceContext> для каждого вызова.</span><span class="sxs-lookup"><span data-stu-id="16475-172">-   Behavior with sessionful channel: A session and <xref:System.ServiceModel.InstanceContext> for each call.</span></span><br /><span data-ttu-id="16475-173">-Поведение с каналом: <xref:System.ServiceModel.InstanceContext> для каждого вызова.</span><span class="sxs-lookup"><span data-stu-id="16475-173">-   Behavior with sessionless channel: An <xref:System.ServiceModel.InstanceContext> for each call.</span></span>|<span data-ttu-id="16475-174">-Поведение с сеансовым каналом: возникает исключение.</span><span class="sxs-lookup"><span data-stu-id="16475-174">-   Behavior with sessionful channel: An exception is thrown.</span></span><br /><span data-ttu-id="16475-175">-Поведение с каналом: <xref:System.ServiceModel.InstanceContext> для каждого вызова.</span><span class="sxs-lookup"><span data-stu-id="16475-175">-   Behavior with sessionless channel: An <xref:System.ServiceModel.InstanceContext> for each call.</span></span>|  
|<span data-ttu-id="16475-176">PerSession</span><span class="sxs-lookup"><span data-stu-id="16475-176">PerSession</span></span>|<span data-ttu-id="16475-177">-Поведение с сеансовым каналом: сеанс и <xref:System.ServiceModel.InstanceContext> для каждого канала.</span><span class="sxs-lookup"><span data-stu-id="16475-177">-   Behavior with sessionful channel: A session and <xref:System.ServiceModel.InstanceContext> for each channel.</span></span><br /><span data-ttu-id="16475-178">-Поведение с каналом: возникает исключение.</span><span class="sxs-lookup"><span data-stu-id="16475-178">-   Behavior with sessionless channel: An exception is thrown.</span></span>|<span data-ttu-id="16475-179">-Поведение с сеансовым каналом: сеанс и <xref:System.ServiceModel.InstanceContext> для каждого канала.</span><span class="sxs-lookup"><span data-stu-id="16475-179">-   Behavior with sessionful channel: A session and <xref:System.ServiceModel.InstanceContext> for each channel.</span></span><br /><span data-ttu-id="16475-180">-Поведение с каналом: <xref:System.ServiceModel.InstanceContext> для каждого вызова.</span><span class="sxs-lookup"><span data-stu-id="16475-180">-   Behavior with sessionless channel: An <xref:System.ServiceModel.InstanceContext> for each call.</span></span>|<span data-ttu-id="16475-181">-Поведение с сеансовым каналом: возникает исключение.</span><span class="sxs-lookup"><span data-stu-id="16475-181">-   Behavior with sessionful channel: An exception is thrown.</span></span><br /><span data-ttu-id="16475-182">-Поведение с каналом: <xref:System.ServiceModel.InstanceContext> для каждого вызова.</span><span class="sxs-lookup"><span data-stu-id="16475-182">-   Behavior with sessionless channel: An <xref:System.ServiceModel.InstanceContext> for each call.</span></span>|  
|<span data-ttu-id="16475-183">Single</span><span class="sxs-lookup"><span data-stu-id="16475-183">Single</span></span>|<span data-ttu-id="16475-184">-Поведение с сеансовым каналом: сеанс и один <xref:System.ServiceModel.InstanceContext> для всех вызовов.</span><span class="sxs-lookup"><span data-stu-id="16475-184">-   Behavior with sessionful channel: A session and one <xref:System.ServiceModel.InstanceContext> for all calls.</span></span><br /><span data-ttu-id="16475-185">-Поведение с каналом: возникает исключение.</span><span class="sxs-lookup"><span data-stu-id="16475-185">-   Behavior with sessionless channel: An exception is thrown.</span></span>|<span data-ttu-id="16475-186">-Поведение с сеансовым каналом: сеанс и <xref:System.ServiceModel.InstanceContext> для созданной или указанной пользователем одноэлементной службы.</span><span class="sxs-lookup"><span data-stu-id="16475-186">-   Behavior with sessionful channel: A session and <xref:System.ServiceModel.InstanceContext> for the created or user-specified singleton.</span></span><br /><span data-ttu-id="16475-187">-Поведение с каналом: <xref:System.ServiceModel.InstanceContext> для созданной или указанной пользователем одноэлементной службы.</span><span class="sxs-lookup"><span data-stu-id="16475-187">-   Behavior with sessionless channel: An <xref:System.ServiceModel.InstanceContext> for the created or user-specified singleton.</span></span>|<span data-ttu-id="16475-188">-Поведение с сеансовым каналом: возникает исключение.</span><span class="sxs-lookup"><span data-stu-id="16475-188">-   Behavior with sessionful channel: An exception is thrown.</span></span><br /><span data-ttu-id="16475-189">-Поведение с каналом: <xref:System.ServiceModel.InstanceContext> для каждой созданной или указанной пользователем одноэлементной службы.</span><span class="sxs-lookup"><span data-stu-id="16475-189">-   Behavior with sessionless channel: An <xref:System.ServiceModel.InstanceContext> for each created singleton or for the user-specified singleton.</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="16475-190">См. также</span><span class="sxs-lookup"><span data-stu-id="16475-190">See Also</span></span>  
 [<span data-ttu-id="16475-191">Использование сеансов</span><span class="sxs-lookup"><span data-stu-id="16475-191">Using Sessions</span></span>](../../../../docs/framework/wcf/using-sessions.md)  
 [<span data-ttu-id="16475-192">Как: создать службу, которой требуются сеансы</span><span class="sxs-lookup"><span data-stu-id="16475-192">How to: Create a Service That Requires Sessions</span></span>](../../../../docs/framework/wcf/feature-details/how-to-create-a-service-that-requires-sessions.md)  
 [<span data-ttu-id="16475-193">Как: управление созданием экземпляров служб</span><span class="sxs-lookup"><span data-stu-id="16475-193">How to: Control Service Instancing</span></span>](../../../../docs/framework/wcf/feature-details/how-to-control-service-instancing.md)  
 [<span data-ttu-id="16475-194">Параллелизм</span><span class="sxs-lookup"><span data-stu-id="16475-194">Concurrency</span></span>](../../../../docs/framework/wcf/samples/concurrency.md)  
 [<span data-ttu-id="16475-195">Создание экземпляров</span><span class="sxs-lookup"><span data-stu-id="16475-195">Instancing</span></span>](../../../../docs/framework/wcf/samples/instancing.md)  
 [<span data-ttu-id="16475-196">Сеанс</span><span class="sxs-lookup"><span data-stu-id="16475-196">Session</span></span>](../../../../docs/framework/wcf/samples/session.md)
