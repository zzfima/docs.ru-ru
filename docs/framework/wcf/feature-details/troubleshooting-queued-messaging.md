---
title: "Устранение неполадок обмена сообщениями с использованием очередей"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: a5f2836f-018d-42f5-a571-1e97e64ea5b0
caps.latest.revision: "19"
author: Erikre
ms.author: erikre
manager: erikre
ms.openlocfilehash: 1c12f02bc40764c1e4acc70906c6145988103d9b
ms.sourcegitcommit: bd1ef61f4bb794b25383d3d72e71041a5ced172e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/18/2017
---
# <a name="troubleshooting-queued-messaging"></a><span data-ttu-id="0ab22-102">Устранение неполадок обмена сообщениями с использованием очередей</span><span class="sxs-lookup"><span data-stu-id="0ab22-102">Troubleshooting Queued Messaging</span></span>
<span data-ttu-id="0ab22-103">Данный раздел содержит наиболее распространенные вопросы и справку по устранению неполадок при использовании очередей в [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)].</span><span class="sxs-lookup"><span data-stu-id="0ab22-103">This section contains common questions and troubleshooting help for using queues in [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)].</span></span>  
  
## <a name="common-questions"></a><span data-ttu-id="0ab22-104">Наиболее распространенные вопросы</span><span class="sxs-lookup"><span data-stu-id="0ab22-104">Common Questions</span></span>  
 <span data-ttu-id="0ab22-105">**Вопрос** я использовал [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] бета-версии 1 и установлено исправление MSMQ.</span><span class="sxs-lookup"><span data-stu-id="0ab22-105">**Q:** I used [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] Beta 1 and I installed the MSMQ hotfix.</span></span> <span data-ttu-id="0ab22-106">Требуется ли удалять исправление?</span><span class="sxs-lookup"><span data-stu-id="0ab22-106">Do I need to remove the hotfix?</span></span>  
  
 <span data-ttu-id="0ab22-107">**О.** Да.</span><span class="sxs-lookup"><span data-stu-id="0ab22-107">**A:** Yes.</span></span> <span data-ttu-id="0ab22-108">Это исправление больше не поддерживается.</span><span class="sxs-lookup"><span data-stu-id="0ab22-108">This hotfix is no longer supported.</span></span> [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]<span data-ttu-id="0ab22-109"> теперь работает на MSMQ, не требуя установки исправления.</span><span class="sxs-lookup"><span data-stu-id="0ab22-109"> now works on MSMQ without a hotfix requirement.</span></span>  
  
 <span data-ttu-id="0ab22-110">**Вопрос** имеется две привязки для MSMQ: <xref:System.ServiceModel.NetMsmqBinding> и <xref:System.ServiceModel.MsmqIntegration.MsmqIntegrationBinding>.</span><span class="sxs-lookup"><span data-stu-id="0ab22-110">**Q:** There are two bindings for MSMQ: <xref:System.ServiceModel.NetMsmqBinding> and <xref:System.ServiceModel.MsmqIntegration.MsmqIntegrationBinding>.</span></span> <span data-ttu-id="0ab22-111">Какую необходимо использовать и когда?</span><span class="sxs-lookup"><span data-stu-id="0ab22-111">What should I use and when?</span></span>  
  
 <span data-ttu-id="0ab22-112">**Ответ** использовать <xref:System.ServiceModel.NetMsmqBinding> при необходимости использовать MSMQ в качестве транспорта для взаимодействия с использованием очередей между двумя [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] приложений.</span><span class="sxs-lookup"><span data-stu-id="0ab22-112">**A:** Use the <xref:System.ServiceModel.NetMsmqBinding> when you want to use MSMQ as a transport for queued communication between two [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] applications.</span></span> <span data-ttu-id="0ab22-113">Выберите <xref:System.ServiceModel.MsmqIntegration.MsmqIntegrationBinding>, если необходимо использовать существующие приложения MSMQ для взаимодействия с новыми приложениями [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)].</span><span class="sxs-lookup"><span data-stu-id="0ab22-113">Use the <xref:System.ServiceModel.MsmqIntegration.MsmqIntegrationBinding> when you want to use existing MSMQ applications to communicate with new [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] applications.</span></span>  
  
 <span data-ttu-id="0ab22-114">**Вопрос** нужно ли обновлять MSMQ, чтобы использовать <xref:System.ServiceModel.NetMsmqBinding> и `MsmqIntegration` привязки?</span><span class="sxs-lookup"><span data-stu-id="0ab22-114">**Q:** Do I have to upgrade MSMQ to use the <xref:System.ServiceModel.NetMsmqBinding> and `MsmqIntegration` bindings?</span></span>  
  
 <span data-ttu-id="0ab22-115">**Ответ.** Нет.</span><span class="sxs-lookup"><span data-stu-id="0ab22-115">**A:** No.</span></span> <span data-ttu-id="0ab22-116">Обе привязки работают с MSMQ 3.0 в [!INCLUDE[wxp](../../../../includes/wxp-md.md)] и [!INCLUDE[ws2003](../../../../includes/ws2003-md.md)].</span><span class="sxs-lookup"><span data-stu-id="0ab22-116">Both bindings work with MSMQ 3.0 on [!INCLUDE[wxp](../../../../includes/wxp-md.md)] and [!INCLUDE[ws2003](../../../../includes/ws2003-md.md)].</span></span> <span data-ttu-id="0ab22-117">Некоторые возможности привязок будут доступны при обновлении до MSMQ 4.0 в [!INCLUDE[wv](../../../../includes/wv-md.md)].</span><span class="sxs-lookup"><span data-stu-id="0ab22-117">Certain features of the bindings become available when you upgrade to MSMQ 4.0 in [!INCLUDE[wv](../../../../includes/wv-md.md)].</span></span>  
  
 <span data-ttu-id="0ab22-118">**Вопрос** какие функции <xref:System.ServiceModel.NetMsmqBinding> и <xref:System.ServiceModel.MsmqIntegration.MsmqIntegrationBinding> привязки доступны в MSMQ 4.0, но отсутствуют в MSMQ 3.0?</span><span class="sxs-lookup"><span data-stu-id="0ab22-118">**Q:** What features of the <xref:System.ServiceModel.NetMsmqBinding> and <xref:System.ServiceModel.MsmqIntegration.MsmqIntegrationBinding> bindings are available in MSMQ 4.0 but not in MSMQ 3.0?</span></span>  
  
 <span data-ttu-id="0ab22-119">**Ответ** следующие функции доступны в MSMQ 4.0, но отсутствуют в MSMQ 3.0:</span><span class="sxs-lookup"><span data-stu-id="0ab22-119">**A:** The following features are available in MSMQ 4.0 but not in MSMQ 3.0:</span></span>  
  
-   <span data-ttu-id="0ab22-120">Пользовательская очередь недоставленных сообщений поддерживается только в MSMQ 4.0.</span><span class="sxs-lookup"><span data-stu-id="0ab22-120">Custom dead-letter queue is supported only on MSMQ 4.0.</span></span>  
  
-   <span data-ttu-id="0ab22-121">MSMQ 3.0 и 4.0 обрабатывают опасные сообщения по-разному.</span><span class="sxs-lookup"><span data-stu-id="0ab22-121">MSMQ 3.0 and 4.0 handle poison messages differently.</span></span>  
  
-   <span data-ttu-id="0ab22-122">Удаленные чтения в транзакциях поддерживаются только MSMQ 4.0.</span><span class="sxs-lookup"><span data-stu-id="0ab22-122">Only MSMQ 4.0 supports remote transacted read.</span></span>  
  
 [!INCLUDE[crdefault](../../../../includes/crdefault-md.md)]<span data-ttu-id="0ab22-123">[Различия в возможностях очередей в Windows Vista, Windows Server 2003 и Windows XP](../../../../docs/framework/wcf/feature-details/diff-in-queue-in-vista-server-2003-windows-xp.md).</span><span class="sxs-lookup"><span data-stu-id="0ab22-123"> [Differences in Queuing Features in Windows Vista, Windows Server 2003, and Windows XP](../../../../docs/framework/wcf/feature-details/diff-in-queue-in-vista-server-2003-windows-xp.md).</span></span>  
  
 <span data-ttu-id="0ab22-124">**Вопрос** можно ли использовать MSMQ 3.0 на одной стороне взаимодействия с использованием очередей, а MSMQ 4.0 на другой стороне?</span><span class="sxs-lookup"><span data-stu-id="0ab22-124">**Q:** Can I use MSMQ 3.0 on one side of a queued communication and MSMQ 4.0 on the other side?</span></span>  
  
 <span data-ttu-id="0ab22-125">**О.** Да.</span><span class="sxs-lookup"><span data-stu-id="0ab22-125">**A:** Yes.</span></span>  
  
 <span data-ttu-id="0ab22-126">**Вопрос** необходимо интегрировать существующие приложения MSMQ с помощью оператора new [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] клиентов или серверов.</span><span class="sxs-lookup"><span data-stu-id="0ab22-126">**Q:** I want to integrate existing MSMQ applications with new [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] clients or servers.</span></span> <span data-ttu-id="0ab22-127">Требуются ли обновления для обеих сторон инфраструктуры MSMQ?</span><span class="sxs-lookup"><span data-stu-id="0ab22-127">Do I need to upgrade both sides of my MSMQ infrastructure?</span></span>  
  
 <span data-ttu-id="0ab22-128">**Ответ.** Нет.</span><span class="sxs-lookup"><span data-stu-id="0ab22-128">**A:** No.</span></span> <span data-ttu-id="0ab22-129">Для обеих сторон обновление до MSMQ 4.0 не требуется.</span><span class="sxs-lookup"><span data-stu-id="0ab22-129">You do not have to upgrade to MSMQ 4.0 on either side.</span></span>  
  
## <a name="troubleshooting"></a><span data-ttu-id="0ab22-130">Устранение неполадок</span><span class="sxs-lookup"><span data-stu-id="0ab22-130">Troubleshooting</span></span>  
 <span data-ttu-id="0ab22-131">Данный раздел содержит ответы на вопросы, связанные с устранением распространенных неполадок.</span><span class="sxs-lookup"><span data-stu-id="0ab22-131">This section contains answers to most common troubleshooting issues.</span></span> <span data-ttu-id="0ab22-132">Некоторые вопросы, являющиеся известными ограничениями, описаны также в заметках о выпуске.</span><span class="sxs-lookup"><span data-stu-id="0ab22-132">Some issues that are known limitations are also described in the release notes.</span></span>  
  
 <span data-ttu-id="0ab22-133">**Вопрос** я пытаюсь использовать частную очередь и получено следующее исключение: `System.InvalidOperationException`: URL-адрес является недопустимым.</span><span class="sxs-lookup"><span data-stu-id="0ab22-133">**Q:** I am trying to use a private queue and I get the following exception: `System.InvalidOperationException`: The URL is invalid.</span></span> <span data-ttu-id="0ab22-134">URL-адрес очереди не может содержать символ "$".</span><span class="sxs-lookup"><span data-stu-id="0ab22-134">The URL for the queue cannot contain the '$' character.</span></span> <span data-ttu-id="0ab22-135">Используйте синтаксис net.msmq://machine/private/queueName, чтобы адресовать частную очередь.</span><span class="sxs-lookup"><span data-stu-id="0ab22-135">Use the syntax in net.msmq://machine/private/queueName to address a private queue.</span></span>  
  
 <span data-ttu-id="0ab22-136">**Ответ** Проверьте универсальный код ресурса (URI) очереди в конфигурации и коде.</span><span class="sxs-lookup"><span data-stu-id="0ab22-136">**A:** Please check the queue Uniform Resource Identifier (URI) in your configuration and code.</span></span> <span data-ttu-id="0ab22-137">Не используйте символ "$" в универсальном коде ресурса (URI).</span><span class="sxs-lookup"><span data-stu-id="0ab22-137">Do not use the "$" character in the URI.</span></span> <span data-ttu-id="0ab22-138">Например, чтобы адресовать частную очередь с именем OrdersQueue, задайте следующий универсальный код ресурса (URI): net.msmq://localhost/private/ordersQueue.</span><span class="sxs-lookup"><span data-stu-id="0ab22-138">For example, to address a private queue named OrdersQueue, specify the URI as net.msmq://localhost/private/ordersQueue.</span></span>  
  
 <span data-ttu-id="0ab22-139">**Вопрос** вызов `ServiceHost.Open()` для очереди приложения вызывает следующее исключение: `System.ArgumentException`: базовый адрес не может содержать строку запроса URI.</span><span class="sxs-lookup"><span data-stu-id="0ab22-139">**Q:** Calling `ServiceHost.Open()` on my queued application throws the following exception: `System.ArgumentException`: A base address cannot contain a URI query string.</span></span> <span data-ttu-id="0ab22-140">Почему?</span><span class="sxs-lookup"><span data-stu-id="0ab22-140">Why?</span></span>  
  
 <span data-ttu-id="0ab22-141">**Ответ** проверять очередь URI в файле конфигурации и коде.</span><span class="sxs-lookup"><span data-stu-id="0ab22-141">**A:** Check the queue URI in your configuration file and in your code.</span></span> <span data-ttu-id="0ab22-142">Хотя очереди MSMQ поддерживают использование символа "?", универсальные коды ресурсов (URI) интерпретируют этот символ как начало строки запроса.</span><span class="sxs-lookup"><span data-stu-id="0ab22-142">While MSMQ queues support the use of the '?' character, URIs interpret this character as the beginning of a string query.</span></span> <span data-ttu-id="0ab22-143">Чтобы избежать этого, не используйте символ "?" в именах очередей.</span><span class="sxs-lookup"><span data-stu-id="0ab22-143">To avoid this issue, use queue names that do not contain '?' characters.</span></span>  
  
 <span data-ttu-id="0ab22-144">**Вопрос** Отправка выполнена успешно, но ни одна из операций службы вызывается на стороне получателя.</span><span class="sxs-lookup"><span data-stu-id="0ab22-144">**Q:** My send succeeded but no service operation is invoked on the receiver.</span></span> <span data-ttu-id="0ab22-145">Почему?</span><span class="sxs-lookup"><span data-stu-id="0ab22-145">Why?</span></span>  
  
 <span data-ttu-id="0ab22-146">**Ответ** чтобы определиться с ответом, работают в следующем контрольном списке:</span><span class="sxs-lookup"><span data-stu-id="0ab22-146">**A:** To determine the answer, work through the following check list:</span></span>  
  
-   <span data-ttu-id="0ab22-147">Проверьте, совместимы ли требования транзакционной очереди с заданными гарантиями.</span><span class="sxs-lookup"><span data-stu-id="0ab22-147">Check that the transactional queue requirements are compatible with the assurances specified.</span></span> <span data-ttu-id="0ab22-148">Обратите внимание на следующие принципы.</span><span class="sxs-lookup"><span data-stu-id="0ab22-148">Note the following principles:</span></span>  
  
    -   <span data-ttu-id="0ab22-149">Отправить устойчивые сообщения (датаграммы и сеансы) с «ровно один раз» гарантии (<xref:System.ServiceModel.MsmqBindingBase.ExactlyOnce%2A> = `true`) только в транзакционную очередь.</span><span class="sxs-lookup"><span data-stu-id="0ab22-149">You can send durable messages (datagrams and sessions) with "exactly once" assurances (<xref:System.ServiceModel.MsmqBindingBase.ExactlyOnce%2A> = `true`) only to a transactional queue.</span></span>  
  
    -   <span data-ttu-id="0ab22-150">Сеансы можно отправлять только с гарантиями доставки точно по одному разу.</span><span class="sxs-lookup"><span data-stu-id="0ab22-150">You can send sessions only with "exactly once" assurances.</span></span>  
  
    -   <span data-ttu-id="0ab22-151">Необходимо, чтобы в сеансе транзакция получала сообщения из транзакционной очереди.</span><span class="sxs-lookup"><span data-stu-id="0ab22-151">A transaction is required to receive messages in a session from a transactional queue.</span></span>  
  
    -   <span data-ttu-id="0ab22-152">Можно отправлять и получать неустойчивые и устойчивые сообщения (только датаграммы) без гарантий (<xref:System.ServiceModel.MsmqBindingBase.ExactlyOnce%2A> = `false`) только в нетранзакционную очередь.</span><span class="sxs-lookup"><span data-stu-id="0ab22-152">You can send or receive volatile or durable messages (datagrams only) with no assurances (<xref:System.ServiceModel.MsmqBindingBase.ExactlyOnce%2A> = `false`) only to a non-transactional queue.</span></span>  
  
-   <span data-ttu-id="0ab22-153">Проверьте очередь недоставленных писем.</span><span class="sxs-lookup"><span data-stu-id="0ab22-153">Check the dead-letter queue.</span></span> <span data-ttu-id="0ab22-154">Если в этой очереди есть сообщения, определите причину, по которой они не были доставлены.</span><span class="sxs-lookup"><span data-stu-id="0ab22-154">If you find the messages there, determine why they were not delivered.</span></span>  
  
-   <span data-ttu-id="0ab22-155">Проверьте очереди исходящих сообщений на наличие проблем с подключением и адресацией.</span><span class="sxs-lookup"><span data-stu-id="0ab22-155">Check the outgoing queues for connectivity or addressing problems.</span></span>  
  
 <span data-ttu-id="0ab22-156">**Вопрос** задана пользовательскую очередь недоставленных сообщений, но при запуске приложения отправителя получается исключение, либо очереди недоставленных сообщений не найден или отправляющее приложение не имеет разрешения на очередь недоставленных сообщений.</span><span class="sxs-lookup"><span data-stu-id="0ab22-156">**Q:** I have specified a custom dead-letter queue, but when I start the sender application, I get an exception that either the dead-letter queue is not found, or the sending application has no permission to the dead-letter queue.</span></span> <span data-ttu-id="0ab22-157">Что происходит?</span><span class="sxs-lookup"><span data-stu-id="0ab22-157">Why is this happening?</span></span>  
  
 <span data-ttu-id="0ab22-158">**Ответ** пользовательскую очередь недоставленных сообщений URI должен включать значение «localhost» или имя компьютера в первый сегмент, например: NET.MSMQ://localhost/Private/myappdead-Letter queue.</span><span class="sxs-lookup"><span data-stu-id="0ab22-158">**A:** The custom dead-letter queue URI must include a "localhost" or the computer name in the first segment, for example, net.msmq://localhost/private/myAppdead-letter queue.</span></span>  
  
 <span data-ttu-id="0ab22-159">**Вопрос** ли всегда необходимо определить пользовательскую очередь недоставленных сообщений или существует очередь недоставленных сообщений по умолчанию?</span><span class="sxs-lookup"><span data-stu-id="0ab22-159">**Q:** Is it always necessary to define a custom dead-letter queue, or is there a default dead-letter queue?</span></span>  
  
 <span data-ttu-id="0ab22-160">**Ответ** Если используются гарантии с «только один раз» (<xref:System.ServiceModel.MsmqBindingBase.ExactlyOnce%2A> = `true`), и если не указать пользовательскую очередь недоставленных сообщений, по умолчанию используется системная транзакционную очередь недоставленных сообщений.</span><span class="sxs-lookup"><span data-stu-id="0ab22-160">**A:** If assurances are "exactly once" (<xref:System.ServiceModel.MsmqBindingBase.ExactlyOnce%2A> = `true`), and if you do not specify a custom dead-letter queue, the default is a system-wide transactional dead-letter queue.</span></span>  
  
 <span data-ttu-id="0ab22-161">Если гарантии отсутствуют (<xref:System.ServiceModel.MsmqBindingBase.ExactlyOnce%2A> = `false`), то значение по умолчанию — не добавляет новых функций очереди недоставленных сообщений.</span><span class="sxs-lookup"><span data-stu-id="0ab22-161">If assurances are none (<xref:System.ServiceModel.MsmqBindingBase.ExactlyOnce%2A> = `false`), then the default is no dead-letter queue functionality.</span></span>  
  
 <span data-ttu-id="0ab22-162">**Вопрос** служба вызывает исключение Svchost.Open с сообщением «требования к EndpointListener могут быть выполнены с ListenerFactory».</span><span class="sxs-lookup"><span data-stu-id="0ab22-162">**Q:** My service throws on SvcHost.Open with a message "EndpointListener requirements cannot be met by the ListenerFactory".</span></span> <span data-ttu-id="0ab22-163">Почему?</span><span class="sxs-lookup"><span data-stu-id="0ab22-163">Why?</span></span>  
  
 <span data-ttu-id="0ab22-164">О.</span><span class="sxs-lookup"><span data-stu-id="0ab22-164">A.</span></span> <span data-ttu-id="0ab22-165">Проверьте контракт службы.</span><span class="sxs-lookup"><span data-stu-id="0ab22-165">Check your service contract.</span></span> <span data-ttu-id="0ab22-166">Возможно, вы забыли поместить «IsOneWay =`true`» на все операции службы.</span><span class="sxs-lookup"><span data-stu-id="0ab22-166">You may have forgotten to put "IsOneWay=`true`" on all the service operations.</span></span> <span data-ttu-id="0ab22-167">Очереди поддерживают только односторонние операции службы.</span><span class="sxs-lookup"><span data-stu-id="0ab22-167">Queues support only one-way service operations.</span></span>  
  
 <span data-ttu-id="0ab22-168">**Вопрос** в очереди имеются сообщения, но операция службы не вызывается.</span><span class="sxs-lookup"><span data-stu-id="0ab22-168">**Q:** There are messages in the queue but no service operation is invoked.</span></span> <span data-ttu-id="0ab22-169">В чем суть проблемы?</span><span class="sxs-lookup"><span data-stu-id="0ab22-169">What is the problem?</span></span>  
  
 <span data-ttu-id="0ab22-170">**Ответ** возможно, произошел сбой узла службы.</span><span class="sxs-lookup"><span data-stu-id="0ab22-170">**A:** Determine if your service host is faulted.</span></span> <span data-ttu-id="0ab22-171">Убедиться в этом можно, просмотрев трассировку или реализовав `IErrorHandler`.</span><span class="sxs-lookup"><span data-stu-id="0ab22-171">You can check by looking at the trace or implementing `IErrorHandler`.</span></span> <span data-ttu-id="0ab22-172">По умолчанию сбой узла службы происходит при обнаружении подозрительного сообщения.</span><span class="sxs-lookup"><span data-stu-id="0ab22-172">Service host faults, by default, if a poison message is detected.</span></span>  
  
 <span data-ttu-id="0ab22-173">**Вопрос** в очереди имеются сообщения, но моя веб узле служба в очереди не активируется.</span><span class="sxs-lookup"><span data-stu-id="0ab22-173">**Q:** There are messages in the queue but my Web-hosted queued service is not getting activated.</span></span> <span data-ttu-id="0ab22-174">Почему?</span><span class="sxs-lookup"><span data-stu-id="0ab22-174">Why?</span></span>  
  
 <span data-ttu-id="0ab22-175">**Ответ** наиболее распространенной причиной является разрешения.</span><span class="sxs-lookup"><span data-stu-id="0ab22-175">**A:** The most common reason is permissions.</span></span>  
  
1.  <span data-ttu-id="0ab22-176">Убедитесь в том, что выполняется процесс `NetMsmqActivator` и удостоверению процесса `NetMsmqActivator` предоставлено разрешение на чтение и поиск для данной очереди.</span><span class="sxs-lookup"><span data-stu-id="0ab22-176">Ensure that the `NetMsmqActivator` process is running and the identity of the `NetMsmqActivator` process is given read and seek permission on the queue.</span></span>  
  
2.  <span data-ttu-id="0ab22-177">Если процесс `NetMsmqActivator` отслеживает очереди на удаленном компьютере, убедитесь в том, что `NetMsmqActivator` не выполняется с маркером ограниченного доступа.</span><span class="sxs-lookup"><span data-stu-id="0ab22-177">If the `NetMsmqActivator` is monitoring queues on a remote machine, ensure that `NetMsmqActivator` does not run under a restricted token.</span></span> <span data-ttu-id="0ab22-178">Чтобы выполнить процесс `NetMsmqActivator` с маркером неограниченного доступа, используется следующий код.</span><span class="sxs-lookup"><span data-stu-id="0ab22-178">To run the `NetMsmqActivator` with an unrestricted token:</span></span>  
  
    ```  
    sc sidtype NetMsmqActivator unrestricted  
    ```  
  
 <span data-ttu-id="0ab22-179">Связанные веб узла проблем см. в: [веб-размещения приложения, в очередь](../../../../docs/framework/wcf/feature-details/web-hosting-a-queued-application.md).</span><span class="sxs-lookup"><span data-stu-id="0ab22-179">For non-security related Web host issues refer to: [Web Hosting a Queued Application](../../../../docs/framework/wcf/feature-details/web-hosting-a-queued-application.md).</span></span>  
  
 <span data-ttu-id="0ab22-180">**Вопрос** возможности самый простой способ доступа к сеансам?</span><span class="sxs-lookup"><span data-stu-id="0ab22-180">**Q:** What is the easiest way to access sessions?</span></span>  
  
 <span data-ttu-id="0ab22-181">**Ответ** задайте AutoComplete =`true` на операцию, которая соответствует последнему сообщению в сеансе и задайте AutoComplete =`false` на всех остальных операций службы.</span><span class="sxs-lookup"><span data-stu-id="0ab22-181">**A:** Set AutoComplete=`true` on the operation that corresponds to the last message in the session, and set AutoComplete=`false` on all remaining service operations.</span></span>  
  
 <span data-ttu-id="0ab22-182">**Вопрос** где можно найти ответы на часто задаваемые вопросы по MSMQ?</span><span class="sxs-lookup"><span data-stu-id="0ab22-182">**Q:** Where can I find answers to common questions on MSMQ?</span></span>  
  
 <span data-ttu-id="0ab22-183">**Ответ** [!INCLUDE[crabout](../../../../includes/crabout-md.md)] MSMQ, в разделе [Microsoft Message Queuing](http://go.microsoft.com/fwlink/?LinkId=87810).</span><span class="sxs-lookup"><span data-stu-id="0ab22-183">**A:** [!INCLUDE[crabout](../../../../includes/crabout-md.md)] MSMQ, see [Microsoft Message Queuing](http://go.microsoft.com/fwlink/?LinkId=87810).</span></span>  
  
 <span data-ttu-id="0ab22-184">**Вопрос** почему создается исключение в службе `ProtocolException` при чтении из очереди, который содержит сообщения сеанса в очереди и сообщения датаграммы?</span><span class="sxs-lookup"><span data-stu-id="0ab22-184">**Q:** Why does my service throw a `ProtocolException` when reading from a queue that contains both queued session messages and queued datagram messages?</span></span>  
  
 <span data-ttu-id="0ab22-185">**Ответ** формируются датаграмм из очереди и фундаментальных различий в сеанс, каким образом в очереди сообщений.</span><span class="sxs-lookup"><span data-stu-id="0ab22-185">**A:** There is a fundamental difference in the way queued session messages and queued datagram messages are composed.</span></span> <span data-ttu-id="0ab22-186">Вследствие этого, служба, ожидающая чтения сообщения сеанса из очереди не может получить сообщение датаграммы из очереди, а служба, ожидающая чтения сообщения датаграммы из очереди не может получить сообщения сеанса.</span><span class="sxs-lookup"><span data-stu-id="0ab22-186">Because of this, a service that is expecting to read a queued session message cannot receive a queued datagram message and a service expecting to read a queued datagram message cannot receive a session message.</span></span> <span data-ttu-id="0ab22-187">При попытке чтения сообщений обоих типов из одной очереди будет получено следующее исключение.</span><span class="sxs-lookup"><span data-stu-id="0ab22-187">Attempting to read both types of messages from the same queue throws the following exception:</span></span>  
  
```  
System.ServiceModel.MsmqPoisonMessageException: The transport channel detected a poison message. This occurred because the message exceeded the maximum number of delivery attempts or because the channel detected a fundamental problem with the message. The inner exception may contain additional information.   
---> System.ServiceModel.ProtocolException: An incoming MSMQ message contained invalid or unexpected .NET Message Framing information in its body. The message cannot be received. Ensure that the sender is using a compatible service contract with a matching SessionMode.  
```  
  
 <span data-ttu-id="0ab22-188">Системная очередь недоставленных сообщений, а также любая пользовательская очередь недоставленных сообщений особенно чувствительна к этой проблеме, если приложение отправляет с одного компьютера как сообщения сеанса в очереди, так и сообщения датаграммы.</span><span class="sxs-lookup"><span data-stu-id="0ab22-188">The system dead-letter queue, as well as any custom dead-letter queue, is particularly susceptible to this issue if an application sends both queued session messages and queued datagram messages from the same computer.</span></span> <span data-ttu-id="0ab22-189">Если сообщение не удается отправить, оно перемещается в очередь недоставленных сообщений.</span><span class="sxs-lookup"><span data-stu-id="0ab22-189">If a message cannot be sent successfully, it is moved to the dead-letter queue.</span></span> <span data-ttu-id="0ab22-190">При этих обстоятельствах в очереди недоставленных сообщений могут быть как сообщения сеанса, так и сообщения датаграмм.</span><span class="sxs-lookup"><span data-stu-id="0ab22-190">Under these circumstances, it is possible to have both session and datagram messages in the dead-letter queue.</span></span> <span data-ttu-id="0ab22-191">При чтении из очереди во время выполнения отсутствует возможность разделения двух типов сообщений, поэтому приложения не должны отправлять сообщения сеанса в очереди и сообщения датаграмм в очереди с одного компьютера.</span><span class="sxs-lookup"><span data-stu-id="0ab22-191">There is no way to separate both types of messages at runtime when reading from a queue, therefore, applications should not send both queued session messages and queued datagram messages from the same computer.</span></span>  
  
### <a name="msmq-integration-specific-troubleshooting"></a><span data-ttu-id="0ab22-192">Интеграция MSMQ: устранение конкретных неполадок</span><span class="sxs-lookup"><span data-stu-id="0ab22-192">MSMQ Integration: Specific Troubleshooting</span></span>  
 <span data-ttu-id="0ab22-193">**Вопрос** при отправке сообщения или открытии узла службы, получить ошибку, указывающую схема неверна.</span><span class="sxs-lookup"><span data-stu-id="0ab22-193">**Q:** When I send a message, or when I open the service host, I get an error that indicates the scheme is wrong.</span></span> <span data-ttu-id="0ab22-194">Почему?</span><span class="sxs-lookup"><span data-stu-id="0ab22-194">Why?</span></span>  
  
 <span data-ttu-id="0ab22-195">**Ответ** при использовании привязки интеграции MSMQ необходимо применять схему msmq.formatname.</span><span class="sxs-lookup"><span data-stu-id="0ab22-195">**A:** When you use the MSMQ integration binding, you must use the msmq.formatname scheme.</span></span> <span data-ttu-id="0ab22-196">Например, msmq.formatname:DIRECT=OS:.\private$\OrdersQueue.</span><span class="sxs-lookup"><span data-stu-id="0ab22-196">For example, msmq.formatname:DIRECT=OS:.\private$\OrdersQueue.</span></span> <span data-ttu-id="0ab22-197">Однако если задана пользовательская очередь недоставленных сообщений, необходимо использовать схему net.msmq.</span><span class="sxs-lookup"><span data-stu-id="0ab22-197">But when you specify the custom dead-letter queue, you must use the net.msmq scheme.</span></span>  
  
 <span data-ttu-id="0ab22-198">**Вопрос** при использовании имени в открытом или закрытом формате и открытии узла службы на [!INCLUDE[wv](../../../../includes/wv-md.md)], выводится сообщение об ошибке.</span><span class="sxs-lookup"><span data-stu-id="0ab22-198">**Q:** When I use a public or private format name and open the service host on [!INCLUDE[wv](../../../../includes/wv-md.md)], I get an error.</span></span> <span data-ttu-id="0ab22-199">Почему?</span><span class="sxs-lookup"><span data-stu-id="0ab22-199">Why?</span></span>  
  
 <span data-ttu-id="0ab22-200">**Ответ** [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] каналом интеграции на [!INCLUDE[wv](../../../../includes/wv-md.md)] проверяет, если можно открыть вложенную очередь для основной очереди приложения для обработки подозрительных сообщений.</span><span class="sxs-lookup"><span data-stu-id="0ab22-200">**A:** The [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] integration channel on [!INCLUDE[wv](../../../../includes/wv-md.md)] checks to see if a sub-queue can be opened for the main application queue for handling poison messages.</span></span> <span data-ttu-id="0ab22-201">Имя вложенной очереди является производным от универсального кода ресурса (URI) msmq.formatname, передаваемого прослушивателю.</span><span class="sxs-lookup"><span data-stu-id="0ab22-201">The sub-queue name is derived from an msmq.formatname URI passed to the listener.</span></span> <span data-ttu-id="0ab22-202">Имя вложенной очереди в MSMQ может быть только непосредственным именем формата.</span><span class="sxs-lookup"><span data-stu-id="0ab22-202">The sub-queue name in MSMQ can only be a direct format name.</span></span> <span data-ttu-id="0ab22-203">Из-за этого возникает ошибка.</span><span class="sxs-lookup"><span data-stu-id="0ab22-203">So you see the error.</span></span> <span data-ttu-id="0ab22-204">Измените URI очереди на непосредственное имя формата.</span><span class="sxs-lookup"><span data-stu-id="0ab22-204">Change the queue URI to a direct format name.</span></span>  
  
 <span data-ttu-id="0ab22-205">**Вопрос** при получении сообщения из приложения MSMQ, сообщение останется в очереди и не читается принимающим [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] приложения.</span><span class="sxs-lookup"><span data-stu-id="0ab22-205">**Q:** When receiving a message from an MSMQ application, the message sits in the queue and is not read by the receiving [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] application.</span></span> <span data-ttu-id="0ab22-206">Почему?</span><span class="sxs-lookup"><span data-stu-id="0ab22-206">Why?</span></span>  
  
 <span data-ttu-id="0ab22-207">**Ответ** проверьте, является ли сообщение имеет тело.</span><span class="sxs-lookup"><span data-stu-id="0ab22-207">**A:** Check to see whether the message has a body.</span></span> <span data-ttu-id="0ab22-208">Если в сообщении отсутствует тело, канал интеграции MSMQ игнорирует его.</span><span class="sxs-lookup"><span data-stu-id="0ab22-208">If the message has no body, the MSMQ integration channel ignores the message.</span></span> <span data-ttu-id="0ab22-209">Реализуйте интерфейс `IErrorHandler`, чтобы получать уведомления об исключениях, и проверьте трассировки.</span><span class="sxs-lookup"><span data-stu-id="0ab22-209">Implement `IErrorHandler` to be notified of exceptions and check the traces.</span></span>  
  
### <a name="security-related-troubleshooting"></a><span data-ttu-id="0ab22-210">Устранение неполадок, связанных с безопасностью</span><span class="sxs-lookup"><span data-stu-id="0ab22-210">Security-Related Troubleshooting</span></span>  
 <span data-ttu-id="0ab22-211">**Вопрос** при выполнении образца, использующего привязку по умолчанию в режиме рабочей группы, сообщения отправляются, но никогда не доходят до получателя.</span><span class="sxs-lookup"><span data-stu-id="0ab22-211">**Q:** When I run the sample that uses a default binding in workgroup mode, messages seem to get sent but are never received by the receiver.</span></span>  
  
 <span data-ttu-id="0ab22-212">**Ответ** по умолчанию сообщения подписываются с использованием внутреннего сертификата MSMQ, которого требуется служба каталогов Active Directory.</span><span class="sxs-lookup"><span data-stu-id="0ab22-212">**A:** By default, messages are signed using an MSMQ internal certificate that requires the Active Directory directory service.</span></span> <span data-ttu-id="0ab22-213">В режиме рабочей группы происходит сбой подписи сообщения, так как служба каталогов Active Directory недоступна.</span><span class="sxs-lookup"><span data-stu-id="0ab22-213">In workgroup mode, because Active Directory is not available, signing the message fails.</span></span> <span data-ttu-id="0ab22-214">Поэтому сообщение попадает в очередь недоставленных сообщений и указывает причины сбоя, например «Неверная сигнатура».</span><span class="sxs-lookup"><span data-stu-id="0ab22-214">So the message lands in the dead-letter queue and failure cause, such as "Bad signature", is indicated.</span></span>  
  
 <span data-ttu-id="0ab22-215">Чтобы обойти эту проблему, можно отключить систему безопасности.</span><span class="sxs-lookup"><span data-stu-id="0ab22-215">The workaround is to turn off security.</span></span> <span data-ttu-id="0ab22-216">Это можно сделать, настроив <xref:System.ServiceModel.NetMsmqSecurity.Mode%2A>  =  <xref:System.ServiceModel.NetMsmqSecurityMode.None> для работы в режиме рабочей группы.</span><span class="sxs-lookup"><span data-stu-id="0ab22-216">This is done by setting <xref:System.ServiceModel.NetMsmqSecurity.Mode%2A> = <xref:System.ServiceModel.NetMsmqSecurityMode.None> to make it work in workgroup mode.</span></span>  
  
 <span data-ttu-id="0ab22-217">Как вариант можно получить <xref:System.ServiceModel.MsmqTransportSecurity> из свойства <xref:System.ServiceModel.NetMsmqSecurity.Transport%2A> и присвоить ему значение <xref:System.ServiceModel.MsmqAuthenticationMode.Certificate>, а затем задать сертификат клиента.</span><span class="sxs-lookup"><span data-stu-id="0ab22-217">Another workaround is to get the <xref:System.ServiceModel.MsmqTransportSecurity> from the <xref:System.ServiceModel.NetMsmqSecurity.Transport%2A> property and set it to <xref:System.ServiceModel.MsmqAuthenticationMode.Certificate>, and set the client certificate.</span></span>  
  
 <span data-ttu-id="0ab22-218">Еще одним обходным путем является установка MSMQ с интеграцией Active Directory.</span><span class="sxs-lookup"><span data-stu-id="0ab22-218">Yet another workaround is to install MSMQ with Active Directory integration.</span></span>  
  
 <span data-ttu-id="0ab22-219">**Вопрос** при отправке сообщения с привязкой по умолчанию (Безопасность транспорта включена) в Active Directory в очередь, появляется сообщение «внутренний сертификат не найден».</span><span class="sxs-lookup"><span data-stu-id="0ab22-219">**Q:** When I send a message with default binding (transport security turned on) in Active Directory to a queue, I get an "internal certificate not found" message.</span></span> <span data-ttu-id="0ab22-220">Как устранить эту проблему?</span><span class="sxs-lookup"><span data-stu-id="0ab22-220">How do I fix this?</span></span>  
  
 <span data-ttu-id="0ab22-221">**Ответ** это означает, что сертификат в Active Directory для отправителя должен обновляться.</span><span class="sxs-lookup"><span data-stu-id="0ab22-221">**A:** This means that the certificate in Active Directory for the sender must be renewed.</span></span> <span data-ttu-id="0ab22-222">Чтобы сделать это, откройте **панели управления**, **Администрирование**, **Управление компьютером**, щелкните правой кнопкой мыши **MSMQ**и выберите **Свойства**.</span><span class="sxs-lookup"><span data-stu-id="0ab22-222">To do so, open **Control Panel**, **Administrative Tools**, **Computer Management**, right-click **MSMQ**, and select **Properties**.</span></span> <span data-ttu-id="0ab22-223">Выберите **сертификат пользователя** и нажмите кнопку **Renew** кнопки.</span><span class="sxs-lookup"><span data-stu-id="0ab22-223">Select the **User Certificate** tab and click the **Renew** button.</span></span>  
  
 <span data-ttu-id="0ab22-224">**Вопрос** при отправке сообщения с помощью <xref:System.ServiceModel.MsmqAuthenticationMode.Certificate> и укажите сертификат для использования, сообщение об ошибке «Недопустимый сертификат».</span><span class="sxs-lookup"><span data-stu-id="0ab22-224">**Q:** When I send a message using <xref:System.ServiceModel.MsmqAuthenticationMode.Certificate> and specify the certificate to use, I get an "Invalid certificate" message.</span></span> <span data-ttu-id="0ab22-225">Как устранить эту проблему?</span><span class="sxs-lookup"><span data-stu-id="0ab22-225">How do I fix this?</span></span>  
  
 <span data-ttu-id="0ab22-226">**Ответ** хранилища сертификатов локального компьютера нельзя использовать в режиме сертификатов.</span><span class="sxs-lookup"><span data-stu-id="0ab22-226">**A:** You cannot use a local machine certificate store with certificate mode.</span></span> <span data-ttu-id="0ab22-227">Необходимо скопировать сертификат из хранилища сертификатов компьютера в хранилище текущего пользователя с помощью оснастки сертификатов.</span><span class="sxs-lookup"><span data-stu-id="0ab22-227">You have to copy the certificate from the machine certificate store to the current user store using the Certificate snap-in.</span></span> <span data-ttu-id="0ab22-228">Чтобы получить оснастку сертификатов, выполните следующие действия.</span><span class="sxs-lookup"><span data-stu-id="0ab22-228">To get the Certificate snap-in:</span></span>  
  
1.  <span data-ttu-id="0ab22-229">Нажмите кнопку **запустить**выберите **запуска**, тип `mmc`и нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="0ab22-229">Click **Start**, select **Run**, type `mmc`, and click **OK**.</span></span>  
  
2.  <span data-ttu-id="0ab22-230">В **консоли управления**откройте **файл** и выбрать пункт **добавить или удалить оснастку**.</span><span class="sxs-lookup"><span data-stu-id="0ab22-230">In the **Microsoft Management Console**, open the **File** menu and select **Add/Remove Snap-in**.</span></span>  
  
3.  <span data-ttu-id="0ab22-231">В **добавить или удалить оснастку** диалоговое окно, нажмите кнопку **добавить** кнопки.</span><span class="sxs-lookup"><span data-stu-id="0ab22-231">In the **Add/Remove Snap-in** dialog box, click the **Add** button.</span></span>  
  
4.  <span data-ttu-id="0ab22-232">В **Добавить изолированную оснастку** диалоговое окно, выберите сертификаты и нажмите кнопку **добавить**.</span><span class="sxs-lookup"><span data-stu-id="0ab22-232">In the **Add Standalone Snap-in** dialog box, select Certificates and click **Add**.</span></span>  
  
5.  <span data-ttu-id="0ab22-233">В **сертификаты** оснастки диалоговом **моей учетной записи пользователя** и нажмите кнопку **Готово**.</span><span class="sxs-lookup"><span data-stu-id="0ab22-233">In the **Certificates** snap-in dialog box, select **My user account,** and click **Finish**.</span></span>  
  
6.  <span data-ttu-id="0ab22-234">Добавьте второй оснастку сертификатов вышеуказанные действия, но на этот раз выберите **учетная запись компьютера** и нажмите кнопку **Далее**.</span><span class="sxs-lookup"><span data-stu-id="0ab22-234">Next, add a second Certificates snap-in using the previous steps, but this time select **Computer account** and click **Next**.</span></span>  
  
7.  <span data-ttu-id="0ab22-235">Выберите **локального компьютера** и нажмите кнопку **Готово**.</span><span class="sxs-lookup"><span data-stu-id="0ab22-235">Select **Local Computer** and click **Finish**.</span></span> <span data-ttu-id="0ab22-236">Теперь сертификаты можно перетаскивать из хранилища сертификатов компьютера в хранилище текущего пользователя.</span><span class="sxs-lookup"><span data-stu-id="0ab22-236">You can now drag and drop certificates from the machine certificate store to the current user store.</span></span>  
  
 <span data-ttu-id="0ab22-237">**Вопрос** когда служба считывает из очереди на другом компьютере в режиме рабочей группы, получается исключение «доступ запрещен».</span><span class="sxs-lookup"><span data-stu-id="0ab22-237">**Q:** When my service reads from a queue on another computer in workgroup mode, I get an "access denied" exception.</span></span>  
  
 <span data-ttu-id="0ab22-238">**Ответ** в режиме рабочей группы, для удаленного приложения, чтобы получить доступ к очереди, приложению требуется разрешение на доступ к очереди.</span><span class="sxs-lookup"><span data-stu-id="0ab22-238">**A:** In workgroup mode, for a remote application to gain access to the queue, the application must have permission to access the queue.</span></span> <span data-ttu-id="0ab22-239">Добавьте «Анонимный вход» для очереди в список управления доступом (ACL) и предоставить ему разрешение на чтение.</span><span class="sxs-lookup"><span data-stu-id="0ab22-239">Add "Anonymous login" to the queue's access control list (ACL) and give it read permission.</span></span>  
  
 <span data-ttu-id="0ab22-240">**Вопрос** когда клиент сетевой службы (или любого клиента, который не имеет учетной записи домена) отправляет сообщения из очереди, происходит сбой отправки с недействительным сертификатом.</span><span class="sxs-lookup"><span data-stu-id="0ab22-240">**Q:** When a network service client (or any client that does not have a domain account) sends a queued message, the send fails with an invalid certificate.</span></span> <span data-ttu-id="0ab22-241">Как устранить эту проблему?</span><span class="sxs-lookup"><span data-stu-id="0ab22-241">How do I fix this?</span></span>  
  
 <span data-ttu-id="0ab22-242">**Ответ** Проверьте конфигурацию привязки.</span><span class="sxs-lookup"><span data-stu-id="0ab22-242">**A:** Check the binding configuration.</span></span> <span data-ttu-id="0ab22-243">В привязке по умолчанию включена безопасность транспорта MSMQ для подписи сообщения.</span><span class="sxs-lookup"><span data-stu-id="0ab22-243">The default binding has MSMQ transport security turned on to sign the message.</span></span> <span data-ttu-id="0ab22-244">Отключите ее.</span><span class="sxs-lookup"><span data-stu-id="0ab22-244">Turn it off.</span></span>  
  
### <a name="remote-transacted-receives"></a><span data-ttu-id="0ab22-245">Удаленное получение транзакций</span><span class="sxs-lookup"><span data-stu-id="0ab22-245">Remote Transacted Receives</span></span>  
 <span data-ttu-id="0ab22-246">**Вопрос** при наличии очереди на компьютере A и [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] службы, который считывает сообщения из очереди на компьютере B (сценарий удаленного получения транзакций), сообщения, не считываются из очереди.</span><span class="sxs-lookup"><span data-stu-id="0ab22-246">**Q:** When I have a queue on machine A, and a [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] service that reads messages from a queue on machine B (the remote transacted receive scenario), messages are not read from the queue.</span></span> <span data-ttu-id="0ab22-247">Сведения трассировки указывают на сбой получения с сообщение «не удается импортировать транзакцию.»</span><span class="sxs-lookup"><span data-stu-id="0ab22-247">Tracing information indicates the receive failed with the message "Transaction cannot be imported."</span></span> <span data-ttu-id="0ab22-248">Как решить эту проблему?</span><span class="sxs-lookup"><span data-stu-id="0ab22-248">What can I do to fix this?</span></span>  
  
 <span data-ttu-id="0ab22-249">**Ответ** существуют три возможные причины этого:</span><span class="sxs-lookup"><span data-stu-id="0ab22-249">**A:** There are three possible reasons for this:</span></span>  
  
-   <span data-ttu-id="0ab22-250">В режиме домена для удаленного получения транзакций требуется доступ к сети координатора распределенных транзакций (Майкрософт) (MSDTC).</span><span class="sxs-lookup"><span data-stu-id="0ab22-250">If you are in domain mode, remote transacted receive requires Microsoft Distributed Transaction Coordinator (MSDTC) network access.</span></span> <span data-ttu-id="0ab22-251">Это можно включить с помощью **Добавление и удаление компонентов**.</span><span class="sxs-lookup"><span data-stu-id="0ab22-251">You can enable this using **Add/Remove Components**.</span></span>  
  
     <span data-ttu-id="0ab22-252">![Включение сетевого доступа DTC](../../../../docs/framework/wcf/feature-details/media/applicationserveraddcomps.jpg "ApplicationServerAddComps")</span><span class="sxs-lookup"><span data-stu-id="0ab22-252">![Enabling network DTC access](../../../../docs/framework/wcf/feature-details/media/applicationserveraddcomps.jpg "ApplicationServerAddComps")</span></span>  
  
-   <span data-ttu-id="0ab22-253">Проверьте режим проверки подлинности для взаимодействия с диспетчером транзакций.</span><span class="sxs-lookup"><span data-stu-id="0ab22-253">Check the authentication mode for communicating with the transaction manager.</span></span> <span data-ttu-id="0ab22-254">Если вы находитесь в режиме рабочей группы, необходимо выбрать «Проверка подлинности не требуется».</span><span class="sxs-lookup"><span data-stu-id="0ab22-254">If you are in workgroup mode, "No Authentication Required" must be selected.</span></span> <span data-ttu-id="0ab22-255">Если вы находитесь в режиме домена, необходимо выбрать «Требуется взаимная проверка подлинности».</span><span class="sxs-lookup"><span data-stu-id="0ab22-255">If you are in domain mode, then "Mutual Authentication Required" must be selected.</span></span>  
  
     <span data-ttu-id="0ab22-256">![Включение транзакций XA](../../../../docs/framework/wcf/feature-details/media/4f3695e0-fb0b-4c5b-afac-75f8860d2bb0.jpg "4f3695e0-fb0b-4c5b-afac-75f8860d2bb0")</span><span class="sxs-lookup"><span data-stu-id="0ab22-256">![Enabling XA transactions](../../../../docs/framework/wcf/feature-details/media/4f3695e0-fb0b-4c5b-afac-75f8860d2bb0.jpg "4f3695e0-fb0b-4c5b-afac-75f8860d2bb0")</span></span>  
  
-   <span data-ttu-id="0ab22-257">Убедитесь, что MSDTC находится в списке исключений в **брандмауэра** параметры.</span><span class="sxs-lookup"><span data-stu-id="0ab22-257">Make sure that MSDTC is in the list of exceptions in the **Internet Connection Firewall** settings.</span></span>  
  
-   <span data-ttu-id="0ab22-258">Убедитесь, что используется [!INCLUDE[wv](../../../../includes/wv-md.md)].</span><span class="sxs-lookup"><span data-stu-id="0ab22-258">Ensure that you are using [!INCLUDE[wv](../../../../includes/wv-md.md)].</span></span> <span data-ttu-id="0ab22-259">MSMQ в [!INCLUDE[wv](../../../../includes/wv-md.md)] поддерживает удаленное чтение в транзакциях.</span><span class="sxs-lookup"><span data-stu-id="0ab22-259">MSMQ on [!INCLUDE[wv](../../../../includes/wv-md.md)] supports remote transacted read.</span></span> <span data-ttu-id="0ab22-260">MSMQ в более ранних версиях Windows не поддерживает удаленное чтение в транзакциях.</span><span class="sxs-lookup"><span data-stu-id="0ab22-260">MSMQ on earlier Windows releases does not support remote transacted read.</span></span>  
  
 <span data-ttu-id="0ab22-261">**Вопрос** когда чтение из очереди выполняется сетевой службой, например, на веб-узле, почему получить исключение об отказе в доступе возникает при чтении из очереди?</span><span class="sxs-lookup"><span data-stu-id="0ab22-261">**Q:** When the service reading from the queue is a network service, for example, in a Web host, why do I get an access-denied exception is raised when reading from the queue?</span></span>  
  
 <span data-ttu-id="0ab22-262">**Ответ** доступ чтения сетевой службы необходимо добавить в очередь ACL, чтобы убедиться, что сетевой службы можно считывать из очереди.</span><span class="sxs-lookup"><span data-stu-id="0ab22-262">**A:** Network service read access must be added to the queue ACL to ensure that a network service can read from the queue.</span></span>  
  
 <span data-ttu-id="0ab22-263">**Вопрос** используется служба активации MSMQ для активации на основе сообщений в очереди на удаленном компьютере приложений?</span><span class="sxs-lookup"><span data-stu-id="0ab22-263">**Q:** Can I use the MSMQ activation service to activate applications based on messages in a queue on a remote machine?</span></span>  
  
 <span data-ttu-id="0ab22-264">**О.** Да.</span><span class="sxs-lookup"><span data-stu-id="0ab22-264">**A:** Yes.</span></span> <span data-ttu-id="0ab22-265">Для этого необходимо настроить службу активации MSMQ для выполнения в качестве сетевой службы, а также добавить доступ сетевой службы к очереди на удаленном компьютере.</span><span class="sxs-lookup"><span data-stu-id="0ab22-265">To do this, you must configure the MSMQ activation service to run as a network service, and add network service access to the queue on the remote machine.</span></span>  
  
## <a name="using-custom-msmq-bindings-with-receivecontext-enabled"></a><span data-ttu-id="0ab22-266">Использование пользовательских привязок MSMQ с включенным ReceiveContext</span><span class="sxs-lookup"><span data-stu-id="0ab22-266">Using Custom MSMQ Bindings with ReceiveContext Enabled</span></span>  
 <span data-ttu-id="0ab22-267">При использовании пользовательских привязок MSMQ с включенным <xref:System.ServiceModel.Channels.ReceiveContext> для обработки входящего сообщения будет использоваться поток из пула потоков, поскольку собственная MSMQ не поддерживает завершение ввода-вывода для асинхронного получения <xref:System.ServiceModel.Channels.ReceiveContext>.</span><span class="sxs-lookup"><span data-stu-id="0ab22-267">When using a custom MSMQ binding with <xref:System.ServiceModel.Channels.ReceiveContext> enabled processing an incoming message will use a thread pool thread because native MSMQ does not support I/O completion for asynchronous <xref:System.ServiceModel.Channels.ReceiveContext> receives.</span></span> <span data-ttu-id="0ab22-268">Причина этого в том, что при обработке такого сообщения для <xref:System.ServiceModel.Channels.ReceiveContext> используются внутренние транзакции, а MSMQ не поддерживает асинхронной обработки.</span><span class="sxs-lookup"><span data-stu-id="0ab22-268">This is because processing such a message uses internal transactions for <xref:System.ServiceModel.Channels.ReceiveContext> and MSMQ does not support asynchronous processing.</span></span> <span data-ttu-id="0ab22-269">Эту проблему можно обойти, добавив <xref:System.ServiceModel.Description.SynchronousReceiveBehavior> к конечной точке для принудительной асинхронной обработки или установив для параметра <xref:System.ServiceModel.Description.DispatcherSynchronizationBehavior.MaxPendingReceives%2A> значение 1.</span><span class="sxs-lookup"><span data-stu-id="0ab22-269">To work around this issue you can add a <xref:System.ServiceModel.Description.SynchronousReceiveBehavior> to the endpoint to force synchronous processing or set <xref:System.ServiceModel.Description.DispatcherSynchronizationBehavior.MaxPendingReceives%2A> to 1.</span></span>
