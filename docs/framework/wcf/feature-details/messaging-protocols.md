---
title: Протоколы обмена сообщениями
ms.date: 03/30/2017
ms.assetid: 5b20bca7-87b3-4c8f-811b-f215b5987104
ms.openlocfilehash: d35cd496db32e1a2886f7ca06e7a3d0964f9c9b5
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/12/2020
ms.locfileid: "79184585"
---
# <a name="messaging-protocols"></a>Протоколы обмена сообщениями

В стеке каналов Windows Communication Foundation (WCF) используются каналы кодирования и транспортировки для преобразования внутреннего представления сообщений в формат провода и отправки его с помощью определенного транспорта. Для взаимодействия веб-служб чаще всего используется транспорт HTTP, а в качестве кодировок в веб-службах чаще всего используются основанные на XML протоколы SOAP 1.1, SOAP 1.2 и механизм оптимизации передачи сообщений (MTOM).

Эта тема охватывает сведения о реализации WCF <xref:System.ServiceModel.Channels.HttpTransportBindingElement>для следующих протоколов, используемых .

Спецификация/документ:

- [HTTP 1.1](https://www.ietf.org/rfc/rfc2616.txt)
- [SOAP 1.1 HTTP Binding](https://www.w3.org/TR/2000/NOTE-SOAP-20000508), Раздел 7
- [SOAP 1.2 HTTP Связывание](https://www.w3.org/TR/soap12-part2) Раздел 7

Эта тема охватывает сведения о реализации WCF для следующих протоколов, которые <xref:System.ServiceModel.Channels.TextMessageEncodingBindingElement> и <xref:System.ServiceModel.Channels.MtomMessageEncodingBindingElement> используются.

Спецификация/документ:

- [Xml](https://www.w3.org/TR/REC-xml)
- [SOAP 1,1](https://www.w3.org/TR/2000/NOTE-SOAP-20000508/)
- [SOAP 1.2 Core](https://www.w3.org/TR/soap12-part1/)
- [WS-Addressing 2004/08](https://www.w3.org/Submission/2004/SUBM-ws-addressing-20040810/)
- [W3C Web Services Addressing 1.0 - Core](https://www.w3.org/TR/2006/REC-ws-addr-core-20060509)
- [W3C Web Services Addressing 1.0 - привязка SOAP](https://www.w3.org/TR/2006/REC-ws-addr-soap-20060509)
- [W3C Веб-сервисы Адресации 1.0 - WSDL Связывание](https://www.w3.org/TR/2006/CR-ws-addr-wsdl-20060529/)
- [W3C Web Services Addressing 1.0 - метаданные](https://www.w3.org/TR/ws-addr-metadata/)
- [Привязка WSDL SOAP1.1](https://www.w3.org/TR/wsdl/)
- [Привязка WSDL SOAP1.2](https://www.w3.org/Submission/wsdl11soap12/)

Эта тема охватывает детали реализации WCF <xref:System.ServiceModel.Channels.MtomMessageEncodingBindingElement> для следующих протоколов, использующих.

Спецификация/документ:

- [Xop](https://www.w3.org/TR/xop10/)
- [MTOM + привязка SOAP 1.2](https://www.w3.org/TR/soap12-mtom/)
- [Привязка MTOM SOAP 1.1](https://www.w3.org/Submission/soap11mtom10/)
- [MTOM WS-Policy Assertion](https://www.w3.org/Submission/2006/SUBM-WS-MTOMPolicy-20061101/)

Следующие пространства имен XML и связанные с ними префиксы используются в этой теме:

| Prefix | Универсальный код ресурса (URI) пространства имен |
|------------|---------------------------------------------------|
| s11 | `http://schemas.xmlsoap.org/soap/envelope` |
| s12 |`http://www.w3.org/2003/05/soap-envelope` |
| wsa |`http://www.w3.org/2004/08/addressing` |
| wsam |`http://www.w3.org/2007/05/addressing/metadata` |
| wsap |`http://schemas.xmlsoap.org/ws/2004/09/policy/addressing` |
| wsa10 |`http://www.w3.org/2005/08/addressing` |
| wsaw10 |`http://www.w3.org/2006/05/addressing/wsdl` |
| xop |`http://www.w3.org/2004/08/xop/include` |
| xmime |`http://www.w3.org/2004/06/xmlmime`<br /><br /> `http://www.w3.org/2005/05/xmlmime` |
| dp |`http://schemas.microsoft.com/net/2006/06/duplex` |

## <a name="soap-11-and-soap-12"></a>SOAP 1.1 и SOAP 1.2

### <a name="envelope-and-processing-model"></a>Конверт и модель обработки
WCF реализует обработку конвертов SOAP 1.1 после базового профиля 1.1 (BP11) и Основного профиля 1.0 (SSBP10). Обработка конверта SOAP 1.2 реализована в соответствии со спецификацией SOAP12-Part1.

В этом разделе разъясняются некоторые варианты реализации, принятые WCF в отношении BP11 и SOAP12-Part1.

#### <a name="mandatory-header-processing"></a>Обработка обязательных заголовков
WCF следует правилам обработки `mustUnderstand` заголовков, отмеченных в спецификациях SOAP 1.1 и SOAP 1.2 со следующими вариациями.

Сообщение, входящее в стек канала WCF, обрабатывается отдельными каналами, настроенными на связанные элементы связывания, например кодирование текстовых сообщений, безопасность, надежное сообщение и транзакции. Каждый канал распознает заголовки из связанного пространства имен и помечает их как распознанные. После поступления сообщения в диспетчер модуль форматирования операций считывает заголовки, ожидаемые соответствующим контрактом сообщения/операции, и помечает их как распознанные. Затем диспетчер проверяет, не остались ли нераспознанные заголовки, помеченные как `mustUnderstand`, и создает исключение. Сообщения, содержащие заголовки `mustUnderstand` и предназначенные получателю, не обрабатываются кодом приложения получателя.

Такая многоуровневая обработка обеспечивает разделение уровней инфраструктуры и уровней приложения узла SOAP:

- B1111: Заголовки, которые не понятны, обнаруживаются после обработки сообщения стеком канала инфраструктуры WCF, но до того, как оно будет обработано приложением

     Значения заголовка `mustUnderstand` в SOAP 1.1 и SOAP 1.2 различаются. Профиль Basic Profile 1.1 требует, чтобы для сообщений SOAP 1.1 значение параметра `mustUnderstand` было равно 0 или 1. В спецификации SOAP 1.2 допускаются значения 0, 1, `false` и `true`, но рекомендуется использовать каноническое представление значений `xs:boolean` (`false`, `true`).

- B1112: WCF `mustUnderstand` излучает значения 0 и 1 для soap 1.1 и SOAP 1.2 версии конверта SOAP. WCF принимает все значение `xs:boolean` пространства `mustUnderstand` для заголовка (0, 1, `false`, `true`)

#### <a name="soap-faults"></a>Ошибки SOAP
Ниже приводится список wCF конкретных реализаций SOAP.

- B2121: WCF возвращает следующие коды неисправностей `s11:Client`SOAP `s11:Server`1.1: `s11:mustUnderstand`, и .

- B2122: WCF возвращает следующие коды неисправностей `s12:Sender`SOAP `s12:Receiver`1.2: `s12:MustUnderstand`, и .

### <a name="http-binding"></a>Привязка HTTP

#### <a name="soap-11-http-binding"></a>Привязка SOAP 1.1 HTTP
WCF реализует привязку SOAP1.1 HTTP в соответствии с разделом спецификации Basic Profile 1.1 3.4 со следующими разъяснениями:

- B2211: Служба WCF не осуществляет перенаправление запросов HTTP POST.

- B2212: Клиенты WCF поддерживают http Cookies в соответствии с 3.4.8.

#### <a name="soap-12-http-binding"></a>Привязка SOAP 1,2 HTTP
WCF реализует связывание SOAP 1.2 HTTP, как описано в спецификации SOAP 1.2-части 2 (SOAP12Part2) со следующими разъяснениями.

В SOAP 1.2 введен необязательный параметр действия для типа носителя `application/soap+xml`. Этот параметр полезен для оптимизации распределения сообщений без необходимости анализа тела сообщения SOAP, если не используется протокол WS-Addressing.

- R2221: параметр действия `application/soap+xml`, если он присутствует в запросе SOAP 1.2, должен соответствовать атрибуту `soapAction` элемента `wsoap12:operation` в соответствующей привязке WSDL.

- R2222: параметр действия `application/soap+xml`, если он присутствует в сообщении SOAP 1.2, должен соответствовать `wsa:Action`, если используется WS-Addressing 2004/08 или WS-Addressing 1.0.

Если привязка WS-Addressing отключена, а входящий запрос не содержит параметра действия, параметр `Action` сообщения считается неуказанным.

## <a name="ws-addressing"></a>WS-Addressing
WCF реализует 3 версии WS-Addressing:

- WS-Addressing 2004/08

- W3C Web Services Addressing 1.0 Core (ADDR10-CORE) и SOAP Binding (ADDR10-SOAP)

- WS-Addressing 1.0 ― метаданные

### <a name="endpoint-references"></a>Ссылки на конечные точки
Во всех версиях WS-Addressing, которые реализует WCF, используются ссылки на конечные точки для описания конечных точек.

#### <a name="endpoint-references-and-ws-addressing-versions"></a>Ссылки на конечные точки и версии WS-Addressing
WCF реализует ряд инфраструктурных протоколов, в которые используется `EndpointReference` WS-Addressing и, в частности, элемент и `W3C.WsAddressing.EndpointReferenceType` класс (например, WS-ReliableMessaging, WS-SecureConversation и WS-Trust). WCF поддерживает использование любой версии WS-Addressing с другими протоколами инфраструктуры. Конечные точки WCF поддерживают одну версию WS-Addressing на конечную точку.

Для R3111 пространство имен `EndpointReference` для элемента или типа, используемого в сообщениях, обмениваемых с конечной точкой WCF, должно соответствовать версии WS-Addressing, реализованной этой конечной точкой.

Например, если конечная точка WCF реализует WS-ReliableMessaging, `AcksTo` заголовок, `CreateSequenceResponse` возвращенный такой конечнейточкой внутри, использует версию WS-Addressing, которую `EncodingBinding` элемент определяет для этой конечной точки.

#### <a name="endpoint-references-and-metadata"></a>Ссылки на конечные точки и метаданные
В ряде сценариев требуется передача метаданных или ссылки на метаданные для определенной конечной точки.

B3121: WCF использует механизмы, описанные в разделе спецификации WS-MetadataExchange (MEX), для включения метаданных для конечных ссылок по стоимости или ссылке.

Рассмотрим сценарий, при котором служба WCF требует аутентификации с помощью токена `http://sts.fabrikam123.com`Language Sassertions Markup Language (SAML), выпущенного эмитентом токенов по адресу. Конечная точка WCF описывает это `sp:IssuedToken` требование проверки `sp:Issuer` подлинности, используя утверждение с вложенным утверждением, указывающим на эмитента токенов. Клиентское приложение, обращающееся к утверждению `sp:Issuer`, должно знать, как взаимодействовать с конечной точкой издателя маркера. Клиенту требуются метаданные об издателе маркера. Используя расширения метаданных конечных точек, определенные в MEX, WCF предоставляет ссылку на метаданные эмитента токенов.

```xml
<sp:IssuedToken>
  <sp:Issuer>
    <wsa10:Address>
      http://sts.fabrikam123.com
    </wsa10:Address>
    <wsa10:Metadata>
      <mex:Metadata>
        <mex:MetadataSection>
          <mex:MetadataReference>
            <wsa10:Address>
              http://sts.fabrikam123.com/mex
            </wsa10:Address>
          </mex:MetadataReference>
        </mex:MetadataSection>
      </mex:Metadata>
    </wsa10:Metadata>
  </sp:Issuer>
</sp:IssuedToken>
```

### <a name="message-addressing-headers"></a>Заголовки адресации сообщения

#### <a name="message-headers"></a>Заголовки сообщений
Для обеих версий WS-Addressing WCF использует следующие заголовки `wsa:To` `wsa:ReplyTo`сообщений, как это предписано спецификациями, `wsa:Action` `wsa:MessageID`и `wsa:RelatesTo`.

B3211: Для всех WS-Addressing версии, WCF отличием, но не производит из `wsa:FaultTo` `wsa:From`коробки, WS-Addressing заголовки сообщений и .

Приложения, взаимодействующие с приложениями WCF, могут добавлять эти заголовки сообщений, и WCF будет обрабатывать их соответствующим образом.

#### <a name="reference-parameters-and-properties"></a>Параметры и свойства ссылок

WCF осуществляет обработку конечных эталонных параметров и эталонных свойств в соответствии с соответствующими спецификациями.

B3221: При настройке для использования WS-Addressing 2004/08 конечные точки WCF не различают обработку справочных свойств и эталонных параметров.

### <a name="message-exchange-patterns"></a>Шаблоны обмена сообщениями
Последовательность сообщений, участвующих в вызове операции Web-сервиса, называется *шаблоном обмена сообщениями.* WCF поддерживает модели обмена односторонним, запрос-ответом и дуплексными схемами обмена сообщениями. В этом разделе поясняются требования WS-Addressing по обработке сообщений в зависимости от используемого шаблона обмена сообщениями.

В этом разделе первое сообщение отправляется запрашивающей стороной и принимается отвечающей стороной.

#### <a name="one-way-message"></a>Односторонний обмен сообщениями
Когда конечная точка WCF настроена для `Action` поддержки сообщений с данным, чтобы следовать односторонней модели, конечная точка WCF следует следующим поведениям и требованиям. Если не указано иное, поведение и правила применяются для обеих версий WS-Addressing, поддерживаемых в WCF:

- R3311: запрашивающая сторона должна включить `wsa:To`, `wsa:Action` и заголовки для всех ссылочных параметров, указанных ссылкой на конечную точку. Если используется WS-Addressing 2004/08 и ссылкой на конечную точку заданы [reference properties], в сообщение также должны быть включены соответствующие заголовки.

- B3312: запрашивающая сторона может включить заголовки `MessageID`, `ReplyTo` и `FaultTo`. Инфраструктура принимающей стороны не учитывает их, и они передаются в приложение.

- R3313: если используется HTTP и по ответному плечу HTTP не передается никакое сообщение, отвечающая сторона должна отправить ответ HTTP с пустым телом и кодом состояния HTTP 202.

     Если используется транспорт HTTP и в контракте операции объявлен односторонний обмен сообщениями, ответ HTTP все равно может использоваться для отправки инфраструктурных сообщений - например, протокол надежного обмена сообщениями может отправить сообщение `SequenceAcknowledgement` в ответе HTTP.

- B3314: Ответчик WCF не отправляет сообщение о неисправности в ответ на одностороннее сообщение.

#### <a name="request-reply"></a>Запрос-ответ
Когда конечная точка WCF настроена для `Action` сообщения с данным, чтобы следовать шаблону запроса-ответа, конечная точка WCF следует за поведением и требованиями ниже. Если не указано иное, поведение и правила применяются для обеих версий WS-Addressing, поддерживаемых в WCF:

- R3321: Запрашиваель должен включать `wsa:To` `wsa:Action`в `wsa:MessageID`запрос , и заголовки для всех эталонных параметров или эталонных свойств (или оба), указанные в конечном пункте ссылки.

- R3322: если используется WS-Addressing 2004/08, в запрос также должен быть включен параметр `ReplyTo`.

- R3323: При использовании WS-Addressing `ReplyTo` 1.0 и не присутствует в запросе, используется конечная `http://www.w3.org/2005/08/addressing/anonymous` точка по умолчанию с свойством «адрес», равным свойству.

- R3324: Запрашиваель `wsa:To`должен `wsa:Action`включать `wsa:RelatesTo` в себя и заголовки в ответном сообщении, а также заголовки для `ReplyTo` всех эталонных параметров или свойств ссылки (или оба), указанные в конечном пункте ссылки в запросе.

### <a name="web-services-addressing-faults"></a>Ошибки Web Services Addressing
R3411: WCF производит следующие неисправности, определенные WS-Addressing 2004/08.

| Код | Причина |
|----------|-----------|
| `wsa:DestinationUnreachable` | Поступило сообщение со значением `ReplyTo`, отличающимся от адреса ответа, установленного для данного канала; нет конечной точки, ожидающей передачи данных по адресу, указанному в заголовке «To». |
| `wsa:ActionNotSupported` | Каналы инфраструктуры или диспетчер, связанные с конечной точкой, не распознали действие, указанное в заголовке `Action`. |

R3412: WCF производит следующие неисправности, определяемые WS-Addressing 1.0.

| Код | Причина |
|----------|-----------|
| `wsa10:InvalidAddressingHeader` | `wsa:To`Дублировать `wsa:ReplyTo` `wsa:From` , `wsa:MessageID`, или . Дублировать `wsa:RelatesTo` с `RelationshipType`тем же . |
| `wsa10:MessageAddressingHeaderRequired` | Отсутствует обязательный заголовок адресации. |
| `wsa10:DestinationUnreachable` | Поступило сообщение со значением `ReplyTo`, отличающимся от адреса ответа, установленного для данного канала. Нет конечной точки, ожидающей передачи данных по адресу, указанному в заголовке «To». |
| `wsa10:ActionNotSupported` | Действие, указанное в заголовке `Action`, не распознано каналами инфраструктуры или диспетчером, связанным с конечной точкой. |
| `wsa10:EndpointUnavailable` | Канал надежного обмена сообщениями возвращает эту ошибку, указывающую на то, что конечная точка не обрабатывает последовательность на основании проверки заголовков адресов в сообщении `CreateSequence`. |

Код в предыдущих таблицах соответствует параметру `FaultCode` в SOAP 1.1 и параметру `SubCode` (с Code=Sender) в SOAP 1.2.

### <a name="wsdl-11-binding-and-ws-policy-assertions"></a>Привязка WSDL 1.1 и утверждения WS-Policy

#### <a name="indicating-use-of-ws-addressing"></a>Указание использования WS-Addressing
WCF использует утверждения политики для обозначения поддержки конечных точек для конкретной версии WS-Addressing.

Следующее утверждение политики имеет субъект политики конечной точки [WS-PA] и указывает, что в сообщениях, отправляемых и принимаемых с конечной точки, должна использоваться спецификация WS-Addressing 2004/08.

```xml
<wsap:UsingAddressing />
```

Это утверждение политики дополняет спецификацию WS-Addressing 2004/08.

Следующее утверждение политики указывает, что в отправляемых и принимаемых сообщениях должна использоваться спецификация WS-Addressing 1.0.

```xml
<wsam:Addressing/>
```

Следующее утверждение политики имеет субъект политики конечной точки [WS-PA] и указывает, что в сообщениях, отправляемых и принимаемых с конечной точки, должна использоваться спецификация WS-Addressing 2004/08.

```xml
<wsaw10:UsingAddressing />
```

Элемент `wsaw10:UsingAddressing` заимствован из [WS-Addressing-WSDL] и используется в контексте WS-Policy в соответствии с этой спецификацией, раздел 3.1.2.

Использование Addressing не изменяет семантики привязок WSDL 1.1, SOAP 1.1 и SOAP 1.2 HTTP. Например, если ожидается ответ на запрос, отправленный в конечную точку, использующую Addressing и привязку WSDL SOAP 1.x HTTP, ответ должен быть отправлен с помощью HTTP-ответа.

Для ответов, передаваемых с помощью HTTP-ответа, используется следующее утверждение WS-AM.

```xml
<wsam:AnonymousResponses/>
```

Полный код утверждения политики может выглядеть следующим образом.

```xml
<wsam:Addressing>
    <wsp:Policy>
        <wsam:AnonymousResponses />
    </wsp:Policy>
</wsam:Addressing>
```

Тем не менее при использовании некоторых схем обмена сообщениями удобно использовать два независимых HTTP-соединения, установленные между запрашивающей и отвечающей сторонами. Например, это позволяет принимать незапрошенные односторонние сообщения, отправленные отвечающей стороной.

WCF предлагает функцию, с помощью которой два основных транспортных канала могут образовывать канал Composite Duplex, где один канал используется для входных сообщений, а другой используется для выходных сообщений. В случае транспорта HTTP составной дуплексный канал обеспечивает два встречных HTTP-подключения. Запрашивающая сторона использует одно соединение для отправки сообщений отвечающей стороне, а отвечающая сторона использует другой канал для отправки сообщений обратно запрашивающей стороне.

Для ответов на отдельные запросы http используется следующее утверждение WS-AM.

```xml
<wsam:NonAnonymousResponses/>
```

Полный код утверждения политики может выглядеть следующим образом.

```xml
<wsam:Addressing>
    <wsp:Policy>
        <wsam:NonAnonymousResponses />
    </wsp:Policy>
</wsam:Addressing>
```

Использование следующего утверждения, содержащего субъект политики конечной точки [WS-PA], в конечных точках, в которых используются привязки WSDL 1.1 SOAP 1.x HTTP, требует двух отдельных встречных HTTP-соединений для передачи сообщений от запрашивающей стороны к отвечающей стороне и для передачи сообщений от отвечающей стороны к запрашивающей стороне соответственно.

```xml
<cdp:CompositeDuplex/>
```

Предыдущий оператор определяет следующие требования к заголовку `wsa:ReplyTo` для сообщений запроса.

- R3514: Запрос сообщений, отправленных `ReplyTo` в конечную `[address]` точку, `http://www.w3.org/2005/08/addressing/anonymous` должен иметь заголовок с свойством, не равным, если конечная `wsap10:UsingAddressing` точка `wsap:UsingAddressing` использует wsDL 1.1 SOAP 1.x HTTP привязки и имеет альтернативу политики с или утверждение в сочетании с `cdp:CompositeDuplex` прилагается.

- R3515: Запрос сообщений, отправленных `ReplyTo` в конечную `[address]` точку `http://www.w3.org/2005/08/addressing/anonymous`должен иметь `ReplyTo` заголовок с свойством, равным, или не иметь заголовок на всех, если `wsap10:UsingAddressing` конечная `cdp:CompositeDuplex` точка использует WSDL 1.1 SOAP 1.x HTTP связывания и имеет альтернативу политики с утверждением и не утверждение прилагается.

- R3516: Запрос сообщений, отправленных `ReplyTo` в конечную `[address]` точку, должен иметь заголовок с свойством, равным, `http://www.w3.org/2005/08/addressing/anonymous` если конечная `wsap:UsingAddressing` точка использует `cdp:CompositeDuplex` wsDL 1.1 SOAP 1.x HTTP привязки и имеет альтернативу политики с утверждением и не прилагается утверждение.

Спецификация WS-Addressing языка WSDL пытается описать аналогичные привязки протокола путем введения элемента `<wsaw:Anonymous/>` (раздел 3.2). К сожалению, такое определение элемента плохо подходит в качестве утверждения в контексте спецификации WS-Policy, так как оно требует специфичных для домена расширений, поддерживающих пересечение альтернатив, использующих такой элемент в качестве утверждения. Кроме того, такое определение элемента задает значение заголовка `ReplyTo` в противоположность поведению конечной точки в канале связи, что делает его специфичным для транспорта HTTP.

#### <a name="action-definition"></a>Определение действия
Спецификация WS-Addressing 2004/08 определяет атрибут `wsa:Action` для элементов `wsdl:portType/wsdl:operation/[wsdl:input | wsdl:output | wsdl:fault]`. Привязка WS-Addressing 1.0 WSDL (WS-ADDR10-WSDL) определяет аналогичный атрибут, `wsaw10:Action`.

Единственное отличие между этими двумя атрибутами заключается в семантике шаблона действия по умолчанию, описанной в разделе 3.3.2 спецификации WS-ADDR и в разделе 4.4.4 спецификации WS-ADDR10-WSDL соответственно.

Разумно иметь две конечные точки, которые `portType` имеют одинаковые (или контракт, в терминологии WCF), но с использованием различных версий WS-Addressing. Однако с учетом того, что действие определяется параметром `portType` и не должно изменяться между конечными точками, реализующими `portType`, одновременная поддержка обоих шаблонов действия по умолчанию становится невозможной.

Чтобы разрешить этот спор, WCF поддерживает `Action` единую версию атрибута.

B3521: WCF `wsaw10:Action` использует `wsdl:portType/wsdl:operation/[wsdl:input | wsdl:output | wsdl:fault]` атрибут на элементах, определенных в WS-ADDR10-WSDL, чтобы определить `Action` URI для соответствующих сообщений независимо от версии WS-Addressing, используемой конечной точкой.

#### <a name="use-endpoint-reference-inside-wsdl-port"></a>Использование ссылки на конечную точку внутри порта WSDL
Раздел 4.1 спецификации WS-ADDR10-WSDL расширяет элемент `wsdl:port`, включая в него дочерний элемент `<wsa10:EndpointReference…/>` для описания конечной точки в терминах WS-Addressing. WCF расширяет эту утилиту на WS-Addressing 2004/08, что позволяет `<wsa:EndpointReference…/>` появляться в качестве детского элемента `wsdl:port`.

- R3531: если к конечной точке прикреплена альтернативная политика с утверждением политики `<wsaw10:UsingAddressing/>``wsdl:port`.

- R3532: Если `wsdl:port` `<wsa10:EndpointReference …/>`элемент ребенка `wsa10:EndpointReference/wsa10:Address` содержит элемент ребенка, значение `@address` элемента `wsdl:port` / `wsdl:location` ребенка должно соответствовать значению атрибута элемента брата.

- R3533: если к конечной точке прикреплена альтернативная политика с утверждением политики `<wsap:UsingAddressing/>``wsdl:port`.

- R3534: Если `wsdl:port` `<wsa:EndpointReference …/>`элемент ребенка `wsa:EndpointReference/wsa:Address` содержит элемент ребенка, значение `@address` элемента `wsdl:port` / `wsdl:location` ребенка должно соответствовать значению атрибута элемента брата.

### <a name="composition-with-ws-security"></a>Сочетаемость с WS-Security
В соответствии с разделами спецификаций WS-ADDR и WS-ADDR10, посвященными вопросам безопасности, все заголовки адресации сообщения рекомендуется подписывать совместно с телом сообщения, чтобы связать их вместе.

Если для защиты целостности сообщения используется WS-Security, заголовки сообщения WS-Addressing, а также заголовки, связанные с параметрами или свойствами (или и тем, и другим) ссылки, должны быть подписаны совместно с телом сообщения.

### <a name="examples"></a>Примеры

#### <a name="one-way-message"></a>Односторонний обмен сообщениями
В этом сценарии отправитель отправляет одностороннее сообщение принимающей стороне. Используются SOAP 1.2, HTTP 1.1 и W3C WS-Addressing 1.0.

Структура сообщения запроса: заголовки сообщения содержат элементы `wsa10:To` и `wsa10:Action`. Тело сообщения содержит специфичный элемент `<app:Ping>` из пространства имен приложения.

HTTP Заголовки: Пункт назначения в POST `wsa10:To` соответствует URI в элементе.

Заголовок Content-Type имеет значение `application/soap+xml`, как требуется спецификацией SOAP 1.2. Присутствуют параметры `charset` и `action`. Параметр `action` заголовка Content-Type соответствует значению заголовка сообщения `wsa10:Action`.

```
POST http://fabrikam123.com/Service HTTP/1.1
Content-Type: application/soap+xml; charset=utf-8;  
              action="http://fabrikam123.com/Service/OneWay"
Host: 131.107.72.15
Content-Length: 1501
Expect: 100-continue
Proxy-Connection: Keep-Alive
<s12:Envelope>
  <s12:Header>
    <wsa10:To s12:mustUnderstand="1">
        http://fabrikam123.com/Service
    </wsa10:To>
    <wsa10:Action s12:mustUnderstand="1">
        http://fabrikam123.com/Service/OneWay
    </wsa10:Action>
  </s12:Header>
  <s12:Body>
    <Ping xmlns="http://fabrikam123.com/Service/">
      <Text>Hello World</Text>
    </Ping>
  </s12:Body>
</s12:Envelope>
```

Получающая сторона отвечает пустым ответом HTTP и состоянием 202. Пример ответа HTTP:

```
HTTP/1.1 202 Accepted
Date: Fri, 15 Jul 2005 08:56:07 GMT
Server: Microsoft-IIS/6.0
MicrosoftOfficeWebServer: 5.0_Pub
X-Powered-By: ASP.NET
X-AspNet-Version: 2.0.50215
Cache-Control: private
Content-Length: 0
```

## <a name="soap-message-transmission-optimization-mechanism"></a>Механизм оптимизации передачи сообщений SOAP
В этом разделе описаны детали реализации WCF для HTTP SOAP MTOM. Технология MTOM — это механизм кодирования сообщений SOAP того же класса, что и традиционное кодирование текста/XML или кодирование двоичного кодирования WCF. MTOM включает в себя следующие компоненты.

- Кодировка XML и механизм упаковки, описываемый [XOP], который оптимизирует информационные элементы XML, содержащие двоичные данные в кодировке base64, в отдельные двоичные части.

- Инкапсуляция MIME пакета XOP, которая сериализует набор сведений XML и каждую двоичную часть пакета XOP в отдельную часть MIME.

- Кодирование MIME XOP, примененное к конверту SOAP 1.x.

- Привязка транспорта HTTP.

Можно использовать MTOM с не-HTTP транспорты с WCF. Однако этот раздел посвящен HTTP.

Формат MTOM построен на основе большого количества спецификаций, охватывающих сам механизм MTOM, XOP и MIME. Модульность этого набора спецификаций затрудняет реконструкцию точных требований к формату и семантике обработки. В этом разделе описываются формат и требования к обработке для привязки MTOM HTTP.

### <a name="mtom-message-encoding"></a>Кодирование сообщений MTOM

#### <a name="generating-mtom-messages"></a>Создание сообщений MTOM
В спецификации [XOP], раздел 3.1, описывается процесс кодирования XML с информационными единицами элемента, содержащими base64-значения, в абстрактно определенный пакет XOP.

Приведенная ниже последовательность этапов описывает специфичный для MTOM процесс кодирования.

1. Убедитесь, что конверт SOAP, который будет закодирован, `[local name]` не `Include`содержит элемента `[namespace name]` информации `http://www.w3.org/2004/08/xop/include` с a и a .

2. Создайте пустой пакет MIME.

3. Определите в исходном наборе сведений XML информационные единицы элементов, подлежащие оптимизации. Для оптимизации элементов символы, составляющие `[children]` элемент элемента, должны находиться в `xs:base64Binary` канонической форме (см. XSD-2, 3.2.16 base64Binary) и не должны содержать никаких символов белого пространства, предшествующих, содержащимся в небелом пространстве или следуя ему.

4. Создайте конверт XOP SOAP, являющийся копией исходного конверта SOAP, но в котором дочерние элементы всех информационных единиц элементов, определенных на предыдущем шаге, заменены информационной единицей элементов `xop:Include`, построенной следующим образом:

    1. Преобразуйте замененные символы в двоичные данные, обработав их как данные в кодировке base64.

    2. Создайте уникальное значение заголовка Content-ID, удовлетворяющее требованиям R3133 и R3134.

    3. Создайте заголовок Content-Transfer-Encoding MIME со значением binary.

    4. Если оптимизируемая информационная единица элемента ([parent] вновь вставленной информационной единицы `xop:Include`) имеет информационную единицу атрибута `xmime:contentType`, создайте заголовок Content-Type MIME со значением атрибута `xmime:contentType`.

    5. Создайте новую двоичную часть MIME с содержимым, образованным двоичными данными, декодированными из замененных символов, обработанных как base64, заголовка Content-ID из шага 4b, заголовка Content-Transfer-Encoding из шага 4c, заголовка Content-Type, если он создан в шаге 4d.

    6. Добавьте атрибут `href` в элемент `xop:Include` со значением cid: uri, полученным из значения заголовка Content-ID, созданного на шаге 4b. Удалите прилагающие символы "и"\<>, URL-побег оставшейся `cid:`строки и добавьте префикс. В соответствии с RFC1738 и RFC2396 в escape-последовательности должен преобразовываться указанный ниже минимальный набор символов. Возможно преобразование в escape-символы и других символов.

        ```
        Hexadecimal 00-1F , 7F, 20, "<" | ">" | "#" | "%" | <">
        "{" | "}" | "|" | "\" | "^" | "[" | "]" | "`" | "~" | "^"
        ```

5. Создайте корневую часть MIME с конвертом XOP SOAP из шага 4.

6. Запишите заголовки HTTP, включая заголовок HTTP Content-Type.

7. Запишите пакет MIME.

#### <a name="processing-mtom-messages"></a>Обработка сообщений MTOM
Обработка сообщения MTOM производится точно в обратном порядке по сравнению с процессом, описанном в предыдущем разделе «Создание сообщений MTOM».

1. Убедитесь, что корневая часть MIME имеет Content-Type `application/xop+xml`.

2. Постройте конверт SOAP, проанализировав корневую часть MIME пакета как документ XML. Кодировка символов определяется параметром `charset` заголовка Content-Type корневой части MIME.

3. Для каждой информационной единицы элементов в построенном конверте SOAP, которая имеет, как единственный член своего свойства [children], информационную единицу элемента `xop:Include`:

    1. Удалите префикс `cid:` и выполните обратное преобразование из escape-представления всех escape-последовательностей универсального кода ресурса (URI) (RFC 2396) в значении атрибута `@href` элемента `xop:Include`. Приложить строку результата\<в ", ">".

    2. Найдите часть MIME в значении заголовка Content-ID, соответствующую строке, полученной на шаге 3a.

    3. Замените информационную единицу элемента `xop:Include`, имеющуюся в свойстве `children` каждой единицы, информационными единицами символов, представляющими каноническую кодировку base64 (см. XSD-2, 3.2.16 base64Binary) тела сущности части MIME, указанной в шаге 3b (эффективно это означает, что надо заменить информационную единицу элемента `xop:Include` данными, восстановленными из части пакета).

#### <a name="http-content-type-header"></a>Заголовок HTTP Content-Type
Ниже приводится список разъяснений WCF для формата заголовка HTTP Content-Type закодированного сообщения SOAP 1.x MTOM, полученного из требований, изложенных в самой спецификации MTOM, и полученных из MTOM и RFC 2387.

- R4131: заголовок HTTP Content-Type должен иметь значение multipart/related (без учета регистра) с параметрами. В именах параметров регистр не учитывается. Порядок параметров не имеет значения.

- Полная форма Бэкуса-Наура (BNF) заголовка Content-Type для сообщений MIME указана в RFC 2045, раздел 5.1.

- R4132: заголовок HTTP Content-Type должен иметь параметр type со значением `application/xop+xml`, заключенным в двойные кавычки.

Хотя требование об использовании двойных кавычек не является явным в RFC 2387, в тексте отмечается,\@что все параметры мультичасти/связанного типа мультимедиа, скорее всего, содержат зарезервированные символы, такие как "" или "/" и поэтому нуждаются в двойных кавычках.

- R4133: заголовок HTTP Content-Type должен иметь параметр start со значением заголовка Content-ID части MIME, содержащей конверт SOAP 1.x, заключенным в двойные кавычки. Если параметр start опущен, первая часть MIME должна содержать конверт SOAP 1.x.

- R4134: заголовок HTTP Content-Type для сообщения с кодировкой SOAP 1.1 MTOM должен содержать параметр start-info со значением text/xml, заключенным в двойные кавычки.

- R4135: заголовок HTTP Content-Type для сообщения с кодировкой SOAP 1.2 MTOM должен содержать параметр start-info со значением `application/soap+xml`, заключенным в двойные кавычки.

- R4136: заголовок HTTP Content-Type для сообщения с кодировкой SOAP 1.x MTOM должен содержать параметр boundary со значением (заключенным в двойные кавычки), соответствующим границе MIME BNF, определенной в спецификации RFC 2046, раздел 5.1.1.

    ```
    boundary := 0*69<bchars> bcharsnospace
    bchars := bcharsnospace / " "
    bcharsnospace :=    DIGIT / ALPHA / "'" / "(" / ")" / "+"
                        / "_" / "," / "-" / "." / "/" / ":" / "=" / "?"
    ```

     Примеры:

     ПРАВИЛЬНО

    ```
    Content-Type: multipart/related; type="application/xop+xml";start=" <part0@tempuri.org>";boundary="uuid:0ca0e16e-feb1-426c-97d8-c4508ada5e82+id=1";start-info="text/xml"
    ```

     ПРАВИЛЬНО

    ```
    Content-Type: Multipart/Related; type="application/xop+xml";start-info="text/xml";boundary="uuid:0ca0e16e-feb1-426c-97d8-c4508ada5e82+id=1"
    ```

     НЕПРАВИЛЬНО

    ```
    Content-Type: Multipart/Related; type=application/xop+xml;start=" <part0@tempuri.org>";start-info="text/xml";boundary="uuid:0ca0e16e-feb1-426c-97d8-c4508ada5e82+id=1"
    ```

#### <a name="infoset-mime-part"></a>Часть Infoset MIME
Конверт SOAP 1.x инкапсулируется как корневая часть пакета XOP MIME и часто называется частью `infoset`.

- R4141: конверт SOAP 1.x должен быть инкапсулирован как корневая часть пакета XOP MIME, называемая частью `infoset`, ссылка на которую содержится в заголовке HTTP Content-Type.

- R4142: часть SOAP `Infoset` должна содержать следующие заголовки MIME: `Content-ID`, `Content-Transfer-Encoding` и `Content-Type`.

Формат заголовка Content-ID определяется в RFC 2045 как

```
"Content-ID" ":" msg-id
```

где `msg-id` определяется в RFC 2822 (которая заменяет RFC 822, указанную в RFC 2045) следующим образом:

```
msg-id    =       [CFWS] "<" id-left "@" id-right ">" [CFWS]
```

и фактически адрес электронной почты прилагается в "\<и ">". Префикс и суффикс `[CFWS]` были добавлены в RFC 2822 для внесения комментариев и не должны использоваться, чтобы не нарушать совместимость.

R4143: значение заголовка Content-ID для части Infoset MIME должно задаваться в соответствии с правилами для `msg-id` из RFC 2822 без частей с префиксом и суффиксом `[CFWS]`.

Ряд реализаций MIME смягчил требования к значению, приложенному в "и"\<> как адрес электронной почты и используемый `absoluteURI` в ",\<">" в дополнение к адресу электронной почты. В этой версии WCF используются значения заголовок формы Content-ID MIME:

```
Content-ID: <http://tempuri.org/0>
```

R4144: процессоры MTOM должны воспринимать значения заголовка Content-ID, соответствующие следующему ослабленному требованию к `msg-id`.

```
msg-id-relaxed =     [CFWS] "<" (absoluteURI | mail-address) ">" [CFWS]
mail-address   =     id-left "@" id-right
```

В MIME (RFC 2045) предусмотрен заголовок Content-Transfer-Encoding для сообщения о кодировке содержимого части MIME. По умолчанию для Content-Transfer-Encoding задано значение 7-bit, которое не подходит для большинства сообщений SOAP, поэтому для расширения совместимости требуется заголовок Content-Transfer-Encoding:

- R4145: часть SOAP Infoset должна содержать заголовок Content-Transfer-Encoding.

- R4146: если для конверта SOAP принята кодировка символов UTF-8, значение заголовка Content-Transfer-Encoding должно быть 8-bit.

- R4147: если для конверта SOAP принята кодировка символов UTF-16, значение заголовка Content-Transfer-Encoding должно быть binary.

- В соответствии с [XOP], раздел 5,

- R4148: часть INFOset SOAP1.1 должна содержать заголовок Content-Type с приложением типа мультимедиа/xop-xml и типом параметров

    ```
    Content-Type: application/xop+xml;
                  charset=utf-8;type="text/xml"
    ```

- R4149: Часть SOAP 1.2 Infoset должна содержать заголовок `application/xop+xml` Content-Type с`application/soap+xml`типом `charset`мультимедиа и типом параметров» и .

    ```
    Content-Type: application/xop+xml;
                  charset=utf-8;type="application/soap+xml"
    ```

     Хотя в XOP параметр `charset` для `application/xop+xml` определяется как необязательный, он необходим для совместимости, аналогично требованию BP 1.1 к параметру `charset` для типа носителя `text/xml`.

- R41410: в заголовке Content-Type части SOAP 1.x Infoset должны присутствовать параметры `type` и `charset`.

#### <a name="wcf-endpoint-support-for-mtom"></a>Поддержка MTOM конечной точкой WCF
Целью механизма MTOM является кодирование сообщения SOAP для оптимизации данных с кодировкой base64. Ниже приведен список ограничений.

- R4151: любая информационная единица элемента, содержащая данные в кодировке base64, может быть оптимизирована.

- B4152: WCF оптимизирует элементы информации элементов, которые содержат базовые 64 закодированные данные и превышают 1024 байтов по длине.

Конечная точка WCF, настроенная на использование MTOM, всегда будет отправлять закодированные MTOM сообщения. Даже если ни одна из частей не удовлетворяет требуемым критериям, сообщение все равно является MTOM-кодированным (сериализованным в виде пакета MIME с единственной частью MIME, содержащей конверт SOAP).

### <a name="ws-policy-assertion-for-mtom"></a>Утверждение WS-Policy для MTOM
WCF использует следующее утверждение политики для обозначения использования MTOM по конечной точке:

```xml
<wsoma:OptimizedMimeSerialization ... />
```

- R4211: предыдущее утверждение политики содержит субъект политики конечной точки и указывает, что все сообщения, отправляемые на конечную точку и получаемые от нее, должны быть оптимизированы с помощью MTOM.

- B4212: При настройке для оптимизации MTOM конечная точка WCF добавляет утверждение политики MTOM к политике, прилагаемый к соответствующему. `wsdl:binding`

### <a name="composition-with-ws-security"></a>Сочетаемость с WS-Security
MTOM является механизмкодирования, который похож `text/xml` на и WCF Binary XML. MTOM обеспечивает естественную сочетаемость с протоколом WS-Security и другими протоколами WS-*: сообщение, защищенное с помощью протокола WS-Security, может быть оптимизировано с помощью MTOM.

### <a name="examples"></a>Примеры

#### <a name="wcf-soap-11-message-encoded-using-mtom"></a>Сообщение WCF SOAP 1.1, закодированное с помощью MTOM

```
POST http://131.107.72.15/Mtom/svc/service.svc/Soap11MtomUTF8 HTTP/1.1
SOAPAction: "http://xmlsoap.org/echoBinaryAsString"
Content-Type: multipart/related;type="application/xop+xml";
              start="<http://tempuri.org/0>";start-info="text/xml";
       boundary="uuid:0ca0e16e-feb1-426c-97d8-c4508ada5e82+id=1"
Host: 131.107.72.15
Content-Length: 1501
--uuid:0ca0e16e-feb1-426c-97d8-c4508ada5e82+id=1
Content-ID: <http://tempuri.org/0>
Content-Transfer-Encoding: 8bit
Content-Type: application/xop+xml;charset=utf-8;type="text/xml"
<s:Envelope xmlns:s="http://schemas.xmlsoap.org/soap/envelope/">
  <s:Body>
    <EchoBinaryAsString xmlns="http://xmlsoap.org/Ping">
      <array>
        <xop:Include
         href="cid:http%3A%2F%2Ftempuri.org%2F1%2F632618206521093670"
         xmlns:xop="http://www.w3.org/2004/08/xop/include"/>
      </array>
    </EchoBinaryAsString>
  </s:Body>
</s:Envelope>
--uuid:0ca0e16e-feb1-426c-97d8-c4508ada5e82+id=1
Content-ID: <http://tempuri.org/1/632618206521093670>
Content-Transfer-Encoding: binary
Content-Type: application/octet-stream
…Binary Content..
--uuid:0ca0e16e-feb1-426c-97d8-c4508ada5e82+id=1
```

#### <a name="wcf-secure-soap-12-message-encoded-using-mtom"></a>Безопасное сообщение WCF SOAP 1.2, закодированное с помощью MTOM
В этом примере с помощью MTOM и SOAP 1.2 кодируется сообщение, защищенное с помощью протокола WS-Security. Двоичные части, указанные для кодирования, являются содержимым элементов `BinarySecurityToken`, `CipherValue` элемента `EncryptedData`, соответствующих зашифрованной подписи и зашифрованному телу. Обратите внимание, что `CipherValue` из не `EncryptedKey` был определен для оптимизации WCF, потому что его длина меньше, чем 1024 байтов.

```
POST http://131.107.72.15/Mtom/service.svc/Soap12MtomSecureSignEncrypt HTTP/1.1
Content-Type: multipart/related; type="application/xop+xml";
              start="<http://tempuri.org/0>";
            boundary="uuid:0ca0e16e-feb1-426c-97d8-c4508ada5e82+id=3";
              start-info="application/soap+xml";
              action="http://xmlsoap.org/echoBinaryAsString"
Host: 131.107.72.15
Content-Length: 1941
--uuid:0ca0e16e-feb1-426c-97d8-c4508ada5e82+id=3
Content-ID: <http://tempuri.org/0>
Content-Transfer-Encoding: 8bit
Content-Type: application/xop+xml;charset=utf-8;type="application/soap+xml"
<s:Envelope xmlns:s="http://schemas.xmlsoap.org/soap/envelope/" xmlns:u="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd">
  <s:Header>
    <o:Security s:mustUnderstand="1" xmlns:o="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd">
      <u:Timestamp u:Id="uuid-4d4ee765-5717-4d53-9ac9-99bddc07df6c-5">
        <u:Created>2005-09-09T06:57:32.488Z</u:Created>
        <u:Expires>2005-09-09T07:02:32.488Z</u:Expires>
      </u:Timestamp>
      <o:BinarySecurityToken u:Id="uuid-4d4ee765-5717-4d53-9ac9-99bddc07df6c-2" ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3" EncodingType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0#Base64Binary">
        <xop:Include href="cid:http%3A%2F%2Ftempuri.org%2F1%2F632618206525089430" xmlns:xop="http://www.w3.org/2004/08/xop/include"/>
      </o:BinarySecurityToken>
      <e:EncryptedKey Id="_1" xmlns:e="http://www.w3.org/2001/04/xmlenc#">
        <e:EncryptionMethod Algorithm="http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p"/>
        <KeyInfo xmlns="http://www.w3.org/2000/09/xmldsig#">
          <o:SecurityTokenReference>
            <o:KeyIdentifier ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509SubjectKeyIdentifier">Xeg55vRyK3ZhAEhEf+YT0z986L0=</o:KeyIdentifier>
          </o:SecurityTokenReference>
        </KeyInfo>
        <e:CipherData>          <e:CipherValue>oQfpxwT8/SAGyZQzKE2b4yO6dXuQj7pwJ+5CGL3Rf7C06bQ5ttMoQ9GLJcQYkXTzin+WwHEgs5bj5ml9HKTW9QAU5JJ6lksdymmQvWP5ZtGPBVchO4sofEGoCKmBiZL/DYS/cnbzgnc/3a6NYnc10y2fWGaGLiqa00zijAw7o0Y=</e:CipherValue>
        </e:CipherData>
      </e:EncryptedKey>
      <c:DerivedKeyToken u:Id="_2" xmlns:c="http://schemas.xmlsoap.org/ws/2005/02/sc">
        <o:SecurityTokenReference>
          <o:Reference URI="#_1"/>
        </o:SecurityTokenReference>
        <c:Nonce>OrEPRX7fISIS4sXYWPMv3g==</c:Nonce>
      </c:DerivedKeyToken>
      <e:ReferenceList xmlns:e="http://www.w3.org/2001/04/xmlenc#">
        <e:DataReference URI="#_3"/>
        <e:DataReference URI="#_4"/>
      </e:ReferenceList>
      <e:EncryptedData Id="_4" Type="http://www.w3.org/2001/04/xmlenc#Element" xmlns:e="http://www.w3.org/2001/04/xmlenc#">
        <e:EncryptionMethod Algorithm="http://www.w3.org/2001/04/xmlenc#aes256-cbc"/>
        <KeyInfo xmlns="http://www.w3.org/2000/09/xmldsig#">
          <o:SecurityTokenReference>
            <o:Reference URI="#_2"/>
          </o:SecurityTokenReference>
        </KeyInfo>
        <e:CipherData>
          <e:CipherValue>
            <xop:Include href="cid:http%3A%2F%2Ftempuri.org%2F2%2F632618206525089430" xmlns:xop="http://www.w3.org/2004/08/xop/include"/>
          </e:CipherValue>
        </e:CipherData>
      </e:EncryptedData>
    </o:Security>
  </s:Header>
  <s:Body u:Id="_0">
    <e:EncryptedData Id="_3" Type="http://www.w3.org/2001/04/xmlenc#Content" xmlns:e="http://www.w3.org/2001/04/xmlenc#">
      <e:EncryptionMethod Algorithm="http://www.w3.org/2001/04/xmlenc#aes256-cbc"/>
      <KeyInfo xmlns="http://www.w3.org/2000/09/xmldsig#">
        <o:SecurityTokenReference xmlns:o="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd">
          <o:Reference URI="#_2"/>
        </o:SecurityTokenReference>
      </KeyInfo>
      <e:CipherData>
        <e:CipherValue>
          <xop:Include href="cid:http%3A%2F%2Ftempuri.org%2F3%2F632618206525089430" xmlns:xop="http://www.w3.org/2004/08/xop/include"/>
        </e:CipherValue>
      </e:CipherData>
    </e:EncryptedData>
  </s:Body>
</s:Envelope>
--uuid:0ca0e16e-feb1-426c-97d8-c4508ada5e82+id=3
Content-ID: <http://tempuri.org/1/632618206525089430>
Content-Transfer-Encoding: binary
Content-Type: application/octet-stream
...Binary content of BinarySecurityToken - X509 Certificate...
--uuid:0ca0e16e-feb1-426c-97d8-c4508ada5e82+id=3
Content-ID: <http://tempuri.org/2/632618206525089430>
Content-Transfer-Encoding: binary
Content-Type: application/octet-stream
...Binary serialization of the encrypted primary signature...
--uuid:0ca0e16e-feb1-426c-97d8-c4508ada5e82+id=3
Content-ID: <http://tempuri.org/3/632618206525089430>
Content-Transfer-Encoding: binary
Content-Type: application/octet-stream
...Binary serialization of the encrypted Body...
--uuid:0ca0e16e-feb1-426c-97d8-c4508ada5e82+id=3--
```
