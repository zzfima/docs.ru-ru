---
title: Общие сведения о службах рабочих процессов
ms.date: 03/30/2017
ms.assetid: e536dda3-e286-441e-99a7-49ddc004b646
ms.openlocfilehash: cb013dd419d09af61eaff290709164427b1b655f
ms.sourcegitcommit: 30a558d23e3ac5a52071121a52c305c85fe15726
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/25/2019
ms.locfileid: "75347866"
---
# <a name="workflow-services-overview"></a>Общие сведения о службах рабочих процессов

Службы рабочих процессов — это службы на основе WCF, которые реализуются с помощью рабочих процессов. Службы рабочих процессов — это рабочие процессы, которые используют действия обмена сообщениями для отправки и получения сообщений Windows Communication Foundation (WCF). В.NET Framework 4.5 появилось несколько действий обмена сообщениями, позволяющих отправлять и получать сообщения из рабочего процесса. Дополнительные сведения о действиях обмена сообщениями и о том, как их можно использовать для реализации различных шаблонов обмена сообщениями, см. в разделе [действия обмена](messaging-activities.md)сообщениями.

## <a name="benefits-of-using-workflow-services"></a>Преимущества использования служб рабочих процессов

По мере возрастания распределения приложений отдельные службы становятся ответственными за вызов других служб для передачи им некоторой части работы. Реализация таких вызовов в виде асинхронных операций в коде представляет некоторую сложность. Обработка ошибок добавляет некоторую сложность в форме обработки исключений и обеспечения подробных сведений об отслеживании. Довольно часто некоторые службы являются длительными и занимают ценные системные ресурсы при ожидании ввода. Вследствие этих причин распределенные приложения часто являются очень сложными и их трудно разрабатывать и поддерживать. Рабочие процессы являются естественным способом координации асинхронной работы, особенно вызовов внешних служб. Рабочие процессы также достаточно эффективны при представлении длительных бизнес-процессов. Эти качества делают рабочий процесс великолепным активом для построения служб в распределенной среде.

## <a name="implementing-a-workflow-service"></a>Реализация службы рабочего процесса

При реализации службы WCF вы определяете несколько контрактов, описывающих службу и данные, которые она отправляет и получает. Данные, представленные в виде контрактов данных и сообщений. Службы WCF и службы рабочих процессов используют контракты данных и определения контрактов сообщений как часть описаний служб. Служба сама предоставляет метаданные (в форме WSDL) для описания операций службы. В WCF контракты службы и операций определяют службу и операции, которые она поддерживает. Однако в службе рабочего процесса эти контракты являются частью самого бизнес-процесса. Они поставляются в метаданные процессом, называемым выводом контракта. При размещении службы рабочего процесса с использованием <xref:System.ServiceModel.Activities.WorkflowServiceHost> просматривается определение рабочего процесса и формируется контракт на основе набора действий по отправке и получению сообщений, обнаруженных в рабочем процессе. В частности, для создания контракта используются следующие действия и свойства:

Действие <xref:System.ServiceModel.Activities.Receive>

- <xref:System.ServiceModel.Activities.Receive.ServiceContractName%2A>

- <xref:System.ServiceModel.Activities.Receive.OperationName%2A>

- <xref:System.ServiceModel.Activities.Receive.Action%2A>

Действие <xref:System.ServiceModel.Activities.SendReply>

- <xref:System.ServiceModel.Activities.SendReply.Action%2A>

Действие <xref:System.ServiceModel.Activities.TransactedReceiveScope>

Конечным результатом вывода контракта является описание службы, использующее те же структуры данных, что и службы WCF и контракты операций. Затем эти сведения используются для предоставления WSDL для службы рабочего процесса.

> [!NOTE]
> [!INCLUDE[netfx_current_short](../../../../includes/netfx-current-short-md.md)] не позволяет писать службы рабочего процесса с использованием существующего определения контракта без дополнительных средств разработки. Контракты служб рабочих процессов создаются посредством процесса вывода, который был рассмотрен ранее. Контракты сообщений и данных, тем не менее, полностью поддерживаются.

## <a name="workflow-services-and-msmq-based-bindings"></a>Службы рабочих процессов и привязки на основе MSMQ

WCF определяет две привязки на основе очереди сообщений (MSMQ) - <xref:System.ServiceModel.NetMsmqBinding> и <xref:System.ServiceModel.MsmqIntegration.MsmqIntegrationBinding>.  Привязки на основе очереди сообщений (MSMQ) часто используются со службами рабочих процессов, что связано с продолжительностью работы таких служб. Привязки на основе очереди сообщений (MSMQ) имеют свойство `ValidityDuration`, определяющее срок, в течение которого сообщения MSMQ считаются достоверными. Из-за длительного срока работы служб рабочих процессов возможно, что длительность достоверности сообщения MSMQ закончится до того, как служба рабочих процессов сможет его обработать. Поэтому очень важно задать для длительности достоверности привязки MSMQ подходящее значение. Это значение должно выбираться на основе рабочего процесса и способа, с помощью которого он обрабатывает сообщения. Например, если имеется рабочий процесс с действием <xref:System.ServiceModel.Activities.Receive>, сопровождаемым пользовательским действием, которое выполняется 10 минут, и действием <xref:System.ServiceModel.Activities.Receive>, правильное значение `ValidityDuration` должно превышать 10 минут.

## <a name="hosting-a-workflow-service"></a>Размещение службы рабочего процесса

Как и службы WCF, необходимо размещать службы рабочих процессов. Службы WCF используют класс <xref:System.ServiceModel.ServiceHost> для размещения служб и служб рабочих процессов, которые используют <xref:System.ServiceModel.Activities.WorkflowServiceHost> для размещения служб. Как и службы WCF, службы рабочих процессов могут размещаться различными способами, например:

- В управляемом .NET Framework приложении.

- В службах IIS.

- в службе WAS;

- в управляемой службе Windows.

Службы рабочего процесса, размещенные в управляемом .NET Framework приложении или управляемой службе Windows, создают экземпляр класса <xref:System.ServiceModel.Activities.WorkflowServiceHost> и передают ему экземпляр <xref:System.ServiceModel.Activities.WorkflowService>, содержащий определение рабочего процесса в свойстве <xref:System.ServiceModel.Activities.WorkflowService.Body%2A>. Определение рабочего процесса, содержащее действия обмена сообщениями, предоставлено службой рабочего процесса.

Для размещения службы рабочего процесса в IIS или WAS поместите XAMLX-файл, содержащий определение службы рабочего процесса, в виртуальный каталог. Конечная точка по умолчанию (с использованием <xref:System.ServiceModel.BasicHttpBinding>) создается автоматически. Дополнительные сведения см. в разделе [упрощенная конфигурация](../../../../docs/framework/wcf/simplified-configuration.md). Также для указания собственных конечных точек можно разместить файл Web.config в виртуальном каталоге. Если определение рабочего процесса находится в сборке, то можно разместить SVC-файл в виртуальном каталоге, а сборку рабочего процесса в каталоге с кодом приложения. SVC-файл должен указывать фабрику узла службы и класс, реализующий службу рабочего процесса. В следующем примере показан способ указания фабрики узла службы и класса, реализующего службу рабочего процесса.

```
<%@ServiceHost Factory=" System.ServiceModel.Activities.Activation.WorkflowServiceHostFactory
Service="EchoService"%>
```
