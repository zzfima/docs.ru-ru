---
title: "Рекомендации по работе с надежными сеансами"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: b94f6e01-8070-40b6-aac7-a2cb7b4cb4f2
caps.latest.revision: "6"
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.workload: dotnet
ms.openlocfilehash: c022db62103826aa89e9035fd36c050d1f7c0f84
ms.sourcegitcommit: 16186c34a957fdd52e5db7294f291f7530ac9d24
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/22/2017
---
# <a name="best-practices-for-reliable-sessions"></a>Рекомендации по работе с надежными сеансами

В этом разделе приводятся рекомендации для надежных сеансов.

## <a name="setting-maxtransferwindowsize"></a>Установка MaxTransferWindowSize

Надежные сеансы в [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] используют окно передачи для хранения сообщений в клиенте или в службе. Настраиваемое свойство <xref:System.ServiceModel.Channels.ReliableSessionBindingElement.MaxTransferWindowSize%2A> указывает количество сообщений, которое может храниться в окне передачи.

На стороне отправителя это указывает количество сообщений, которые могут храниться в окне передачи во время ожидания подтверждения; на стороне получателя оно указывает количество сообщений в буфер для службы.

Выбор правильного размера влияет на эффективность работы сети и оптимальную производительность службы. В следующих разделах подробно, что следует учитывать при выборе значения для этого свойства, а также влияние значения.

Размер окна передачи по умолчанию — восемь сообщения.

### <a name="efficient-use-of-the-network"></a>Эффективное использование сети

В этом контексте термин *сети* соответствует всему, что используется в качестве основы связи между клиентом (отправителем) и службой (получателем). Сюда входят подключения транспорта и любые посредника или мосты между ними, включая маршрутизаторы SOAP или HTTP-прокси-серверы или брандмауэры.

Эффективное использование сети обеспечивает максимальные возможности сети. Объем данных, передаваемых по сети в секунду (*скорость передачи данных*) и время, необходимое для передачи данных от отправителя к получателю (*задержки*) повлиять на эффективность сети используется.

На стороне отправителя свойство <xref:System.ServiceModel.Channels.ReliableSessionBindingElement.MaxTransferWindowSize%2A> указывает количество сообщений, которое может храниться в его окне передачи во время ожидания подтверждения. Если Высокая задержка сети и для обеспечения ответа отправителя и эффективного использования сети, следует увеличить размер окна передачи.

Например даже, если отправитель поддерживает скорость передачи данных, задержка может быть высокой, если существует несколько посредников между отправителем и получателем, или необходимо передать данные через посредника потерь или сеть. Таким образом отправитель должен ждать подтверждения сообщений в его окне передачи, прежде чем принимать новые сообщения для отправки по сети. Чем меньше буфер с большой задержкой, тем менее эффективными использования сети. С другой стороны слишком большой размер окна передачи может повлиять службы, так как служба может потребоваться Догнать высокую скорость данных, отправленных клиентом.

### <a name="running-the-service-to-capacity"></a>Выполнение службы с оптимальной производительностью

Настолько, насколько эффективно ни использовалась сеть, в идеальном случае требуется выполнение службы с максимальной производительностью. Свойство размера окна передачи на стороне получателя указывает количество сообщений, которое получатель может поместить в буфер. Такая буферизация сообщений помогает не только управлять потоком в сети, но и обеспечивает выполнение службы с максимальной производительностью. Например, если буфер одно сообщение, а сообщения прибывают быстрее, чем их обработки службой затем сети могут удалять сообщения и емкости может напрасно или неполностью.

При использовании буфера повышается доступность службы, как она одновременно получает и помещает в буфер сообщение во время обработки полученных ранее сообщений.

Рекомендуется использовать одинаковый `MaxTransferWindowSize` на отправителя и получателя.

### <a name="enabling-flow-control"></a>Включение управления потоком

*Поток управления* — это механизм, который гарантирует, что отправитель и получатель не отставать друг с другом, т. е. сообщения принимаются и ответных быстрое время они созданы. Размер окна передачи со стороны клиента и службы гарантирует, что отправитель и получатель находятся в разумном окне синхронизации.

Настоятельно рекомендуется задать для свойства <xref:System.ServiceModel.Channels.ReliableSessionBindingElement.FlowControlEnabled%2A> для `true` при использовании надежного сеанса между [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] клиента и [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] службы.

## <a name="setting-maxpendingchannels"></a>Установка MaxPendingChannels

При написании службы, обеспечивающей надежный сеанс передачи данных от разных клиентов, можно задать многим клиентам установить надежный сеанс к службе, в то же время. Ответ службы в таких ситуациях зависит от свойства `MaxPendingChannels`.

Когда отправитель создает канал надежного сеанса для связи с получателем, после подтверждения между ними устанавливается надежный сеанс. После установки надежного сеанса канал помещается в очередь ожидающих каналов для принятия службой. Свойство `MaxPendingChannels` указывает количество каналов, которые могут находиться в этом состоянии.

Это служба может находиться в состоянии, где он не может принимать несколько каналов. Если очередь заполнена, попытка установки надежного сеанса отклоняется и клиент должен повторить попытку.

Можно также, когда ожидающие каналы в очереди остаются в очереди длительный срок. В то же время ожидания простоя в надежного сеанса может возникнуть, вызывает канал перейдет в состояние сбоя.

При написании службы, обслуживающей несколько клиентов одновременно, необходимо задать значение, которая подходит для потребностей. Слишком большое значение для параметра `MaxPendingChannels` свойство влияет на рабочее множество.

Значение по умолчанию <xref:System.ServiceModel.Channels.ReliableSessionBindingElement.MaxPendingChannels%2A> — четыре канала.

## <a name="reliable-sessions-and-hosting"></a>Надежные сеансы и размещение

При веб-службой, использующей надежные сеансы, вам необходимо учитывать следующие важные вопросы:

- В надежных сеансах можно отследить состояние, которое поддерживается в домене приложения. Это значит, что все сообщения, являющиеся частью надежного сеанса, необходимо обрабатывать в том же домене приложения. Веб-фермы и веб-садов, где размер фермы или сада больше, чем один узел не может гарантировать это ограничение.

- Надежные сеансы, использующих двунаправленные каналы HTTP (например, с помощью `WsDualHttpBinding`) может потребовать более чем по умолчанию два HTTP соединений на одного клиента. Это означает, что дуплексного надежного сеанса может потребоваться до двух соединений в каждую сторону, так как параллельные приложения и протокола сообщений может передачи каждую сторону в любой момент времени. При определенных условиях, в зависимости от шаблона обмена сообщениями службы это означает, что можно взаимозаблокировать службу веб сервере, с помощью двойных каналов HTTP и надежных сеансов. Чтобы увеличить число допустимых HTTP-соединений на одного клиента, добавьте следующее в соответствующий файл конфигурации (например, *web.config* рассматриваемой службы):

  ```xml
  <configuration>
    <system.net>
      <connectionManagement>
        <add name="*" maxconnection="4" />
      </connectionManagement>
    </system.net>
  </configuration>
  ```

  Значение `maxconnection` атрибута является число подключений. В этом случае минимальное должно быть четыре подключения.
