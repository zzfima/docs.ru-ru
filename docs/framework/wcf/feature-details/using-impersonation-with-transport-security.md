---
title: Использование олицетворения при обеспечении безопасности транспорта
ms.custom: ''
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: ''
ms.suite: ''
ms.technology:
- dotnet-clr
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 426df8cb-6337-4262-b2c0-b96c2edf21a9
caps.latest.revision: 12
author: BrucePerlerMS
ms.author: bruceper
manager: mbaldwin
ms.workload:
- dotnet
ms.openlocfilehash: d5610a107a198a3d8fd0517dca6ca7e2f4d22cbb
ms.sourcegitcommit: 94d33cadc5ff81d2ac389bf5f26422c227832052
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/30/2018
---
# <a name="using-impersonation-with-transport-security"></a><span data-ttu-id="661aa-102">Использование олицетворения при обеспечении безопасности транспорта</span><span class="sxs-lookup"><span data-stu-id="661aa-102">Using Impersonation with Transport Security</span></span>
<span data-ttu-id="661aa-103">*Олицетворение* — это способность серверного приложения принимать идентификацию клиента.</span><span class="sxs-lookup"><span data-stu-id="661aa-103">*Impersonation* is the ability of a server application to take on the identity of the client.</span></span> <span data-ttu-id="661aa-104">Обычно службы используют олицетворение при проверке доступа к ресурсам.</span><span class="sxs-lookup"><span data-stu-id="661aa-104">It is common for services to use impersonation when validating access to resources.</span></span> <span data-ttu-id="661aa-105">Серверное приложение выполняется с использованием учетной записи службы, но когда сервер принимает клиентское подключение, он олицетворяет клиента для выполнения проверки доступа с использованием учетных данных клиента.</span><span class="sxs-lookup"><span data-stu-id="661aa-105">The server application runs using a service account, but when the server accepts a client connection, it impersonates the client so that access checks are performed using the client's credentials.</span></span> <span data-ttu-id="661aa-106">Безопасность транспорта - это механизм, используемый как для передачи учетных данных, так и для обеспечения безопасности связи с использованием этих учетных данных.</span><span class="sxs-lookup"><span data-stu-id="661aa-106">Transport security is a mechanism both for passing credentials and securing communication using those credentials.</span></span> <span data-ttu-id="661aa-107">В этом разделе описано использование безопасности транспорта в [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] с функцией олицетворения.</span><span class="sxs-lookup"><span data-stu-id="661aa-107">This topic describes using transport security in [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] with the impersonation feature.</span></span> <span data-ttu-id="661aa-108">Дополнительные сведения об олицетворении, с помощью безопасности сообщений см. в разделе [делегирования и олицетворения](../../../../docs/framework/wcf/feature-details/delegation-and-impersonation-with-wcf.md).</span><span class="sxs-lookup"><span data-stu-id="661aa-108">For more information about impersonation using message security, see [Delegation and Impersonation](../../../../docs/framework/wcf/feature-details/delegation-and-impersonation-with-wcf.md).</span></span>  
  
## <a name="five-impersonation-levels"></a><span data-ttu-id="661aa-109">Пять уровней олицетворения</span><span class="sxs-lookup"><span data-stu-id="661aa-109">Five Impersonation Levels</span></span>  
 <span data-ttu-id="661aa-110">В безопасности транспорта используется пять уровней олицетворения, как описано в приведенной ниже таблице.</span><span class="sxs-lookup"><span data-stu-id="661aa-110">Transport security makes use of five levels of impersonation, as described in the following table.</span></span>  
  
|<span data-ttu-id="661aa-111">Уровень олицетворения</span><span class="sxs-lookup"><span data-stu-id="661aa-111">Impersonation level</span></span>|<span data-ttu-id="661aa-112">Описание</span><span class="sxs-lookup"><span data-stu-id="661aa-112">Description</span></span>|  
|-------------------------|-----------------|  
|<span data-ttu-id="661aa-113">Нет</span><span class="sxs-lookup"><span data-stu-id="661aa-113">None</span></span>|<span data-ttu-id="661aa-114">Серверное приложение не пытается олицетворить клиент.</span><span class="sxs-lookup"><span data-stu-id="661aa-114">The server application does not attempt to impersonate the client.</span></span>|  
|<span data-ttu-id="661aa-115">Anonymous</span><span class="sxs-lookup"><span data-stu-id="661aa-115">Anonymous</span></span>|<span data-ttu-id="661aa-116">Серверное приложение может выполнять проверки доступа с использованием учетных данных клиента, но не получает никакой информации об идентификации клиента.</span><span class="sxs-lookup"><span data-stu-id="661aa-116">The server application can perform access checks against the client's credentials, but does not receive any information about the client's identity.</span></span> <span data-ttu-id="661aa-117">Использовать этот уровень олицетворения имеет смысл только при обмене данными на компьютере, например по именованным каналам.</span><span class="sxs-lookup"><span data-stu-id="661aa-117">This impersonation level is meaningful only for on-machine communication, such as named pipes.</span></span> <span data-ttu-id="661aa-118">Если уровень `Anonymous` используется при удаленном подключении, он повышается до уровня олицетворения "Identify".</span><span class="sxs-lookup"><span data-stu-id="661aa-118">Using `Anonymous` with a remote connection promotes the impersonation level to Identify.</span></span>|  
|<span data-ttu-id="661aa-119">Identify</span><span class="sxs-lookup"><span data-stu-id="661aa-119">Identify</span></span>|<span data-ttu-id="661aa-120">Серверное приложение знает идентификацию клиента и может выполнить проверку доступа с использованием учетных данных клиента, но не может олицетворить клиент.</span><span class="sxs-lookup"><span data-stu-id="661aa-120">The server application knows the client's identity and can perform access validation against the client's credentials, but cannot impersonate the client.</span></span> <span data-ttu-id="661aa-121">Уровень "Identify" - это уровень олицетворения по умолчанию, используемый с учетными данными SSPI в [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)], пока поставщик маркеров не укажет другой уровень олицетворения.</span><span class="sxs-lookup"><span data-stu-id="661aa-121">Identify is the default impersonation level used with SSPI credentials in [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] unless the token provider provides a different impersonation level.</span></span>|  
|<span data-ttu-id="661aa-122">Impersonate</span><span class="sxs-lookup"><span data-stu-id="661aa-122">Impersonate</span></span>|<span data-ttu-id="661aa-123">Серверное приложение может получить доступ к ресурсам на компьютере-сервере в качестве клиента помимо выполнения проверок доступа.</span><span class="sxs-lookup"><span data-stu-id="661aa-123">The server application can access resources on the server machine as the client in addition to performing access checks.</span></span> <span data-ttu-id="661aa-124">Серверное приложение не может получить доступ к ресурсам на удаленных компьютерах, используя идентификацию клиента, поскольку олицетворяемый маркер не имеет сетевых учетных данных.</span><span class="sxs-lookup"><span data-stu-id="661aa-124">The server application cannot access resources on remote machines using the client's identity because the impersonated token does not have network credentials</span></span>|  
|<span data-ttu-id="661aa-125">делегат</span><span class="sxs-lookup"><span data-stu-id="661aa-125">Delegate</span></span>|<span data-ttu-id="661aa-126">Уровень олицетворения "Delegate" предоставляет те же возможности, что уровень `Impersonate`, а также позволяет серверному приложению получить доступ к ресурсам на удаленных компьютерах с использованием идентификации клиента и передавать эту идентификацию другим приложениям.</span><span class="sxs-lookup"><span data-stu-id="661aa-126">In addition to having the same capabilities as `Impersonate`, the Delegate impersonation level also enables the server application to access resources on remote machines using the client's identity and to pass the identity to other applications.</span></span><br /><br /> <span data-ttu-id="661aa-127">**Важные** учетную запись домена сервера должен быть помечен как доверенную для делегирования на контроллере домена, чтобы использовать эти дополнительные возможности.</span><span class="sxs-lookup"><span data-stu-id="661aa-127">**Important** The server domain account must be marked as trusted for delegation on the domain controller to use these additional features.</span></span> <span data-ttu-id="661aa-128">Этот уровень олицетворения нельзя использовать с учетными записями домена клиента, отмеченными как конфиденциальные.</span><span class="sxs-lookup"><span data-stu-id="661aa-128">This level of impersonation cannot be used with client domain accounts marked as sensitive.</span></span>|  
  
 <span data-ttu-id="661aa-129">Чаще всего используется с безопасностью транспорта уровни `Identify` и `Impersonate`.</span><span class="sxs-lookup"><span data-stu-id="661aa-129">The levels most commonly used with transport security are `Identify` and `Impersonate`.</span></span> <span data-ttu-id="661aa-130">Не рекомендуется использовать уровни `None` и `Anonymous` в стандартных ситуациях, большинство транспортов не поддерживает использование этих уровней с проверкой подлинности.</span><span class="sxs-lookup"><span data-stu-id="661aa-130">The levels `None` and `Anonymous` are not recommended for typical use, and many transports do not support using those levels with authentication.</span></span> <span data-ttu-id="661aa-131">Уровень `Delegate` - это функция с широкими возможностями, которую следует использовать осторожно.</span><span class="sxs-lookup"><span data-stu-id="661aa-131">The `Delegate` level is a powerful feature that should be used with care.</span></span> <span data-ttu-id="661aa-132">Разрешение на делегирование учетных записей следует предоставлять только доверенным серверным приложениям.</span><span class="sxs-lookup"><span data-stu-id="661aa-132">Only trusted server applications should be given the permission to delegate credentials.</span></span>  
  
 <span data-ttu-id="661aa-133">Для использования уровней `Impersonate` или `Delegate` необходимо, чтобы серверные приложения имели привилегию `SeImpersonatePrivilege`.</span><span class="sxs-lookup"><span data-stu-id="661aa-133">Using impersonation at the `Impersonate` or `Delegate` levels requires the server application to have the `SeImpersonatePrivilege` privilege.</span></span> <span data-ttu-id="661aa-134">Приложение имеет эту привилегию по умолчанию, если оно выполняется от имени учетной записи в группе "Администраторы" или от имени учетной записи с идентификатором безопасности службы (сетевая служба, локальная служба или локальная система).</span><span class="sxs-lookup"><span data-stu-id="661aa-134">An application has this privilege by default if it is running on an account in the Administrators group or on an account with a Service SID (Network Service, Local Service, or Local System).</span></span> <span data-ttu-id="661aa-135">Для олицетворения не требуется проведения взаимной проверки подлинности клиента и сервера.</span><span class="sxs-lookup"><span data-stu-id="661aa-135">Impersonation does not require mutual authentication of the client and server.</span></span> <span data-ttu-id="661aa-136">Некоторые схемы проверки подлинности, поддерживающие олицетворение, такие как NTLM, нельзя использовать при проведении взаимной проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="661aa-136">Some authentication schemes that support impersonation, such as NTLM, cannot be used with mutual authentication.</span></span>  
  
## <a name="transport-specific-issues-with-impersonation"></a><span data-ttu-id="661aa-137">Проблемы соответствия транспорта и олицетворения</span><span class="sxs-lookup"><span data-stu-id="661aa-137">Transport-Specific Issues with Impersonation</span></span>  
 <span data-ttu-id="661aa-138">Выбор транспорта в [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] влияет на возможный выбор олицетворения.</span><span class="sxs-lookup"><span data-stu-id="661aa-138">The choice of a transport in [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] affects the possible choices for impersonation.</span></span> <span data-ttu-id="661aa-139">В данном разделе описываются проблемы, влияющие на стандартный транспорт HTTP и транспорт именованных каналов в [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)].</span><span class="sxs-lookup"><span data-stu-id="661aa-139">This section describes issues affecting the standard HTTP and named pipe transports in [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)].</span></span> <span data-ttu-id="661aa-140">Пользовательские транспорты имеют свои собственные ограничения поддержки олицетворения.</span><span class="sxs-lookup"><span data-stu-id="661aa-140">Custom transports have their own restrictions on support for impersonation.</span></span>  
  
### <a name="named-pipe-transport"></a><span data-ttu-id="661aa-141">Транспорт именованных каналов</span><span class="sxs-lookup"><span data-stu-id="661aa-141">Named Pipe Transport</span></span>  
 <span data-ttu-id="661aa-142">К транспорту именованных каналов применяются следующие положения.</span><span class="sxs-lookup"><span data-stu-id="661aa-142">The following items are used with the named pipe transport:</span></span>  
  
-   <span data-ttu-id="661aa-143">Транспорт именованных каналов предназначен для использования только на локальном компьютере.</span><span class="sxs-lookup"><span data-stu-id="661aa-143">The named pipe transport is intended for use only on the local machine.</span></span> <span data-ttu-id="661aa-144">Транспорт именованных каналов в [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] явным образом запрещает обмен данными между компьютерами.</span><span class="sxs-lookup"><span data-stu-id="661aa-144">The named pipe transport in [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] explicitly disallows cross-machine connections.</span></span>  
  
-   <span data-ttu-id="661aa-145">Именованные каналы невозможно использовать с уровнем олицетворения `Impersonate` или `Delegate`.</span><span class="sxs-lookup"><span data-stu-id="661aa-145">Named pipes cannot be used with the `Impersonate` or `Delegate` impersonation level.</span></span> <span data-ttu-id="661aa-146">Именованный канал не может обеспечить выполнение гарантии на компьютере на этих уровнях олицетворения.</span><span class="sxs-lookup"><span data-stu-id="661aa-146">The named pipe cannot enforce the on-machine guarantee at these impersonation levels.</span></span>  
  
 <span data-ttu-id="661aa-147">Дополнительные сведения об именованных каналах см. в разделе [выбор транспорта](../../../../docs/framework/wcf/feature-details/choosing-a-transport.md).</span><span class="sxs-lookup"><span data-stu-id="661aa-147">For more information about named pipes, see [Choosing a Transport](../../../../docs/framework/wcf/feature-details/choosing-a-transport.md).</span></span>  
  
### <a name="http-transport"></a><span data-ttu-id="661aa-148">Транспорт HTTP</span><span class="sxs-lookup"><span data-stu-id="661aa-148">HTTP Transport</span></span>  
 <span data-ttu-id="661aa-149">Привязки, использующие транспорт по протоколу HTTP (<xref:System.ServiceModel.WSHttpBinding> и <xref:System.ServiceModel.BasicHttpBinding>) поддерживает несколько схем проверки подлинности, как описано в статье [основные сведения о проверке подлинности HTTP](../../../../docs/framework/wcf/feature-details/understanding-http-authentication.md).</span><span class="sxs-lookup"><span data-stu-id="661aa-149">The bindings that use the HTTP transport (<xref:System.ServiceModel.WSHttpBinding> and <xref:System.ServiceModel.BasicHttpBinding>) support several authentication schemes, as explained in [Understanding HTTP Authentication](../../../../docs/framework/wcf/feature-details/understanding-http-authentication.md).</span></span> <span data-ttu-id="661aa-150">Поддерживаемый уровень олицетворения зависит от схемы проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="661aa-150">The impersonation level supported depends on the authentication scheme.</span></span> <span data-ttu-id="661aa-151">К транспорту HTTP применяются следующие положения.</span><span class="sxs-lookup"><span data-stu-id="661aa-151">The following items are used with the HTTP transport:</span></span>  
  
-   <span data-ttu-id="661aa-152">Схема проверки подлинности `Anonymous` игнорирует олицетворение.</span><span class="sxs-lookup"><span data-stu-id="661aa-152">The `Anonymous` authentication scheme ignores impersonation.</span></span>  
  
-   <span data-ttu-id="661aa-153">`Basic` Схему проверки подлинности поддерживает только `Delegate` уровне.</span><span class="sxs-lookup"><span data-stu-id="661aa-153">The `Basic` authentication scheme supports only the `Delegate` level.</span></span> <span data-ttu-id="661aa-154">Все более низкие уровни олицетворения обновляются.</span><span class="sxs-lookup"><span data-stu-id="661aa-154">All lower impersonation levels are upgraded.</span></span>  
  
-   <span data-ttu-id="661aa-155">Схема проверки подлинности `Digest` поддерживает только уровни `Impersonate` и `Delegate`.</span><span class="sxs-lookup"><span data-stu-id="661aa-155">The `Digest` authentication scheme supports only the `Impersonate` and `Delegate` levels.</span></span>  
  
-   <span data-ttu-id="661aa-156">Схема проверки подлинности `NTLM`, которую можно выбрать как прямо, так и посредством согласования, поддерживает только уровень `Delegate` на локальном компьютере.</span><span class="sxs-lookup"><span data-stu-id="661aa-156">The `NTLM` authentication scheme, selectable either directly or through negotiation, supports only the `Delegate` level on the local machine.</span></span>  
  
-   <span data-ttu-id="661aa-157">Схема проверки подлинности Kerberos, которую можно выбрать только посредством согласования, используется на любом поддерживаемом уровне олицетворения.</span><span class="sxs-lookup"><span data-stu-id="661aa-157">The Kerberos authentication scheme, which can only be selected through negotiation, can be used with any supported impersonation level.</span></span>  
  
 <span data-ttu-id="661aa-158">Дополнительные сведения о HTTP-транспорт. в разделе [выбор транспорта](../../../../docs/framework/wcf/feature-details/choosing-a-transport.md).</span><span class="sxs-lookup"><span data-stu-id="661aa-158">For more information about the HTTP transport, see [Choosing a Transport](../../../../docs/framework/wcf/feature-details/choosing-a-transport.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="661aa-159">См. также</span><span class="sxs-lookup"><span data-stu-id="661aa-159">See Also</span></span>  
 [<span data-ttu-id="661aa-160">Делегирование и олицетворение</span><span class="sxs-lookup"><span data-stu-id="661aa-160">Delegation and Impersonation</span></span>](../../../../docs/framework/wcf/feature-details/delegation-and-impersonation-with-wcf.md)  
 [<span data-ttu-id="661aa-161">Авторизация</span><span class="sxs-lookup"><span data-stu-id="661aa-161">Authorization</span></span>](../../../../docs/framework/wcf/feature-details/authorization-in-wcf.md)  
 [<span data-ttu-id="661aa-162">Практическое руководство. Олицетворение клиента в рамках службы</span><span class="sxs-lookup"><span data-stu-id="661aa-162">How to: Impersonate a Client on a Service</span></span>](../../../../docs/framework/wcf/how-to-impersonate-a-client-on-a-service.md)  
 [<span data-ttu-id="661aa-163">Основные сведения о проверке подлинности HTTP</span><span class="sxs-lookup"><span data-stu-id="661aa-163">Understanding HTTP Authentication</span></span>](../../../../docs/framework/wcf/feature-details/understanding-http-authentication.md)
