---
title: Служба маршрутизации
ms.date: 03/30/2017
ms.assetid: ca7c216a-5141-4132-8193-102c181d2eba
ms.openlocfilehash: b0d58e70d482532e3f148d3f4f92741f46221982
ms.sourcegitcommit: 6b308cf6d627d78ee36dbbae8972a310ac7fd6c8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/23/2019
ms.locfileid: "54495309"
---
# <a name="routing-service"></a>Служба маршрутизации
Служба маршрутизации является универсальным посредником протокола SOAP, действующим в качестве маршрутизатора сообщений. Основной функцией службы маршрутизации является возможность перенаправлять сообщения, исходя из их содержимого, благодаря чему сообщение можно переслать конечной точке клиента в зависимости от значения в самом сообщении, находящемся в заголовке или в тексте сообщения.  
  
 <xref:System.ServiceModel.Routing.RoutingService> Реализуется как служба Windows Communication Foundation (WCF) в <xref:System.ServiceModel.Routing> пространства имен. Служба маршрутизации обеспечивает доступ к одной или нескольким конечным точкам служб, которые производят получение сообщений и их маршрутизацию к одной или нескольким клиентским конечным точкам в зависимости от содержимого. Служба предоставляет следующие функциональные возможности.  
  
-   Маршрутизация на основе содержимого  
  
    -   Статистическая обработка служб  
  
    -   Управление версиями служб  
  
    -   Приоритетная маршрутизация  
  
    -   Динамическая конфигурация  
  
-   Связывание протоколов  
  
-   Обработка протокола SOAP  
  
-   Расширенная обработка ошибок.  
  
-   Резервные конечные точки  
  
 Поскольку создание службы-посредника направлено на достижение одной или нескольких из этих задач, очень часто такая реализация привязана к конкретному сценарию или решению и поэтому неприменима ко всем новым приложениям.  
  
 Служба маршрутизации реализует универсальный, динамически настраиваемый, расширяемый SOAP-посредник, совместимый с моделями служб WCF и каналов и позволяет выполнять маршрутизацию на основе содержимого сообщения SOAP.  
  
> [!NOTE]
>  Служба маршрутизации в настоящее время не поддерживает маршрутизацию служб WCF REST.  Маршрутизацию вызовов REST, рассмотрите возможность использования <xref:System.Web.Routing> или [маршрутизации запросов приложений](https://go.microsoft.com/fwlink/?LinkId=164589).  
  
## <a name="content-based-routing"></a>Маршрутизация на основе содержимого  
 Маршрутизация на основе содержимого - это возможность перенаправления сообщения на основе одного или нескольких содержащихся в нем значений. Служба маршрутизации проверяет каждое сообщение и перенаправляет его в целевую конечную точку, определяемую на основе содержимого сообщения и созданной логики маршрутизации. Маршрутизация на основе содержимого обеспечивает основу статистической обработки служб, управления версиями и приоритетами.  
  
 Реализация маршрутизации на основе содержимого строится на реализациях <xref:System.ServiceModel.Dispatcher.MessageFilter>, которые служат для поиска определенных значений в маршрутизируемых сообщениях. Если **MessageFilter** совпадений, сообщение, сообщение направляется в целевую конечную точку, связанные с **MessageFilter**.  Для построения сложной логики маршрутизации фильтры сообщений группируются в таблицы фильтров (<xref:System.ServiceModel.Routing.Configuration.FilterTableCollection>). Например, таблица фильтров может содержать пять взаимоисключающих фильтров, которые приводят к маршрутизации сообщений только к одной из пяти целевых конечных точек.  
  
 Служба маршрутизации позволяет настроить логику, используемую для выполнения маршрутизации исходя из содержимого сообщений, а также динамически обновлять ее во время выполнения.  
  
 Логика маршрутизации может быть построена за счет группирования фильтров сообщений в таблицы фильтров. Это позволяет обрабатывать несколько сценариев маршрутизации, например:  
  
-   Статистическая обработка служб  
  
-   Управление версиями служб  
  
-   Приоритетная маршрутизация  
  
-   Динамическая конфигурация  
  
 Дополнительные сведения о фильтрах сообщений и таблицах фильтров см. в разделе [Общие сведения о маршрутизации](../../../../docs/framework/wcf/feature-details/routing-introduction.md) и [фильтры сообщений](../../../../docs/framework/wcf/feature-details/message-filters.md).  
  
### <a name="service-aggregation"></a>Статистическая обработка служб  
 Маршрутизация на основе содержимого позволяет через одну конечную точку принимать сообщения от внешних клиентских приложений и перенаправлять их соответствующим внутренним конечным точкам в соответствии со значениями, содержащимися в сообщениях. Это полезно в случае, если через одну конечную точку работает несколько серверных приложений, или при необходимости разбить на несколько служб приложение, которое для клиентов должно быть представлено одной конечной точкой приложения.  
  
### <a name="service-versioning"></a>Управление версиями службы  
 При переходе на новую версию решения приходится обеспечивать параллельную работу старой версии для существующих клиентов. Часто для этого клиентам для обмена данными с решением приходится устанавливать соединение с новой версией по новому адресу. Служба маршрутизации позволяет клиентам обеих версий производить доступ через одну конечную точку службы, перенаправляя сообщения нужным решениям исходя из их содержимого. Пример такой реализации см. в разделе [How To: Управление версиями службы](../../../../docs/framework/wcf/feature-details/how-to-service-versioning.md).  
  
### <a name="priority-routing"></a>Приоритетная маршрутизация  
 При обслуживании множества клиентов с некоторыми из них может быть заключено соглашение об уровне обслуживания (SLA), предусматривающее обработку их данных отдельно от других клиентов. Применение фильтра для поиска информации о клиенте, содержащейся в сообщении, легко позволяет выполнить маршрутизацию сообщений от конкретных партнеров до конечной точки, созданной для того, чтобы обеспечить соответствие соглашениям SLA.  
  
## <a name="dynamic-configuration"></a>Динамическая конфигурация  
 Для поддержки систем обработки критически важных данных, где сообщения должны обрабатываться без перерывов в работе служб, возможность изменения конфигурации компонентов в системе во время выполнения весьма существенна. В поддержку этого требования служба маршрутизации обеспечивает реализацию интерфейса <xref:System.ServiceModel.IExtension%601>, класс <xref:System.ServiceModel.Routing.RoutingExtension>, который позволяет динамически обновлять конфигурацию службы маршрутизации во время выполнения.  
  
 Дополнительные сведения о динамической конфигурации службы маршрутизации, см. в разделе [Общие сведения о маршрутизации](../../../../docs/framework/wcf/feature-details/routing-introduction.md).  
  
## <a name="protocol-bridging"></a>Связывание протоколов  
 Одной из проблем, возникающих в сценариях с использованием посредника, является то, что конечная точка может использовать транспорт и версию SOAP, отличные от конечной точки, которая занимается приемом сообщений. Для поддержки таких сценариев служба маршрутизации может обеспечивать преобразование протокола, а также выполнять обработку сообщений SOAP с помощью версии <xref:System.ServiceModel.Channels.MessageVersion>, необходимой целевым конечным точкам. Таким образом, для внутреннего обмена данными может быть использован один протокол, а для внешнего - другой.  
  
 Для поддержки маршрутизации сообщений между конечными точками с различными транспортными протоколами служба маршрутизации использует предоставляемые системой привязки, которые позволяют ей обеспечивать взаимодействие между разными протоколами. Это происходит автоматически, когда конечная точка службы, реализованная службой маршрутизации, использует протокол, отличный от протокола, используемого клиентскими точками, которым передаются сообщения.  
  
## <a name="soap-processing"></a>Обработка SOAP  
 Общее требование - возможность маршрутизации сообщений между конечными точками с различными требованиями SOAP. Для выполнения этого требования служба маршрутизации реализует <xref:System.ServiceModel.Routing.SoapProcessingBehavior> , автоматически создает новую **MessageVersion** , отвечающий требованиям целевой конечной точки, прежде чем сообщение направляется к нему. Это поведение также создает новый **MessageVersion** для сообщения ответа перед его возвратом запрашивающему клиентскому приложению, чтобы убедиться, что **MessageVersion** ответа соответствие исходный запрос.  
  
 Дополнительные сведения об обработке SOAP см. в разделе [Общие сведения о маршрутизации](../../../../docs/framework/wcf/feature-details/routing-introduction.md).  
  
## <a name="error-handling"></a>Обработка ошибок  
 В системах, состоящих из распределенных служб, которые зависят от сетевого взаимодействия, важно обеспечить устойчивость системы к временным отказам.  Служба маршрутизации реализует обработку ошибок, позволяющую обрабатывать различные сценарии сбоев взаимодействия, которые могут привести к простою службы.  
  
 Если служба маршрутизации обнаружила исключение <xref:System.ServiceModel.CommunicationException> при попытке отправки сообщения, то будет выполнена обработка ошибок.  Эти исключения обычно указывают на то, что при попытке связаться с определенной конечной точкой клиента была обнаружена проблема, например <xref:System.ServiceModel.EndpointNotFoundException>, <xref:System.ServiceModel.ServerTooBusyException> или <xref:System.ServiceModel.CommunicationObjectFaultedException>.  Код обработки ошибок также перехватит и попытается повторить отправку при **TimeoutException** происходит, это еще одно общее исключение, которое не является производным от **CommunicationException**.  
  
 Дополнительные сведения об обработке ошибок см. в разделе [Общие сведения о маршрутизации](../../../../docs/framework/wcf/feature-details/routing-introduction.md).  
  
## <a name="backup-endpoints"></a>Резервные конечные точки  
 Помимо целевых клиентских конечных точек, связанных с определениями фильтров в таблице фильтров, можно создать также список резервных конечных точек. В случае ошибки передачи данных будет выполнена маршрутизация сообщения к этим резервным конечным точкам. Если для записи фильтра определен резервный список, то при возникновении ошибки служба маршрутизации попытается отправить сообщение к первой конечной точке из этого списка. Если передача данных завершилась ошибкой, то служба пытается отправить сообщение следующей конечной точке. Этот процесс продолжается до тех пор, пока операция не будет выполнена успешно, пока не будет возвращена ошибка, не связанная с передачей данных, либо до конца резервного списка.  
  
 Дополнительные сведения о резервных конечных точек см. в разделе [Общие сведения о маршрутизации](../../../../docs/framework/wcf/feature-details/routing-introduction.md) и [фильтры сообщений](../../../../docs/framework/wcf/feature-details/message-filters.md).  
  
## <a name="streaming"></a>Потоковые операторы  
 Служба маршрутизации может успешно передавать сообщения, если задать привязку для поддержки потоковой передачи.  Однако существуют определенные условия, при которых сообщения необходимо помещать в буфер.  
  
-   Многоадресность (буфер для создания дополнительных копий сообщения)  
  
-   Переход на другой ресурс при отказе (буфер, необходимый для отправки сообщения в резервную копию)  
  
-   System.ServiceModel.Routing.RoutingConfiguration.RouteOnHeadersOnly имеет значение «False» (буфер для представления MessageFilterTable с MessageBuffer, чтобы фильтры могли проверить текст)  
  
-   Динамическая конфигурация  
  
## <a name="see-also"></a>См. также
- [Введение в маршрутизацию](../../../../docs/framework/wcf/feature-details/routing-introduction.md)
- [Контракты маршрутизации](../../../../docs/framework/wcf/feature-details/routing-contracts.md)
- [Фильтры сообщений](../../../../docs/framework/wcf/feature-details/message-filters.md)
