---
title: Проблемы безопасности при ведении журналов сообщений
ms.date: 03/30/2017
ms.assetid: 21f513f2-815b-47f3-85a6-03c008510038
ms.openlocfilehash: bb1a6ab84ceba27b398d397b4407a55aa02c4cae
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/12/2020
ms.locfileid: "79185765"
---
# <a name="security-concerns-for-message-logging"></a><span data-ttu-id="cb271-102">Проблемы безопасности при ведении журналов сообщений</span><span class="sxs-lookup"><span data-stu-id="cb271-102">Security Concerns for Message Logging</span></span>
<span data-ttu-id="cb271-103">В этом разделе описываются способы защиты конфиденциальных данных от раскрытия в журналах сообщений, а также в событиях, формируемых посредством ведения журнала сообщений.</span><span class="sxs-lookup"><span data-stu-id="cb271-103">This topic describes how you can protect sensitive data from being exposed in message logs, as well as events generated by message logging.</span></span>  
  
## <a name="security-concerns"></a><span data-ttu-id="cb271-104">Проблемы безопасности</span><span class="sxs-lookup"><span data-stu-id="cb271-104">Security Concerns</span></span>  
  
### <a name="logging-sensitive-information"></a><span data-ttu-id="cb271-105">Регистрация конфиденциальных сведений</span><span class="sxs-lookup"><span data-stu-id="cb271-105">Logging Sensitive Information</span></span>  
 <span data-ttu-id="cb271-106">Фонд связи Windows (WCF) не изменяет данные в заголовках и органах, специфичных для приложений.</span><span class="sxs-lookup"><span data-stu-id="cb271-106">Windows Communication Foundation (WCF) does not modify any data in application-specific headers and body.</span></span> <span data-ttu-id="cb271-107">WCF также не отслеживает личную информацию в заголовках приложений или данных органов.</span><span class="sxs-lookup"><span data-stu-id="cb271-107">WCF also does not track personal information in application-specific headers or body data.</span></span>  
  
 <span data-ttu-id="cb271-108">Когда регистрация сообщений включена, персональные данные в заголовках, зависящих от приложения (такие как строка запроса), и в теле сообщения (такие как номер кредитной карты), могут быть видимы в журналах.</span><span class="sxs-lookup"><span data-stu-id="cb271-108">When message logging is enabled, personal information in application-specific headers, such as, a query string; and body information, such as, a credit card number, can become visible in the logs.</span></span> <span data-ttu-id="cb271-109">За надлежащее управление доступом к файлам конфигурации и журналов отвечает специалист, выполняющий развертывание приложения.</span><span class="sxs-lookup"><span data-stu-id="cb271-109">The application deployer is responsible for enforcing access control on the configuration and log files.</span></span> <span data-ttu-id="cb271-110">Если требуется, чтобы подобные сведения не были видимы, необходимо отключить регистрацию или фильтровать часть данных (если предполагается доступ к журналам других лиц).</span><span class="sxs-lookup"><span data-stu-id="cb271-110">If you do not want this kind of information to be visible, you should disable logging, or filter out part of the data if you want to share the logs.</span></span>  
  
 <span data-ttu-id="cb271-111">Следующие советы помогут предотвратить непреднамеренное раскрытие содержимого файла журнала.</span><span class="sxs-lookup"><span data-stu-id="cb271-111">The following tips can help you to prevent the content of a log file from being exposed unintentionally:</span></span>  
  
- <span data-ttu-id="cb271-112">Убедитесь, что файлы журналов защищены с помощью списков управления доступом (ACL), как в сценарии с размещением на веб-сервере, так и в сценарии с резидентной службой.</span><span class="sxs-lookup"><span data-stu-id="cb271-112">Ensure that the log files are protected by Access Control Lists (ACL) both in Web-host and self-host scenarios.</span></span>  
  
- <span data-ttu-id="cb271-113">Выберите расширение файла, которое нельзя легко получить с помощью веб-запроса.</span><span class="sxs-lookup"><span data-stu-id="cb271-113">Choose a file extension that cannot be easily served using a Web request.</span></span> <span data-ttu-id="cb271-114">Например, расширение XML безопасным не является.</span><span class="sxs-lookup"><span data-stu-id="cb271-114">For example, the .xml file extension is not a safe choice.</span></span> <span data-ttu-id="cb271-115">Список расширений, которые могут быть получены, можно найти в руководстве по администрированию Internet Information Services (IIS).</span><span class="sxs-lookup"><span data-stu-id="cb271-115">You can check the Internet Information Services (IIS) administration guide to see a list of extensions that can be served.</span></span>  
  
- <span data-ttu-id="cb271-116">Задайте абсолютный путь к местоположению файла журнала, которое должно находиться за пределами общедоступного каталога vroot веб-сервера во избежание доступа к нему третьих лиц с помощью веб-браузера.</span><span class="sxs-lookup"><span data-stu-id="cb271-116">Specify an absolute path for the log file location, which should be outside of the Web host vroot public directory to prevent it from being accessed by an external party using a Web browser.</span></span>  
  
 <span data-ttu-id="cb271-117">По умолчанию ключи и персональные данные (personally identifiable information, PII), такие как имя пользователя и пароль, не регистрируются трассировкой и не указываются в заносимых в журнал сообщениях.</span><span class="sxs-lookup"><span data-stu-id="cb271-117">By default, keys and personally identifiable information (PII) such as username and password are not logged in traces and logged messages.</span></span> <span data-ttu-id="cb271-118">Администратор компьютера может, тем не менее, с помощью атрибута `enableLoggingKnownPII` в элементе `machineSettings` файла Machine.config разрешить приложениям, выполняющимся на компьютере, регистрировать известные персональные данные (PII).</span><span class="sxs-lookup"><span data-stu-id="cb271-118">A machine administrator, however, can use the `enableLoggingKnownPII` attribute in the `machineSettings` element of the Machine.config file to permit applications running on the machine to log known personally identifiable information (PII).</span></span> <span data-ttu-id="cb271-119">Следующая конфигурация показывает, как это сделать.</span><span class="sxs-lookup"><span data-stu-id="cb271-119">The following configuration demonstrates how to do this:</span></span>  
  
```xml  
<configuration>  
   <system.serviceModel>  
      <machineSettings enableLoggingKnownPii="true"/>  
   </system.serviceModel>  
</configuration>
```  
  
 <span data-ttu-id="cb271-120">Специалист, выполняющий развертывание приложения, может затем с помощью атрибута `logKnownPii` в файле App.config или Web.config включить регистрацию персональных данных следующим образом:</span><span class="sxs-lookup"><span data-stu-id="cb271-120">An application deployer can then use the `logKnownPii` attribute in either the App.config or Web.config file to enable PII logging as follows:</span></span>  
  
```xml  
<system.diagnostics>  
  <sources>  
      <source name="System.ServiceModel.MessageLogging"  
        logKnownPii="true">  
        <listeners>  
                 <add name="messages"  
                 type="System.Diagnostics.XmlWriterTraceListener"  
                 initializeData="c:\logs\messages.svclog" />  
          </listeners>  
      </source>  
    </sources>  
</system.diagnostics>  
```  
  
 <span data-ttu-id="cb271-121">Регистрация PII включена, только когда оба параметра имеют значение `true`.</span><span class="sxs-lookup"><span data-stu-id="cb271-121">Only when both settings are `true` is PII logging enabled.</span></span> <span data-ttu-id="cb271-122">Такое сочетание из двух ключей позволяет регистрировать известные PII для каждого приложения.</span><span class="sxs-lookup"><span data-stu-id="cb271-122">The combination of two switches allows the flexibility to log known PII for each application.</span></span>  
  
> [!IMPORTANT]
> <span data-ttu-id="cb271-123">В [!INCLUDE[netfx_current_long](../../../../includes/netfx-current-long-md.md)] для флагов `logEntireMessage` и `logKnownPii` необходимо задать значение `true` в файле Web.config или файле App.config, чтобы включить регистрацию персональных данных, как показано в следующем примере: `<system.serviceModel><messageLogging logEntireMessage="true" logKnownPii="true" …`.</span><span class="sxs-lookup"><span data-stu-id="cb271-123">In [!INCLUDE[netfx_current_long](../../../../includes/netfx-current-long-md.md)] the `logEntireMessage` and `logKnownPii` flags must also be set to `true` in the Web.config file or the App.config file to enable PII logging, as show in the following example `<system.serviceModel><messageLogging logEntireMessage="true" logKnownPii="true" …`.</span></span>  
  
 <span data-ttu-id="cb271-124">Необходимо иметь в виду, что при задании в файле конфигурации двух или более пользовательских источников считываются только атрибуты первого источника.</span><span class="sxs-lookup"><span data-stu-id="cb271-124">You should be aware that if you specify two or more custom sources in a configuration file, only the attributes of the first source are read.</span></span> <span data-ttu-id="cb271-125">Остальные атрибуты не учитываются.</span><span class="sxs-lookup"><span data-stu-id="cb271-125">The others are ignored.</span></span> <span data-ttu-id="cb271-126">Это значит, что в случае следующего файла App.config PII не регистрируются для обоих источников, несмотря на то что для второго источника явно включена регистрация персональных данных.</span><span class="sxs-lookup"><span data-stu-id="cb271-126">This means that, for the following App.config, file, PII is not logged for both sources even though PII logging is explicitly enabled for the second source.</span></span>  
  
```xml  
<system.diagnostics>  
   <sources>  
      <source name="System.ServiceModel.MessageLogging"  
              logKnownPii="false">  
              <listeners>  
                 <add name="messages"  
                      type="System.Diagnostics.XmlWriterTraceListener"  
                      initializeData="c:\logs\messages.svclog" />  
              </listeners>  
            </source>  
      <source name="System.ServiceModel"
              logKnownPii="true">  
              <listeners>  
                 <add name="traces"  
                      type="System.Diagnostics.XmlWriterTraceListener"  
                      initializeData="c:\logs\traces.svclog" />  
              </listeners>  
      </source>  
   </sources>  
</system.diagnostics>  
```  
  
 <span data-ttu-id="cb271-127">Если элемент `<machineSettings enableLoggingKnownPii="Boolean"/>`<xref:System.Configuration.ConfigurationErrorsException> присутствует за пределами файла Machine.config, система вызывает исключение.</span><span class="sxs-lookup"><span data-stu-id="cb271-127">If the `<machineSettings enableLoggingKnownPii="Boolean"/>` element exists outside the Machine.config file, the system throws a <xref:System.Configuration.ConfigurationErrorsException>.</span></span>  
  
 <span data-ttu-id="cb271-128">Изменения вступают в силу только после запуска или перезапуска приложения.</span><span class="sxs-lookup"><span data-stu-id="cb271-128">The changes are effective only when the application starts or restarts.</span></span> <span data-ttu-id="cb271-129">Когда оба атрибута имеют значение `true`, при запуске регистрируется событие.</span><span class="sxs-lookup"><span data-stu-id="cb271-129">An event is logged at startup when both attributes are set to `true`.</span></span> <span data-ttu-id="cb271-130">Событие также регистрируется, если атрибут `logKnownPii` имеет значение `true`, а атрибут `enableLoggingKnownPii` имеет значение `false`.</span><span class="sxs-lookup"><span data-stu-id="cb271-130">An event is also logged if `logKnownPii` is set to `true` but `enableLoggingKnownPii` is `false`.</span></span>  
  
 <span data-ttu-id="cb271-131">Администратор компьютера и специалист, выполняющий развертывание приложения, должны быть предельно осторожными при использовании этих двух переключателей.</span><span class="sxs-lookup"><span data-stu-id="cb271-131">The machine administrator and application deployer should exercise extreme caution when using these two switches.</span></span> <span data-ttu-id="cb271-132">Если регистрация PII включена, ключи контроля доступа и персональные данные заносятся в журналы.</span><span class="sxs-lookup"><span data-stu-id="cb271-132">If PII logging is enabled, security keys and PII are logged.</span></span> <span data-ttu-id="cb271-133">Если она отключена, конфиденциальные и зависящие от приложения данные все равно регистрируются в составе заголовков и тел сообщений.</span><span class="sxs-lookup"><span data-stu-id="cb271-133">If it is disabled, sensitive and application-specific data is still logged in message headers and bodies.</span></span> <span data-ttu-id="cb271-134">Для более тщательного обсуждения конфиденциальности и защиты PII от [разоблачения, см.](https://docs.microsoft.com/previous-versions/dotnet/articles/aa480490(v=msdn.10))</span><span class="sxs-lookup"><span data-stu-id="cb271-134">For a more thorough discussion about privacy and protecting PII from being exposed, see [User Privacy](https://docs.microsoft.com/previous-versions/dotnet/articles/aa480490(v=msdn.10)).</span></span>  
  
> [!CAUTION]
> <span data-ttu-id="cb271-135">В неправильно сформированных сообщениях PII не скрываются.</span><span class="sxs-lookup"><span data-stu-id="cb271-135">PII is not hidden in malformed messages.</span></span> <span data-ttu-id="cb271-136">Такие сообщения регистрируются «как есть», без каких-либо изменений.</span><span class="sxs-lookup"><span data-stu-id="cb271-136">Such messaged are logged as-is without any modification.</span></span> <span data-ttu-id="cb271-137">Упомянутые выше атрибуты никак на это не влияют.</span><span class="sxs-lookup"><span data-stu-id="cb271-137">Attributes mentioned previously have no effect on this.</span></span>  
  
### <a name="custom-trace-listener"></a><span data-ttu-id="cb271-138">Пользовательский прослушиватель трассировки</span><span class="sxs-lookup"><span data-stu-id="cb271-138">Custom Trace Listener</span></span>  
 <span data-ttu-id="cb271-139">Добавление пользовательского прослушивателя трассировки на источник трассировки «Ведение журнала сообщений» должно быть привилегией исключительно администратора.</span><span class="sxs-lookup"><span data-stu-id="cb271-139">Adding a custom trace listener on the Message Logging trace source is a privilege that should be restricted to the administrator.</span></span> <span data-ttu-id="cb271-140">Это связано с тем, что пользовательские прослушиватели могут быть настроены злоумышленниками на удаленную отправку сообщений, что может привести к разглашению конфиденциальных сведений.</span><span class="sxs-lookup"><span data-stu-id="cb271-140">This is because malicious custom listeners can be configured to send messages remotely, which leads to sensitive information disclosure.</span></span> <span data-ttu-id="cb271-141">Кроме того, если пользовательский прослушиватель настроен на отправку сообщений по линии связи, например в удаленную базу данных, необходимо обеспечить надлежащее управление доступом к журналам сообщений на удаленной машине.</span><span class="sxs-lookup"><span data-stu-id="cb271-141">In addition, if you configure a custom listener to send messages on the wire, such as, to a remote database, you should enforce proper access control on the message logs in the remote machine.</span></span>  
  
## <a name="events-triggered-by-message-logging"></a><span data-ttu-id="cb271-142">События, активируемые регистрацией сообщений</span><span class="sxs-lookup"><span data-stu-id="cb271-142">Events Triggered by Message Logging</span></span>  
 <span data-ttu-id="cb271-143">Ниже приведен исчерпывающий список событий, формируемых регистрацией событий.</span><span class="sxs-lookup"><span data-stu-id="cb271-143">The following lists all the events emitted by message logging.</span></span>  
  
- <span data-ttu-id="cb271-144">Регистрация сообщений включена: это событие создается при включении регистрации сообщений в конфигурации или посредством инструментария WMI.</span><span class="sxs-lookup"><span data-stu-id="cb271-144">Message logging on: This event is emitted when message logging is enabled in configuration, or through WMI.</span></span> <span data-ttu-id="cb271-145">Содержание события: "Регистрация сообщений включена.</span><span class="sxs-lookup"><span data-stu-id="cb271-145">The content of the event is "Message logging has been turned on.</span></span> <span data-ttu-id="cb271-146">Секретные сведения могут регистрироваться без шифрования, даже если при передаче они были зашифрованы, например, тексты сообщений".</span><span class="sxs-lookup"><span data-stu-id="cb271-146">Sensitive information may be logged in clear text, even if they were encrypted on the wire, for example, message bodies."</span></span>  
  
- <span data-ttu-id="cb271-147">Регистрация сообщений отключена: это событие создается при отключении регистрации сообщений в конфигурации или посредством инструментария WMI.</span><span class="sxs-lookup"><span data-stu-id="cb271-147">Message logging off: This event is emitted when message logging is disabled through WMI.</span></span> <span data-ttu-id="cb271-148">Содержание события: "Регистрация сообщений отключена".</span><span class="sxs-lookup"><span data-stu-id="cb271-148">The content of the event is "Message logging has been turned off."</span></span>  
  
- <span data-ttu-id="cb271-149">Регистрация известных PII отключена: это событие создается при включении регистрации известных персональных данных.</span><span class="sxs-lookup"><span data-stu-id="cb271-149">Log Known PII On: This event is emitted when logging of known PII is enabled.</span></span> <span data-ttu-id="cb271-150">Это происходит, `enableLoggingKnownPii` когда `machineSettings` атрибут в элементе файла Machine.config установлен `true`на , и `logKnownPii` атрибут `source` элемента в app.config `true`или Web.config файл установлен на .</span><span class="sxs-lookup"><span data-stu-id="cb271-150">This happens when the `enableLoggingKnownPii` attribute in the `machineSettings` element of the Machine.config file is set to `true`, and the `logKnownPii` attribute of the `source` element in either the App.config or Web.config file is set to `true`.</span></span>  
  
- <span data-ttu-id="cb271-151">Регистрация известных PII запрещена: это событие создается, когда Регистрация известных персональных данных не разрешена.</span><span class="sxs-lookup"><span data-stu-id="cb271-151">Log Known PII Not Allowed: This event is emitted when logging of known PII is not allowed.</span></span> <span data-ttu-id="cb271-152">Это происходит, `logKnownPii` когда `source` атрибут элемента в файле App.config или `true`Web.config установлен, но `enableLoggingKnownPii` атрибут в `machineSettings` элементе `false`файла Machine.config установлен на .</span><span class="sxs-lookup"><span data-stu-id="cb271-152">This happens when the `logKnownPii` attribute of the `source` element in either the App.config or Web.config file is set to `true`, but the `enableLoggingKnownPii` attribute in the `machineSettings` element of the Machine.config file is set to `false`.</span></span> <span data-ttu-id="cb271-153">Исключение не возникает.</span><span class="sxs-lookup"><span data-stu-id="cb271-153">No exception is thrown.</span></span>  
  
 <span data-ttu-id="cb271-154">Эти события можно просмотреть с помощью средства просмотра событий, входящего в состав Windows.</span><span class="sxs-lookup"><span data-stu-id="cb271-154">These events can be viewed in the Event Viewer tool that comes with Windows.</span></span> <span data-ttu-id="cb271-155">Для получения дополнительной информации об этом [см.](./event-logging/index.md)</span><span class="sxs-lookup"><span data-stu-id="cb271-155">For more information on this, see [Event Logging](./event-logging/index.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="cb271-156">См. также раздел</span><span class="sxs-lookup"><span data-stu-id="cb271-156">See also</span></span>

- [<span data-ttu-id="cb271-157">Ведение журналов сообщений</span><span class="sxs-lookup"><span data-stu-id="cb271-157">Message Logging</span></span>](message-logging.md)
- [<span data-ttu-id="cb271-158">Проблемы безопасности и полезные советы при трассировке</span><span class="sxs-lookup"><span data-stu-id="cb271-158">Security Concerns and Useful Tips for Tracing</span></span>](./tracing/security-concerns-and-useful-tips-for-tracing.md)
