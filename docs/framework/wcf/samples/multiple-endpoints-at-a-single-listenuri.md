---
title: Несколько конечных точек по одному ListenUri
ms.date: 03/30/2017
ms.assetid: 911ffad4-4d47-4430-b7c2-79192ce6bcbd
ms.openlocfilehash: 8e26cc18ed35c446dda120c678dd7e879c756c0f
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/12/2020
ms.locfileid: "79183485"
---
# <a name="multiple-endpoints-at-a-single-listenuri"></a><span data-ttu-id="93fd3-102">Несколько конечных точек по одному ListenUri</span><span class="sxs-lookup"><span data-stu-id="93fd3-102">Multiple Endpoints at a Single ListenUri</span></span>
<span data-ttu-id="93fd3-103">В этом образце показана служба, в которой размещается несколько конечных точек по одному адресу `ListenUri`.</span><span class="sxs-lookup"><span data-stu-id="93fd3-103">This sample demonstrates a service that hosts multiple endpoints at a single `ListenUri`.</span></span> <span data-ttu-id="93fd3-104">Этот пример основан на [getting Started,](../../../../docs/framework/wcf/samples/getting-started-sample.md) который реализует услугу калькулятора.</span><span class="sxs-lookup"><span data-stu-id="93fd3-104">This sample is based on the [Getting Started](../../../../docs/framework/wcf/samples/getting-started-sample.md) that implements a calculator service.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="93fd3-105">Процедура настройки и инструкции по построению для данного образца приведены в конце этого раздела.</span><span class="sxs-lookup"><span data-stu-id="93fd3-105">The setup procedure and build instructions for this sample are located at the end of this topic.</span></span>  
  
 <span data-ttu-id="93fd3-106">Как показано в примере [Multiple Endpoints,](../../../../docs/framework/wcf/samples/multiple-endpoints.md) служба может размещать несколько конечных точек, каждая из которых имеет разные адреса и, возможно, также различные привязки.</span><span class="sxs-lookup"><span data-stu-id="93fd3-106">As demonstrated in the [Multiple Endpoints](../../../../docs/framework/wcf/samples/multiple-endpoints.md) sample, a service can host multiple endpoints, each with different addresses and possibly also different bindings.</span></span> <span data-ttu-id="93fd3-107">В этом образце показано, что можно разместить несколько конечных точек по одному адресу.</span><span class="sxs-lookup"><span data-stu-id="93fd3-107">This sample shows that it is possible to host multiple endpoints at the same address.</span></span> <span data-ttu-id="93fd3-108">Кроме того, в этом образце демонстрируются различия между двумя видами адресов конечной точки службы: `EndpointAddress` и `ListenUri`.</span><span class="sxs-lookup"><span data-stu-id="93fd3-108">This sample also demonstrates the differences between the two kinds of addresses that a service endpoint has: `EndpointAddress` and `ListenUri`.</span></span>  
  
 <span data-ttu-id="93fd3-109">`EndpointAddress` является логическим адресом службы.</span><span class="sxs-lookup"><span data-stu-id="93fd3-109">The `EndpointAddress` is the logical address of a service.</span></span> <span data-ttu-id="93fd3-110">Это адрес, по которому отправляются сообщения SOAP.</span><span class="sxs-lookup"><span data-stu-id="93fd3-110">It is the address that SOAP messages are addressed to.</span></span> <span data-ttu-id="93fd3-111">`ListenUri` является физическим адресом службы.</span><span class="sxs-lookup"><span data-stu-id="93fd3-111">The `ListenUri` is the physical address of the service.</span></span> <span data-ttu-id="93fd3-112">В нем содержится информация о порте и адресе, где конечная точка службы фактически прослушивает сообщения на текущем компьютере.</span><span class="sxs-lookup"><span data-stu-id="93fd3-112">It has the port and address information where the service endpoint actually listens for messages on the current machine.</span></span> <span data-ttu-id="93fd3-113">В большинстве случаев эти адреса не должны отличаться; если `ListenUri` не указан явно, по умолчанию используется URI из адреса `EndpointAddress` конечной точки.</span><span class="sxs-lookup"><span data-stu-id="93fd3-113">In most cases, there is no need for these addresses to differ; when a `ListenUri` is not explicitly specified, it defaults to the URI of the `EndpointAddress` of the endpoint.</span></span> <span data-ttu-id="93fd3-114">В некоторых случаях, например при настройке маршрутизатора, который может принимать сообщения, адресованные нескольким различным службам, эти адреса полезно различать.</span><span class="sxs-lookup"><span data-stu-id="93fd3-114">In a few cases, it is useful to distinguish them, such as when configuring a router, which might accept messages addressed to a number of different services.</span></span>  
  
## <a name="service"></a><span data-ttu-id="93fd3-115">Служба</span><span class="sxs-lookup"><span data-stu-id="93fd3-115">Service</span></span>  
 <span data-ttu-id="93fd3-116">Служба в образце имеет два контракта: `ICalculator` и `IEcho`.</span><span class="sxs-lookup"><span data-stu-id="93fd3-116">The service in this sample has two contracts, `ICalculator` and `IEcho`.</span></span> <span data-ttu-id="93fd3-117">Кроме обычной конечной точки `IMetadataExchange` существуют три конечные точки приложения, как показано в следующем коде.</span><span class="sxs-lookup"><span data-stu-id="93fd3-117">In addition to the customary `IMetadataExchange` endpoint, there are three application endpoints, as shown in the following code.</span></span>  
  
```xml  
<endpoint address="urn:Stuff"  
        binding="wsHttpBinding"  
        contract="Microsoft.ServiceModel.Samples.ICalculator"
        listenUri="http://localhost/servicemodelsamples/service.svc" />  
<endpoint address="urn:Stuff"  
        binding="wsHttpBinding"  
        contract="Microsoft.ServiceModel.Samples.IEcho"
        listenUri="http://localhost/servicemodelsamples/service.svc" />  
<endpoint address="urn:OtherEcho"  
        binding="wsHttpBinding"  
        contract="Microsoft.ServiceModel.Samples.IEcho"
        listenUri="http://localhost/servicemodelsamples/service.svc" />  
```  
  
 <span data-ttu-id="93fd3-118">Все три конечные точки размещаются по одному адресу `ListenUri` и используют одну привязку (`binding`) - конечные точки, расположенные по одному адресу `ListenUri`, должны иметь одну и ту же привязку, поскольку они совместно используют один стек каналов, который прослушивает сообщения в расположении, определенном данным физическим адресом на компьютере.</span><span class="sxs-lookup"><span data-stu-id="93fd3-118">All three endpoints are hosted at the same `ListenUri` and use the same `binding` - endpoints at the same `ListenUri` must have the same binding, because they are sharing a single channel stack that listens for messages at that physical address on the machine.</span></span> <span data-ttu-id="93fd3-119">Адрес (`address`) каждой конечной точки является универсальным именем ресурса (URN); несмотря на то что обычно адреса представляют физические расположения, фактически, адресом может быть URI любого вида, поскольку адрес используется для сопоставления и фильтрации, как показано в данном образце.</span><span class="sxs-lookup"><span data-stu-id="93fd3-119">The `address` of each endpoint is a URN; though typically addresses represent physical locations, in fact the address can be any kind of URI, because the address is used for matching and filtering purposes as is demonstrated in this sample.</span></span>  
  
 <span data-ttu-id="93fd3-120">Поскольку все три конечные точки имеют одинаковую `ListenUri`общую информацию, когда сообщение поступает туда, Фонд связи Windows (WCF) должен решить, для какой конечней точки предназначено сообщение.</span><span class="sxs-lookup"><span data-stu-id="93fd3-120">Because all three endpoints share the same `ListenUri`, when a message arrives there, Windows Communication Foundation (WCF) must decide which endpoint the message is destined for.</span></span> <span data-ttu-id="93fd3-121">Каждая конечная точка имеет фильтр сообщений, состоящий из двух частей: фильтр адресов и фильтр контрактов.</span><span class="sxs-lookup"><span data-stu-id="93fd3-121">Each endpoint has a message filter that is comprised of two parts: the address filter and the contract filter.</span></span> <span data-ttu-id="93fd3-122">Фильтр адресов сопоставляет значение поля `To` сообщения SOAP с адресом конечной точки службы.</span><span class="sxs-lookup"><span data-stu-id="93fd3-122">The address filter matches the `To` of the SOAP message to the address of the service endpoint.</span></span> <span data-ttu-id="93fd3-123">Например, только сообщения с адресацией `To "Urn:OtherEcho"` являются кандидатами для третьей конечной точки данной службы.</span><span class="sxs-lookup"><span data-stu-id="93fd3-123">For example, only messages addressed `To "Urn:OtherEcho"` are candidates for the third endpoint of this service.</span></span> <span data-ttu-id="93fd3-124">Фильтр контрактов соответствует действиям, связанным с операциями конкретного контракта.</span><span class="sxs-lookup"><span data-stu-id="93fd3-124">The contract filter matches the Actions associated with the operations of a particular contract.</span></span> <span data-ttu-id="93fd3-125">Например, сообщения с действием `IEcho`.</span><span class="sxs-lookup"><span data-stu-id="93fd3-125">For example, messages with the action of `IEcho`.</span></span> <span data-ttu-id="93fd3-126">`Echo` сопоставляется с фильтрами контрактов второй и третьей конечной точки данной службы, поскольку обе эти конечные точки размещают контракт `IEcho`.</span><span class="sxs-lookup"><span data-stu-id="93fd3-126">`Echo` matches the contract filters of both the second and third endpoints of this service, because both of those endpoints host the `IEcho` contract.</span></span>  
  
 <span data-ttu-id="93fd3-127">Таким образом, комбинация фильтра адресов и фильтра контрактов позволяет направлять каждое сообщение, поступающее по адресу `ListenUri` данной службы, в правильную конечную точку.</span><span class="sxs-lookup"><span data-stu-id="93fd3-127">Thus the combination of address filter and contract filter makes it possible to route each message that arrives at this service's `ListenUri` to the correct endpoint.</span></span> <span data-ttu-id="93fd3-128">Третья конечная точка отличается от других двух, поскольку она принимает сообщения, отправляемые по другому адресу из других конечных точек.</span><span class="sxs-lookup"><span data-stu-id="93fd3-128">The third endpoint is differentiated from the other two because it accepts messages sent to a different address from the other endpoints.</span></span> <span data-ttu-id="93fd3-129">Первая и вторая конечные точки отличаются друг от друга своими контрактами (действием исходящего сообщения).</span><span class="sxs-lookup"><span data-stu-id="93fd3-129">The first and second endpoints are differentiated from each other based on their contracts (the Action of the incoming message).</span></span>  
  
## <a name="client"></a><span data-ttu-id="93fd3-130">клиент</span><span class="sxs-lookup"><span data-stu-id="93fd3-130">Client</span></span>  
 <span data-ttu-id="93fd3-131">Как и в случае конечных точек сервера у конечных точек клиента имеется два адреса.</span><span class="sxs-lookup"><span data-stu-id="93fd3-131">Just as endpoints on the server have two different addresses, client endpoints also have two addresses.</span></span> <span data-ttu-id="93fd3-132">Логический адрес на сервере и на клиенте называется `EndpointAddress`.</span><span class="sxs-lookup"><span data-stu-id="93fd3-132">On both server and client, the logical address is called the `EndpointAddress`.</span></span> <span data-ttu-id="93fd3-133">Однако на сервере физический адрес называется `ListenUri`, в то время как на клиенте он называется `Via`.</span><span class="sxs-lookup"><span data-stu-id="93fd3-133">But whereas the physical address is called the `ListenUri` on the server, on the client, the physical address is called the `Via`.</span></span>  
  
 <span data-ttu-id="93fd3-134">Аналогично серверу по умолчанию эти два адреса одинаковы.</span><span class="sxs-lookup"><span data-stu-id="93fd3-134">As on the server, by default, these two addresses are the same.</span></span> <span data-ttu-id="93fd3-135">Для задания на клиенте адреса `Via`, отличающегося от адреса конечной точки, используется `ClientViaBehavior`:</span><span class="sxs-lookup"><span data-stu-id="93fd3-135">To specify a `Via` on the client that is different from the endpoint's address, `ClientViaBehavior` is used:</span></span>  
  
```csharp  
Uri via = new Uri("http://localhost/ServiceModelSamples/service.svc");  
CalculatorClient calcClient = new CalculatorClient();  
calcClient.ChannelFactory.Endpoint.Behaviors.Add(  
        new ClientViaBehavior(via));  
```  
  
 <span data-ttu-id="93fd3-136">Как обычно, адрес поступает из файла конфигурации клиента, созданного с помощью средства Svcutil.exe.</span><span class="sxs-lookup"><span data-stu-id="93fd3-136">As usual, the address comes from the client configuration file, which was generated by Svcutil.exe.</span></span> <span data-ttu-id="93fd3-137">Адрес `Via` (который соответствует `ListenUri` службы) не отображается в метаданных службы, таким образом, эту информацию необходимо передать клиенту вне диапазона (аналогично адресу метаданных службы).</span><span class="sxs-lookup"><span data-stu-id="93fd3-137">The `Via` (which corresponds to the `ListenUri` of the service) does not appear in the service's metadata and so this information must be communicated to the client out-of-band (just like the service's metadata address).</span></span>  
  
 <span data-ttu-id="93fd3-138">В этом образце клиент отправляет сообщения каждой из трех конечных точек приложения, чтобы показать, что он может взаимодействовать со всеми тремя конечными точками (и различать их), даже если они имеют один и тот же адрес `Via`.</span><span class="sxs-lookup"><span data-stu-id="93fd3-138">The client in this sample sends messages to each of the server's three application endpoints, to demonstrate that it can communicate with (and differentiate) all three endpoints, even though they all have the same `Via`.</span></span>  
  
#### <a name="to-set-up-build-and-run-the-sample"></a><span data-ttu-id="93fd3-139">Настройка, сборка и выполнение образца</span><span class="sxs-lookup"><span data-stu-id="93fd3-139">To set up, build, and run the sample</span></span>  
  
1. <span data-ttu-id="93fd3-140">Убедитесь, что вы выполнили [одноразовую процедуру настройки для образцов Фонда связи Windows.](../../../../docs/framework/wcf/samples/one-time-setup-procedure-for-the-wcf-samples.md)</span><span class="sxs-lookup"><span data-stu-id="93fd3-140">Ensure that you have performed the [One-Time Setup Procedure for the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/one-time-setup-procedure-for-the-wcf-samples.md).</span></span>  
  
2. <span data-ttu-id="93fd3-141">Чтобы создать выпуск решения на языке C# или Visual Basic .NET, следуйте инструкциям в разделе [Building the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/building-the-samples.md).</span><span class="sxs-lookup"><span data-stu-id="93fd3-141">To build the C# or Visual Basic .NET edition of the solution, follow the instructions in [Building the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/building-the-samples.md).</span></span>  
  
3. <span data-ttu-id="93fd3-142">Чтобы запустить образец в одно- или кросс-машинной конфигурации, следуйте инструкциям в [Запуске образцов Фонда связи Windows.](../../../../docs/framework/wcf/samples/running-the-samples.md)</span><span class="sxs-lookup"><span data-stu-id="93fd3-142">To run the sample in a single- or cross-machine configuration, follow the instructions in [Running the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/running-the-samples.md).</span></span>  
  
    > [!NOTE]
    > <span data-ttu-id="93fd3-143">В случае нескольких компьютеров в файле Client.cs необходимо заменить localhost именем компьютера службы.</span><span class="sxs-lookup"><span data-stu-id="93fd3-143">For cross-machine, you must replace localhost in the Client.cs file with the name of the service machine.</span></span>  
  
> [!IMPORTANT]
> <span data-ttu-id="93fd3-144">Образцы уже могут быть установлены на компьютере.</span><span class="sxs-lookup"><span data-stu-id="93fd3-144">The samples may already be installed on your machine.</span></span> <span data-ttu-id="93fd3-145">Перед продолжением проверьте следующий каталог (по умолчанию).</span><span class="sxs-lookup"><span data-stu-id="93fd3-145">Check for the following (default) directory before continuing.</span></span>  
>
> `<InstallDrive>:\WF_WCF_Samples`  
>
> <span data-ttu-id="93fd3-146">Если этого каталога не существует, перейдите в [Windows Communication Foundation (WCF) и Windows Workflow Foundation (WF) Образцы для .NET Framework 4,](https://www.microsoft.com/download/details.aspx?id=21459) чтобы загрузить все Windows Communication Foundation (WCF) и [!INCLUDE[wf1](../../../../includes/wf1-md.md)] образцы.</span><span class="sxs-lookup"><span data-stu-id="93fd3-146">If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://www.microsoft.com/download/details.aspx?id=21459) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples.</span></span> <span data-ttu-id="93fd3-147">Этот образец расположен в следующем каталоге.</span><span class="sxs-lookup"><span data-stu-id="93fd3-147">This sample is located in the following directory.</span></span>  
>
> `<InstallDrive>:\WF_WCF_Samples\WCF\Basic\Services\MultipleEndpointsSingleUri`  
