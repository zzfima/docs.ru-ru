---
title: "Условные методы Get и Put"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 3d22067f-57b8-4e0f-a571-a694512187ae
caps.latest.revision: "8"
author: Erikre
ms.author: erikre
manager: erikre
ms.openlocfilehash: e4ab4d0a97cbbaa2e5aaee25e0154e1cc94a82f8
ms.sourcegitcommit: bd1ef61f4bb794b25383d3d72e71041a5ced172e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/18/2017
---
# <a name="conditional-get-and-put"></a><span data-ttu-id="97e6c-102">Условные методы Get и Put</span><span class="sxs-lookup"><span data-stu-id="97e6c-102">Conditional Get and Put</span></span>
<span data-ttu-id="97e6c-103">В этом образце демонстрируется использование новых интерфейсов API условного получения и обновления для модели программирования WCF REST.</span><span class="sxs-lookup"><span data-stu-id="97e6c-103">This sample demonstrates how to use the new conditional retrieve and update APIs for the WCF REST programming model.</span></span> <span data-ttu-id="97e6c-104">Поскольку больше всего подходят для условного получения и обновления ориентацией на ресурсы и службы REST, в этом примере расширяет [базовой службы ресурсов](../../../../docs/framework/wcf/samples/basic-resource-service.md) образца.</span><span class="sxs-lookup"><span data-stu-id="97e6c-104">Because conditional retrieve and update are most appropriate for resource-oriented and REST services, this sample extends the [Basic Resource Service](../../../../docs/framework/wcf/samples/basic-resource-service.md) sample.</span></span> <span data-ttu-id="97e6c-105">В этом примере уделяется добавлена поддержка условного получения и обновления для [базовой службы ресурсов](../../../../docs/framework/wcf/samples/basic-resource-service.md) образца с помощью новых API, представленные в [!INCLUDE[netfx40_long](../../../../includes/netfx40-long-md.md)].</span><span class="sxs-lookup"><span data-stu-id="97e6c-105">This sample focuses on adding support for conditional retrieve and update to the [Basic Resource Service](../../../../docs/framework/wcf/samples/basic-resource-service.md) sample using the new APIs introduced in [!INCLUDE[netfx40_long](../../../../includes/netfx40-long-md.md)].</span></span>  
  
## <a name="demonstrates"></a><span data-ttu-id="97e6c-106">Демонстрации</span><span class="sxs-lookup"><span data-stu-id="97e6c-106">Demonstrates</span></span>  
 <span data-ttu-id="97e6c-107">Условное получение и обновление</span><span class="sxs-lookup"><span data-stu-id="97e6c-107">Conditional Retrieve and Update</span></span>  
  
## <a name="discussion"></a><span data-ttu-id="97e6c-108">Обсуждение</span><span class="sxs-lookup"><span data-stu-id="97e6c-108">Discussion</span></span>  
 <span data-ttu-id="97e6c-109">В этом образце служба WCF предоставляет доступ к коллекции клиентов в стиле REST и с ориентацией на ресурсы.</span><span class="sxs-lookup"><span data-stu-id="97e6c-109">The WCF service in this sample exposes a collection of customers in a resource-oriented and REST manner.</span></span> <span data-ttu-id="97e6c-110">Подробное описание реализации службы, см. в разделе [базовой службы ресурсов](../../../../docs/framework/wcf/samples/basic-resource-service.md) образца.</span><span class="sxs-lookup"><span data-stu-id="97e6c-110">For a detailed description of the service implementation, please see the [Basic Resource Service](../../../../docs/framework/wcf/samples/basic-resource-service.md) sample.</span></span>  
  
 <span data-ttu-id="97e6c-111">В этом примере добавляется условного получения и обновления возможностей [базовой службы ресурсов](../../../../docs/framework/wcf/samples/basic-resource-service.md) образца.</span><span class="sxs-lookup"><span data-stu-id="97e6c-111">This sample adds conditional retrieve and update capabilities to the [Basic Resource Service](../../../../docs/framework/wcf/samples/basic-resource-service.md) sample.</span></span> <span data-ttu-id="97e6c-112">Для проверки наличия у клиента последней сущности для данного ресурса при условном получении и обновлении используются теги сущности HTTP и заголовки HTTP If-None-Match и If-Match.</span><span class="sxs-lookup"><span data-stu-id="97e6c-112">Conditional retrieve and update use HTTP entity tags and the HTTP If-None-Match and If-Match headers to validate that clients either have or do not have the most current entity for a given resource.</span></span> <span data-ttu-id="97e6c-113">Однако реализация кода для правильной проверки заголовков HTTP If-None-Match и If-Match занимает много времени и редко получается без ошибок.</span><span class="sxs-lookup"><span data-stu-id="97e6c-113">However, implementing the code to correctly parse the HTTP If-None-Match and If-Match headers can be tedious and error-prone.</span></span> <span data-ttu-id="97e6c-114">В связи с этим в контекст <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> были добавлены методы <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> и <xref:System.ServiceModel.Web.IncomingWebRequestContext>, доступ к которым можно получить с помощью текущего экземпляра контекста <xref:System.ServiceModel.Web.WebOperationContext>.</span><span class="sxs-lookup"><span data-stu-id="97e6c-114">Therefore, the <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> and <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> methods have been added to the <xref:System.ServiceModel.Web.IncomingWebRequestContext>, which can be accessed using the current instance of the <xref:System.ServiceModel.Web.WebOperationContext>.</span></span> <span data-ttu-id="97e6c-115">Кроме того, в контекст `SetETag` был добавлен метод <xref:System.ServiceModel.Web.OutgoingWebRequestContext>, что упрощает возврат допустимых тегов сущностей.</span><span class="sxs-lookup"><span data-stu-id="97e6c-115">In addition, the `SetETag` method has been added to the <xref:System.ServiceModel.Web.OutgoingWebRequestContext>, making it easier to return valid entity tags.</span></span>  
  
 <span data-ttu-id="97e6c-116">Метод <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> предназначен для использования с операциями [WebGet].</span><span class="sxs-lookup"><span data-stu-id="97e6c-116">The <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> method is intended to be used with [WebGet] operations.</span></span> <span data-ttu-id="97e6c-117">Он принимает тег текущей сущности данного ресурса в качестве параметра `entityTag`, который может иметь тип `string`, `int`, `long` или `Guid`.</span><span class="sxs-lookup"><span data-stu-id="97e6c-117">It takes the current entity tag for the given resource as the `entityTag` parameter, which can be a `string`, `int`, `long` or `Guid`.</span></span> <span data-ttu-id="97e6c-118">Метод <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> проверяет тег сущности по заголовку HTTP If-None-Match запроса.</span><span class="sxs-lookup"><span data-stu-id="97e6c-118">The <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> method checks the entity tag against the HTTP If-None-Match header of the request.</span></span> <span data-ttu-id="97e6c-119">Если этот тег сущности имеется в заголовке HTTP If-None-Match, то формируется исключение <xref:System.ServiceModel.Web.WebFaultException> с кодом состояния «Не изменено» (304). В противном случае метод возвращает значение.</span><span class="sxs-lookup"><span data-stu-id="97e6c-119">If the entity tag is present in the HTTP If-None-Match header, then a <xref:System.ServiceModel.Web.WebFaultException> with a status code of Not Modified (304) is thrown; otherwise the method returns.</span></span> <span data-ttu-id="97e6c-120">Этот механизм условного получения позволяет клиенту сообщать серверу, что у него есть эта сущность, и отправлять текущую сущность, только если ее у клиента нет.</span><span class="sxs-lookup"><span data-stu-id="97e6c-120">The conditional retrieve mechanism allows the client to tell the server that it has this entity and to only send the current entity if the client does not already have it.</span></span> <span data-ttu-id="97e6c-121">Пример использования метода <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> можно посмотреть в операциях `GetCustomer` и `GetCustomers` службы.</span><span class="sxs-lookup"><span data-stu-id="97e6c-121">Example usage of the <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> method can be seen in the `GetCustomer` and `GetCustomers` operations of the service.</span></span> <span data-ttu-id="97e6c-122">Важно отметить, что при вызове метода <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> значение может быть не возвращено.</span><span class="sxs-lookup"><span data-stu-id="97e6c-122">It is important to note that calls to <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> may not return.</span></span> <span data-ttu-id="97e6c-123">Разработчикам следует реализовывать операцию так, чтобы до вызова метода <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> уже было известно, что запрос выполнен успешно, с тем чтобы при отсутствии вызова метода <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> служба отправляла сообщение с кодом состояния успешного выполнения.</span><span class="sxs-lookup"><span data-stu-id="97e6c-123">Developers should implement the operation so that the request is already known to be successful before the call to <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> is executed, such that if the call to <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> was not present, the service would send a response with a successful status code.</span></span>  
  
 <span data-ttu-id="97e6c-124">Метод <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> похож на метод <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A>.</span><span class="sxs-lookup"><span data-stu-id="97e6c-124">The <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> method is similar to the <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> method.</span></span> <span data-ttu-id="97e6c-125">Он тоже принимает тег текущей сущности для данного ресурса.</span><span class="sxs-lookup"><span data-stu-id="97e6c-125">It also takes the current entity tag for the given resource.</span></span> <span data-ttu-id="97e6c-126">Тем не менее он предназначен для использования с операциями [WebInvoke], в которых метод имеет значение «PUT» или «DELETE».</span><span class="sxs-lookup"><span data-stu-id="97e6c-126">However, it is intended to be used with [WebInvoke] operations in which the method is set to "PUT" or "DELETE".</span></span> <span data-ttu-id="97e6c-127">Метод <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> проверяет тег сущности по заголовку HTTP If-Match запроса.</span><span class="sxs-lookup"><span data-stu-id="97e6c-127">The <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> method checks the entity tag against the HTTP If-Match header of the request.</span></span> <span data-ttu-id="97e6c-128">Если в заголовке HTTP If-Match тег сущности отсутствует, то формируется исключение <xref:System.ServiceModel.Web.WebFaultException> с кодом состояния «Предварительное условие не выполнено» (412).</span><span class="sxs-lookup"><span data-stu-id="97e6c-128">If the entity tag is not present in the HTTP If-Match header, then a <xref:System.ServiceModel.Web.WebFaultException> with a status code of Precondition Failed (412) is thrown.</span></span> <span data-ttu-id="97e6c-129">Этот механизм условного обновления позволяет клиенту сообщать серверу, что у него есть эта сущность для ресурса; он позволяет клиенту изменять ресурс, только если имеющаяся у него сущность является текущей.</span><span class="sxs-lookup"><span data-stu-id="97e6c-129">The conditional update mechanism allows the client to tell the server that it has this entity for the resource and to only allow the client to alter the resource; if the entity it has is current.</span></span> <span data-ttu-id="97e6c-130">Пример использования метода <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> можно посмотреть в операциях `UpdateCustomer` и `DeleteCustomer` службы.</span><span class="sxs-lookup"><span data-stu-id="97e6c-130">Example usage of the <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> method can be seen in the `UpdateCustomer` and `DeleteCustomer` operations of the service.</span></span> <span data-ttu-id="97e6c-131">Как и в случае с методом <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A>, важно отметить, что при вызове метода <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> значение может быть не возвращено.</span><span class="sxs-lookup"><span data-stu-id="97e6c-131">Just as with <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A>, it is important to note that calls to <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> may not return.</span></span> <span data-ttu-id="97e6c-132">Разработчикам следует реализовывать операцию так, чтобы до вызова метода <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> уже было известно, что запрос выполнен успешно, с тем чтобы при отсутствии вызова метода <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> служба отправляла сообщение с кодом состояния успешного выполнения.</span><span class="sxs-lookup"><span data-stu-id="97e6c-132">Developers should implement the operation such that the request is already known to be successful before the call to <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> is executed, such that if the call to <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> was not present, the service would respond with a successful status code.</span></span>  
  
 <span data-ttu-id="97e6c-133">Образец состоит из резидентной службы и клиента, который работает в консольном приложении.</span><span class="sxs-lookup"><span data-stu-id="97e6c-133">The sample consists of a self-hosted service and a client that runs within a console application.</span></span> <span data-ttu-id="97e6c-134">Во время выполнения консольного приложения клиент совершает запросы к службе и выводит в окно консоли нужные сведения из ответов.</span><span class="sxs-lookup"><span data-stu-id="97e6c-134">As the console application runs, the client makes requests to the service and writes the pertinent information from the responses to the console window.</span></span>  
  
#### <a name="to-run-the-sample"></a><span data-ttu-id="97e6c-135">Выполнение образца</span><span class="sxs-lookup"><span data-stu-id="97e6c-135">To run the sample</span></span>  
  
1.  <span data-ttu-id="97e6c-136">Откройте решение для образца Conditional Get and Put.</span><span class="sxs-lookup"><span data-stu-id="97e6c-136">Open the solution for the Conditional Get and Put sample.</span></span> <span data-ttu-id="97e6c-137">Для успешного выполнения образца среду [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)] необходимо запускать от имени администратора.</span><span class="sxs-lookup"><span data-stu-id="97e6c-137">When launching [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)], you must run as an administrator to execute the sample successfully.</span></span> <span data-ttu-id="97e6c-138">Для этого щелкните правой кнопкой мыши [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)] значок и выбрав **Запуск от имени администратора** в контекстном меню.</span><span class="sxs-lookup"><span data-stu-id="97e6c-138">Do this by right-clicking the [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)] icon and choosing **Run as Administrator** from the context menu.</span></span>  
  
2.  <span data-ttu-id="97e6c-139">Нажмите сочетание клавиш CTRL+SHIFT+B, чтобы построить решение, а затем сочетание клавиш CTRL+F5, чтобы запустить проект консольного приложения.</span><span class="sxs-lookup"><span data-stu-id="97e6c-139">Press CTRL+SHIFT+B to build the solution and then press CTRL+F5 to run the console application project.</span></span> <span data-ttu-id="97e6c-140">Если запустить этот проект с включенной функцией отладки (нажав клавишу F5 вместо CTRL+F5), то отладчик будет останавливаться, когда условная проверка GET и PUT формирует исключение.</span><span class="sxs-lookup"><span data-stu-id="97e6c-140">If running this project with debugging enabled (by pressing F5 instead of CTRL+F5), the debugger stops when an exception is thrown by the conditional GET and PUT checking.</span></span> <span data-ttu-id="97e6c-141">В этом случае нажмите клавишу F5, чтобы продолжить выполнение образца.</span><span class="sxs-lookup"><span data-stu-id="97e6c-141">When this happens, press F5 to continue executing the sample.</span></span>  
  
3.  <span data-ttu-id="97e6c-142">Открывается окно консоли с URI запущенной службы и URI HTML-страницы справки для запущенной службы.</span><span class="sxs-lookup"><span data-stu-id="97e6c-142">The console window appear sand provides the URI of the running service and the URI of the HTML help page for the running service.</span></span>  
  
4.  <span data-ttu-id="97e6c-143">Во время выполнения образца клиент отправляет запросы к службе и выводит ответы в окно консоли.</span><span class="sxs-lookup"><span data-stu-id="97e6c-143">As the sample runs, the client sends requests to the service and writes the responses to the console window.</span></span>  
  
5.  <span data-ttu-id="97e6c-144">Чтобы завершить образец, нажмите любую клавишу.</span><span class="sxs-lookup"><span data-stu-id="97e6c-144">Press any key to terminate the sample.</span></span>  
  
> [!IMPORTANT]
>  <span data-ttu-id="97e6c-145">Образцы уже могут быть установлены на компьютере.</span><span class="sxs-lookup"><span data-stu-id="97e6c-145">The samples may already be installed on your machine.</span></span> <span data-ttu-id="97e6c-146">Перед продолжением проверьте следующий каталог (по умолчанию).</span><span class="sxs-lookup"><span data-stu-id="97e6c-146">Check for the following (default) directory before continuing.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples`  
>   
>  <span data-ttu-id="97e6c-147">Если этот каталог не существует, перейдите на страницу [Примеры Windows Communication Foundation (WCF) и Windows Workflow Foundation (WF) для .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) , чтобы скачать все примеры [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] и [!INCLUDE[wf1](../../../../includes/wf1-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="97e6c-147">If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) to download all [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples.</span></span> <span data-ttu-id="97e6c-148">Этот образец расположен в следующем каталоге.</span><span class="sxs-lookup"><span data-stu-id="97e6c-148">This sample is located in the following directory.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples\WCF\Basic\Web\ConditionalGetAndPut`
