---
title: "Процедура однократной настройки образцов Windows Communication Foundation"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: a5848ffd-3eb5-432d-812e-bd948ccb6bca
caps.latest.revision: "83"
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.workload: dotnet
ms.openlocfilehash: bab723e4e52db9936e635f1348dff86d75de274d
ms.sourcegitcommit: c0dd436f6f8f44dc80dc43b07f6841a00b74b23f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/19/2018
---
# <a name="one-time-setup-procedure-for-the-windows-communication-foundation-samples"></a><span data-ttu-id="80e9d-102">Процедура однократной настройки образцов Windows Communication Foundation</span><span class="sxs-lookup"><span data-stu-id="80e9d-102">One-Time Setup Procedure for the Windows Communication Foundation Samples</span></span>
<span data-ttu-id="80e9d-103">Большинство примеров [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] размещаются в службах IIS и выполняются из общего виртуального каталога.</span><span class="sxs-lookup"><span data-stu-id="80e9d-103">Most of the [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] samples are hosted in Internet Information Services (IIS) and run from a common virtual directory.</span></span> <span data-ttu-id="80e9d-104">Эта процедура однократной настройки создает папку на диске. Он также добавляет виртуальный каталог IIS с именем **ServiceModelSamples**.</span><span class="sxs-lookup"><span data-stu-id="80e9d-104">This one-time setup procedure creates a folder on the disk; it also adds a virtual directory to IIS named **ServiceModelSamples**.</span></span>  
  
 <span data-ttu-id="80e9d-105">**ServiceModelSamples** виртуальный каталог используется для построения и выполнения всех образцов, которые используют службу, размещенную в IIS.</span><span class="sxs-lookup"><span data-stu-id="80e9d-105">The **ServiceModelSamples** virtual directory is used for building and running all samples that use an IIS-hosted service.</span></span> <span data-ttu-id="80e9d-106">Это единственный виртуальный каталог, необходимый для выполнения примеров.</span><span class="sxs-lookup"><span data-stu-id="80e9d-106">This is the only virtual directory that is required to run the samples.</span></span> <span data-ttu-id="80e9d-107">При построении образца будет заменена любая служба, развернутая ранее в этом виртуальном каталоге. Развернут и доступен в данном виртуальном каталоге будет только последний построенный образец.</span><span class="sxs-lookup"><span data-stu-id="80e9d-107">Building a sample will replace any previously deployed service at this virtual directory; only the most recently built sample will be deployed and available in this virtual directory.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="80e9d-108">Необходимо выполнить все команды от имени учетной записи локального администратора.</span><span class="sxs-lookup"><span data-stu-id="80e9d-108">You must run all commands under a local administrator account.</span></span> <span data-ttu-id="80e9d-109">При использовании Windows 7, [!INCLUDE[windowsver](../../../../includes/windowsver-md.md)] или Windows Server 2008 R2 необходимо запустить командную строку с более высоким уровнем привилегий.</span><span class="sxs-lookup"><span data-stu-id="80e9d-109">If you are using Windows 7, [!INCLUDE[windowsver](../../../../includes/windowsver-md.md)], or Windows Server 2008 R2, you must also run the command prompt with elevated privileges.</span></span> <span data-ttu-id="80e9d-110">Чтобы сделать это, щелкните правой кнопкой мыши значок командной строки и нажмите кнопку **Запуск от имени администратора**.</span><span class="sxs-lookup"><span data-stu-id="80e9d-110">To do so, right-click the command prompt icon, and then click **Run as administrator**.</span></span> <span data-ttu-id="80e9d-111">Все команды в данном разделе должны выполняться в командной строке с соответствующим образом заданными параметрами пути.</span><span class="sxs-lookup"><span data-stu-id="80e9d-111">All commands in this topic must be run in a command prompt that has the appropriate path settings.</span></span>  <span data-ttu-id="80e9d-112">Проще всего добиться этого, используя командную строку Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="80e9d-112">The easiest way to ensure this is by using the Visual Studio Command Prompt.</span></span> <span data-ttu-id="80e9d-113">Чтобы открыть этот запрос, нажмите кнопку **запустить**выберите **все программы**, прокрутите вниз до **Visual Studio 2010**выберите **набора средств Visual Studio**, Щелкните правой кнопкой мыши **командной строки Visual Studio (2010)**, а затем нажмите кнопку **Запуск от имени администратора**.</span><span class="sxs-lookup"><span data-stu-id="80e9d-113">To open this prompt, click **Start**, select **All Programs**, scroll down to **Visual Studio 2010**, select **Visual Studio Tools**, right-click **Visual Studio Command Prompt (2010)**, and then click **Run as administrator**.</span></span> <span data-ttu-id="80e9d-114">Если установлен один из выпусков Visual Studio Express, эта командная строка недоступна. В этом случае добавьте в системный путь строку «C:\Windows\Microsoft.Net\Framework\v4.0».</span><span class="sxs-lookup"><span data-stu-id="80e9d-114">If you have one of the Visual Studio Express editions installed, this command prompt is not available, and you will have to add "C:\Windows\Microsoft.Net\Framework\v4.0" to the system path.</span></span>  
  
### <a name="one-time-setup-procedure-for-wcf-samples"></a><span data-ttu-id="80e9d-115">Однократно настраиваемая процедура для образцов WCF</span><span class="sxs-lookup"><span data-stu-id="80e9d-115">One-time setup procedure for WCF samples</span></span>  
  
1.  <span data-ttu-id="80e9d-116">Убедитесь, что [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] установлена.</span><span class="sxs-lookup"><span data-stu-id="80e9d-116">Ensure that [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] is set up.</span></span> [!INCLUDE[crabout](../../../../includes/crabout-md.md)]<span data-ttu-id="80e9d-117">как настроить [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)], в разделе [службы размещения инструкции по IIS](../../../../docs/framework/wcf/samples/internet-information-service-hosting-instructions.md).</span><span class="sxs-lookup"><span data-stu-id="80e9d-117"> how to set up [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)], see [Internet Information Service Hosting Instructions](../../../../docs/framework/wcf/samples/internet-information-service-hosting-instructions.md).</span></span>  
  
2.  <span data-ttu-id="80e9d-118">Убедитесь, что установлена платформа [!INCLUDE[netfx40_long](../../../../includes/netfx40-long-md.md)].</span><span class="sxs-lookup"><span data-stu-id="80e9d-118">Ensure that [!INCLUDE[netfx40_long](../../../../includes/netfx40-long-md.md)] is installed.</span></span> <span data-ttu-id="80e9d-119">Найдите каталог для версии 4.0 (или более поздней версии): **\Windows\Microsoft.NET\Framework**</span><span class="sxs-lookup"><span data-stu-id="80e9d-119">Search the following directory for v4.0 (or later): **\Windows\Microsoft.NET\Framework**</span></span>  
  
3.  <span data-ttu-id="80e9d-120">Если [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)] не установлен, и операционная система не Windows Server 2008 SP2 или более поздней версии, установите [251798 исправление](http://go.microsoft.com/fwlink/?LinkId=184693).</span><span class="sxs-lookup"><span data-stu-id="80e9d-120">If [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)] is not installed, and your operating system is not Windows Server 2008 SP2 or later, install [Hotfix 251798](http://go.microsoft.com/fwlink/?LinkId=184693).</span></span>  
  
4.  <span data-ttu-id="80e9d-121">Выполните следующие команды.</span><span class="sxs-lookup"><span data-stu-id="80e9d-121">Run the following commands.</span></span> <span data-ttu-id="80e9d-122">Дополнительные сведения о том, почему необходимо запустить эти команды см. в разделе [сбое размещенной службы IIS](http://msdn.microsoft.com/library/ee5499fc-1b10-4cda-a9b1-13dba70f05f8).</span><span class="sxs-lookup"><span data-stu-id="80e9d-122">For more information about why these commands must be run, see [IIS Hosted Service Fails](http://msdn.microsoft.com/library/ee5499fc-1b10-4cda-a9b1-13dba70f05f8).</span></span>  
  
    > [!WARNING]
    >  <span data-ttu-id="80e9d-123">Если IIS был переустановлен, необходимо вновь выполнить следующие команды.</span><span class="sxs-lookup"><span data-stu-id="80e9d-123">If IIS is reinstalled, the following commands will need to be run again.</span></span>  
  
    ```  
    "%WINDIR%\Microsoft.Net\Framework\v4.0.30319\aspnet_regiis" –i –enable  
    "%WINDIR%\Microsoft.Net\Framework\v4.0.30319\ServiceModelReg.exe" -r  
    ```  
  
    > [!WARNING]
    >  <span data-ttu-id="80e9d-124">Выполнение команды `aspnet_regiis –i –enable` будет выполняться пул приложений по умолчанию с использованием [!INCLUDE[netfx40_short](../../../../includes/netfx40-short-md.md)], что могут возникнуть проблемы совместимости для других приложений на том же компьютере.</span><span class="sxs-lookup"><span data-stu-id="80e9d-124">Running the command `aspnet_regiis –i –enable` will make the Default App Pool run using [!INCLUDE[netfx40_short](../../../../includes/netfx40-short-md.md)], which may produce incompatibility issues for other applications on the same computer.</span></span>  
  
5.  <span data-ttu-id="80e9d-125">Выполните [инструкции брандмауэра](../../../../docs/framework/wcf/samples/firewall-instructions.md) для включения порты, используемые в образцах.</span><span class="sxs-lookup"><span data-stu-id="80e9d-125">Follow the [Firewall Instructions](../../../../docs/framework/wcf/samples/firewall-instructions.md) for enabling the ports used by the samples.</span></span>  
  
6.  <span data-ttu-id="80e9d-126">Проверьте следующий каталог по умолчанию: \<Диск_установки >:**\WF_WCF_Samples**.</span><span class="sxs-lookup"><span data-stu-id="80e9d-126">Check for the following default directory: \<InstallDrive>:**\WF_WCF_Samples**.</span></span> <span data-ttu-id="80e9d-127">Если образцы были предварительно установлены, этот каталог будет выбран по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="80e9d-127">If the samples were previously installed, this is the default directory.</span></span>  
  
7.  <span data-ttu-id="80e9d-128">Если образцы не устанавливаются, установите их из расположения загрузки образцов для [Visual C#](http://go.microsoft.com/fwlink/?LinkId=190939) или [Visual Basic](http://go.microsoft.com/fwlink/?LinkID=193373).</span><span class="sxs-lookup"><span data-stu-id="80e9d-128">If the samples are not installed, install them from the samples download location for [Visual C#](http://go.microsoft.com/fwlink/?LinkId=190939) or [Visual Basic](http://go.microsoft.com/fwlink/?LinkID=193373).</span></span>  
  
8.  <span data-ttu-id="80e9d-129">После установки образцов перейдите: \<Диск_установки >:**\WF_WCF_Samples\WCF\Setup\\**</span><span class="sxs-lookup"><span data-stu-id="80e9d-129">After installing the samples, go to : \<InstallDrive>:**\WF_WCF_Samples\WCF\Setup\\**</span></span>  
  
9. <span data-ttu-id="80e9d-130">Запустите **Setupvroot.bat** пакетного файла.</span><span class="sxs-lookup"><span data-stu-id="80e9d-130">Run the **Setupvroot.bat** batch file.</span></span> <span data-ttu-id="80e9d-131">Выполняются следующие действия.</span><span class="sxs-lookup"><span data-stu-id="80e9d-131">The following steps are performed:</span></span>  
  
    -   <span data-ttu-id="80e9d-132">В службах IIS создается виртуальный каталог с именем ServiceModelSamples.</span><span class="sxs-lookup"><span data-stu-id="80e9d-132">A virtual directory is created in IIS named ServiceModelSamples.</span></span>  
  
    -   <span data-ttu-id="80e9d-133">Создаются новые каталоги диска с именами «%SystemDrive%\Inetpub\wwwroot\ServiceModelSamples» и «%SystemDrive%\Inetpub\wwwroot\ServiceModelSamples\bin».</span><span class="sxs-lookup"><span data-stu-id="80e9d-133">New disk directories are created named %SystemDrive%\Inetpub\wwwroot\ServiceModelSamples and %SystemDrive%\Inetpub\wwwroot\ServiceModelSamples\bin.</span></span>  
  
     <span data-ttu-id="80e9d-134">Если вы предпочитаете вручную настроить эти каталоги, см. раздел [виртуальный каталог установки инструкции](../../../../docs/framework/wcf/samples/virtual-directory-setup-instructions.md).</span><span class="sxs-lookup"><span data-stu-id="80e9d-134">If you prefer to set up these directories manually, see the [Virtual Directory Setup Instructions](../../../../docs/framework/wcf/samples/virtual-directory-setup-instructions.md).</span></span> <span data-ttu-id="80e9d-135">Чтобы отменить все изменения, произведенные на данном шаге, запустите файл cleanupvroot.bat по окончании использования образцов.</span><span class="sxs-lookup"><span data-stu-id="80e9d-135">To revert all changes done in this step, run cleanupvroot.bat after you finish using the samples.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="80e9d-136">Если только не запущен файл cleanupvroot.bat, эта процедура выполняется только один раз для каждого компьютера.</span><span class="sxs-lookup"><span data-stu-id="80e9d-136">This procedure must be performed only once on a computer, unless cleanupvroot.bat is run.</span></span>  
  
10. <span data-ttu-id="80e9d-137">Предоставьте разрешение на изменение папки «%SystemDrive%\inetpub\wwwroot» для учетной записи, от имени которой выполняется построение образцов, и для пользователя сетевой службы.</span><span class="sxs-lookup"><span data-stu-id="80e9d-137">You must grant permission to modify for %SystemDrive%\inetpub\wwwroot to the account under which you are building the samples and the Network Service user.</span></span> <span data-ttu-id="80e9d-138">При построении некоторых образцов, размещенных на веб-сервере, может быть выполнена попытка копирования компилированных двоичных файлов в указанное ранее расположение, и если соответствующие разрешения не заданы, построение прервется.</span><span class="sxs-lookup"><span data-stu-id="80e9d-138">While building, some Web-hosted samples might attempt to copy the compiled binaries to the previously mentioned location, and if you have not set the appropriate permissions, the build will break.</span></span> <span data-ttu-id="80e9d-139">Можно также оставить разрешения неизменными и запускать командную строку пакета SDK или Visual Studio(2012) от имени администратора или строить образцы в [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)] также от имени администратора.</span><span class="sxs-lookup"><span data-stu-id="80e9d-139">Alternatively, you can leave the permissions as they are and run the SDK command prompt or Visual Studio Command Prompt (2012) as Administrator, or build the samples in [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)], also run as Administrator.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="80e9d-140">Если этот шаг не выполнен, построение всех образцов, размещенных в службах IIS, завершится с ошибкой.</span><span class="sxs-lookup"><span data-stu-id="80e9d-140">If this step is not completed, all IIS-hosted samples will fail while building.</span></span> <span data-ttu-id="80e9d-141">Убедитесь, что разрешения заданы правильно, или запустите и командную строку пакета SDK, и командную строку Visual Studio (2012) от имени администратора.</span><span class="sxs-lookup"><span data-stu-id="80e9d-141">Ensure that you set the permissions correctly, or run both the SDK command prompt and Visual Studio Command Prompt (2012) as Administrator.</span></span>  
  
11. <span data-ttu-id="80e9d-142">Создайте на компьютере каталог C:\logs. Некоторые образцы могут ожидать его наличия.</span><span class="sxs-lookup"><span data-stu-id="80e9d-142">Create a C:\logs directory on the computer; some samples might be expecting it.</span></span> <span data-ttu-id="80e9d-143">Убедитесь, что соответствующая учетная запись имеет разрешение на запись в этот каталог.</span><span class="sxs-lookup"><span data-stu-id="80e9d-143">Make sure that the appropriate account has write access granted to this folder.</span></span> <span data-ttu-id="80e9d-144">Для Windows 7 [!INCLUDE[wv](../../../../includes/wv-md.md)], и Windows Server 2008 R2, эта учетная запись является **сетевой службы**.</span><span class="sxs-lookup"><span data-stu-id="80e9d-144">For Windows 7, [!INCLUDE[wv](../../../../includes/wv-md.md)], and Windows Server 2008 R2, this account is **Network Service**.</span></span> <span data-ttu-id="80e9d-145">Для [!INCLUDE[lserver](../../../../includes/lserver-md.md)] это учетная запись NT Authority\Network Service.</span><span class="sxs-lookup"><span data-stu-id="80e9d-145">For  [!INCLUDE[lserver](../../../../includes/lserver-md.md)], the account is NT Authority\Network Service.</span></span> <span data-ttu-id="80e9d-146">Для [!INCLUDE[wxp](../../../../includes/wxp-md.md)] и [!INCLUDE[ws2003](../../../../includes/ws2003-md.md)] это учетная запись ASPNET.</span><span class="sxs-lookup"><span data-stu-id="80e9d-146">For [!INCLUDE[wxp](../../../../includes/wxp-md.md)] and [!INCLUDE[ws2003](../../../../includes/ws2003-md.md)], the account is ASPNET.</span></span>  
  
12. <span data-ttu-id="80e9d-147">Запустите файл Setupcerttool.bat.</span><span class="sxs-lookup"><span data-stu-id="80e9d-147">Run the Setupcerttool.bat file.</span></span> <span data-ttu-id="80e9d-148">Этот файл находится в \<Пусть_установки > \WF_WCF_Samples\WCF\Setup\ папки.</span><span class="sxs-lookup"><span data-stu-id="80e9d-148">This file is located in the  \<InstallPath>\WF_WCF_Samples\WCF\Setup\  folder.</span></span>  <span data-ttu-id="80e9d-149">Этот скрипт выполнит следующие задачи.</span><span class="sxs-lookup"><span data-stu-id="80e9d-149">This script will perform the following tasks:</span></span>  
  
    -   <span data-ttu-id="80e9d-150">Построит средство FindPrivateKey.</span><span class="sxs-lookup"><span data-stu-id="80e9d-150">Build the FindPrivateKey tool.</span></span>  
  
    -   <span data-ttu-id="80e9d-151">Создаст каталог с именем %ProgramFiles%\ServiceModelSampleTools.</span><span class="sxs-lookup"><span data-stu-id="80e9d-151">Create a directory called %ProgramFiles%\ServiceModelSampleTools.</span></span>  
  
    -   <span data-ttu-id="80e9d-152">Скопирует в этот каталог новое средство FindPrivateKey.</span><span class="sxs-lookup"><span data-stu-id="80e9d-152">Copy the new FindPrivateKey tool to this directory.</span></span>  
  
     <span data-ttu-id="80e9d-153">Данное средство необходимо для образцов, в которых используются сертификаты и которые размещены в службах IIS.</span><span class="sxs-lookup"><span data-stu-id="80e9d-153">This tool is required by samples that use certificates and are hosted in IIS.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="80e9d-154">В целях безопасности по завершении работы с образцами не забудьте удалить определение виртуального каталога и разрешения, предоставленные на шагах установки, запустив пакетный файл Cleanupvroot.bat.</span><span class="sxs-lookup"><span data-stu-id="80e9d-154">For security purposes, remember to remove the virtual directory definition and permissions granted in the setup steps above by running the batch file named Cleanupvroot.bat after you are finished with the samples.</span></span>  
  
13. <span data-ttu-id="80e9d-155">Резидентным образцам (не размещенным в службах IIS) требуется разрешение на регистрацию HTTP-адресов на компьютере для прослушивания.</span><span class="sxs-lookup"><span data-stu-id="80e9d-155">Samples that are self-hosted (not hosted in IIS) require permission to register HTTP addresses on the computer for listening.</span></span> <span data-ttu-id="80e9d-156">Разрешение на резервирование пространства имен HTTP поступает от учетной записи пользователя, используемой для выполнения образца.</span><span class="sxs-lookup"><span data-stu-id="80e9d-156">The permission for an HTTP namespace reservation comes from the user account used to run the sample.</span></span> <span data-ttu-id="80e9d-157">По умолчанию учетные записи администратора имеют разрешение на регистрацию любых HTTP-адресов.</span><span class="sxs-lookup"><span data-stu-id="80e9d-157">By default, administrator accounts have the permission to register any HTTP address.</span></span> <span data-ttu-id="80e9d-158">Неадминистративным учетным записям должно быть предоставлено разрешение на использование пространства имен HTTP, применяемых в образцах кода.</span><span class="sxs-lookup"><span data-stu-id="80e9d-158">Non-administrator accounts must be granted permission for the HTTP namespaces used by the samples.</span></span> [!INCLUDE[crabout](../../../../includes/crabout-md.md)]<span data-ttu-id="80e9d-159">как настроить резервирование пространства имен см. в разделе [Настройка протоколов HTTP и HTTPS](../../../../docs/framework/wcf/feature-details/configuring-http-and-https.md).</span><span class="sxs-lookup"><span data-stu-id="80e9d-159"> how to configure namespace reservations, see [Configuring HTTP and HTTPS](../../../../docs/framework/wcf/feature-details/configuring-http-and-https.md).</span></span>  
  
14. <span data-ttu-id="80e9d-160">Для некоторых примеров требуется очередь сообщений.</span><span class="sxs-lookup"><span data-stu-id="80e9d-160">Some samples require Message Queuing.</span></span> <span data-ttu-id="80e9d-161">В разделе [Установка Message Queuing (MSMQ)](../../../../docs/framework/wcf/samples/installing-message-queuing-msmq.md) инструкции по установке.</span><span class="sxs-lookup"><span data-stu-id="80e9d-161">See [Installing Message Queuing (MSMQ)](../../../../docs/framework/wcf/samples/installing-message-queuing-msmq.md) for installation instructions.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="80e9d-162">Перед запуском всех образцов, использующих очереди сообщений, необходимо убедиться, что запущена служба очередей сообщений.</span><span class="sxs-lookup"><span data-stu-id="80e9d-162">Ensure that you start the MSMQ service before you run any samples that require Message Queuing.</span></span>  
  
15. <span data-ttu-id="80e9d-163">Для некоторых образцов требуются сертификаты.</span><span class="sxs-lookup"><span data-stu-id="80e9d-163">Some samples require certificates.</span></span> <span data-ttu-id="80e9d-164">В разделе [инструкции по установке сертификата сервера (IIS) в службах IIS](../../../../docs/framework/wcf/samples/iis-server-certificate-installation-instructions.md).</span><span class="sxs-lookup"><span data-stu-id="80e9d-164">See [Internet Information Services (IIS) Server Certificate Installation Instructions](../../../../docs/framework/wcf/samples/iis-server-certificate-installation-instructions.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="80e9d-165">См. также</span><span class="sxs-lookup"><span data-stu-id="80e9d-165">See Also</span></span>
