---
title: Управление потреблением ресурсов и повышение производительности
ms.date: 03/30/2017
ms.assetid: 9a829669-5f76-4c88-80ec-92d0c62c0660
ms.openlocfilehash: 11d1333ed0ae8b46f8f87fa6f4643d4b31fac3ff
ms.sourcegitcommit: 6b308cf6d627d78ee36dbbae8972a310ac7fd6c8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/23/2019
ms.locfileid: "54664165"
---
# <a name="controlling-resource-consumption-and-improving-performance"></a>Управление потреблением ресурсов и повышение производительности
В этом разделе описано несколько свойств разных областей архитектуры Windows Communication Foundation (WCF), которые работают с управления потреблением ресурсов и влияют на метрики производительности.

## <a name="properties-that-constrain-resource-consumption-in-wcf"></a>Свойства, ограничивающие потребление ресурсов в WCF
 Windows Communication Foundation (WCF) накладывает ограничения на некоторые типы процессов в целях безопасности или производительности. Такие ограничения накладываются в двух основных формах: квот и регулировок. *Квоты* ограничения, которые при достижении или превышении активируют немедленно вызывается исключение в определенный момент в системе. *Регулирует* ограничения, которые не вызывают исключение, исключение. Вместо этого по достижении предела регулировки обработка продолжается, но уже в рамках пределов, установленных значением регулировки. Во время ограниченной таким образом обработки исключение, в зависимости от приложения, может быть вызвано в другом месте.

 Кроме различий между квотами и регулировками, некоторые ограничивающие свойства располагаются на уровне сериализации, некоторые - на транспортном уровне, некоторые - на уровне приложения. Например, чтобы препятствовать атакам типа «отказ в обслуживании» на службу со стороны вредоносных клиентов, приводящим к чрезмерному потреблению памяти, квота <xref:System.ServiceModel.Channels.TransportBindingElement.MaxReceivedMessageSize%2A?displayProperty=nameWithType>, реализованная всеми поддерживаемыми системой элементами привязки транспорта, по умолчанию имеет значение 65 536. (Обычно, уменьшая это значение, можно увеличить производительность.)

 Примером квоты сериализации является свойство <xref:System.Runtime.Serialization.DataContractSerializer.MaxItemsInObjectGraph%2A?displayProperty=nameWithType>, задающее максимальное число объектов, которые сериализатор сериализует или десериализует за один вызов метода <xref:System.Runtime.Serialization.DataContractSerializer.ReadObject%2A>. Примером регулировки на уровне приложения является свойство <xref:System.ServiceModel.Dispatcher.ServiceThrottle.MaxConcurrentSessions%2A?displayProperty=nameWithType>, которое по умолчанию ограничивает до 10 число одновременных подключений каналов сеанса. (В отличие от квот, по достижении значения, заданного регулировкой, приложение продолжает обработку, но не принимает новые каналы сеанса - это означает, что новые клиенты не могут подключиться, пока не прекратится соединение по одному из каналов сеанса.)

 Данные элементы управления представляют собой встроенную защиту от некоторых типов атак или улучшают метрики производительности, такие как используемый объем памяти, время запуска и т. п. Однако, в зависимости от приложения, данные элементы управления могут снижать производительность приложения службы или вовсе препятствовать работе приложения. Например, приложение, предназначенное для потокового видео, может легко превысить заданное по умолчанию свойство <xref:System.ServiceModel.Channels.TransportBindingElement.MaxReceivedMessageSize%2A?displayProperty=nameWithType>. Этот раздел содержит общие сведения о различных средствах, применяемых к приложениям на всех уровнях WCF, описываются различные способы для получения дополнительных сведений о ли параметр к ухудшению приложения и описываются способы устранения ряда проблем. Большинство ограничителей и некоторые квоты доступны на уровне приложения, даже когда базовым свойством является ограничение сериализации или транспорта. Например, можно задать в классе службы свойство <xref:System.Runtime.Serialization.DataContractSerializer.MaxItemsInObjectGraph%2A?displayProperty=nameWithType> с помощью свойства <xref:System.ServiceModel.ServiceBehaviorAttribute.MaxItemsInObjectGraph%2A?displayProperty=nameWithType>.

> [!NOTE]
> При наличии конкретной проблемы, сначала нужно прочесть [устранения неполадок WCF](../../../docs/framework/wcf/wcf-troubleshooting-quickstart.md) ли там указан ваш (и решение).

 Свойства, ограничивающие процессы сериализации, перечислены в [вопросы безопасности для данных](../../../docs/framework/wcf/feature-details/security-considerations-for-data.md). Свойства, ограничивающие потребление ресурсов, относящихся к транспорту, перечислены в [квоты транспорта](../../../docs/framework/wcf/feature-details/transport-quotas.md). Свойства, ограничивающие потребление ресурсов на уровне приложения, являются членами класса <xref:System.ServiceModel.Dispatcher.ServiceThrottle>.

## <a name="detecting-application-and-performance-issues-related-to-quota-settings"></a>Выявление проблем с приложением и производительностью, связанных с параметрами квоты
 Значения по умолчанию указанных выше параметров выбраны таким образом, чтобы обеспечить функциональность основного приложения в широком диапазоне типов приложения, обеспечивая при этом основную защиту от общих проблем безопасности. Однако дизайн некоторых приложений может превышать значение одного или нескольких параметров регулировки, хотя в противном случае приложение защищено и будет работать, как было задумано. В таких случаях необходимо определить, какие значения ограничителей и на каком уровне превышены, и принять решение о соответствующих действиях по повышению пропускной способности приложения.

 Обычно при написании и отладке приложения свойству <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> программно или с помощью файла конфигурации присваивается значение `true`. Это предписывает WCF для возврата в клиентское приложение для просмотра содержимого стека исключения службы. Данная возможность позволяет создавать отчеты о большинстве исключений на уровне приложения таким образом, чтобы показать, если проблема заключается в этом, какие параметры квоты могут являться причиной.

 Некоторые исключения вызываются во время выполнения за пределами видимости уровня приложения, не возвращаются при помощи такого механизма и не могут быть обработаны пользовательской реализацией <xref:System.ServiceModel.Dispatcher.IErrorHandler?displayProperty=nameWithType>. В среде разработки, такой как Microsoft Visual Studio, большинство исключений отображается автоматически. Тем не менее, некоторые исключения могут маскироваться в соответствии с параметрами среды разработки, такие как [Just My Code](/visualstudio/debugger/just-my-code) Visual Studio.

 Независимо от возможностей среды разработки можно использовать возможности трассировки WCF и ведение журнала сообщений для отладки всех исключений и настройки производительности ваших приложений. Дополнительные сведения см. в разделе [с помощью трассировки для устранения неполадок приложения](../../../docs/framework/wcf/diagnostics/tracing/using-tracing-to-troubleshoot-your-application.md).

## <a name="performance-issues-and-xmlserializer"></a>Проблемы производительности и XmlSerializer
 Службы и клиентские приложения, использующие типы данных, сериализуемых при помощи сериализатора <xref:System.Xml.Serialization.XmlSerializer>, создают и компилируют код сериализации для этих типов данных во время выполнения, что может привести к снижению производительности при запуске.

> [!NOTE]
> Предварительно созданный код сериализации может использоваться только в клиентских приложениях, а не в службах.

 [ServiceModel Metadata Utility Tool (Svcutil.exe)](../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md) может повысить производительность при запуске этих приложений путем создания необходимого кода сериализации из компилированных сборок для приложения. Дополнительные сведения см. в разделе [Как Улучшения запуска время клиентских приложений WCF с использованием XmlSerializer](../../../docs/framework/wcf/feature-details/startup-time-of-wcf-client-applications-using-the-xmlserializer.md).

## <a name="performance-issues-when-hosting-wcf-services-under-aspnet"></a>Проблемы производительности при размещении служб WCF под ASP.NET
 Когда служба WCF размещается под IIS и ASP.NET, параметры конфигурации IIS и ASP.NET могут повлиять на пропускную способность и объем занимаемой службой WCF памяти.  Дополнительные сведения о производительности ASP.NET см. в разделе [повышение производительности ASP.NET](https://go.microsoft.com/fwlink/?LinkId=186462).  Есть один параметр, использование которого может иметь непредвиденные последствия. Это <xref:System.Web.Configuration.ProcessModelSection.MinWorkerThreads%2A>, который является свойством <xref:System.Web.Configuration.ProcessModelSection>. Если приложение имеет фиксированное или небольшое количество клиентов, изменение параметра <xref:System.Web.Configuration.ProcessModelSection.MinWorkerThreads%2A> на 2 может обеспечить повышение пропускной способности на многопроцессорных компьютерах с близким к 100% использованием ЦП. За такое увеличение производительности приходится платить: оно также влечет за собой повышение использования памяти, что может снизить масштабируемость.

## <a name="see-also"></a>См. также

- [Администрирование и диагностика](../../../docs/framework/wcf/diagnostics/index.md)
- [Большие наборы данных и потоковая передача](../../../docs/framework/wcf/feature-details/large-data-and-streaming.md)
