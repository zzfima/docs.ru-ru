---
title: Автоматическое обнаружение прокси-сервера
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- automatic proxy detections
- Web Proxy Auto-Discovery
- Web proxy
- detecting proxies automatically
- WebProxy class, automatic proxy detections
- proxies, automatically detecting
- network
- WPAD (Web Proxy Auto-Discovery)
ms.assetid: fcd9c3bd-93de-4c92-8ff3-837327ad18de
ms.openlocfilehash: 4c5bc9e0efb39032d388d141e8bccf3e520ebd45
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/15/2020
ms.locfileid: "79180896"
---
# <a name="automatic-proxy-detection"></a>Автоматическое обнаружение прокси-сервера
В ходе автоматического обнаружения прокси-сервера система определяет сервер веб-прокси, который используется для отправки запросов от имени клиента. Эта функция также называется автообнаружением веб-прокси (WPAD). Если автоматическое обнаружение прокси-сервера включено, система пытается обнаружить скрипт конфигурации прокси-сервера, возвращающий набор прокси-серверов, который можно использовать для обработки запросов. Если такой скрипт обнаружен, он скачивается, компилируется и запускается на локальном компьютере при получении информации о прокси-сервере, потока запроса или ответа для запроса, который использует экземпляр <xref:System.Net.WebProxy>.  
  
 Автоматическое обнаружение прокси-сервера реализуется с помощью класса <xref:System.Net.WebProxy>. Параметры этого процесса могут задаваться на уровне запроса, в файлах конфигурации, а также в диалоговом окне **Локальная сеть (LAN)** браузера Internet Explorer.  
  
> [!NOTE]
> Чтобы открыть диалоговое окно **Параметры локальной сети** Internet Explorer, выберите **Сервис** в главном меню этого браузера, а затем пункт **Свойства браузера**. Перейдите на вкладку **Подключения** и выберите **Параметры локальной сети**.  
  
 Если автоматическое обнаружение прокси-сервера включено, класс <xref:System.Net.WebProxy> пытается найти скрипт конфигурации прокси-сервера следующим образом:  
  
1. Функция WinINet `InternetQueryOption` используется для поиска скрипта конфигурации прокси-сервера, который был обнаружен браузером Internet Explorer в последний раз.  
  
2. Если найти этот скрипт не удается, класс <xref:System.Net.WebProxy> использует для его поиска протокола DHCP. DHCP-сервер может вернуть в ответе расположение (имя узла) скрипта или полный URL-адрес скрипта.  
  
3. Если с помощью DHCP не удалось определить узел автообнаружения веб-прокси (WPAD), выполняется запрос узла DNS, в качестве имени или псевдонима которого используется WPAD.  
  
4. Если обнаружить узел не удается и расположение скрипта конфигурации прокси-сервера задается в файле конфигурации или параметрах локальной сети браузера Internet Explorer, используется это расположение.  
  
> [!NOTE]
> Приложения, выполняемые как службы NT или в составе ASP.NET, используют параметры прокси-сервера, задаваемые Internet Explorer (если доступны), вызывающего пользователя. Эти параметры могут быть доступны не для всех приложений службы.  
  
 Прокси-серверы настраиваются отдельно для каждого устройства подключения. Устройство подключения — это элемент в диалоговом окне сетевого подключения, который может быть как физическим сетевым устройством (модем или плата Ethernet), так и виртуальным интерфейсом (например, VPN-подключение, работающее через сетевое устройство). При изменении устройства подключения (например, при смене точки доступа для беспроводного подключения или включении VPN) алгоритм обнаружения прокси-сервера запускается снова.  
  
 По умолчанию для обнаружения прокси-сервера используются параметры прокси, задаваемые браузером Internet Explorer. Если приложение выполняется под учетной записью, не являющейся интерактивной (не поддерживает удобный способ настройки параметров прокси-сервера в Internet Explorer), или требуется использовать другие параметры прокси-сервера, вы можете настроить собственный прокси-сервер, создав файл конфигурации, в котором определены [элемент \<defaultProxy> (сетевые параметры)](../configure-apps/file-schema/network/defaultproxy-element-network-settings.md) и [элемент \<proxy> (сетевые параметры)](../configure-apps/file-schema/network/proxy-element-network-settings.md).  
  
 Для создаваемых вами запросов можно отключить автоматическое обнаружение прокси-сервера на уровне запроса, указав в нем <xref:System.Net.WebRequest.Proxy%2A> NULL, как показано в следующем примере.  
  
```csharp  
public static void DisableForMyRequest (Uri resource)  
{  
    WebRequest request = WebRequest.Create (resource);  
    request.Proxy = null;  
    WebResponse response = request.GetResponse ();  
}  
```  
  
```vb  
Public Shared Sub DisableForMyRequest(ByVal resource As Uri)  
    Dim request As WebRequest = WebRequest.Create(resource)  
    request.Proxy = Nothing  
    Dim response As WebResponse = request.GetResponse()  
    End Sub
```  
  
 Для обработки запросов, не указывающих прокси-сервер, используется прокси-сервер по умолчанию домена приложения, который доступен в свойстве <xref:System.Net.WebRequest.DefaultWebProxy%2A>.  
  
## <a name="see-also"></a>См. также раздел

- <xref:System.Net.WebProxy>
- <xref:System.Net.WebRequest>
- [Элемент \<system.Net> (сетевые параметры)](../configure-apps/file-schema/network/system-net-element-network-settings.md)
