---
title: Публикация и разрешение имени однорангового узла
ms.date: 03/30/2017
ms.assetid: f0370e08-9fa6-4ee5-ab78-9a58a20a7da2
ms.openlocfilehash: 4a0787972a61f5700d1e8728be96db8ef9ee749e
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/15/2020
ms.locfileid: "64623205"
---
# <a name="peer-name-publication-and-resolution"></a><span data-ttu-id="2a7ff-102">Публикация и разрешение имени однорангового узла</span><span class="sxs-lookup"><span data-stu-id="2a7ff-102">Peer Name Publication and Resolution</span></span>

## <a name="publishing-a-peer-name"></a><span data-ttu-id="2a7ff-103">Публикация имени однорангового узла</span><span class="sxs-lookup"><span data-stu-id="2a7ff-103">Publishing a peer name</span></span>  

 <span data-ttu-id="2a7ff-104">Чтобы опубликовать новый идентификатор PNRP, одноранговый узел выполняет следующие операции:</span><span class="sxs-lookup"><span data-stu-id="2a7ff-104">To publish a new PNRP ID, a peer performs the following:</span></span>  
  
- <span data-ttu-id="2a7ff-105">Отправляет сообщения публикации PNRP своим соседям по кэшу (одноранговые узлы с зарегистрированными идентификаторами PNRP на самом низком уровне кэша) для инициализации соответствующих кэшей.</span><span class="sxs-lookup"><span data-stu-id="2a7ff-105">Sends PNRP publication messages to its cache neighbors (the peers that have registered PNRP IDs in the lowest level of the cache) to seed their caches.</span></span>  
  
- <span data-ttu-id="2a7ff-106">Выбирает случайные узлы в облаке, которые не являются его соседями, и отправляет запросы разрешения имен PNRP для своего собственного идентификатора P2P.</span><span class="sxs-lookup"><span data-stu-id="2a7ff-106">Chooses random nodes in the cloud that are not its neighbors and sends them PNRP name resolution requests for its own P2P ID.</span></span> <span data-ttu-id="2a7ff-107">Результирующий процесс определения конечной точки инициализирует кэши случайных узлов в облаке, используя идентификатор PNRP публикующего однорангового узла.</span><span class="sxs-lookup"><span data-stu-id="2a7ff-107">The resulting endpoint determination process seeds the caches of random nodes in the cloud with the PNRP ID of the publishing peer.</span></span>  
  
<span data-ttu-id="2a7ff-108">Узлы PNRP версии 2 не публикуют идентификаторы PNRP в том случае, если они разрешают только другие идентификаторы P2P.</span><span class="sxs-lookup"><span data-stu-id="2a7ff-108">PNRP version 2 nodes do not publish PNRP IDs if they are only resolving other P2P IDs.</span></span> <span data-ttu-id="2a7ff-109">Параметр реестра HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\PeerNet\PNRP\IPV6-Global\SearchOnly=1 (REG_DWORD type) указывает, что одноранговый узел использует PNRP только для разрешения имен и никогда не использует его для публикации имен.</span><span class="sxs-lookup"><span data-stu-id="2a7ff-109">The HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\PeerNet\PNRP\IPV6-Global\SearchOnly=1 registry value (REG_DWORD type) specifies that peers only use PNRP for name resolution, never for name publication.</span></span> <span data-ttu-id="2a7ff-110">Этот параметр реестра также можно настроить с помощью групповой политики.</span><span class="sxs-lookup"><span data-stu-id="2a7ff-110">This registry value can also be configured through Group Policy.</span></span>  
  
## <a name="resolving-a-peer-name"></a><span data-ttu-id="2a7ff-111">Разрешение имени однорангового узла</span><span class="sxs-lookup"><span data-stu-id="2a7ff-111">Resolving a peer name</span></span>

 <span data-ttu-id="2a7ff-112">Поиск других одноранговых узлов в сети PNRP или облаке состоит из двух этапов:</span><span class="sxs-lookup"><span data-stu-id="2a7ff-112">Locating other peers in a PNRP network or cloud is a process comprised of two phases:</span></span>  
  
1. <span data-ttu-id="2a7ff-113">Определение конечной точки</span><span class="sxs-lookup"><span data-stu-id="2a7ff-113">Endpoint Determination</span></span>  
  
2. <span data-ttu-id="2a7ff-114">Разрешение идентификатора PNRP</span><span class="sxs-lookup"><span data-stu-id="2a7ff-114">PNRP ID Resolution</span></span>  
  
 <span data-ttu-id="2a7ff-115">На этапе определения конечной точки одноранговый узел, который пытается разрешить идентификатор PNRP службы на другом компьютере, определяет IPv6-адрес этого удаленного однорангового узла.</span><span class="sxs-lookup"><span data-stu-id="2a7ff-115">In the endpoint determination phase, a peer that is attempting to resolve the PNRP ID of a service on another computer determines the IPv6 address of that remote peer.</span></span>  <span data-ttu-id="2a7ff-116">В качестве удаленного однорангового узла выступает узел, который опубликован или связан с идентификатором PNRP компьютера или службы.</span><span class="sxs-lookup"><span data-stu-id="2a7ff-116">The remote peer is the one that published, or is associated with, the PNRP ID of the computer or service.</span></span>  
  
 <span data-ttu-id="2a7ff-117">После подтверждения регистрации удаленной конечной точки в облаке PNRP запрашивающий одноранговый узел на этапе разрешения идентификатора PNRP отправляет запрос к этой конечной точке однорангового узла для получения идентификатора PNRP требуемой службы.</span><span class="sxs-lookup"><span data-stu-id="2a7ff-117">After confirming that the remote endpoint has been registered into the PNRP cloud, the requesting peer in the PNRP ID resolution phase sends a request to that peer endpoint for the PNRP ID of the desired service.</span></span> <span data-ttu-id="2a7ff-118">Конечная точка отправляет ответ с подтверждением идентификатора PNRP службы, комментарий, а также до 4 КБ дополнительной информации, которую запрашивающий одноранговый узел может использовать для обмена данными в дальнейшем.</span><span class="sxs-lookup"><span data-stu-id="2a7ff-118">The endpoint sends a reply confirming the PNRP ID of the service, a comment, and up to 4 kilobytes of additional information that the requesting peer can use for future communication.</span></span> <span data-ttu-id="2a7ff-119">Например, если требуемая конечная точка является игровым сервером, в дополнительных данных записи с именем однорангового узла могут содержаться сведения об игре, достигнутом уровне, а также текущем количестве игроков.</span><span class="sxs-lookup"><span data-stu-id="2a7ff-119">For example, if the desired endpoint is a gaming server, the additional peer name record data can contain information about the game, the level of play, and the current number of players.</span></span>  
  
 <span data-ttu-id="2a7ff-120">На этапе определения конечной точки PNRP использует итеративный процесс для поиска узла, который опубликовал идентификатор PNRP. В этом случае выполняющий разрешение узел отвечает за обращение к узлам, которые максимально близки к целевому идентификатору PNRP.</span><span class="sxs-lookup"><span data-stu-id="2a7ff-120">In the endpoint determination phase, PNRP uses an iterative process for locating the node that published the PNRP ID, in which the node performing the resolution is responsible for contacting nodes that are successively closer to the target PNRP ID.</span></span>  
  
 <span data-ttu-id="2a7ff-121">Чтобы выполнить разрешение имен в PNRP, одноранговый узел анализирует записи в собственном кэше на наличие записи, которая соответствует целевому идентификатору PNRP.</span><span class="sxs-lookup"><span data-stu-id="2a7ff-121">To perform name resolution in PNRP, the peer examines the entries in its own cache for an entry that matches the target PNRP ID.</span></span> <span data-ttu-id="2a7ff-122">Если такая запись найдена, одноранговый узел отправляет сообщение запроса PNRP к одноранговому узлу и ожидает ответа.</span><span class="sxs-lookup"><span data-stu-id="2a7ff-122">If found, the peer sends a PNRP Request message to the peer and waits for a response.</span></span> <span data-ttu-id="2a7ff-123">Если запись для идентификатора PNRP не найдена, одноранговый узел отправляет сообщение запроса PNRP к одноранговому узлу, который соответствует записи с идентификатором PNRP, наиболее полно соответствующим целевому идентификатору PNRP.</span><span class="sxs-lookup"><span data-stu-id="2a7ff-123">If an entry for the PNRP ID is not found, the peer sends a PNRP Request message to the peer that corresponds to the entry that has a PNRP ID that most closely matches the target PNRP ID.</span></span> <span data-ttu-id="2a7ff-124">Узел, получающий сообщение запроса PNRP, анализирует собственный кэш и выполняет следующие действия:</span><span class="sxs-lookup"><span data-stu-id="2a7ff-124">The node that receives the PNRP Request message examines its own cache and does the following:</span></span>  
  
- <span data-ttu-id="2a7ff-125">Если идентификатор PNRP найден, запрошенный одноранговый узел конечной точки отвечает непосредственно запрашивающему одноранговому узлу.</span><span class="sxs-lookup"><span data-stu-id="2a7ff-125">If the PNRP ID is found, the requested endpoint peer replies directly to the requesting peer.</span></span>  
  
- <span data-ttu-id="2a7ff-126">Если идентификатор PNRP не найден, а идентификатор PNRP близок к целевому, запрошенный одноранговый узел отправляет запрашивающему узлу ответ, содержащий IPv6-адрес однорангового узла, который представляет запись с идентификатором PNRP, наиболее близко соответствующим целевому идентификатору PNRP.</span><span class="sxs-lookup"><span data-stu-id="2a7ff-126">If the PNRP ID is not found and a PNRP ID in the cache is closer to the target PNRP ID, the requested peer sends a response to the requesting peer containing the IPv6 address of the peer that represents the entry with a PNRP ID that more closely matches the target PNRP ID.</span></span> <span data-ttu-id="2a7ff-127">Используя IP-адрес в ответе, запрашивающий узел отправляет другое сообщение запроса PNRP по этому IPv6-адресу, чтобы дать ответ или проанализировать свой кэш.</span><span class="sxs-lookup"><span data-stu-id="2a7ff-127">Using the IP address in the response, the requesting node sends another PNRP Request message to the IPv6 address to respond or examine its cache.</span></span>  
  
- <span data-ttu-id="2a7ff-128">Если идентификатор PNRP не найден и близкий к конечному идентификатор PNRP отсутствует в кэше, запрошенный одноранговый узел отправляет запрашивающему узлу ответ, указывающий на это состояние.</span><span class="sxs-lookup"><span data-stu-id="2a7ff-128">If the PNRP ID is not found and there is no PNRP ID in its cache that is closer to the target PNRP ID, the requested peer sends the requesting peer a response that indicates this condition.</span></span> <span data-ttu-id="2a7ff-129">После этого запрашивающий одноранговый узел выбирает идентификатор PNRP следующего ближайшего узла.</span><span class="sxs-lookup"><span data-stu-id="2a7ff-129">The requesting peer then chooses the next-closest PNRP ID.</span></span>  
  
<span data-ttu-id="2a7ff-130">Запрашивающий узел продолжает этот процесс, повторяя итерации, пока не будет найден узел, зарегистрировавший идентификатор PNRP.</span><span class="sxs-lookup"><span data-stu-id="2a7ff-130">The requesting peer continues this process with successive iterations, eventually locating the node that registered the PNRP ID.</span></span>  
  
 <span data-ttu-id="2a7ff-131">В пространстве имен <xref:System.Net.PeerToPeer> определено отношение "многие ко многим" между записями <xref:System.Net.PeerToPeer.PeerName>, содержащими конечные точки, и одноранговыми сетями или облаками PNRP, в которых они осуществляют обмен данными.</span><span class="sxs-lookup"><span data-stu-id="2a7ff-131">Within the <xref:System.Net.PeerToPeer> namespace, there is a many-to-many relationship between the <xref:System.Net.PeerToPeer.PeerName> records that contain endpoints and PNRP clouds or meshes in which they communicate.</span></span> <span data-ttu-id="2a7ff-132">При наличии повторяющихся или устаревших записей или нескольких узлов с одинаковыми именами однорангового узла узлы PNRP могут получать актуальную информацию с помощью класса <xref:System.Net.PeerToPeer.PeerNameResolver>.</span><span class="sxs-lookup"><span data-stu-id="2a7ff-132">When there are duplicate or stale entries, or multiple nodes with the same peer name, PNRP nodes can obtain current information using the <xref:System.Net.PeerToPeer.PeerNameResolver> class.</span></span> <span data-ttu-id="2a7ff-133">Методы <xref:System.Net.PeerToPeer.PeerNameResolver> используют одно имя однорангового узла, упрощая соотношение между именами одноранговых узлов и записями или облаками до "один ко многим".</span><span class="sxs-lookup"><span data-stu-id="2a7ff-133">The <xref:System.Net.PeerToPeer.PeerNameResolver> methods use a single peer name to simplify the perspective to one peer-to-many peer name records and the same one peer to many clouds.</span></span> <span data-ttu-id="2a7ff-134">Это поведение аналогично выполнению запроса с использованием соединения реляционной таблицы.</span><span class="sxs-lookup"><span data-stu-id="2a7ff-134">This is similar to a query performed using a relational-table join.</span></span> <span data-ttu-id="2a7ff-135">В случае успешного выполнения объект Resolver возвращает <xref:System.Net.PeerToPeer.PeerNameRecordCollection> для заданного имени однорангового узла.</span><span class="sxs-lookup"><span data-stu-id="2a7ff-135">Upon successful completion, the Resolver object returns a <xref:System.Net.PeerToPeer.PeerNameRecordCollection> for the specified peer name.</span></span>  <span data-ttu-id="2a7ff-136">Например, имя однорангового узла может встречаться во всех записях имен одноранговых узлов в коллекции с упорядочением по облаку.</span><span class="sxs-lookup"><span data-stu-id="2a7ff-136">For example, a peer name would occur in all the peer name records in the collection, ordered by cloud.</span></span> <span data-ttu-id="2a7ff-137">Для этих экземпляров имен одноранговых узлов приложение на основе протокола PNRP сможет запрашивать вспомогательные данные.</span><span class="sxs-lookup"><span data-stu-id="2a7ff-137">These are the instances of the peer name whose supporting data may be requested by a PNRP-based application.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="2a7ff-138">См. также раздел</span><span class="sxs-lookup"><span data-stu-id="2a7ff-138">See also</span></span>

- <xref:System.Net.PeerToPeer>
