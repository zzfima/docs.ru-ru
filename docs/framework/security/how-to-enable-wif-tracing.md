---
title: Практическое руководство. Включение трассировки WIF
ms.date: 03/30/2017
ms.assetid: 271b6889-3454-46ff-96ab-9feb15e742ee
author: BrucePerlerMS
ms.openlocfilehash: f763c279c29bec73d4fc20d59dc86726d84e21bd
ms.sourcegitcommit: 213292dfbb0c37d83f62709959ff55c50af5560d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/25/2018
ms.locfileid: "47171703"
---
# <a name="how-to-enable-wif-tracing"></a>Практическое руководство. Включение трассировки WIF
## <a name="applies-to"></a>Применение  
  
-   Microsoft® Windows® Identity Foundation (WIF)  
  
-   Веб-формы ASP.NET®  
  
## <a name="summary"></a>Сводка  
 Это практическое руководство содержит подробные пошаговые инструкции по включению трассировки WIF в приложении ASP.NET. В нем также приведены инструкции по тестированию приложения, которые позволяют проверить правильную работу прослушивателя трассировки и журнала. В этом практическом руководстве нет подробных инструкций по созданию службы токенов безопасности (STS); вместо этого используется служба Development STS, входящая в состав средства Identity and Access Tool. Служба Development STS не выполняет фактическую аутентификацию и предназначена только для тестирования. Для выполнения этого практического руководства необходимо установить средство Identity and Access Tool. Его можно скачать на следующей странице: [Средство Identity and Access Tool](https://go.microsoft.com/fwlink/?LinkID=245849)  
  
> [!IMPORTANT]
>  Включение трассировки WIF для пассивных приложений, то есть для приложений, использующих протокол WS-Federation, может привести к тому, что приложение станет уязвимым к атакам типа "отказ в обслуживании" или к раскрытию конфиденциальной информации. К таким приложениям относятся как пассивные приложения PR (приложения проверяющей стороны), так и пассивные приложения STS. По этой причине рекомендуется не включать трассировку WIF для пассивных приложений RP или STS в рабочей среде.  
  
## <a name="contents"></a>Описание  
  
-   Цели  
  
-   Обзор  
  
-   Сводка действий  
  
-   Шаг 1. Создание простого приложения веб-форм ASP.NET и включение трассировки  
  
-   Шаг 2. Тестирование решения  
  
## <a name="objectives"></a>Цели  
  
-   Создание простого приложения ASP.NET, которое использует WIF и службу Development STS в составе средства Identity and Access Tool  
  
-   Включение трассировки и проверка ее работы  
  
## <a name="overview"></a>Обзор  
 Трассировка позволяет отлаживать и решать различные проблемы, связанные с WIF, в том числе с маркерами, файлами cookie, утверждениями, сообщениями протокола и др. Трассировка WIF похожа на трассировку WCF; например, вы можете выбрать уровень детализации трассировки для отображения всех сообщений или только критических сообщений. Трассировка WIF может создаваться в файлах **.xml** или в файлах **.svclog**, которые можно просмотреть с помощью средства просмотра трассировки служб. Это средство находится в каталоге **bin** в папке установки пакета Windows SDK на вашем компьютере, например: **C:\Program Files\Microsoft SDKs\Windows\v7.1\Bin\SvcTraceViewer.exe**.  
  
## <a name="summary-of-steps"></a>Сводка действий  
  
-   Шаг 1. Создание простого приложения веб-форм ASP.NET и включение трассировки  
  
-   Шаг 2. Тестирование решения  
  
## <a name="step-1--create-a-simple-aspnet-web-forms-application-and-enable-tracing"></a>Шаг 1. Создание простого приложения веб-форм ASP.NET и включение трассировки  
 На этом шаге вы создадите приложение веб-форм ASP.NET и включите трассировку, изменив файл *Web.config*.  
  
#### <a name="to-create-a-simple-aspnet-application"></a>Создание простого приложения ASP.NET  
  
1.  Запустите Visual Studio и выберите **Файл**, **Создать** и затем **Проект**.  
  
2.  В окне **Новый проект** выберите **Приложение веб-форм ASP.NET**.  
  
3.  В поле **Имя** введите `TestApp` и нажмите кнопку **ОК**.  
  
4.  В **обозревателе решений** щелкните правой кнопкой мыши проект **TestApp**, а затем выберите **Идентификация и доступ**.  
  
5.  Откроется окно **Идентификация и доступ**. В поле **Поставщики** выберите **Протестировать приложение с помощью локальной службы Development STS** и нажмите кнопку **Применить**.  
  
6.  Создайте папку **logs** в корне диска **C:** (**C:\logs**).  
  
7.  Добавьте следующий элемент **\<system.diagnostics>** в файл конфигурации *Web.config* сразу после закрывающего элемента **\</configSections>**, как показано ниже:  
  
    ```xml  
    <configuration>  
        <configSections>  
        …  
        </configSections>  
        <system.diagnostics>  
            <sources>  
                <source name="System.IdentityModel" switchValue="Verbose">  
                    <listeners>  
                        <add name="xml" type="System.Diagnostics.XmlWriterTraceListener" initializeData="C:\logs\WIF.xml" />  
                    </listeners>  
                </source>  
            </sources>  
            <trace autoflush="true" />  
        </system.diagnostics>  
    ```  
  
    > [!NOTE]
    >  Для создания журналов каталог, указанный в атрибуте **initializeData**, должен существовать на диске. Если этого каталога не существует, журналы не будут созданы.  
  
     С приведенными выше параметрами будет включен **подробный** уровень трассировки для WIF, а полученный журнал будет сохранен в файле **C:\logs\WIF.xml**.  
  
## <a name="step-2--test-your-solution"></a>Шаг 2. Тестирование решения  
 На этом шаге вы проверите запись журналов в приложении ASP.NET с поддержкой WIF.  
  
#### <a name="to-test-your-wif-enabled-aspnet-application-for-successful-tracing"></a>Проверка трассировки в приложении ASP.NET с поддержкой WIF  
  
1.  Запустите решение, нажав клавишу **F5**. Откроется домашняя страница ASP.NET по умолчанию, и будет выполнен автоматический вход в систему с именем пользователя *Terry*. Это пользователь по умолчанию для службы Development STS.  
  
2.  Закройте окно браузера и перейдите в папку **C:\logs**. Откройте файл **C:\logs\WIF.xml** в текстовом редакторе.  
  
3.  Просмотрите файл **WIF.xml** и убедитесь, что в нем есть записи, которые начинаются с элемента **\<E2ETraceEvent>**. Эти записи трассировки будут содержать элементы **\<TraceRecord>** с описаниями действий трассировки, например **Validating SecurityToken**.
