---
title: "Практическое руководство. Отображение состояния входа с помощью WIF"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology:
- dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 4d1174e4-5397-4962-9a5f-3b1ad7b3fc14
caps.latest.revision: 6
author: BrucePerlerMS
ms.author: bruceper
manager: mbaldwin
ms.translationtype: HT
ms.sourcegitcommit: 306c608dc7f97594ef6f72ae0f5aaba596c936e1
ms.openlocfilehash: 494e67b39187a2a38f29f994e17051430d90f708
ms.contentlocale: ru-ru
ms.lasthandoff: 08/21/2017

---
# <a name="how-to-display-signed-in-status-using-wif"></a>Практическое руководство. Отображение состояния входа с помощью WIF
## <a name="applies-to"></a>Применение  
  
-   Microsoft® Windows® Identity Foundation (WIF) 4.5  
  
-   Веб-формы ASP.NET®  
  
## <a name="summary"></a>Сводка  
 В этом разделе описывается отображение состояния входа в приложении ASP.NET с поддержкой WIF. Платформа WIF предоставляет механизм для создания приложений с поддержкой утверждений, управления проверкой подлинности и авторизации ресурсов приложения.  
  
## <a name="contents"></a>Описание  
  
-   Обзор  
  
-   Сводка действий  
  
-   Шаг 1. Установка расширения для управления удостоверениями и доступом  
  
-   Шаг 2. Создание приложения ASP.NET проверяющей стороны  
  
-   Шаг 3. Включение локальной службы маркеров безопасности разработки для проверки подлинности пользователей  
  
-   Шаг 4. Изменение приложения ASP.NET для отображения сведений о состоянии входа  
  
-   Шаг 5. Проверка интеграции между платформой WIF и приложением ASP.NET  
  
## <a name="overview"></a>Обзор  
 В этом разделе показано, как создать простое приложение на основе утверждений с помощью платформы WIF и реализовать отображение состояния входа для пользователя. При выполнении этих шагов используется локальная служба маркеров безопасности разработки, которая входит в состав расширения для управления удостоверениями и доступом Visual Studio. Локальная служба маркеров безопасности разработки предназначена для тестирования и разработки среды, которая обеспечивает простую интеграцию утверждений в приложение. Она не выполняет фактическую проверку подлинности и не запрашивает учетные данные, в связи с чем ее нельзя использовать в рабочей среде. Тем не менее императивный код, используемый при выполнении этих действий, аналогичен тому, который будет применяться в готовом к работе приложении, использующем фактическую проверку подлинности.  
  
## <a name="summary-of-steps"></a>Сводка действий  
  
-   Шаг 1. Установка расширения для управления удостоверениями и доступом  
  
-   Шаг 2. Создание приложения ASP.NET проверяющей стороны  
  
-   Шаг 3. Включение локальной службы маркеров безопасности разработки для проверки подлинности пользователей  
  
-   Шаг 4. Изменение приложения ASP.NET для отображения сведений о состоянии входа  
  
-   Шаг 5. Проверка интеграции между платформой WIF и приложением ASP.NET  
  
## <a name="step-1--install-the-identity-and-access-extension"></a>Шаг 1. Установка расширения для управления удостоверениями и доступом  
 В этом разделе описывается настройка расширения для управления доступом и удостоверениями Visual Studio 2012. Это расширение автоматизирует процесс настройки приложения для взаимодействия с конечными точками службы маркеров безопасности.  
  
#### <a name="to-install-the-identity-and-access-extension"></a>Установка расширения для управления удостоверениями и доступом  
  
1.  Запустите Visual Studio от имени администратора.  
  
2.  В Visual Studio откройте меню **Сервис** и выберите пункт **Диспетчер расширений**. Появится окно **Диспетчер расширений**.  
  
3.  В окне **Диспетчер расширений** выберите **Сетевые расширения** в меню слева, а затем щелкните элемент **Коллекция Visual Studio**.  
  
4.  В верхнем правом углу окна **Диспетчер расширений** выполните поиск строки *Удостоверения и доступ*.  
  
5.  В результатах поиска появится элемент **Удостоверения и доступ**. Щелкните его и нажмите кнопку **Скачать**.  
  
6.  Появится диалоговое окно **Скачать и установить**. Если вы согласны с условиями лицензии, нажмите кнопку **Установить**.  
  
7.  После окончания установки расширения **Удостоверения и доступ** перезапустите Visual Studio с правами администратора.  
  
## <a name="step-2--create-a-relying-party-aspnet-application"></a>Шаг 2. Создание приложения ASP.NET проверяющей стороны  
 В этом разделе описывается создание приложения проверяющей стороны на основе веб-форм ASP.NET, которое будет интегрировано с платформой WIF.  
  
#### <a name="to-create-a-simple-aspnet-application"></a>Создание простого приложения ASP.NET  
  
1.  Запустите Visual Studio и выберите **Файл**, **Создать** и затем **Проект**.  
  
2.  В окне **Новый проект** выберите **Приложение веб-форм ASP.NET**.  
  
3.  В поле **Имя** введите `TestApp` и нажмите кнопку **ОК**.  
  
## <a name="step-3--enable-local-development-sts-to-authenticate-users"></a>Шаг 3. Включение локальной службы маркеров безопасности разработки для проверки подлинности пользователей  
 В этом разделе описывается, как включить локальную службу маркеров безопасности разработки в приложении. Локальную службу маркеров безопасности разработки можно включить с помощью расширения для управления удостоверениями и доступом Visual Studio.  
  
#### <a name="to-enable-local-development-sts-in-your-aspnet-application"></a>Включение локальной службы маркеров безопасности разработки в приложении ASP.NET  
  
1.  В Visual Studio щелкните правой кнопкой мыши проект **TestApp** в **обозревателе решений** и выберите элемент **Удостоверения и доступ**.  
  
2.  Откроется окно **Идентификация и доступ**. В поле **Поставщики** выберите **Протестировать приложение с помощью локальной службы Development STS** и нажмите кнопку **Применить**.  
  
## <a name="step-4--modify-your-aspnet-application-to-display-sign-in-status"></a>Шаг 4. Изменение приложения ASP.NET для отображения сведений о состоянии входа  
 В этом разделе описывается, как изменить приложение ASP.NET для динамического отображения состояния входа текущего пользователя. После настройки поставщика службы маркеров безопасности входящие утверждения обрабатываются платформой WIF. Теперь необходимо настроить код приложения, чтобы отображать результаты проверки подлинности.  
  
#### <a name="to-display-sign-in-status"></a>Отображение состояния входа  
  
1.  В Visual Studio откройте файл **Default.aspx** в проекте **TestApp**.  
  
2.  В файле **Default.aspx** замените существующую разметку следующей:  
  
    ```  
    <%@ Page Language="C#" AutoEventWireup="true" CodeFile="Default.aspx.cs" Inherits="_Default" %>  
  
    <!DOCTYPE html>  
  
    <html>  
    <head runat="server">  
        <title>Logged In Status</title>  
    </head>  
    <body>  
        <asp:label ID="myLabel" runat="server" />  
    </body>  
    </html>  
    ```  
  
3.  Сохраните файл **Default.aspx**, а затем откройте его файл кода программной части с именем **Default.aspx.cs**.  
  
    > [!NOTE]
    >  Файл **Default.aspx.cs** может быть скрыт в узле **Default.aspx** в обозревателе решений. Если файл **Default.aspx.cs** не отображается, разверните узел **Default.aspx**, щелкнув значок треугольника рядом с ним.  
  
4.  В файле **Default.aspx.cs** замените существующий код следующим:  
  
    ```csharp  
    using System;  
    using System.Web.UI;  
    using System.Security.Claims;  
  
    namespace TestApp  
    {  
        protected void Page_Load(object sender, EventArgs e)  
        {  
            ClaimsPrincipal claimsPrincipal = Thread.CurrentPrincipal as ClaimsPrincipal;  
  
            if (claimsPrincipal != null)  
            {  
                myLabel.Text = "You are signed in.";  
            }  
            else  
            {  
                myLabel.Text = "You are not signed in.";  
            }  
        }  
    }  
    ```  
  
5.  Сохраните файл **Default.aspx.cs** и выполните построение приложения.  
  
## <a name="step-5--test-the-integration-between-wif-and-your-aspnet-application"></a>Шаг 5. Проверка интеграции между платформой WIF и приложением ASP.NET  
 В этом разделе описывается проверка интеграции между платформой WIF и приложением ASP.NET.  
  
#### <a name="to-test-the-integration-between-wif-and-aspnet"></a>Проверка интеграции между платформой WIF и приложением ASP.NET  
  
1.  В Visual Studio нажмите клавишу **F5**, чтобы запустить отладку приложения. Если не будут обнаружены ошибки, откроется новое окно браузера.  
  
2.  Обратите внимание, что браузер автоматически перенаправляет запрос к службе маркеров безопасности, после чего открывает страницу Default.aspx. Если платформа WIF правильно настроена, появится страница сайта с текстом **"Вход выполнен"**.

