---
title: Уровни доверия, используемые при доступе к ресурсам
ms.date: 03/30/2017
ms.assetid: fb5be924-317d-4d69-b33a-3d18ecfb9d6e
ms.openlocfilehash: 7070d82c430b762059153c544e26478dc2d7ae39
ms.sourcegitcommit: 2d792961ed48f235cf413d6031576373c3050918
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/31/2019
ms.locfileid: "70205868"
---
# <a name="security-trust-levels-in-accessing-resources"></a>Уровни доверия, используемые при доступе к ресурсам
В этом разделе описывается порядок ограничения доступа к ресурсам различных типов, используемым инфраструктурой <xref:System.Transactions>.  
  
 Предусмотрено три основных уровня доверия для инфраструктуры <xref:System.Transactions>. Уровни доверия определяются на основе типов ресурсов, используемых инфраструктурой <xref:System.Transactions>, и уровня доверия, который требуется для доступа к этим ресурсам. Ресурсами, к которым инфраструктура <xref:System.Transactions> предоставляет доступ, являются системная память, ресурсы, общие для всего процесса, и ресурсы, общие для всей системы. Ниже представлены предусмотренные уровни доверия.  
  
- **AllowPartiallyTrustedCallers** (APTCA) для приложений, использующих транзакции в одном домене приложения.  
  
- **DistributedTransactionPermission** (DTP) для приложений, использующих распределенные транзакции.  
  
- FullTrust - для устойчивых ресурсов, приложений управления конфигурацией и приложений взаимодействия с традиционными системами.  
  
> [!NOTE]
> Не следует вызывать какие-либо интерфейсы зачисления с олицетворяемыми контекстами.  
  
## <a name="trust-levels"></a>Уровни доверия  
  
### <a name="aptca-partial-trust"></a>APTCA (частичное доверие)  
 Сборка может вызываться частично доверенным кодом, так как она помечена атрибутом AllowPartiallyTrustedCallers (APTCA). <xref:System.Transactions> Этот атрибут по сути удаляет неявный <xref:System.Security.Permissions.SecurityAction.LinkDemand> для набора разрешений **FullTrust** , который в противном случае автоматически размещается в каждом общедоступном методе каждого типа. Однако для некоторых типов и элементов по-прежнему требуются разрешения более высокого уровня.  
  
 Атрибут APTCA позволяет приложениям использовать транзакции с частичным доверием в одном домене приложения. Это обеспечивает использование неповышаемых транзакций и зачислений неустойчивых ресурсов, которые можно применять для обработки ошибок. В качестве примера рассмотрим транзакционную хэш-таблицу и используемое ей приложение. Данные можно добавлять и удалять из хэш-таблицы в рамках одной транзакции. В случае последующего отката транзакции все произведенные в рамках транзакции изменения хэш-таблицы могут быть отменены.  
  
### <a name="distributedtransactionpermission-dtp"></a>Разрешение DistributedTransactionPermission (DTP)  
 При передаче управления транзакцией <xref:System.Transactions> координатору MSDTC инфраструктура <xref:System.Transactions> запрашивает разрешение <xref:System.Transactions.DistributedTransactionPermission> (DTP) для создания распределенной транзакции. Это означает, что коду, вызывающему передачу транзакции на следующий уровень иерархии (например, посредством сериализации или зачисления дополнительных устойчивых ресурсов), требуется предоставление разрешения DTP. Коду, который изначально создал транзакцию <xref:System.Transactions>, не обязательно располагать данным разрешением.  
  
### <a name="fulltrust-link-demands"></a>FullTrust (полное доверие)  
 Этот уровень разрешений предназначен для ограничения приложений, записывающих данные в устойчивые ресурсы. В случае сбоя приложение должно быть способно восстановить связь с диспетчером транзакций для определения окончательного результата транзакции, чтобы обновить постоянные данные. Приложение такого типа называется диспетчером устойчивых ресурсов. Классическим примером такого приложения является SQL.  
  
 Для выполнения восстановления у этого приложения имеется способность постоянно потреблять системные ресурсы. Это необходимо, поскольку диспетчер ресурсов, выполняющий восстановление, должен вспомнить все зафиксированные транзакции, прежде чем он сможет подтвердить, что все участвующие в транзакции диспетчеры устойчивых ресурсов получили результат транзакции. Поэтому приложению данного типа требуется разрешение FullTrust, и его не следует запускать, если такой уровень доверия не предоставлен.  
  
 Дополнительные сведения о устойчивых операциях прикрепления и восстановлении см. в разделе [прикрепление ресурсов в качестве участников транзакции](enlisting-resources-as-participants-in-a-transaction.md) и [выполнение](performing-recovery.md) разделов по восстановлению.  
  
 Приложениям, которые выполняют традиционные операции взаимодействия с COM+, также требуется разрешение FullTrust.  
  
 Ниже приведен список типов и членов, которые не вызываются частично доверенным кодом, так как они снабжены атрибутом декларативной безопасности **FullTrust** .  
  
 `PermissionSetAttribute(SecurityAction.LinkDemand, Name := "FullTrust")`  
  
- <xref:System.Transactions.Transaction.EnlistDurable%2A?displayProperty=nameWithType>  
  
- <xref:System.Transactions.Transaction.EnlistPromotableSinglePhase%2A>  
  
- <xref:System.Transactions.TransactionInterop>  
  
- <xref:System.Transactions.TransactionManager.DistributedTransactionStarted>  
  
- <xref:System.Transactions.HostCurrentTransactionCallback>  
  
- <xref:System.Transactions.TransactionManager.Reenlist%2A>  
  
- <xref:System.Transactions.TransactionManager.RecoveryComplete%2A>  
  
- <xref:System.Transactions.TransactionScope.%23ctor%28System.Transactions.TransactionScopeOption%2CSystem.Transactions.TransactionOptions%2CSystem.Transactions.EnterpriseServicesInteropOption%29>  
  
 Только непосредственный вызывающий объект должен обладать набором разрешений **FullTrust** для использования описанных выше типов или методов.
