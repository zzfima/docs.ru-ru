---
title: "Управление разрешениями с использованием хранимых процедур в SQL Server"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-ado
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 08fa34e8-2ffa-470d-ba62-e511a5f8558e
caps.latest.revision: "6"
author: douglaslMS
ms.author: douglasl
manager: craigg
ms.workload: dotnet
ms.openlocfilehash: 38bdc4d41e4b42f2dccaf059d84f6b8b45967ff5
ms.sourcegitcommit: ed26cfef4e18f6d93ab822d8c29f902cff3519d1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/17/2018
---
# <a name="managing-permissions-with-stored-procedures-in-sql-server"></a>Управление разрешениями с использованием хранимых процедур в SQL Server
Одним из методов создания нескольких линий защиты для базы данных является реализация доступа ко всем данным с помощью хранимых процедур или определяемых пользователем функций. Отменяются или запрещаются разрешения на все базовые объекты (например, таблицы), на хранимые процедуры предоставляются разрешения EXECUTE. Тем самым создается эффективный периметр безопасности вокруг данных и объектов базы данных.  
  
## <a name="stored-procedure-benefits"></a>Преимущества хранимых процедур  
 Хранимые процедуры обладают следующими преимуществами.  
  
-   Логику данных и бизнес-правила можно инкапсулировать, чтобы пользователи получали доступ к данным и объектам только тем путем, который предусмотрен разработчиками и администраторами баз данных.  
  
-   Чтобы исключить возможность атак путем внедрения кода SQL, можно использовать параметризованные хранимые процедуры, проверяющие ввод пользователя. При использовании динамического SQL обязательно параметризуйте команды и ни в коем случае не включайте значения параметров непосредственно в строку запроса.  
  
-   Можно запретить нерегламентированные запросы и изменение данных. Таким образом пользователи не смогут злонамеренно или случайно уничтожить данные или выполнить запросы, снижающие производительность сервера в сети.  
  
-   В коде процедур можно обрабатывать ошибки, не передавая их в клиентские приложения. Таким образом предотвращается возвращение сообщений об ошибках, которые могут использоваться в атаках зондированием. Регистрируйте ошибки и обрабатывайте их на сервере.  
  
-   К написанным однажды хранимым процедурам могут обращаться многие приложения.  
  
-   Клиентским приложениям не требуются сведения о базовых структурах данных. Код хранимых процедур можно изменять, не внося изменения в клиентские приложения, если это не влияет на списки параметров и возвращаемые типы данных.  
  
-   Хранимые процедуры снижают нагрузку на сетевой трафик, объединяя несколько операций в одном вызове процедуры.  
  
## <a name="stored-procedure-execution"></a>Выполнение хранимых процедур  
 Хранимые процедуры предоставляют доступ к данным с помощью цепочек владения таким образом, чтобы пользователям не требовались явные разрешения для работы с объектами базы данных. Цепочка владения возникает, когда объекты, последовательно получающие доступ друг к другу, принадлежат одному пользователю. Например, хранимая процедура может вызывать другие хранимые процедуры или обращаться к нескольким таблицам. Если все объекты в цепочке владения принадлежат одному владельцу, то SQL Server проверяет только разрешение EXECUTE вызывающего, но не разрешения вызывающего на другие объекты. Поэтому нужно предоставить только разрешения EXECUTE на хранимые процедуры и отменить или запретить все разрешения на базовые таблицы.  
  
## <a name="best-practices"></a>Рекомендации  
 Простого написания хранимой процедуры недостаточно для надежной защиты приложения. Необходимо учитывать следующие потенциальные уязвимости защиты.  
  
-   Предоставьте разрешения EXECUTE на хранимые процедуры нужным ролям базы данных для доступа к данным.  
  
-   Отмените или запретите все разрешения на базовые таблицы для всех ролей и пользователей базы данных, в том числе роль `public`. Все пользователи наследуют разрешения из роли public. Поэтому запрет разрешений для роли `public` означает, что доступ будут иметь только владельцы объектов и члены роли `sysadmin`, все остальные пользователи не смогут наследовать разрешения, будучи членами других ролей.  
  
-   Не добавляйте пользователей или роли к ролям `sysadmin` и `db_owner`. Системные администраторы и владельцы базы данных имеют доступ ко всем объектам базы данных.  
  
-   Отключите учетную запись `guest`. Это будет препятствовать соединению анонимных пользователей с базой данных. В новых базах данных учетная запись guest отключена по умолчанию.  
  
-   Реализуйте обработку ошибок и ошибочных записей журнала.  
  
-   Создайте параметризованные хранимые процедуры, которые будут проверять ввод пользователей. Считайте все входные данные пользователей не соответствующими требованиям безопасности.  
  
-   Избегайте использования динамического SQL за исключением абсолютно необходимых случаев. Используйте функцию Transact-SQL QUOTENAME() для разделения строковых значений и избегайте любого вхождения разделителей в строке ввода.  
  
## <a name="external-resources"></a>Внешние ресурсы  
 Дополнительные сведения см. в следующих ресурсах.  
  
|Ресурс|Описание:|  
|--------------|-----------------|  
|[Хранимые процедуры](http://msdn.microsoft.com/library/ms190782.aspx) и [атаки SQL Injection](http://go.microsoft.com/fwlink/?LinkId=98234) в электронной документации по SQL Server|Разделы описывают, как создавать хранимые процедуры и как работает внедрение кода SQL.|  
  
## <a name="see-also"></a>См. также  
 [Защита приложений ADO.NET](../../../../../docs/framework/data/adonet/securing-ado-net-applications.md)  
 [Общие сведения о безопасности SQL Server](../../../../../docs/framework/data/adonet/sql/overview-of-sql-server-security.md)  
 [Сценарии безопасности приложений в SQL Server](../../../../../docs/framework/data/adonet/sql/application-security-scenarios-in-sql-server.md)  
 [Написание безопасного динамического кода SQL в SQL Server](../../../../../docs/framework/data/adonet/sql/writing-secure-dynamic-sql-in-sql-server.md)  
 [Подписывание хранимых процедур в SQL Server](../../../../../docs/framework/data/adonet/sql/signing-stored-procedures-in-sql-server.md)  
 [Настройка разрешений с олицетворением в SQL Server](../../../../../docs/framework/data/adonet/sql/customizing-permissions-with-impersonation-in-sql-server.md)  
 [Изменение данных с помощью хранимых процедур](../../../../../docs/framework/data/adonet/modifying-data-with-stored-procedures.md)  
 [Центр разработчиков наборов данных и управляемых поставщиков ADO.NET](http://go.microsoft.com/fwlink/?LinkId=217917)
