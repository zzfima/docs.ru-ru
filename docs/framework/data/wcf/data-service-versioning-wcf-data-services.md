---
title: Управление версиями службы данных (службы WCF Data Services)
ms.date: 03/30/2017
helpviewer_keywords:
- versioning, WCF Data Services
- versioning [WCF Data Services]
- WCF Data Services, versioning
ms.assetid: e3e899cc-7f25-4f67-958f-063f01f79766
ms.openlocfilehash: 341cd8e21b84b220236947bca50311e5a1a75c72
ms.sourcegitcommit: 30a558d23e3ac5a52071121a52c305c85fe15726
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/25/2019
ms.locfileid: "75346124"
---
# <a name="data-service-versioning-wcf-data-services"></a>Управление версиями службы данных (службы WCF Data Services)
Open Data Protocol (OData) позволяет создавать службы данных, чтобы клиенты могли получать доступ к данным как к ресурсам с помощью URI, основанных на модели данных. OData также поддерживает определение операций службы. После первоначального развертывания служб и, возможно, несколько раз на протяжении времени их существования возникает потребность в изменении этих служб. Причин тому немало: изменяющиеся потребности бизнеса, требования информационных технологий или необходимость решить какие-либо другие проблемы. При внесении изменений в существующую службу данных необходимо принять решение, следует ли определить новую версию службы данных и как оптимальным способом свести к минимуму воздействие на существующие клиентские приложения. Этот раздел содержит указания о том, когда и как следует создавать новую версию службы данных. Здесь также описывается, как WCF Data Services обрабатывает обмен между клиентами и службами данных, которые поддерживают различные версии протокола OData.

## <a name="versioning-a-wcf-data-service"></a>Управление версиями службы данных WCF
 После того как служба данных развернута и данные получены, изменения в службе данных могут стать причиной несовместимости с существующими клиентскими приложениями. Но поскольку изменения часто обусловлены общими бизнес-потребностями службы, необходимо решить, когда и как создать новую версию службы данных с минимальным воздействием на клиентские приложения.

### <a name="data-model-changes-that-recommend-a-new-data-service-version"></a>Изменения в модели данных, при внесении которых рекомендуется перейти на новую версию службы данных
 При рассмотрении вопроса о необходимости публиковать новую версию службы данных важно понимать, как различные изменения могут повлиять на клиентские приложения. Изменения в службе данных, которые могут привести к необходимости создать новую версию службы данных, можно разделить на следующие две категории.

- Изменения в контракте службы, которые включают обновления операций службы, изменения в доступности наборов сущностей (каналы), изменения версии и другие изменения поведения службы.

- Изменения в контракте данных, которые включают изменения в модели данных, форматах каналов или настройках каналов.

 В следующей таблице приведены сведения, для каких видов изменений следует рассмотреть вопрос о публикации новой версии службы данных.

|Тип изменения|Требуется новая версия|Новая версия не нужна|
|--------------------|----------------------------|----------------------------|
|Служебные операции|-Добавить новый параметр<br />-Изменить тип возвращаемого значения<br />-Удаление операции службы|-Удалить существующий параметр<br />-Добавить новую операцию службы|
|Поведения служб|— Отключение запросов счетчиков<br />— Отключить поддержку проекции<br />— Увеличение требуемой версии службы данных|— Включить запросы на подсчет<br />— Включить поддержку проекций<br />-Уменьшить требуемую версию службы данных|
|Разрешения набора сущностей|-Ограничить разрешения для набора сущностей<br />-Изменить код ответа (новое значение первой цифры) <sup>1</sup>|— Расстановка разрешений на набор сущностей<br />-Изменить код ответа (то же самое первое цифровое значение)|
|Свойства сущности|-Удалить существующее свойство или связь<br />-Добавить свойство, не допускающее значения NULL<br />-Изменить существующее свойство|-Добавить свойство, допускающее значение NULL<sup>2</sup>|
|Наборы сущностей|-Удалить набор сущностей|-Добавить производный тип<br />-Изменить базовый тип<br />-Добавить набор сущностей|
|Настройка канала|-Изменить сопоставление свойства сущности||

 <sup>1</sup> это может зависеть от того, насколько строго клиентское приложение полагается на получение определенного кода ошибки.

 <sup>2</sup> для свойства <xref:System.Data.Services.Client.DataServiceContext.IgnoreMissingProperties%2A> можно задать значение `true`, чтобы клиент игнорировал все новые свойства, отправленные службой данных, не определенные на клиенте. Однако при выполнении вставок свойства, не включенным клиентом в запрос POST, устанавливаются в значения по умолчанию. Для обновлений все данные, существующие в неизвестном клиенту свойстве, могут быть перезаписаны значениями по умолчанию. В этом случае необходимо отправлять обновление как запрос MERGE, который используется по умолчанию. Дополнительные сведения см. [в разделе Управление контекстом службы данных](managing-the-data-service-context-wcf-data-services.md).

### <a name="how-to-version-a-data-service"></a>Управление версиями службы данных
 При необходимости новая версия службы данных определяется путем создания нового экземпляра службы с обновленным контрактом службы или моделью данных. Затем новая служба предоставляется с использованием новой конечной точки URI, в чем заключается отличие от предыдущей версии. Например:

- Старая версия: `http://services.odata.org/Northwind/v1/Northwind.svc/`

- Новая версия: `http://services.odata.org/Northwind/v2/Northwind.svc/`

 При обновлении службы данных необходимо также обновить клиенты на основе новых метаданных службы данных и использовать новый корневой URI. Если возможно, следует сохранить предыдущую версию службы данных для поддержки клиентов, которые еще не обновлены для работы с новой версией. Более старые версии службы данных можно удалить, если они больше не нужны. Необходимо рассмотреть вопрос о сохранении конечной точки URI службы данных во внешнем файле конфигурации.

## <a name="odata-protocol-versions"></a>Версии протокола OData
 По мере выпуска новых версий OData клиентские приложения могут не использовать ту же версию протокола OData, которая поддерживается службой данных. Более старое клиентское приложение может обращаться к службе данных, которая поддерживает более новую версию OData. Клиентское приложение также может использовать более новую версию клиентской библиотеки WCF Data Services, которая поддерживает более новую версию OData, чем служба данных, к которой осуществляется доступ.

 WCF Data Services использует поддержку, предоставляемую OData для решения таких сценариев управления версиями. Кроме того, существует поддержка создания и использования метаданных модели данных для создания клиентских классов службы данных, когда клиент использует другую версию OData, чем используемая службой данных. Дополнительные сведения см. в разделе протокол управления версиями статьи [OData: обзор](https://www.odata.org/documentation/odata-version-2-0/overview/) .

### <a name="version-negotiation"></a>Согласование версий
 Служба данных может быть настроена для определения самой высокой версии протокола OData, которая будет использоваться службой, независимо от версии, запрошенной клиентом. Это можно сделать, указав значение <xref:System.Data.Services.Common.DataServiceProtocolVersion> для свойства <xref:System.Data.Services.DataServiceBehavior.MaxProtocolVersion%2A> <xref:System.Data.Services.DataServiceBehavior>, используемого службой данных. Дополнительные сведения см. [в разделе Настройка службы данных](configuring-the-data-service-wcf-data-services.md).

 Когда приложение использует клиентские библиотеки WCF Data Services для доступа к службе данных, библиотеки автоматически устанавливают для этих заголовков правильные значения в зависимости от версии OData и функций, используемых в приложении. По умолчанию WCF Data Services использует самую низкую версию протокола, поддерживающую запрошенную операцию.

 В следующей таблице приведены версии .NET Framework и Silverlight, которые включают поддержку WCF Data Services для конкретных версий протокола OData.

|Версия протокола OData|Поддержка введена в...|
|-----------------------------------------------------------------------------------|----------------------------|
|Версия 1|-.NET Framework 3,5 с пакетом обновления 1 (SP1)<br />-Silverlight версии 3|
|Версия 2|-.NET Framework 4<br />— Обновление для .NET Framework 3,5 с пакетом обновления 1 (SP1). Загрузить и установить обновление можно в [центре загрузки Майкрософт](https://go.microsoft.com/fwlink/?LinkId=158125).<br />-Silverlight версии 4|
|Версия 3|— Вы можете скачать и установить предварительную версию, поддерживающую OData версии 3, из [центра загрузки Майкрософт](https://go.microsoft.com/fwlink/?LinkId=203885).|

### <a name="metadata-versions"></a>Версии метаданных
 По умолчанию WCF Data Services использует язык CSDL версии 1,1 для представления модели данных. Это всегда справедливо для моделей данных, основанных на поставщике отражения или на специализированном поставщике служб данных. Но если модель данных определена с помощью платформы Entity Framework, возвращаемая версия CSDL та же, что и версия, используемая платформой Entity Framework. Версия языка CSDL определяется пространством имен [элемента Schema (CSDL)](/ef/ef6/modeling/designer/advanced/edmx/csdl-spec#schema-element-csdl).

 Элемент `DataServices` возвращаемых метаданных содержит также атрибут `DataServiceVersion`, имеющий то же значение, что и заголовок `DataServiceVersion` в ответном сообщении. Клиентские приложения, например диалоговое окно **Добавление ссылки на службу** в Visual Studio, используют эти сведения для создания классов клиентских служб данных, которые правильно работают с версией WCF Data Services, в которой размещена служба данных. Дополнительные сведения см. в разделе протокол управления версиями статьи [OData: обзор](https://www.odata.org/documentation/odata-version-2-0/overview/) .

## <a name="see-also"></a>См. также:

- [Поставщики служб данных](data-services-providers-wcf-data-services.md)
- [Определение служб данных WCF](defining-wcf-data-services.md)
