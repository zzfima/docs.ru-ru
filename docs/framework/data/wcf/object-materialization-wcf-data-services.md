---
title: Материализация объектов (службы данных WCF)
ms.date: 03/30/2017
helpviewer_keywords:
- WCF Data Services, client library
- WCF Data Services, querying
ms.assetid: f0dbf7b0-0292-4e31-9ae4-b98288336dc1
ms.openlocfilehash: 7a2b201e5690c4304e663e9429c54f377e05f556
ms.sourcegitcommit: 79a2d6a07ba4ed08979819666a0ee6927bbf1b01
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/28/2019
ms.locfileid: "74568908"
---
# <a name="object-materialization-wcf-data-services"></a><span data-ttu-id="70b9d-102">Материализация объектов (службы данных WCF)</span><span class="sxs-lookup"><span data-stu-id="70b9d-102">Object Materialization (WCF Data Services)</span></span>

<span data-ttu-id="70b9d-103">При использовании диалогового окна **Добавление ссылки на службу** для использования канала Open Data Protocol (OData) в клиентском приложении на основе .NET Framework для каждого типа сущностей в модели данных, предоставляемой веб-каналом, создаются эквивалентные классы данных.</span><span class="sxs-lookup"><span data-stu-id="70b9d-103">When you use the **Add Service Reference** dialog to consume an Open Data Protocol (OData) feed in a .NET Framework-based client application, equivalent data classes are generated for each entity type in the data model exposed by the feed.</span></span> <span data-ttu-id="70b9d-104">Дополнительные сведения см. [в разделе Создание клиентской библиотеки службы данных](generating-the-data-service-client-library-wcf-data-services.md).</span><span class="sxs-lookup"><span data-stu-id="70b9d-104">For more information, see [Generating the Data Service Client Library](generating-the-data-service-client-library-wcf-data-services.md).</span></span> <span data-ttu-id="70b9d-105">Данные сущности, возвращаемые запросом, материализуются в экземпляр одного из созданных классов клиентской службы данных.</span><span class="sxs-lookup"><span data-stu-id="70b9d-105">Entity data that is returned by a query is materialized into an instance of one of these generated client data service classes.</span></span> <span data-ttu-id="70b9d-106">Сведения о параметрах слияния и разрешении идентификаторов для отслеживания объектов см. [в разделе Управление контекстом службы данных](managing-the-data-service-context-wcf-data-services.md).</span><span class="sxs-lookup"><span data-stu-id="70b9d-106">For information about merge options and identity resolution for tracked objects, see [Managing the Data Service Context](managing-the-data-service-context-wcf-data-services.md).</span></span>

<span data-ttu-id="70b9d-107">WCF Data Services также позволяет определять собственные классы клиентских служб данных вместо использования созданных средством классов данных.</span><span class="sxs-lookup"><span data-stu-id="70b9d-107">WCF Data Services also enables you to define your own client data service classes rather than using the tool-generated data classes.</span></span> <span data-ttu-id="70b9d-108">Это позволяет разработчикам использовать собственные классы данных, также называемые классами данных POCO (Plain Old CLR Object).</span><span class="sxs-lookup"><span data-stu-id="70b9d-108">This enables you to use your own data classes, also known as "plain-old CLR object" (POCO) data classes.</span></span> <span data-ttu-id="70b9d-109">При использовании этих типов пользовательских классов данных следует присвоить классу данных либо <xref:System.Data.Services.Common.DataServiceKeyAttribute>, либо <xref:System.Data.Services.Common.DataServiceEntityAttribute> и убедиться, что имена типов в клиенте совпадают с именами типов в модели данных службы данных.</span><span class="sxs-lookup"><span data-stu-id="70b9d-109">When using these types of custom data classes, you should attribute the data class with either <xref:System.Data.Services.Common.DataServiceKeyAttribute> or <xref:System.Data.Services.Common.DataServiceEntityAttribute> and ensure that type names on the client match type names in the data model of the data service.</span></span>

<span data-ttu-id="70b9d-110">После того как библиотека получает ответное сообщение запроса, она преобразует возвращенные данные из канала OData в экземпляры классов клиентских служб данных, которые имеют тип запроса.</span><span class="sxs-lookup"><span data-stu-id="70b9d-110">After the library receives the query response message, it materializes the returned data from the OData feed into instances of client data service classes that are of the type of the query.</span></span> <span data-ttu-id="70b9d-111">Обычно общий процесс материализации этих объектов происходит следующим образом.</span><span class="sxs-lookup"><span data-stu-id="70b9d-111">The general process for materializing these objects is as follows:</span></span>

1. <span data-ttu-id="70b9d-112">Клиентская библиотека считывает сериализованный тип из элемента `entry` в веб-канале ответных сообщений и пытается создать новый экземпляр правильного типа одним из следующих способов.</span><span class="sxs-lookup"><span data-stu-id="70b9d-112">The client library reads the serialized type from the `entry` element in the response message feed and attempts to create a new instance of the correct type, in one of the following ways:</span></span>

    - <span data-ttu-id="70b9d-113">Если тип, объявленный в веб-канале, имеет то же имя, что и тип <xref:System.Data.Services.Client.DataServiceQuery%601>, новый экземпляр этого типа создается с помощью пустого конструктора.</span><span class="sxs-lookup"><span data-stu-id="70b9d-113">When the type declared in the feed has the same name as the type of the <xref:System.Data.Services.Client.DataServiceQuery%601>, a new instance of this type is created by using the empty constructor.</span></span>

    - <span data-ttu-id="70b9d-114">Если тип, объявленный в веб-канале, имеет то же имя, что и тип, производный от типа <xref:System.Data.Services.Client.DataServiceQuery%601>, новый экземпляр этого производного типа создается с помощью пустого конструктора.</span><span class="sxs-lookup"><span data-stu-id="70b9d-114">When the type declared in the feed has the same name as a type that is derived from the type of the <xref:System.Data.Services.Client.DataServiceQuery%601>, a new instance of this derived type is created by using the empty constructor.</span></span>

    - <span data-ttu-id="70b9d-115">Если тип, объявленный в веб-канале, не может быть сопоставлен с типом <xref:System.Data.Services.Client.DataServiceQuery%601> или любым производным типом, новый экземпляр запрашиваемого типа создается с помощью пустого конструктора.</span><span class="sxs-lookup"><span data-stu-id="70b9d-115">When the type declared in the feed cannot be matched to the type of the <xref:System.Data.Services.Client.DataServiceQuery%601> or any derived types, a new instance of the queried type is created by using the empty constructor.</span></span>

    - <span data-ttu-id="70b9d-116">Если установлено свойство <xref:System.Data.Services.Client.DataServiceContext.ResolveType%2A>, вызывается предоставленный делегат для переопределения сопоставления типа по умолчанию, основанного на имени, и вместо этого создается новый экземпляр типа, возвращаемого объектом <xref:System.Func%602>.</span><span class="sxs-lookup"><span data-stu-id="70b9d-116">When the <xref:System.Data.Services.Client.DataServiceContext.ResolveType%2A> property is set, the supplied delegate is called to override the default name-based type mapping and a new instance of the type returned by the <xref:System.Func%602> is created instead.</span></span> <span data-ttu-id="70b9d-117">Если этот делегат возвращает значение null, то создается новый экземпляр запрошенного типа.</span><span class="sxs-lookup"><span data-stu-id="70b9d-117">If this delegate returns a null value, a new instance of the queried type is created instead.</span></span> <span data-ttu-id="70b9d-118">Для поддержки сценария наследования может потребоваться переопределить сопоставление имени типа по умолчанию, основанное на имени.</span><span class="sxs-lookup"><span data-stu-id="70b9d-118">It may be required to override the default name-based type name mapping to support inheritance scenarios.</span></span>

2. <span data-ttu-id="70b9d-119">Клиентская библиотека считывает из элемента `id` объекта `entry` значение URI, которое является значением идентификатора сущности.</span><span class="sxs-lookup"><span data-stu-id="70b9d-119">The client library reads the URI value from the `id` element of the `entry`, which is the identity value of the entity.</span></span> <span data-ttu-id="70b9d-120">Если значение <xref:System.Data.Services.Client.DataServiceContext.MergeOption%2A> объекта <xref:System.Data.Services.Client.MergeOption.NoTracking> не используется, то значение идентификатора используется для отслеживания объекта в <xref:System.Data.Services.Client.DataServiceContext>.</span><span class="sxs-lookup"><span data-stu-id="70b9d-120">Unless a <xref:System.Data.Services.Client.DataServiceContext.MergeOption%2A> value of <xref:System.Data.Services.Client.MergeOption.NoTracking> is used, the identity value is used to track the object in the <xref:System.Data.Services.Client.DataServiceContext>.</span></span> <span data-ttu-id="70b9d-121">Значение идентификатора используется также для обеспечения создания лишь одного экземпляра сущности, даже если сущность возвращается в ответе на запрос несколько раз.</span><span class="sxs-lookup"><span data-stu-id="70b9d-121">The identity value is also used to guarantee that only a single entity instance is created, even when an entity is returned multiple times in the query response.</span></span>

3. <span data-ttu-id="70b9d-122">Клиентская библиотека считывает свойства из записи веб-канала и устанавливает соответствующие свойства в только что созданном объекте.</span><span class="sxs-lookup"><span data-stu-id="70b9d-122">The client library reads properties from the feed entry and set the corresponding properties on the newly created object.</span></span> <span data-ttu-id="70b9d-123">Если объект, который имеет то же значение идентификатора, уже присутствует в элементе <xref:System.Data.Services.Client.DataServiceContext>, то свойства устанавливаются в соответствии с параметром <xref:System.Data.Services.Client.MergeOption> элемента <xref:System.Data.Services.Client.DataServiceContext>.</span><span class="sxs-lookup"><span data-stu-id="70b9d-123">When an object that has the same identity value already occurs in the <xref:System.Data.Services.Client.DataServiceContext>, the properties are set based on the <xref:System.Data.Services.Client.MergeOption> setting of the <xref:System.Data.Services.Client.DataServiceContext>.</span></span> <span data-ttu-id="70b9d-124">Ответ может содержать значения свойств, для которых соответствующее свойство отсутствует в типе клиента.</span><span class="sxs-lookup"><span data-stu-id="70b9d-124">The response might contain property values for which a corresponding property does not occur in the client type.</span></span> <span data-ttu-id="70b9d-125">В таком случае выполняемое действие зависит от значения свойства <xref:System.Data.Services.Client.DataServiceContext.IgnoreMissingProperties%2A> элемента <xref:System.Data.Services.Client.DataServiceContext>.</span><span class="sxs-lookup"><span data-stu-id="70b9d-125">When this occurs, the action depends on the value of the <xref:System.Data.Services.Client.DataServiceContext.IgnoreMissingProperties%2A> property of the <xref:System.Data.Services.Client.DataServiceContext>.</span></span> <span data-ttu-id="70b9d-126">Если свойство равно `true`, то отсутствующее свойство не учитывается.</span><span class="sxs-lookup"><span data-stu-id="70b9d-126">When this property is set to `true`, the missing property is ignored.</span></span> <span data-ttu-id="70b9d-127">В противном случае произойдет ошибка.</span><span class="sxs-lookup"><span data-stu-id="70b9d-127">Otherwise, an error is raised.</span></span> <span data-ttu-id="70b9d-128">Значения свойств устанавливаются следующим образом.</span><span class="sxs-lookup"><span data-stu-id="70b9d-128">Properties are set as follows:</span></span>

    - <span data-ttu-id="70b9d-129">Скалярным свойствам присваивается соответствующее значение записи ответного сообщения.</span><span class="sxs-lookup"><span data-stu-id="70b9d-129">Scalar properties are set to the corresponding value in the entry in the response message.</span></span>

    - <span data-ttu-id="70b9d-130">Сложным свойствам присваивается новый экземпляр сложного типа, принимающий значения свойств сложного типа из ответа.</span><span class="sxs-lookup"><span data-stu-id="70b9d-130">Complex properties are set to a new complex type instance, which are set with the properties of the complex type from the response.</span></span>

    - <span data-ttu-id="70b9d-131">Свойства навигации, которые возвращают коллекцию связанных сущностей, приравниваются к новому или существующему экземпляру коллекции <xref:System.Collections.Generic.ICollection%601>, где `T` является типом связанной сущности.</span><span class="sxs-lookup"><span data-stu-id="70b9d-131">Navigation properties that return a collection of related entities are set to a new or existing instance of <xref:System.Collections.Generic.ICollection%601>, where `T` is the type of the related entity.</span></span> <span data-ttu-id="70b9d-132">Эта коллекция будет пустой, если связанные объекты не загружены в объект <xref:System.Data.Services.Client.DataServiceContext>.</span><span class="sxs-lookup"><span data-stu-id="70b9d-132">This collection is empty unless the related objects have been loaded into the <xref:System.Data.Services.Client.DataServiceContext>.</span></span> <span data-ttu-id="70b9d-133">Дополнительные сведения см. в разделе [Загрузка отложенного содержимого](loading-deferred-content-wcf-data-services.md).</span><span class="sxs-lookup"><span data-stu-id="70b9d-133">For more information, see [Loading Deferred Content](loading-deferred-content-wcf-data-services.md).</span></span>

      > [!NOTE]
      > <span data-ttu-id="70b9d-134">Если созданные классы клиентских данных поддерживают привязку данных, свойства навигации возвращают вместо этого экземпляры класса <xref:System.Data.Services.Client.DataServiceCollection%601>.</span><span class="sxs-lookup"><span data-stu-id="70b9d-134">When the generated client data classes support data binding, navigation properties return instances of the <xref:System.Data.Services.Client.DataServiceCollection%601> class instead.</span></span> <span data-ttu-id="70b9d-135">Дополнительные сведения см. [в разделе Привязка данных к элементам управления](binding-data-to-controls-wcf-data-services.md).</span><span class="sxs-lookup"><span data-stu-id="70b9d-135">For more information, see [Binding Data to Controls](binding-data-to-controls-wcf-data-services.md).</span></span>

4. <span data-ttu-id="70b9d-136">Возникает событие <xref:System.Data.Services.Client.DataServiceContext.ReadingEntity>.</span><span class="sxs-lookup"><span data-stu-id="70b9d-136">The <xref:System.Data.Services.Client.DataServiceContext.ReadingEntity> event is raised.</span></span>

5. <span data-ttu-id="70b9d-137">Клиентская библиотека присоединяет объект к контексту <xref:System.Data.Services.Client.DataServiceContext>.</span><span class="sxs-lookup"><span data-stu-id="70b9d-137">The client library attaches the object to the <xref:System.Data.Services.Client.DataServiceContext>.</span></span> <span data-ttu-id="70b9d-138">Если параметр <xref:System.Data.Services.Client.MergeOption> равен <xref:System.Data.Services.Client.MergeOption.NoTracking>, объект не присоединяется.</span><span class="sxs-lookup"><span data-stu-id="70b9d-138">The object is not attached when the <xref:System.Data.Services.Client.MergeOption> is <xref:System.Data.Services.Client.MergeOption.NoTracking>.</span></span>

## <a name="see-also"></a><span data-ttu-id="70b9d-139">См. также:</span><span class="sxs-lookup"><span data-stu-id="70b9d-139">See also</span></span>

- [<span data-ttu-id="70b9d-140">Выполнение запросов к службе данных</span><span class="sxs-lookup"><span data-stu-id="70b9d-140">Querying the Data Service</span></span>](querying-the-data-service-wcf-data-services.md)
- [<span data-ttu-id="70b9d-141">Проекции запросов</span><span class="sxs-lookup"><span data-stu-id="70b9d-141">Query Projections</span></span>](query-projections-wcf-data-services.md)
