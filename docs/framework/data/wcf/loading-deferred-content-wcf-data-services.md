---
title: Загрузка отложенного содержимого (службы данных WCF)
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- WCF Data Services, client library
- WCF Data Services, deferred content
- WCF Data Services, loading data
ms.assetid: 32f9b588-c832-44c4-a7e0-fcce635df59a
ms.openlocfilehash: 8ab4dea9e4f687f9548bb2b46a8f6baf428e29af
ms.sourcegitcommit: 3d5d33f384eeba41b2dff79d096f47ccc8d8f03d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/04/2018
ms.locfileid: "33365206"
---
# <a name="loading-deferred-content-wcf-data-services"></a><span data-ttu-id="893bc-102">Загрузка отложенного содержимого (службы данных WCF)</span><span class="sxs-lookup"><span data-stu-id="893bc-102">Loading Deferred Content (WCF Data Services)</span></span>
<span data-ttu-id="893bc-103">По умолчанию [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] ограничивает объем данных, возвращаемых запросом.</span><span class="sxs-lookup"><span data-stu-id="893bc-103">By default, [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] limits the amount of data that a query returns.</span></span> <span data-ttu-id="893bc-104">Однако при необходимости из службы данных можно явно загрузить дополнительные данные, включая связанные сущности, разбитые на страницы данные ответа и потоки двоичных данных.</span><span class="sxs-lookup"><span data-stu-id="893bc-104">However, you can explicitly load additional data, including related entities, paged response data, and binary data streams, from the data service when it is needed.</span></span> <span data-ttu-id="893bc-105">Этот раздел описывает загрузку такого отложенного содержимого в приложении.</span><span class="sxs-lookup"><span data-stu-id="893bc-105">This topic describes how to load such deferred content into your application.</span></span>  
  
## <a name="related-entities"></a><span data-ttu-id="893bc-106">Связанные сущности</span><span class="sxs-lookup"><span data-stu-id="893bc-106">Related Entities</span></span>  
 <span data-ttu-id="893bc-107">При выполнении запроса возвращаются только сущности в адресованном наборе сущностей.</span><span class="sxs-lookup"><span data-stu-id="893bc-107">When you execute a query, only entities in the addressed entity set are returned.</span></span> <span data-ttu-id="893bc-108">Например, когда запрос к службе данных Northwind возвращает сущности `Customers`, по умолчанию возврат связанных сущностей `Orders` не происходит, несмотря на наличие связи между сущностями `Customers` и `Orders`.</span><span class="sxs-lookup"><span data-stu-id="893bc-108">For example, when a query against the Northwind data service returns `Customers` entities, by default the related `Orders` entities are not returned, even though there is a relationship between `Customers` and `Orders`.</span></span> <span data-ttu-id="893bc-109">Кроме того, если в службе данных включена подкачка, необходимо явно загружать последующие страницы данных из службы.</span><span class="sxs-lookup"><span data-stu-id="893bc-109">Also, when paging is enabled in the data service, you must explicitly load subsequent data pages from the service.</span></span> <span data-ttu-id="893bc-110">Существует два способа загрузки связанных сущностей.</span><span class="sxs-lookup"><span data-stu-id="893bc-110">There are two ways to load related entities:</span></span>  
  
-   <span data-ttu-id="893bc-111">**Безотложная загрузка**: можно использовать `$expand` задать параметр запроса для запроса возврата сущностей, связанных ассоциацией сущности, заданного запроса.</span><span class="sxs-lookup"><span data-stu-id="893bc-111">**Eager loading**: You can use the `$expand` query option to request that the query return entities that are related by an association to the entity set that the query requested.</span></span> <span data-ttu-id="893bc-112">Для добавления параметра <xref:System.Data.Services.Client.DataServiceQuery%601.Expand%2A> в запрос, отправляемый службе данных, используйте метод <xref:System.Data.Services.Client.DataServiceQuery%601> класса `$expand`.</span><span class="sxs-lookup"><span data-stu-id="893bc-112">Use the <xref:System.Data.Services.Client.DataServiceQuery%601.Expand%2A> method on the <xref:System.Data.Services.Client.DataServiceQuery%601> to add the `$expand` option to the query that is sent to the data service.</span></span> <span data-ttu-id="893bc-113">Несколько связанных наборов сущностей можно запросить, разделяя их запятыми, как показывает следующий пример.</span><span class="sxs-lookup"><span data-stu-id="893bc-113">You can request multiple related entity sets by separating them by a comma, as in the following example.</span></span> <span data-ttu-id="893bc-114">Все сущности, запрашиваемые в запросе, возвращаются в одном ответе.</span><span class="sxs-lookup"><span data-stu-id="893bc-114">All entities requested by the query are returned in a single response.</span></span> <span data-ttu-id="893bc-115">Следующий пример возвращает сущности `Order_Details` и `Customers` вместе с набором сущностей `Orders`:</span><span class="sxs-lookup"><span data-stu-id="893bc-115">The following example returns `Order_Details` and `Customers` together with the `Orders` entity set:</span></span>  
  
     [!code-csharp[Astoria Northwind Client#ExpandOrderDetailsSpecific](../../../../samples/snippets/csharp/VS_Snippets_Misc/astoria northwind client/cs/source.cs#expandorderdetailsspecific)]
     [!code-vb[Astoria Northwind Client#ExpandOrderDetailsSpecific](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/astoria northwind client/vb/source.vb#expandorderdetailsspecific)]  
  
     <span data-ttu-id="893bc-116">Службы [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] ограничивают количество наборов сущностей, которые можно включить в один запрос, с помощью параметра запроса `$expand` двенадцатью наборами.</span><span class="sxs-lookup"><span data-stu-id="893bc-116">[!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] limits to 12 the number of entity sets that can be included in a single query by using the `$expand` query option.</span></span>  
  
-   <span data-ttu-id="893bc-117">**Явная загрузка**: вы можете вызвать <xref:System.Data.Services.Client.DataServiceContext.LoadProperty%2A> метод <xref:System.Data.Services.Client.DataServiceContext> экземпляра для явной загрузки связанных сущностей.</span><span class="sxs-lookup"><span data-stu-id="893bc-117">**Explicit loading**: You can call the <xref:System.Data.Services.Client.DataServiceContext.LoadProperty%2A> method on the <xref:System.Data.Services.Client.DataServiceContext> instance to explicitly load related entities.</span></span> <span data-ttu-id="893bc-118">При каждом вызове метода <xref:System.Data.Services.Client.DataServiceContext.LoadProperty%2A> создается отдельный запрос к службе данных.</span><span class="sxs-lookup"><span data-stu-id="893bc-118">Each call to the <xref:System.Data.Services.Client.DataServiceContext.LoadProperty%2A> method creates a separate request to the data service.</span></span> <span data-ttu-id="893bc-119">Следующий пример явно загружает сущности `Order_Details` для сущности `Orders`:</span><span class="sxs-lookup"><span data-stu-id="893bc-119">The following example explicitly loads `Order_Details` for an `Orders` entity:</span></span>  
  
     [!code-csharp[Astoria Northwind Client#LoadRelatedOrderDetailsSpecific](../../../../samples/snippets/csharp/VS_Snippets_Misc/astoria northwind client/cs/source.cs#loadrelatedorderdetailsspecific)]
     [!code-vb[Astoria Northwind Client#LoadRelatedOrderDetailsSpecific](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/astoria northwind client/vb/source.vb#loadrelatedorderdetailsspecific)]  
  
 <span data-ttu-id="893bc-120">При выборе параметра помните, что придется соблюдать баланс между числом запросов к службе данных и объемом данных, возвращаемых в одном ответе.</span><span class="sxs-lookup"><span data-stu-id="893bc-120">When you consider which option to use, realize that there is a tradeoff between the number of requests to the data service and the amount of data that is returned in a single response.</span></span> <span data-ttu-id="893bc-121">Активная загрузка используется, если приложению требуются связанные объекты и необходимо избежать дополнительной задержки, связанной с дополнительными запросами для явного извлечения данных.</span><span class="sxs-lookup"><span data-stu-id="893bc-121">Use eager loading when your application requires associated objects and you want to avoid the added latency of additional requests to explicitly retrieve them.</span></span> <span data-ttu-id="893bc-122">Однако в тех случаях, когда приложению требуются только данные для конкретных связанных экземпляров сущности, рассмотрите возможность их явной загрузки путем вызова метода <xref:System.Data.Services.Client.DataServiceContext.LoadProperty%2A>.</span><span class="sxs-lookup"><span data-stu-id="893bc-122">However, if there are cases when the application only needs the data for specific related entity instances, you should consider explicitly loading those entities by calling the <xref:System.Data.Services.Client.DataServiceContext.LoadProperty%2A> method.</span></span> <span data-ttu-id="893bc-123">Дополнительные сведения см. в разделе [как: загрузки связанных сущностей](../../../../docs/framework/data/wcf/how-to-load-related-entities-wcf-data-services.md).</span><span class="sxs-lookup"><span data-stu-id="893bc-123">For more information, see [How to: Load Related Entities](../../../../docs/framework/data/wcf/how-to-load-related-entities-wcf-data-services.md).</span></span>  
  
## <a name="paged-content"></a><span data-ttu-id="893bc-124">Содержимое, разбитое на страницы</span><span class="sxs-lookup"><span data-stu-id="893bc-124">Paged Content</span></span>  
 <span data-ttu-id="893bc-125">Если в службе данных включена подкачка страниц, число сущностей в канале, возвращаемом службой данных, ограничено настройками службы данных.</span><span class="sxs-lookup"><span data-stu-id="893bc-125">When paging is enabled in the data service, the number of entries in the feed that the data service returns is limited by the configuration of the data service.</span></span> <span data-ttu-id="893bc-126">Пределы подкачки можно задавать отдельно для каждого набора сущностей.</span><span class="sxs-lookup"><span data-stu-id="893bc-126">Page limits can be set separately for each entity set.</span></span> <span data-ttu-id="893bc-127">Дополнительные сведения см. в разделе [Настройка службы данных](../../../../docs/framework/data/wcf/configuring-the-data-service-wcf-data-services.md).</span><span class="sxs-lookup"><span data-stu-id="893bc-127">For more information, see [Configuring the Data Service](../../../../docs/framework/data/wcf/configuring-the-data-service-wcf-data-services.md).</span></span> <span data-ttu-id="893bc-128">Если включена подкачка страниц, то последняя запись в канале содержит ссылку на следующую страницу данных.</span><span class="sxs-lookup"><span data-stu-id="893bc-128">When paging is enabled, the final entry in the feed contains a link to the next page of data.</span></span> <span data-ttu-id="893bc-129">Эта ссылка содержится в объекте <xref:System.Data.Services.Client.DataServiceQueryContinuation%601>.</span><span class="sxs-lookup"><span data-stu-id="893bc-129">This link is contained in a <xref:System.Data.Services.Client.DataServiceQueryContinuation%601> object.</span></span> <span data-ttu-id="893bc-130">Получить URI для следующей страницы можно, вызвав метод <xref:System.Data.Services.Client.QueryOperationResponse%601.GetContinuation%2A> объекта <xref:System.Data.Services.Client.QueryOperationResponse%601>, возвращенного при выполнении запроса <xref:System.Data.Services.Client.DataServiceQuery%601>.</span><span class="sxs-lookup"><span data-stu-id="893bc-130">You obtain the URI to the next page of data by calling the <xref:System.Data.Services.Client.QueryOperationResponse%601.GetContinuation%2A> method on the <xref:System.Data.Services.Client.QueryOperationResponse%601> returned when the <xref:System.Data.Services.Client.DataServiceQuery%601> is executed.</span></span> <span data-ttu-id="893bc-131">Возвращенный объект <xref:System.Data.Services.Client.DataServiceQueryContinuation%601> можно затем использовать для загрузки следующей страницы результатов.</span><span class="sxs-lookup"><span data-stu-id="893bc-131">The returned <xref:System.Data.Services.Client.DataServiceQueryContinuation%601> object is then used to load the next page of results.</span></span> <span data-ttu-id="893bc-132">Перед вызовом метода <xref:System.Data.Services.Client.QueryOperationResponse%601.GetContinuation%2A> результат запроса надо перечислить.</span><span class="sxs-lookup"><span data-stu-id="893bc-132">You must enumerate the query result before you call the <xref:System.Data.Services.Client.QueryOperationResponse%601.GetContinuation%2A> method.</span></span> <span data-ttu-id="893bc-133">Рассмотрите возможность применения цикла `do…while`, чтобы сначала перечислить результат запроса, а потом проверить следующее значение ссылки на `non-null`.</span><span class="sxs-lookup"><span data-stu-id="893bc-133">Consider using a `do…while` loop to first enumerate the query result and then check for a `non-null` next link value.</span></span> <span data-ttu-id="893bc-134">Если метод <xref:System.Data.Services.Client.QueryOperationResponse%601.GetContinuation%2A> возвращает `null` (`Nothing` в Visual Basic), дополнительные страницы результата для исходного запроса отсутствуют.</span><span class="sxs-lookup"><span data-stu-id="893bc-134">When the <xref:System.Data.Services.Client.QueryOperationResponse%601.GetContinuation%2A> method returns `null` (`Nothing` in Visual Basic), there are no additional result pages for the original query.</span></span> <span data-ttu-id="893bc-135">Следующий пример показывает цикл `do…while`, который загружает разбитые на страницы данные клиентов из образца службы данных Northwind.</span><span class="sxs-lookup"><span data-stu-id="893bc-135">The following example shows a `do…while` loop that loads paged customer data from the Northwind sample data service.</span></span>  
  
 [!code-csharp[Astoria Northwind Client#LoadNextLink](../../../../samples/snippets/csharp/VS_Snippets_Misc/astoria northwind client/cs/source.cs#loadnextlink)]
 [!code-vb[Astoria Northwind Client#LoadNextLink](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/astoria northwind client/vb/source.vb#loadnextlink)]  
  
 <span data-ttu-id="893bc-136">Если запрос требует возвращения связанных сущностей в одном ответе вместе с запрошенным набором сущностей, пределы разбиения на страницы могут повлиять на вложенные каналы, встроенные вместе с запросом.</span><span class="sxs-lookup"><span data-stu-id="893bc-136">When a query requests that related entities are returned in a single response together with the requested entity set, paging limits may affect nested feeds that are included inline with the response.</span></span> <span data-ttu-id="893bc-137">Например, если в образце службы данных Northwind установлен предел подкачки для набора сущностей `Customers`, независимый предел подкачки может быть также установлен для набора сущностей `Orders`, как в следующем примере из файла Northwind.svc.cs, определяющего образец службы данных Northwind.</span><span class="sxs-lookup"><span data-stu-id="893bc-137">For example, when a paging limit is set in the Northwind sample data service for the `Customers` entity set, an independent paging limit can also be set for the related `Orders` entity set, as in the following example from the Northwind.svc.cs file that defines the Northwind sample data service.</span></span>  
  
 [!code-csharp[Astoria Northwind Service#DataServiceConfigPaging](../../../../samples/snippets/csharp/VS_Snippets_Misc/astoria northwind service/cs/northwind.svc.cs#dataserviceconfigpaging)]
 [!code-vb[Astoria Northwind Service#DataServiceConfigPaging](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/astoria northwind service/vb/northwind.svc.vb#dataserviceconfigpaging)]  
  
 <span data-ttu-id="893bc-138">В этом случае необходимо реализовать подкачку как для канала верхнего уровня `Customers`, так и для вложенного канала сущностей `Orders`.</span><span class="sxs-lookup"><span data-stu-id="893bc-138">In this case, you must implement paging for both the top-level `Customers` and the nested `Orders` entity feeds.</span></span> <span data-ttu-id="893bc-139">Следующий пример показывает цикл `while`, используемый для загрузки страниц сущностей `Orders`, связанных с выбранной сущностью `Customers`.</span><span class="sxs-lookup"><span data-stu-id="893bc-139">The following example shows the `while` loop used to load pages of `Orders` entities related to a selected `Customers` entity.</span></span>  
  
 [!code-csharp[Astoria Northwind Client#LoadNextOrdersLink](../../../../samples/snippets/csharp/VS_Snippets_Misc/astoria northwind client/cs/source.cs#loadnextorderslink)]
 [!code-vb[Astoria Northwind Client#LoadNextOrdersLink](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/astoria northwind client/vb/source.vb#loadnextorderslink)]  
  
 <span data-ttu-id="893bc-140">Дополнительные сведения см. в разделе [как: результатов, разбитых на страницы загрузки](../../../../docs/framework/data/wcf/how-to-load-paged-results-wcf-data-services.md).</span><span class="sxs-lookup"><span data-stu-id="893bc-140">For more information, see [How to: Load Paged Results](../../../../docs/framework/data/wcf/how-to-load-paged-results-wcf-data-services.md).</span></span>  
  
## <a name="binary-data-streams"></a><span data-ttu-id="893bc-141">Потоки двоичных данных</span><span class="sxs-lookup"><span data-stu-id="893bc-141">Binary Data Streams</span></span>  
 <span data-ttu-id="893bc-142">Службы [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] позволяют обращаться к данным большого двоичного объекта (BLOB) как к потоку данных.</span><span class="sxs-lookup"><span data-stu-id="893bc-142">[!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] enables you to access binary large object (BLOB) data as a data stream.</span></span> <span data-ttu-id="893bc-143">Преобразование в поток откладывает загрузку двоичных данных до момента, когда они понадобятся, а клиент имеет возможность обработать их более эффективно.</span><span class="sxs-lookup"><span data-stu-id="893bc-143">Streaming defers the loading of binary data until it is needed, and the client can more efficiently process this data.</span></span> <span data-ttu-id="893bc-144">Чтобы можно было воспользоваться этой функцией, в службе данных должен быть реализован поставщик <xref:System.Data.Services.Providers.IDataServiceStreamProvider>.</span><span class="sxs-lookup"><span data-stu-id="893bc-144">In order to take advantage of this functionality, the data service must implement the <xref:System.Data.Services.Providers.IDataServiceStreamProvider> provider.</span></span> <span data-ttu-id="893bc-145">Дополнительные сведения см. в разделе [потокового поставщика](../../../../docs/framework/data/wcf/streaming-provider-wcf-data-services.md).</span><span class="sxs-lookup"><span data-stu-id="893bc-145">For more information, see [Streaming Provider](../../../../docs/framework/data/wcf/streaming-provider-wcf-data-services.md).</span></span> <span data-ttu-id="893bc-146">Если потоки включены, типы сущностей возвращаются без связанных двоичных данных.</span><span class="sxs-lookup"><span data-stu-id="893bc-146">When streaming is enabled, entity types are returned without the related binary data.</span></span> <span data-ttu-id="893bc-147">В этом случае необходимо использовать <xref:System.Data.Services.Client.DataServiceContext.GetReadStream%2A> метод <xref:System.Data.Services.Client.DataServiceContext> класса для доступа к потоку данных в двоичных данных из службы.</span><span class="sxs-lookup"><span data-stu-id="893bc-147">In this case, you must use the <xref:System.Data.Services.Client.DataServiceContext.GetReadStream%2A> method of the <xref:System.Data.Services.Client.DataServiceContext> class to access the data stream for the binary data from the service.</span></span> <span data-ttu-id="893bc-148">Аналогично можно использовать метод <xref:System.Data.Services.Client.DataServiceContext.SetSaveStream%2A> для добавления или изменения двоичных данных сущности в виде потока.</span><span class="sxs-lookup"><span data-stu-id="893bc-148">Similarly, use the <xref:System.Data.Services.Client.DataServiceContext.SetSaveStream%2A> method to add or change binary data for an entity as a stream.</span></span> <span data-ttu-id="893bc-149">Дополнительные сведения см. в разделе [работа с двоичными данными](../../../../docs/framework/data/wcf/working-with-binary-data-wcf-data-services.md).</span><span class="sxs-lookup"><span data-stu-id="893bc-149">For more information, see [Working with Binary Data](../../../../docs/framework/data/wcf/working-with-binary-data-wcf-data-services.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="893bc-150">См. также</span><span class="sxs-lookup"><span data-stu-id="893bc-150">See Also</span></span>  
 [<span data-ttu-id="893bc-151">Библиотека клиентов служб данных WCF</span><span class="sxs-lookup"><span data-stu-id="893bc-151">WCF Data Services Client Library</span></span>](../../../../docs/framework/data/wcf/wcf-data-services-client-library.md)  
 [<span data-ttu-id="893bc-152">Выполнение запросов к службе данных</span><span class="sxs-lookup"><span data-stu-id="893bc-152">Querying the Data Service</span></span>](../../../../docs/framework/data/wcf/querying-the-data-service-wcf-data-services.md)
