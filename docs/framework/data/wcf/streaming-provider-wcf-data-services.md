---
title: Потоковый поставщик (службы WCF Data Services)
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- WCF Data Services, providers
- WCF Data Services, binary data
- streaming data provider [WCF Data Services]
- WCF Data Services, streams
ms.assetid: f0978fe4-5f9f-42aa-a5c2-df395d7c9495
ms.openlocfilehash: 1eb1267ae0b08d558d5afc41d03270917473a669
ms.sourcegitcommit: 7088f87e9a7da144266135f4b2397e611cf0a228
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/11/2020
ms.locfileid: "75900912"
---
# <a name="streaming-provider-wcf-data-services"></a><span data-ttu-id="b2620-102">Потоковый поставщик (службы WCF Data Services)</span><span class="sxs-lookup"><span data-stu-id="b2620-102">Streaming Provider (WCF Data Services)</span></span>

<span data-ttu-id="b2620-103">Служба данных может обеспечивать доступ к данным больших двоичных объектов.</span><span class="sxs-lookup"><span data-stu-id="b2620-103">A data service can expose large object binary data.</span></span> <span data-ttu-id="b2620-104">Эти двоичные данные могут представлять видео- и аудиопотоки, изображения, файлы документов или двоичные данные медиаресурсов других типов.</span><span class="sxs-lookup"><span data-stu-id="b2620-104">This binary data might represent video and audio streams, images, document files, or other types of binary media.</span></span> <span data-ttu-id="b2620-105">Когда сущность в модели данных включает одно или несколько двоичных свойств, служба данных возвращает двоичные данные в кодировке base-64 в записи в канале ответа.</span><span class="sxs-lookup"><span data-stu-id="b2620-105">When an entity in the data model includes one or more binary properties, the data service returns this binary data encoded as base-64 inside the entry in the response feed.</span></span> <span data-ttu-id="b2620-106">Поскольку загрузка и сериализация больших двоичных данных подобным образом может повлиять на производительность, Open Data Protocol (OData) определяет механизм извлечения двоичных данных независимо от сущности, к которой он принадлежит.</span><span class="sxs-lookup"><span data-stu-id="b2620-106">Because loading and serializing large binary data in this manner can affect performance, the Open Data Protocol (OData) defines a mechanism for retrieving binary data independent of the entity to which it belongs.</span></span> <span data-ttu-id="b2620-107">Это достигается отделением двоичных данных от сущности с последующим разделением их на один или несколько потоков данных.</span><span class="sxs-lookup"><span data-stu-id="b2620-107">This is accomplished by separating the binary data from the entity into one or more data streams.</span></span>

- <span data-ttu-id="b2620-108">Медиаресурсы — это двоичные данные, относящиеся к сущности, такие как видео, аудио, изображения, а также потоки медиаресурсов других типов.</span><span class="sxs-lookup"><span data-stu-id="b2620-108">Media resource - binary data that belongs to an entity, such as a video, audio, image or other type of media resource stream.</span></span>

- <span data-ttu-id="b2620-109">Запись медиассылки — это сущность, содержащая ссылку на соответствующий поток медиаресурса.</span><span class="sxs-lookup"><span data-stu-id="b2620-109">Media link entry - an entity that has a reference to a related media resource stream.</span></span>

<span data-ttu-id="b2620-110">С помощью WCF Data Services вы определяете поток двоичных ресурсов, реализуя поставщик потоковых данных.</span><span class="sxs-lookup"><span data-stu-id="b2620-110">With WCF Data Services, you define a binary resource stream by implementing a streaming data provider.</span></span> <span data-ttu-id="b2620-111">Реализация поставщика потоковой передачи предоставляет службе данных поток ресурсов мультимедиа, связанный с определенной сущностью в качестве объекта <xref:System.IO.Stream>.</span><span class="sxs-lookup"><span data-stu-id="b2620-111">The streaming provider implementation supplies the data service with the media resource stream associated with a specific entity as an <xref:System.IO.Stream> object.</span></span> <span data-ttu-id="b2620-112">Эта реализация позволяет службе данных принимать и возвращать медиаресурсы по протоколу HTTP в виде потоков двоичных данных с указанным типом MIME.</span><span class="sxs-lookup"><span data-stu-id="b2620-112">This implementation enables the data service to accept and return media resources over HTTP as binary data streams of a specified MIME type.</span></span>

<span data-ttu-id="b2620-113">Настройка службы данных для поддержки потоков двоичных данных состоит из следующих этапов.</span><span class="sxs-lookup"><span data-stu-id="b2620-113">Configuring a data service to support the streaming of binary data requires the following steps:</span></span>

1. <span data-ttu-id="b2620-114">Определите одну или несколько сущностей в модели данных как медиассылки.</span><span class="sxs-lookup"><span data-stu-id="b2620-114">Attribute one or more entities in the data model as a media link entry.</span></span> <span data-ttu-id="b2620-115">Эти сущности не должны содержать двоичные данные, предназначенные для преобразования в поток.</span><span class="sxs-lookup"><span data-stu-id="b2620-115">These entities should not include the binary data to be streamed.</span></span> <span data-ttu-id="b2620-116">Любые двоичные свойства сущности всегда возвращаются в записи в виде кодировки base-64.</span><span class="sxs-lookup"><span data-stu-id="b2620-116">Any binary properties of an entity are always returned in the entry as base-64 encoded binary.</span></span>

2. <span data-ttu-id="b2620-117">Реализует интерфейс T:System.Data.Services.Providers.IDataServiceStreamProvider.</span><span class="sxs-lookup"><span data-stu-id="b2620-117">Implement the T:System.Data.Services.Providers.IDataServiceStreamProvider interface.</span></span>

3. <span data-ttu-id="b2620-118">Определите службу данных, использующую интерфейс <xref:System.IServiceProvider>.</span><span class="sxs-lookup"><span data-stu-id="b2620-118">Define a data service that implements the <xref:System.IServiceProvider> interface.</span></span> <span data-ttu-id="b2620-119">Для доступа к реализации поставщика потоковых данных в службе данных используется реализация <xref:System.IServiceProvider.GetService%2A>.</span><span class="sxs-lookup"><span data-stu-id="b2620-119">The data service uses the <xref:System.IServiceProvider.GetService%2A> implementation to access the streaming data provider implementation.</span></span> <span data-ttu-id="b2620-120">Этот метод возвращает соответствующую реализацию потокового поставщика.</span><span class="sxs-lookup"><span data-stu-id="b2620-120">This method returns the appropriate streaming provider implementation.</span></span>

4. <span data-ttu-id="b2620-121">Разрешите большие потоки сообщений в настройке веб-приложения.</span><span class="sxs-lookup"><span data-stu-id="b2620-121">Enable large message streams in the Web application configuration.</span></span>

5. <span data-ttu-id="b2620-122">Включите доступ к двоичным ресурсам на сервере или в источнике данных.</span><span class="sxs-lookup"><span data-stu-id="b2620-122">Enable access to binary resources on the server or in a data source.</span></span>

<span data-ttu-id="b2620-123">Примеры в этом разделе основаны на образце службы Photo Streaming, которая подробно обсуждается в [серии поставщиков потоковой передачи служб данных: реализация поставщика потоковой передачи (часть 1)](https://docs.microsoft.com/archive/blogs/astoriateam/data-services-streaming-provider-series-implementing-a-streaming-provider-part-1).</span><span class="sxs-lookup"><span data-stu-id="b2620-123">The examples in this topic are based on a sample streaming photo service, which is discussed in depth in the post [Data Services Streaming Provider Series: Implementing a Streaming Provider (Part 1)](https://docs.microsoft.com/archive/blogs/astoriateam/data-services-streaming-provider-series-implementing-a-streaming-provider-part-1).</span></span> <span data-ttu-id="b2620-124">Исходный код для образца службы данных для передачи фотографий доступен на сайте [GitHub](https://github.com/microsoftarchive/msdn-code-gallery-community-s-z/tree/master/Streaming%20Photo%20OData%20Service%20Sample).</span><span class="sxs-lookup"><span data-stu-id="b2620-124">The source code for the Streaming Photo Data Service sample is available on [GitHub](https://github.com/microsoftarchive/msdn-code-gallery-community-s-z/tree/master/Streaming%20Photo%20OData%20Service%20Sample).</span></span>

## <a name="defining-a-media-link-entry-in-the-data-model"></a><span data-ttu-id="b2620-125">Определение медиассылки в модели данных</span><span class="sxs-lookup"><span data-stu-id="b2620-125">Defining a Media Link Entry in the Data Model</span></span>

<span data-ttu-id="b2620-126">Поставщик источника данных устанавливает способ, которым сущность определяется как медиассылка в модели данных.</span><span class="sxs-lookup"><span data-stu-id="b2620-126">The data source provider determines the way that an entity is defined as a media link entry in the data model.</span></span>

<span data-ttu-id="b2620-127">**Поставщик Entity Framework**</span><span class="sxs-lookup"><span data-stu-id="b2620-127">**Entity Framework Provider**</span></span>

<span data-ttu-id="b2620-128">Чтобы указать, что запись является медиассылкой, добавьте атрибут `HasStream` к определению типа сущности в концептуальной модели, как в следующем примере:</span><span class="sxs-lookup"><span data-stu-id="b2620-128">To indicate that an entity is a media link entry, add the `HasStream` attribute to the entity type definition in the conceptual model, as in the following example:</span></span>

[!code-xml[Astoria Photo Streaming Service#HasStream](../../../../samples/snippets/xml/VS_Snippets_Misc/astoria_photo_streaming_service/xml/photodata.edmx#hasstream)]

<span data-ttu-id="b2620-129">Необходимо также добавить пространство имен `xmlns:m=http://schemas.microsoft.com/ado/2007/08/dataservices/metadata` либо в сущность, либо в корень EDMX- или CSDL-файла, определяющего модель данных.</span><span class="sxs-lookup"><span data-stu-id="b2620-129">You must also add the namespace `xmlns:m=http://schemas.microsoft.com/ado/2007/08/dataservices/metadata` either to the entity or to the root of the .edmx or .csdl file that defines the data model.</span></span>

<span data-ttu-id="b2620-130">Пример службы данных, использующей поставщик Entity Framework и предоставляющий ресурс мультимедиа, см. в [серии поставщиков потоковой передачи служб данных. Реализация поставщика потоковой передачи (часть 1)](https://docs.microsoft.com/archive/blogs/astoriateam/data-services-streaming-provider-series-implementing-a-streaming-provider-part-1).</span><span class="sxs-lookup"><span data-stu-id="b2620-130">For an example of a data service that uses the Entity Framework provider and exposes a media resource, see the post [Data Services Streaming Provider Series: Implementing a Streaming Provider (Part 1)](https://docs.microsoft.com/archive/blogs/astoriateam/data-services-streaming-provider-series-implementing-a-streaming-provider-part-1).</span></span>

<span data-ttu-id="b2620-131">**Поставщик отражений**</span><span class="sxs-lookup"><span data-stu-id="b2620-131">**Reflection Provider**</span></span>

<span data-ttu-id="b2620-132">Чтобы указать, что сущность является медиассылкой, добавьте <xref:System.Data.Services.Common.HasStreamAttribute> к классу, определяющему тип сущности в поставщике отражения.</span><span class="sxs-lookup"><span data-stu-id="b2620-132">To indicate that an entity is a media link entry, add the <xref:System.Data.Services.Common.HasStreamAttribute> to the class that defines the entity type in the reflection provider.</span></span>

<span data-ttu-id="b2620-133">**Пользовательский поставщик службы данных**</span><span class="sxs-lookup"><span data-stu-id="b2620-133">**Custom Data Service Provider**</span></span>

<span data-ttu-id="b2620-134">При использовании специализированных поставщиков службы данных необходимо реализовать интерфейс <xref:System.Data.Services.Providers.IDataServiceMetadataProvider>, чтобы определить метаданные для службы данных.</span><span class="sxs-lookup"><span data-stu-id="b2620-134">When using custom service providers, you implement the <xref:System.Data.Services.Providers.IDataServiceMetadataProvider> interface to define the metadata for your data service.</span></span> <span data-ttu-id="b2620-135">Дополнительные сведения см. в разделе [пользовательские поставщики служб данных](custom-data-service-providers-wcf-data-services.md).</span><span class="sxs-lookup"><span data-stu-id="b2620-135">For more information, see [Custom Data Service Providers](custom-data-service-providers-wcf-data-services.md).</span></span> <span data-ttu-id="b2620-136">Необходимо указать, что двоичный поток ресурса принадлежит к типу <xref:System.Data.Services.Providers.ResourceType>. Для этого свойству <xref:System.Data.Services.Providers.ResourceType.IsMediaLinkEntry%2A> задается значение `true` применительно к типу <xref:System.Data.Services.Providers.ResourceType>, представляющему тип сущности, которая является записью медиассылки.</span><span class="sxs-lookup"><span data-stu-id="b2620-136">You indicate that a binary resource stream belongs to a <xref:System.Data.Services.Providers.ResourceType> by setting the <xref:System.Data.Services.Providers.ResourceType.IsMediaLinkEntry%2A> property to `true` on the <xref:System.Data.Services.Providers.ResourceType> that represents the entity type, which is a media link entry.</span></span>

## <a name="implementing-the-idataservicestreamprovider-interface"></a><span data-ttu-id="b2620-137">Реализация интерфейса IDataServiceStreamProvider</span><span class="sxs-lookup"><span data-stu-id="b2620-137">Implementing the IDataServiceStreamProvider Interface</span></span>

<span data-ttu-id="b2620-138">Для создания потоковой службы данных, которая поддерживает двоичные потоки данных, необходимо реализовать интерфейс <xref:System.Data.Services.Providers.IDataServiceStreamProvider>.</span><span class="sxs-lookup"><span data-stu-id="b2620-138">To create a data service that supports binary data streams, you must implement the <xref:System.Data.Services.Providers.IDataServiceStreamProvider> interface.</span></span> <span data-ttu-id="b2620-139">Эта реализация позволяет службе данных возвращать клиенту двоичные данные в виде потока и получать двоичные данные в виде потока от клиента.</span><span class="sxs-lookup"><span data-stu-id="b2620-139">This implementation enables the data service to return binary data as a stream to the client and consume binary data as a stream sent from the client.</span></span> <span data-ttu-id="b2620-140">В службе данных экземпляр этого интерфейса создается каждый раз, когда возникает необходимость получить доступ к двоичным данным как к потоку.</span><span class="sxs-lookup"><span data-stu-id="b2620-140">The data service creates an instance of this interface whenever it needs to access binary data as a stream.</span></span> <span data-ttu-id="b2620-141">Интерфейс <xref:System.Data.Services.Providers.IDataServiceStreamProvider> определяет следующие члены.</span><span class="sxs-lookup"><span data-stu-id="b2620-141">The <xref:System.Data.Services.Providers.IDataServiceStreamProvider> interface specifies the following members:</span></span>

|<span data-ttu-id="b2620-142">Имя элемента</span><span class="sxs-lookup"><span data-stu-id="b2620-142">Member name</span></span>|<span data-ttu-id="b2620-143">Описание</span><span class="sxs-lookup"><span data-stu-id="b2620-143">Description</span></span>|
|-----------------|-----------------|
|<xref:System.Data.Services.Providers.IDataServiceStreamProvider.DeleteStream%2A>|<span data-ttu-id="b2620-144">Этот метод вызывается службой данных для удаления соответствующего медиаресурса при удалении относящейся к нему медиассылки.</span><span class="sxs-lookup"><span data-stu-id="b2620-144">This method is invoked by the data service to delete the corresponding media resource when its media link entry is deleted.</span></span> <span data-ttu-id="b2620-145">При реализации <xref:System.Data.Services.Providers.IDataServiceStreamProvider> этот метод содержит код для удаления медиаресурса, связанного с поставляемой медиассылкой.</span><span class="sxs-lookup"><span data-stu-id="b2620-145">When you implement <xref:System.Data.Services.Providers.IDataServiceStreamProvider>, this method contains the code that deletes the media resource associated with the supplied media link entry.</span></span>|
|<xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetReadStream%2A>|<span data-ttu-id="b2620-146">Этот метод вызывается службой данных для возвращения медиаресурса в виде потока.</span><span class="sxs-lookup"><span data-stu-id="b2620-146">This method is invoked by the data service to return a media resource as a stream.</span></span> <span data-ttu-id="b2620-147">При реализации <xref:System.Data.Services.Providers.IDataServiceStreamProvider> этот метод содержит код, создающий поток, используемый службой данных для возвращения медиаресурса, связанного с предоставленной медиассылкой.</span><span class="sxs-lookup"><span data-stu-id="b2620-147">When you implement <xref:System.Data.Services.Providers.IDataServiceStreamProvider>, this method contains the code that provides a stream that is used by the data service to the return media resource that is associated with the provided media link entry.</span></span>|
|<xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetReadStreamUri%2A>|<span data-ttu-id="b2620-148">Этот метод вызывается службой данных для возвращения URI, используемого для запроса медиаресурса для медиассылки.</span><span class="sxs-lookup"><span data-stu-id="b2620-148">This method is invoked by the data service to return the URI that is used to request the media resource for the media link entry.</span></span> <span data-ttu-id="b2620-149">Это значение используется для создания атрибута `src` в элементе содержимого медиассылки, используемого также для запроса потока данных.</span><span class="sxs-lookup"><span data-stu-id="b2620-149">This value is used to create the `src` attribute in the content element of the media link entry and that is used to request the data stream.</span></span> <span data-ttu-id="b2620-150">Если этот метод возвращает `null`, служба данных определяет URI автоматически.</span><span class="sxs-lookup"><span data-stu-id="b2620-150">When this method returns `null`, the data service automatically determines the URI.</span></span> <span data-ttu-id="b2620-151">Этот метод следует использовать, если есть необходимость предоставить клиентам прямой доступ к двоичным данным без использования потокового поставщика.</span><span class="sxs-lookup"><span data-stu-id="b2620-151">Use this method when you need to provide clients with direct access to binary data without using the steam provider.</span></span>|
|<xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetStreamContentType%2A>|<span data-ttu-id="b2620-152">Этот метод вызывается службой данных для возвращения значения Content-Type медиаресурса, связанного с указанной медиассылкой.</span><span class="sxs-lookup"><span data-stu-id="b2620-152">This method is invoked by the data service to return the Content-Type value of the media resource that is associated with the specified media link entry.</span></span>|
|<xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetStreamETag%2A>|<span data-ttu-id="b2620-153">Этот метод вызывается службой данных для возвращения eTag потока данных, связанного с указанной сущностью.</span><span class="sxs-lookup"><span data-stu-id="b2620-153">This method is invoked by the data service to return the eTag of the data stream that is associated with the specified entity.</span></span> <span data-ttu-id="b2620-154">Этот метод используется для управления параллелизмом в двоичных данных.</span><span class="sxs-lookup"><span data-stu-id="b2620-154">This method is used when you manage concurrency for the binary data.</span></span> <span data-ttu-id="b2620-155">Когда этот метод возвращает значение null, служба данных не отслеживает параллелизм.</span><span class="sxs-lookup"><span data-stu-id="b2620-155">When this method returns null, the data service does not track concurrency.</span></span>|
|<xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetWriteStream%2A>|<span data-ttu-id="b2620-156">Этот метод вызывается службой данных для получения потока, используемого при принятии потока, отправляемого от клиента.</span><span class="sxs-lookup"><span data-stu-id="b2620-156">This method is invoked by the data service to obtain the stream that is used when receiving the stream sent from the client.</span></span> <span data-ttu-id="b2620-157">При реализации <xref:System.Data.Services.Providers.IDataServiceStreamProvider> необходимо возвращать поток с возможностью записи, в который служба данных записывает принимаемые потоковые данные.</span><span class="sxs-lookup"><span data-stu-id="b2620-157">When you implement <xref:System.Data.Services.Providers.IDataServiceStreamProvider>, you must return a writable stream to which the data service writes received stream data.</span></span>|
|<xref:System.Data.Services.Providers.IDataServiceStreamProvider.ResolveType%2A>|<span data-ttu-id="b2620-158">Возвращает имя типа с именем пространства имен, представляющее тип, который среда выполнения службы данных должна создать для медиассылки, связанной с потоком данных для вставляемого медиаресурса.</span><span class="sxs-lookup"><span data-stu-id="b2620-158">Returns a namespace-qualified type name that represents the type that the data service runtime must create for the media link entry that is associated with the data stream for the media resource that is being inserted.</span></span>|

## <a name="creating-the-streaming-data-service"></a><span data-ttu-id="b2620-159">Создание потоковой службы данных</span><span class="sxs-lookup"><span data-stu-id="b2620-159">Creating the Streaming Data Service</span></span>

<span data-ttu-id="b2620-160">Чтобы предоставить среде выполнения WCF Data Services доступ к реализации <xref:System.Data.Services.Providers.IDataServiceStreamProvider>, создаваемая служба данных также должна реализовывать интерфейс <xref:System.IServiceProvider>.</span><span class="sxs-lookup"><span data-stu-id="b2620-160">To provide the WCF Data Services runtime with access to the <xref:System.Data.Services.Providers.IDataServiceStreamProvider> implementation, the data service that you create must also implement the <xref:System.IServiceProvider> interface.</span></span> <span data-ttu-id="b2620-161">В следующем примере показана реализация метода <xref:System.IServiceProvider.GetService%2A>, который возвращает экземпляр класса `PhotoServiceStreamProvider`, реализующего <xref:System.Data.Services.Providers.IDataServiceStreamProvider>.</span><span class="sxs-lookup"><span data-stu-id="b2620-161">The following example shows how to implement the <xref:System.IServiceProvider.GetService%2A> method to return an instance of the `PhotoServiceStreamProvider` class that implements <xref:System.Data.Services.Providers.IDataServiceStreamProvider>.</span></span>

[!code-csharp[Astoria Photo Streaming Service#PhotoServiceStreamingProvider](../../../../samples/snippets/csharp/VS_Snippets_Misc/astoria_photo_streaming_service/cs/photodata.svc.cs#photoservicestreamingprovider)]
[!code-vb[Astoria Photo Streaming Service#PhotoServiceStreamingProvider](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/astoria_photo_streaming_service/vb/photodata.svc.vb#photoservicestreamingprovider)]

<span data-ttu-id="b2620-162">Общие сведения о создании службы данных см. в разделе [Настройка службы данных](configuring-the-data-service-wcf-data-services.md).</span><span class="sxs-lookup"><span data-stu-id="b2620-162">For general information about how to create a data service, see [Configuring the Data Service](configuring-the-data-service-wcf-data-services.md).</span></span>

## <a name="enabling-large-binary-streams-in-the-hosting-environment"></a><span data-ttu-id="b2620-163">Включение больших двоичных потоков в среде размещения</span><span class="sxs-lookup"><span data-stu-id="b2620-163">Enabling Large Binary Streams in the Hosting Environment</span></span>

<span data-ttu-id="b2620-164">При создании службы данных в веб-приложении ASP.NET для предоставления реализации протокола HTTP используется Windows Communication Foundation (WCF).</span><span class="sxs-lookup"><span data-stu-id="b2620-164">When you create a data service in an ASP.NET Web application, Windows Communication Foundation (WCF) is used to provide the HTTP protocol implementation.</span></span> <span data-ttu-id="b2620-165">По умолчанию WCF устанавливает для HTTP-сообщений максимальный размер в 65 КБ.</span><span class="sxs-lookup"><span data-stu-id="b2620-165">By default, WCF limits the size of HTTP messages to only 65K bytes.</span></span> <span data-ttu-id="b2620-166">Чтобы иметь возможность направлять большие потоки двоичных данных в службу данных и из нее, необходимо также настроить веб-приложение, включив возможность использования больших двоичных файлов и потоков для передачи.</span><span class="sxs-lookup"><span data-stu-id="b2620-166">To be able to stream large binary data to and from the data service, you must also configure the Web application to enable large binary files and to use streams for transfer.</span></span> <span data-ttu-id="b2620-167">Для этого добавьте к элементу `<configuration />` файла Web.config приложения следующее.</span><span class="sxs-lookup"><span data-stu-id="b2620-167">To do this, add the following in the `<configuration />` element of the application's Web.config file:</span></span>

> [!NOTE]
> <span data-ttu-id="b2620-168">Необходимо использовать режим передачи <xref:System.ServiceModel.TransferMode.Streamed?displayProperty=nameWithType>, чтобы обеспечить потоковую передачу двоичных данных в сообщениях запроса и ответа и не помещает их в буфер WCF.</span><span class="sxs-lookup"><span data-stu-id="b2620-168">You must use a <xref:System.ServiceModel.TransferMode.Streamed?displayProperty=nameWithType> transfer mode to ensure that the binary data in both the request and response messages are streamed and not buffered by WCF.</span></span>

<span data-ttu-id="b2620-169">Дополнительные сведения см. в разделе [потоковая передача сообщений](../../wcf/feature-details/streaming-message-transfer.md) и [квоты транспорта](../../wcf/feature-details/transport-quotas.md).</span><span class="sxs-lookup"><span data-stu-id="b2620-169">For more information, see [Streaming Message Transfer](../../wcf/feature-details/streaming-message-transfer.md) and [Transport Quotas](../../wcf/feature-details/transport-quotas.md).</span></span>

<span data-ttu-id="b2620-170">По умолчанию службы IIS также накладывают на размер запроса ограничение в 4 МБ.</span><span class="sxs-lookup"><span data-stu-id="b2620-170">By default, Internet Information Services (IIS) also limits the size of requests to 4MB.</span></span> <span data-ttu-id="b2620-171">Чтобы служба данных получала больше 4 МБ при работе в службах IIS, необходимо также задать атрибут `maxRequestLength` [элемента httpRuntime (схема параметров ASP.NET)](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/e1f13641(v=vs.100)) в разделе конфигурации `<system.web />`, как показано в следующем примере:</span><span class="sxs-lookup"><span data-stu-id="b2620-171">To enable your data service to receive streams larger than 4MB when running on IIS, you must also set the `maxRequestLength` attribute of the [httpRuntime Element (ASP.NET Settings Schema)](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/e1f13641(v=vs.100)) in the `<system.web />` configuration section, as shown in the following example:</span></span>

## <a name="using-data-streams-in-a-client-application"></a><span data-ttu-id="b2620-172">Использование потоков данных в клиентском приложении</span><span class="sxs-lookup"><span data-stu-id="b2620-172">Using Data Streams in a Client Application</span></span>

<span data-ttu-id="b2620-173">Клиентская библиотека WCF Data Services позволяет получать и обновлять эти ресурсы как двоичные потоки на клиенте.</span><span class="sxs-lookup"><span data-stu-id="b2620-173">The WCF Data Services client library enables you to both retrieve and update these exposed resources as binary streams on the client.</span></span> <span data-ttu-id="b2620-174">Дополнительные сведения см. в разделе [Работа с двоичными данными](working-with-binary-data-wcf-data-services.md).</span><span class="sxs-lookup"><span data-stu-id="b2620-174">For more information, see [Working with Binary Data](working-with-binary-data-wcf-data-services.md).</span></span>

## <a name="considerations-for-working-with-a-streaming-provider"></a><span data-ttu-id="b2620-175">Вопросы по работе с потоковым поставщиком</span><span class="sxs-lookup"><span data-stu-id="b2620-175">Considerations for Working with a Streaming Provider</span></span>

<span data-ttu-id="b2620-176">Следующие моменты следует учитывать при реализации потокового поставщика и доступе к медиаресурсам из службы данных.</span><span class="sxs-lookup"><span data-stu-id="b2620-176">The following are things to consider when you implement a streaming provider and when you access media resources from a data service.</span></span>

- <span data-ttu-id="b2620-177">Запросы MERGE для медиаресурсов не поддерживаются.</span><span class="sxs-lookup"><span data-stu-id="b2620-177">MERGE requests are not supported for media resources.</span></span> <span data-ttu-id="b2620-178">Используйте запрос PUT для изменения медиаресурса существующей сущности.</span><span class="sxs-lookup"><span data-stu-id="b2620-178">Use a PUT request to change the media resource of an existing entity.</span></span>

- <span data-ttu-id="b2620-179">Запрос POST не может использоваться для создания новой медиассылки.</span><span class="sxs-lookup"><span data-stu-id="b2620-179">A POST request cannot be used to create a new media link entry.</span></span> <span data-ttu-id="b2620-180">Вместо этого необходимо выдать запрос POST для создания нового медиаресурса, а служба данных создаст новую медиассылку со значениями по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="b2620-180">Instead, you must issue a POST request to create a new media resource, and the data service creates a new media link entry with default values.</span></span> <span data-ttu-id="b2620-181">Эта новая сущность может впоследствии обновляться с помощью запросов MERGE или PUT.</span><span class="sxs-lookup"><span data-stu-id="b2620-181">This new entity can be updated by a subsequent MERGE or PUT request.</span></span> <span data-ttu-id="b2620-182">Также можно кэшировать сущность и вносить обновления в модуль удаления, такие как установка для свойства значения, равного заголовку Slug в запросе POST.</span><span class="sxs-lookup"><span data-stu-id="b2620-182">You may also consider caching the entity and make updates in the disposer, such as setting the property value to the value of the Slug header in the POST request.</span></span>

- <span data-ttu-id="b2620-183">После приема запроса POST служба данных вызывает метод <xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetWriteStream%2A> для создания медиаресурса перед вызовом <xref:System.Data.Services.IUpdatable.SaveChanges%2A> для создания медиассылки.</span><span class="sxs-lookup"><span data-stu-id="b2620-183">When a POST request is received, the data service calls <xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetWriteStream%2A> to create the media resource before it calls <xref:System.Data.Services.IUpdatable.SaveChanges%2A> to create the media link entry.</span></span>

- <span data-ttu-id="b2620-184">Реализация <xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetWriteStream%2A> не должна возвращать объект <xref:System.IO.MemoryStream>.</span><span class="sxs-lookup"><span data-stu-id="b2620-184">An implementation of <xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetWriteStream%2A> should not return a <xref:System.IO.MemoryStream> object.</span></span> <span data-ttu-id="b2620-185">При использовании потока подобного типа будут возникать проблемы, связанные с использованием памяти, во время получения очень больших потоков данных.</span><span class="sxs-lookup"><span data-stu-id="b2620-185">When you use this kind of stream, memory resource issues will occur when the service receives very large data streams.</span></span>

- <span data-ttu-id="b2620-186">Следующие факторы следует учитывать при хранении медиаресурсов в базе данных:</span><span class="sxs-lookup"><span data-stu-id="b2620-186">The following are things to consider when storing media resources in a database:</span></span>

  - <span data-ttu-id="b2620-187">Двоичное свойство, являющееся медиаресурсом, не должно включаться в модель данных.</span><span class="sxs-lookup"><span data-stu-id="b2620-187">A binary property that is a media resource should not be included in the data model.</span></span> <span data-ttu-id="b2620-188">Все свойства, предоставляемые в модели данных, возвращаются в записи в канале ответа.</span><span class="sxs-lookup"><span data-stu-id="b2620-188">All properties exposed in a data model are returned in the entry in a response feed.</span></span>

  - <span data-ttu-id="b2620-189">Чтобы улучшить производительность при работе с большим двоичным потоком, рекомендуется создать пользовательский класс потока для хранения двоичных данных в базе данных.</span><span class="sxs-lookup"><span data-stu-id="b2620-189">To improve performance with a large binary stream, we recommend that you create a custom stream class to store binary data in the database.</span></span> <span data-ttu-id="b2620-190">Этот класс возвращается посредством реализации <xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetWriteStream%2A> и отправляет двоичные данные в базу данных в виде фрагментов.</span><span class="sxs-lookup"><span data-stu-id="b2620-190">This class is returned by your <xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetWriteStream%2A> implementation and sends the binary data to the database in chunks.</span></span> <span data-ttu-id="b2620-191">Для SQL Server базы данных рекомендуется использовать FILESTREAM для потоковой передачи данных в базу данных, если двоичные данные больше 1 МБ.</span><span class="sxs-lookup"><span data-stu-id="b2620-191">For a SQL Server database, we recommend that you use a FILESTREAM to stream data into the database when the binary data is larger than 1MB.</span></span>

  - <span data-ttu-id="b2620-192">Убедитесь в том, что база данных предусматривает хранение больших двоичных потоков, получаемых используемой службой данных.</span><span class="sxs-lookup"><span data-stu-id="b2620-192">Ensure that your database is designed to store the binary large streams that are to be received by your data service.</span></span>

  - <span data-ttu-id="b2620-193">Когда клиент отправляет запрос POST для вставки медиассылки и медиаресурса в одном запросе, для получения потока вызывается метод <xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetWriteStream%2A> перед тем, как служба данных вставит новую сущность в базу данных.</span><span class="sxs-lookup"><span data-stu-id="b2620-193">When a client sends a POST request to insert a media link entry with a media resource in a single request, <xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetWriteStream%2A> is called to obtain the stream before the data service inserts the new entity into the database.</span></span> <span data-ttu-id="b2620-194">Реализация потокового поставщика должна уметь работать с таким поведением службы данных.</span><span class="sxs-lookup"><span data-stu-id="b2620-194">A streaming provider implementation must be able to handle this data service behavior.</span></span> <span data-ttu-id="b2620-195">Рассмотрите возможность использования отдельной таблицы данных для хранения двоичных данных или хранения потока данных в файле до вставки сущности в базу данных.</span><span class="sxs-lookup"><span data-stu-id="b2620-195">Consider using a separate data table to store the binary data or store the data stream in a file until after the entity has been inserted into the database.</span></span>

- <span data-ttu-id="b2620-196">При реализации методов <xref:System.Data.Services.Providers.IDataServiceStreamProvider.DeleteStream%2A>, <xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetReadStream%2A> или <xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetWriteStream%2A> необходимо использовать значения eTag и Content-Type, предоставляемые в качестве параметров метода.</span><span class="sxs-lookup"><span data-stu-id="b2620-196">When you implement the <xref:System.Data.Services.Providers.IDataServiceStreamProvider.DeleteStream%2A>, <xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetReadStream%2A>, or <xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetWriteStream%2A> methods, you must use the eTag and Content-Type values that are supplied as method parameters.</span></span> <span data-ttu-id="b2620-197">Не устанавливайте заголовки eTag или Content-Type в реализации поставщика <xref:System.Data.Services.Providers.IDataServiceStreamProvider>.</span><span class="sxs-lookup"><span data-stu-id="b2620-197">Do not set eTag or Content-Type headers in your <xref:System.Data.Services.Providers.IDataServiceStreamProvider> provider implementation.</span></span>

- <span data-ttu-id="b2620-198">По умолчанию клиент отправляет большие двоичные потоки, используя фрагментированный HTTP Transfer-Encoding.</span><span class="sxs-lookup"><span data-stu-id="b2620-198">By default, the client sends large binary streams by using a chunked HTTP Transfer-Encoding.</span></span> <span data-ttu-id="b2620-199">Поскольку ASP.NET Development Server не поддерживает такой тип кодирования, этот веб-сервер нельзя использовать для размещения службы потоковой передачи данных, которая должна принимать большие двоичные потоки.</span><span class="sxs-lookup"><span data-stu-id="b2620-199">Because the ASP.NET Development Server does not support this kind of encoding, you cannot use this Web server to host a streaming data service that must accept large binary streams.</span></span> <span data-ttu-id="b2620-200">Дополнительные сведения о ASP.NET Development Server см. [в разделе веб-серверы в Visual Studio для веб-проектов ASP.NET](https://docs.microsoft.com/previous-versions/aspnet/58wxa9w5(v=vs.120)).</span><span class="sxs-lookup"><span data-stu-id="b2620-200">For more information on ASP.NET Development Server, see [Web Servers in Visual Studio for ASP.NET Web Projects](https://docs.microsoft.com/previous-versions/aspnet/58wxa9w5(v=vs.120)).</span></span>

<a name="versioning"></a>

## <a name="versioning-requirements"></a><span data-ttu-id="b2620-201">Требования к управлению версиями</span><span class="sxs-lookup"><span data-stu-id="b2620-201">Versioning Requirements</span></span>

<span data-ttu-id="b2620-202">Поставщик потоковой передачи имеет следующие требования к версии протокола OData:</span><span class="sxs-lookup"><span data-stu-id="b2620-202">The streaming provider has the following OData protocol versioning requirements:</span></span>

- <span data-ttu-id="b2620-203">Поставщик потоковой передачи требует, чтобы служба данных поддерживала версию 2,0 протокола OData и более поздних версий.</span><span class="sxs-lookup"><span data-stu-id="b2620-203">The streaming provider requires that the data service support version 2.0 of the OData protocol and later versions.</span></span>

<span data-ttu-id="b2620-204">Дополнительные сведения см. в разделе [Управление версиями службы данных](data-service-versioning-wcf-data-services.md).</span><span class="sxs-lookup"><span data-stu-id="b2620-204">For more information, see [Data Service Versioning](data-service-versioning-wcf-data-services.md).</span></span>

## <a name="see-also"></a><span data-ttu-id="b2620-205">См. также:</span><span class="sxs-lookup"><span data-stu-id="b2620-205">See also</span></span>

- [<span data-ttu-id="b2620-206">Поставщики служб данных</span><span class="sxs-lookup"><span data-stu-id="b2620-206">Data Services Providers</span></span>](data-services-providers-wcf-data-services.md)
- [<span data-ttu-id="b2620-207">Специализированные поставщики служб данных</span><span class="sxs-lookup"><span data-stu-id="b2620-207">Custom Data Service Providers</span></span>](custom-data-service-providers-wcf-data-services.md)
- [<span data-ttu-id="b2620-208">Работа с двоичными данными</span><span class="sxs-lookup"><span data-stu-id="b2620-208">Working with Binary Data</span></span>](working-with-binary-data-wcf-data-services.md)
