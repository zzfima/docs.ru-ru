---
title: Защита служб WCF Data Services
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- securing application [WCF Data Services]
- WCF Data Services, security
ms.assetid: 99fc2baa-a040-4549-bc4d-f683d60298af
ms.openlocfilehash: 7c47951268bf414a5a2833e9511e854c1c1437a8
ms.sourcegitcommit: 7088f87e9a7da144266135f4b2397e611cf0a228
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/11/2020
ms.locfileid: "75900944"
---
# <a name="securing-wcf-data-services"></a>Защита служб WCF Data Services
В этом разделе описываются вопросы безопасности, связанные с разработкой, развертыванием и запуском WCF Data Services и приложений, которые обращаются к службам, поддерживающим Open Data Protocol (OData). Также следует следовать рекомендациям по созданию безопасных приложений .NET Framework.  
  
При планировании защиты службы OData на основе WCF Data Services необходимо выполнить обе проверки подлинности: процесс обнаружения и проверки удостоверения участника, а также авторизацию, процесс определения того, является ли участник, прошедший проверку подлинности разрешен доступ к запрошенным ресурсам. Следует также рассмотреть необходимость шифрования сообщения с помощью протокола SSL.  
  
## <a name="authenticating-client-requests"></a>Проверка подлинности клиентских запросов  
В WCF Data Services не реализована собственная проверка подлинности, а используется проверка подлинности узла службы данных. Это означает, что служба предполагает, что любой полученный запрос уже прошел проверку подлинности узлом сети и что узел правильно определил принцип для запроса соответствующим образом через интерфейсы, предоставляемые WCF Data Services. Эти параметры проверки подлинности и подходы подробно описаны в составе [серии OData и проверки подлинности](https://devblogs.microsoft.com/odata/?s=%22OData+and+authentication%22).  
  
### <a name="authentication-options-for-a-wcf-data-service"></a>Параметры проверки подлинности для службы данных WCF  
 В приведенной ниже таблице перечислены некоторые из механизмов проверки подлинности, с помощью которых можно выполнять проверку подлинности запросов к службе данных WCF.  
  
|Параметры аутентификации|Описание|  
|----------------------------|-----------------|  
|Анонимная проверка подлинности|При использовании анонимной проверки подлинности по HTTP любой участник может подключиться к службе данных. Учетные данные для анонимного доступа не требуются. Используйте этот параметр, только если требуется предоставить общий доступ к службе данных.|  
|Обычная и дайджест-проверка подлинности|Для проверки подлинности необходимы учетные данные, состоящие из имени пользователя и пароля. Поддерживает проверку подлинности клиентов, отличных от Windows. **Примечание по безопасности.**  Учетные данные обычной проверки подлинности (имя пользователя и пароль) отправляются в CLEAR и могут быть перехвачены. При дайджест-проверке подлинности отправляется хэш, основанный на переданных учетных данных, что обеспечивает большую безопасность по сравнению с обычной проверкой подлинности. Оба эти метода проверки подлинности уязвимы для атак типа «злоумышленник в середине». При использовании этих методов проверки подлинности следует организовать зашифрованное соединение между клиентом и службой данных с помощью протокола SSL. <br /><br /> Microsoft службы IIS (IIS) обеспечивает реализацию как базовой, так и дайджест-проверки подлинности для запросов HTTP в приложении ASP.NET. Эта реализация поставщика проверки подлинности Windows позволяет клиентскому приложению .NET Framework передавать учетные данные службе данных в HTTP-заголовке запроса, что дает возможность беспрепятственно согласовывать проверку подлинности пользователя Windows. Дополнительные сведения см. в разделе [Технический справочник по дайджест-проверке подлинности](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2003/cc782794(v=ws.10)).<br /><br /> Если вы хотите, чтобы служба данных использовала обычную проверку подлинности на основе какой-либо пользовательской службы проверки подлинности, а не учетных данных Windows, необходимо реализовать пользовательский HTTP-модуль ADP.NET для проверки подлинности.<br /><br /> Пример использования пользовательской схемы обычной проверки подлинности с WCF Data Services см. в записи блога [OData и Authentication – часть 6 — пользовательская обычная проверка подлинности](https://devblogs.microsoft.com/odata/odata-and-authentication-part-6-custom-basic-authentication/).|  
|Аутентификация Windows|Обмен учетными данными на базе Windows происходит с помощью NTLM или Kerberos. Этот механизм более надежен, чем простая или дайджест-проверка подлинности, но он требует, чтобы клиент был приложением на базе Windows. Службы IIS также предоставляют реализацию проверки подлинности Windows для HTTP-запросов в приложении ASP.NET. Дополнительные сведения см. в разделе [ASP.NET Forms Authentication Overview](https://docs.microsoft.com/previous-versions/aspnet/7t6b43z4(v=vs.100)).<br /><br /> Пример использования проверки подлинности Windows с WCF Data Services см. в записи блога [OData и Authentication – часть 2 — Проверка подлинности Windows](https://devblogs.microsoft.com/odata/odata-and-authentication-part-2-windows-authentication/).|  
|Проверка подлинности ASP.NET Forms|Проверка подлинности с помощью форм позволяет проверять подлинность пользователей с помощью собственного кода и затем предоставлять маркер проверки подлинности в файле Cookie или в URL-адресе страницы. Проверка подлинности имени пользователя и пароля пользователя выполняется с помощью созданной вами формы входа в систему. Запросы без проверки подлинности перенаправляются на страницу входа, на которой пользователь указывает учетные данные и отправляет их. Если приложение удостоверяет подлинность запроса, система создает билет подлинности, который содержит ключ для повторного запроса данных. Дополнительные сведения см. в разделе [поставщик проверки подлинности с помощью форм](https://docs.microsoft.com/previous-versions/aspnet/9wff0kyh(v=vs.100)). **Примечание по безопасности.**  По умолчанию файл cookie, содержащий билет проверки подлинности форм, не защищен при использовании проверки подлинности с помощью форм в веб-приложении ASP.NET. Рассмотрите вариант с защитой как билета проверки подлинности, так и первоначальных учетных данных для входа с помощью SSL. <br /><br /> Пример использования проверки подлинности с помощью форм с WCF Data Services см. в блоге, посвященном OData и проверке подлинности, [часть 7 — Проверка подлинности с помощью форм](https://devblogs.microsoft.com/odata/odata-and-authentication-part-7-forms-authentication/).|  
|Проверка подлинности на основе утверждений|В случае проверки подлинности на основе утверждений служба данных использует надежную службу поставщика удостоверений для проверки подлинности пользователя. Поставщик удостоверений выполняет с положительным результатом проверку подлинности пользователя, который запросил доступ к ресурсам службы данных, и выдает маркер, предоставляющий доступ к запрошенным ресурсам. Затем этот маркер представляется службе данных, которая предоставляет доступ пользователю на базе отношений доверия со службой удостоверений, выдавшей маркер доступа.<br /><br /> Преимущество использования поставщика проверки подлинности на базе утверждений заключается в том, что этот метод можно использовать для проверки подлинности клиентов различных типов между несколькими доверенными доменами. Благодаря применению такого стороннего поставщика, служба данных может быть освобождена от дополнительной нагрузки по поддержке и проверке подлинности пользователей. OAuth 2.0 — это протокол проверки подлинности на основе утверждений, поддерживаемый системой контроля доступа к фабрике приложений Microsoft Azure для федеративной проверки подлинности и реализованный в виде службы. Этот протокол поддерживает службы на основе REST. Пример использования OAuth 2,0 с WCF Data Services см. в записи блога [OData и Authentication — часть 8 — перенос OAuth](https://devblogs.microsoft.com/odata/odata-and-authentication-part-8-oauth-wrap/).|  
  
<a name="clientAuthentication"></a>   
### <a name="authentication-in-the-client-library"></a>Проверка подлинности в клиентской библиотеке  
 По умолчанию клиентская библиотека WCF Data Services не предоставляет учетные данные при выполнении запроса к службе OData. Если службе данных для проверки подлинности пользователя требуются учетные данные, то их можно предоставить в объекте <xref:System.Net.NetworkCredential>, доступном через свойство <xref:System.Data.Services.Client.DataServiceContext.Credentials%2A> контекста <xref:System.Data.Services.Client.DataServiceContext>, как показано в следующем примере:  
  
```csharp  
// Set the client authentication credentials.  
context.Credentials =  
    new NetworkCredential(userName, password, domain);  
```  
  
```vb  
' Set the client authentication credentials.  
context.Credentials = _  
    New NetworkCredential(userName, password, domain)  
```  
  
 Дополнительные сведения см. [в разделе инструкции. Указание учетных данных клиента для запроса на обслуживание данных](specify-client-creds-for-a-data-service-request-wcf.md).  
  
 Когда служба данных требует учетные данные входа в систему, которые нельзя указать с помощью объекта <xref:System.Net.NetworkCredential>, например маркер на базе утверждений или файл cookie, необходимо вручную задать заголовки в HTTP-запросе, обычно это заголовки `Authorization` и `Cookie`. Дополнительные сведения об этом типе сценария проверки подлинности см. в блоге запись [OData и проверка подлинности — часть 3 – задержка-обработчики](https://devblogs.microsoft.com/odata/odata-and-authentication-part-3-clientside-hooks/). Пример задания заголовков HTTP в сообщении запроса см. в разделе [как задать заголовки в запросе клиента](how-to-set-headers-in-the-client-request-wcf-data-services.md).  
  
## <a name="impersonation"></a>Олицетворение  
 Как правило, служба данных обращается к требуемым ресурсам, например к файлам на сервере или к базе данных, с использованием учетных данных рабочего процесса, в котором размещается служба данных. При использовании олицетворения приложения ASP.NET могут выполняться с удостоверением Windows (учетной записью пользователя) пользователя, выполняющего запрос. Олицетворение обычно используется в приложениях, которым проверку подлинности пользователя обеспечивают службы IIS, а учетные данные участника используются для доступа к требуемым ресурсам. Дополнительные сведения см. в разделе [ASP.NET Impersonation](https://docs.microsoft.com/previous-versions/aspnet/xh507fc5(v=vs.100)).  
  
## <a name="configuring-data-service-authorization"></a>Настройка авторизации службы данных  
 Авторизация — это предоставление доступа к ресурсам приложений участнику или процессу, определяемому на основе успешно выполненной до этого проверки подлинности. Как правило, для выполнения операций, которые требуются клиентским приложениям, нужно лишь предоставить достаточные права пользователям службы данных.  
  
### <a name="restrict-access-to-data-service-resources"></a>Ограничение доступа к ресурсам службы данных  
 По умолчанию WCF Data Services позволяет предоставлять общий доступ на чтение и запись к ресурсам службы данных (наборам сущностей и операциям службы) любому пользователю, который может получить доступ к службе данных. Правила, определяющие доступ для чтения и записи, можно задавать отдельно для каждого набора сущностей, предоставляемого службой данных, а также для любой операции службы. Рекомендуется ограничить доступ для чтения и записи только теми ресурсами, которые необходимы клиентскому приложению. Дополнительные сведения см. в разделе [требования к минимальному доступу к ресурсам](configuring-the-data-service-wcf-data-services.md#accessRequirements).  
  
### <a name="implement-role-based-interceptors"></a>Реализация перехватчиков на базе ролей  
 Перехватчики позволяют перехватывать запросы к ресурсам службы данных до того, как они будут обработаны службой данных. Дополнительные сведения см. в разделе [перехватчики](interceptors-wcf-data-services.md). Перехватчики позволяют принимать решения об авторизации с учетом того, какой пользователь, прошедший проверку подлинности, выполняет запрос. Пример ограничения доступа к ресурсам службы данных на основе удостоверения пользователя, прошедшего проверку подлинности, см. [в разделе как перехватывать сообщения службы данных](how-to-intercept-data-service-messages-wcf-data-services.md).  
  
### <a name="restrict-access-to-the-persisted-data-store-and-local-resources"></a>Ограничение доступа к хранилищу материализованных данных и локальным ресурсам  
 Учетным записям, используемым для доступа к хранилищу материализованных данных, должны быть предоставлены только те права в базе данных или файловой системе, которых достаточно для выполнения требований службы данных. При использовании анонимной проверки подлинности это будет учетная запись, под которой запущено приложение размещения. Для получения дополнительной информации см. [How to: Develop a WCF Data Service Running on IIS](how-to-develop-a-wcf-data-service-running-on-iis.md). При использовании олицетворения пользователям, прошедшим проверку подлинности, должен предоставляться доступ к этим ресурсам — как правило, в рамках группы Windows.  
  
## <a name="other-security-considerations"></a>Другие вопросы безопасности  
  
### <a name="secure-the-data-in-the-payload"></a>Защита полезных данных  
OData основан на протоколе HTTP. Заголовок HTTP-сообщения может содержать полезные учетные данные пользователя в зависимости от типа проверки подлинности, реализуемого службой данных. Текст сообщения может также содержать полезные пользовательские данные, которые могут требовать защиты. В обоих случаях рекомендуется защищать передачу этих сведений по сети с помощью SSL.  
  
### <a name="ignored-message-headers-and-cookies"></a>Пропускаемые заголовки сообщений и файлы cookie  
 Заголовки HTTP-запросов, отличные от объявляющих типы содержимого и расположения ресурсов, пропускаются и никогда не задаются службой данных.  
  
 Файлы cookie можно использовать как часть схемы проверки подлинности, например с проверкой подлинности ASP.NET Forms. Однако все файлы cookie HTTP, заданные для входящего запроса, игнорируются WCF-службами данных. Узел службы данных может обработать файл cookie, но WCF Data Services среда выполнения никогда не анализирует и не возвращает файлы cookie. Клиентская библиотека WCF Data Services также не обрабатывает файлы cookie, отправленные в ответе.  
  
### <a name="custom-hosting-requirements"></a>Требования к пользовательскому размещению  
 По умолчанию WCF Data Services создается как приложение ASP.NET, размещенное в службах IIS. Это позволяет службе данных использовать методы защиты этой платформы. Можно определить WCF Data Services, которые размещаются на настраиваемом узле. Дополнительные сведения см. [в разделе Размещение службы данных](hosting-the-data-service-wcf-data-services.md). Компоненты и платформа, на которой размещается служба данных, должны поддерживать приведенные ниже методы защиты для предотвращения атак на службу данных.  
  
- Ограничение длины URI, принимаемого в запросе к службе данных для всех возможных операций.  
  
- Ограничение размера как входящих, так и исходящих HTTP-сообщений.  
  
- Ограничение общего числа необработанных запросов в любой момент времени.  
  
- Ограничьте размер заголовков HTTP и их значений, а также предоставьте WCF Data Services доступ к данным заголовка.  
  
- Определение и отражение известных атак, например TCP SYN и атак повторной передачи ранее переданных сообщений.  
  
### <a name="values-are-not-further-encoded"></a>Отсутствие дальнейшего кодирования значений  
 Значения свойств, отправленные в службу данных, не шифруются с помощью WCF Data Services среды выполнения. Например, если строковое свойство сущности содержит отформатированное HTML-содержимое, теги не кодируются службой данных в HTML. Кроме того, служба данных не выполняет дальнейшего кодирования значений свойств в ответе. Клиентская библиотека также не выполняет дополнительного кодирования.  
  
### <a name="considerations-for-client-applications"></a>Замечания по клиентским приложениям  
 Следующие вопросы безопасности относятся к приложениям, которые используют клиент WCF Data Services для доступа к службам OData:  
  
- Клиентская библиотека предполагает, что протоколы, используемые для доступа к службам данных, обеспечивают требуемый уровень безопасности.  
  
- Клиентская библиотека использует значения по умолчанию для всех параметров времени ожидания и синтаксического анализа базовых транспортных стеков, предоставленных платформой.  
  
- Клиентская библиотека не считывает никакие параметры из файлов конфигурации приложения.  
  
- В клиентской библиотеке не реализовано никаких механизмов междоменного доступа. Вместо этого механизмы предоставляются базовым стеком HTTP.  
  
- Клиентская библиотека не имеет элементов пользовательского интерфейса и никогда не пытается отобразить или вывести получаемые или отправляемые данные.  
  
- Рекомендуется, чтобы клиентские приложения всегда проверяли вводимые пользователем данные, а также все данные, принимаемые от недоверенных служб.  
  
## <a name="see-also"></a>См. также:

- [Определение служб данных WCF](defining-wcf-data-services.md)
- [Библиотека клиентов служб данных WCF](wcf-data-services-client-library.md)
