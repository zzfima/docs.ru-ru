---
title: Защита служб WCF Data Services
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- securing application [WCF Data Services]
- WCF Data Services, security
ms.assetid: 99fc2baa-a040-4549-bc4d-f683d60298af
ms.openlocfilehash: 0fd966d696e08c74185dc2c3859fd74d90933296
ms.sourcegitcommit: d2ccb199ae6bc5787b4762e9ea6d3f6fe88677af
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/12/2019
ms.locfileid: "56092700"
---
# <a name="securing-wcf-data-services"></a>Защита служб WCF Data Services
В этом разделе приведены сведения по безопасности, связанные с разработкой, развертыванием и запуском [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] и приложений, которые обращаются к службам, поддерживающим [!INCLUDE[ssODataFull](../../../../includes/ssodatafull-md.md)]. Необходимо также следовать инструкциям по созданию безопасных приложений [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)].  
  
 При планировании безопасности службы [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] на базе [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] следует позаботиться как о проверке подлинности (о процедуре определения и проверки идентификатора участника), так и об авторизации (о процедуре, определяющей, разрешен ли прошедшему проверку подлинности участнику доступ к запрашиваемым ресурсам). Следует также рассмотреть необходимость шифрования сообщения с помощью протокола SSL.  
  
## <a name="authenticating-client-requests"></a>Проверка подлинности клиентских запросов  
 Поскольку в [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] не реализована собственная схема проверки подлинности, она реализуется средствами, предоставляемыми узлом службы данных. Это означает, что служба предполагает, что все получаемые запросы уже прошли проверку подлинности на сетевом узле и что узел соответствующим образом правильно определил участника, передавшего запрос, через интерфейсы, предоставляемые [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)]. Эти параметры проверки подлинности и методики, подробно изложены в [OData and Authentication серии](https://go.microsoft.com/fwlink/?LinkId=200381).  
  
### <a name="authentication-options-for-a-wcf-data-service"></a>Параметры проверки подлинности для службы данных WCF  
 В приведенной ниже таблице перечислены некоторые из механизмов проверки подлинности, с помощью которых можно выполнять проверку подлинности запросов к службе данных WCF.  
  
|Параметры проверки подлинности|Описание:|  
|----------------------------|-----------------|  
|Анонимная проверка подлинности|При использовании анонимной проверки подлинности по HTTP любой участник может подключиться к службе данных. Учетные данные для анонимного доступа не требуются. Используйте этот параметр, только если требуется предоставить общий доступ к службе данных.|  
|Обычная и дайджест-проверка подлинности|Для проверки подлинности необходимы учетные данные, состоящие из имени пользователя и пароля. Поддерживает проверку подлинности клиентов, отличных от Windows. **Примечание о безопасности.**  Учетные данные для обычной проверки подлинности (имя пользователя и пароль) отправляются в открытом виде и могут быть перехвачены. При дайджест-проверке подлинности отправляется хэш, основанный на переданных учетных данных, что обеспечивает большую безопасность по сравнению с обычной проверкой подлинности. Оба эти метода проверки подлинности уязвимы для атак типа «злоумышленник в середине». При использовании этих методов проверки подлинности следует организовать зашифрованное соединение между клиентом и службой данных с помощью протокола SSL. <br /><br /> В службах Microsoft IIS предусмотрена реализация как обычной, так и дайджест-проверки подлинности для HTTP-запросов в приложении [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)]. Эта реализация поставщика проверки подлинности Windows позволяет клиентскому приложению .NET Framework передавать учетные данные службе данных в HTTP-заголовке запроса, что дает возможность беспрепятственно согласовывать проверку подлинности пользователя Windows. Дополнительные сведения см. в разделе [Технический справочник хэш-кода проверки подлинности](https://go.microsoft.com/fwlink/?LinkId=200408).<br /><br /> Если требуется использовать в службе данных обычную проверку подлинности на базе некоторой нестандартной службы проверки подлинности и без учетных данных Windows, для этого необходимо реализовать пользовательский HTTP-модуль [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)].<br /><br /> Пример того, как использовать схему пользовательских обычную проверку подлинности с помощью [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)], см. в записи [Custom Basic Authentication](https://go.microsoft.com/fwlink/?LinkID=200388) в [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] и рядов для проверки подлинности.|  
|Аутентификация Windows|Обмен учетными данными на базе Windows происходит с помощью NTLM или Kerberos. Этот механизм более надежен, чем простая или дайджест-проверка подлинности, но он требует, чтобы клиент был приложением на базе Windows. Кроме того, в службах IIS предусмотрена реализация проверки подлинности Windows для HTTP-запросов в приложении [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)]. Дополнительные сведения см. в разделе [обзор проверки подлинности форм ASP.NET](https://docs.microsoft.com/previous-versions/aspnet/7t6b43z4(v=vs.100)).<br /><br /> Пример того, как использовать проверку подлинности Windows с [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)], см. в записи [проверки подлинности Windows](https://go.microsoft.com/fwlink/?LinkID=200384) в [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] и рядов для проверки подлинности.|  
|Проверка подлинности с помощью форм в [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)]|Проверка подлинности с помощью форм позволяет проверять подлинность пользователей с помощью собственного кода и затем предоставлять маркер проверки подлинности в файле Cookie или в URL-адресе страницы. Проверка подлинности имени пользователя и пароля пользователя выполняется с помощью созданной вами формы входа в систему. Запросы без проверки подлинности перенаправляются на страницу входа, на которой пользователь указывает учетные данные и отправляет их. Если приложение удостоверяет подлинность запроса, система создает билет подлинности, который содержит ключ для повторного запроса данных. Дополнительные сведения см. в разделе [поставщика проверки подлинности форм](https://docs.microsoft.com/previous-versions/aspnet/9wff0kyh(v=vs.100)). **Примечание о безопасности.**  По умолчанию файл cookie, который содержит билет проверки подлинности форм, не защищен при использовании проверки подлинности с помощью форм в веб-приложении [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)]. Рассмотрите вариант с защитой как билета проверки подлинности, так и первоначальных учетных данных для входа с помощью SSL. <br /><br /> Для примера использования проверки подлинности форм с [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)], см. в записи [проверки подлинности форм](https://go.microsoft.com/fwlink/?LinkID=200389) в [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] и рядов для проверки подлинности.|  
|Проверка подлинности на основе утверждений|В проверке подлинности на основе утверждений служба данных возлагает на «third-party» доверенный поставщик службы для аутентификации пользователя. Поставщик удостоверений выполняет с положительным результатом проверку подлинности пользователя, который запросил доступ к ресурсам службы данных, и выдает маркер, предоставляющий доступ к запрошенным ресурсам. Затем этот маркер представляется службе данных, которая предоставляет доступ пользователю на базе отношений доверия со службой удостоверений, выдавшей маркер доступа.<br /><br /> Преимущество использования поставщика проверки подлинности на базе утверждений заключается в том, что этот метод можно использовать для проверки подлинности клиентов различных типов между несколькими доверенными доменами. Благодаря применению такого стороннего поставщика, служба данных может быть освобождена от дополнительной нагрузки по поддержке и проверке подлинности пользователей. OAuth 2.0 — это протокол проверки подлинности на основе утверждений, поддерживаемый системой контроля доступа к фабрике приложений Microsoft Azure для федеративной проверки подлинности и реализованный в виде службы. Этот протокол поддерживает службы на основе REST. Пример демонстрирует использование OAuth 2.0 с [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)], см. в записи [OData и OAuth](https://go.microsoft.com/fwlink/?LinkId=200514) в [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] и рядов для проверки подлинности.|  
  
<a name="clientAuthentication"></a>   
### <a name="authentication-in-the-client-library"></a>Проверка подлинности в клиентской библиотеке  
 По умолчанию клиентская библиотека [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] не поддерживает учетные данные при формировании запроса к службе [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)]. Если службе данных для проверки подлинности пользователя требуются учетные данные, то их можно предоставить в объекте <xref:System.Net.NetworkCredential>, доступном через свойство <xref:System.Data.Services.Client.DataServiceContext.Credentials%2A> контекста <xref:System.Data.Services.Client.DataServiceContext>, как показано в следующем примере:  
  
```csharp  
// Set the client authentication credentials.  
context.Credentials =  
    new NetworkCredential(userName, password, domain);  
```  
  
```vb  
' Set the client authentication credentials.  
context.Credentials = _  
    New NetworkCredential(userName, password, domain)  
```  
  
 Дополнительные сведения см. в разделе [Как Укажите учетные данные клиента для запроса службы данных](../../../../docs/framework/data/wcf/specify-client-creds-for-a-data-service-request-wcf.md).  
  
 Когда служба данных требует учетные данные входа в систему, которые нельзя указать с помощью объекта <xref:System.Net.NetworkCredential>, например маркер на базе утверждений или файл cookie, необходимо вручную задать заголовки в HTTP-запросе, обычно это заголовки `Authorization` и `Cookie`. Дополнительные сведения об этом сценарии проверки подлинности см. в публикации [OData and Authentication: Клиентские обработчики](https://go.microsoft.com/fwlink/?LinkID=200385). Пример задания HTTP-заголовков в сообщении запроса, см. в разделе [как: Задать заголовки в клиентском запросе](../../../../docs/framework/data/wcf/how-to-set-headers-in-the-client-request-wcf-data-services.md).  
  
## <a name="impersonation"></a>Олицетворение  
 Как правило, служба данных обращается к требуемым ресурсам, например к файлам на сервере или к базе данных, с использованием учетных данных рабочего процесса, в котором размещается служба данных. При использовании олицетворения приложения [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] могут выполняться с удостоверением Windows (учетной записью) пользователя, выполняющего запрос. Олицетворение обычно используется в приложениях, которым проверку подлинности пользователя обеспечивают службы IIS, а учетные данные участника используются для доступа к требуемым ресурсам. Дополнительные сведения см. в разделе [олицетворение ASP.NET](https://docs.microsoft.com/previous-versions/aspnet/xh507fc5(v=vs.100)).  
  
## <a name="configuring-data-service-authorization"></a>Настройка авторизации службы данных  
 Авторизация — это предоставление доступа к ресурсам приложений участнику или процессу, определяемому на основе успешно выполненной до этого проверки подлинности. Как правило, для выполнения операций, которые требуются клиентским приложениям, нужно лишь предоставить достаточные права пользователям службы данных.  
  
### <a name="restrict-access-to-data-service-resources"></a>Ограничение доступа к ресурсам службы данных  
 По умолчанию в [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] можно предоставлять общий доступ на чтение и запись для ресурсов служб данных (набора сущностей и операций службы) любому пользователю, у которого есть доступ к службе данных. Правила, определяющие доступ для чтения и записи, можно задавать отдельно для каждого набора сущностей, предоставляемого службой данных, а также для любой операции службы. Рекомендуется ограничить доступ для чтения и записи только теми ресурсами, которые необходимы клиентскому приложению. Дополнительные сведения см. в разделе [минимальные требования к доступа ресурсов](../../../../docs/framework/data/wcf/configuring-the-data-service-wcf-data-services.md#accessRequirements).  
  
### <a name="implement-role-based-interceptors"></a>Реализация перехватчиков на базе ролей  
 Перехватчики позволяют перехватывать запросы к ресурсам службы данных до того, как они будут обработаны службой данных. Дополнительные сведения см. в разделе [перехватчики](../../../../docs/framework/data/wcf/interceptors-wcf-data-services.md). Перехватчики позволяют принимать решения об авторизации с учетом того, какой пользователь, прошедший проверку подлинности, выполняет запрос. Например, как ограничить доступ к ресурсам службы данных на основе удостоверения пользователя, прошедшего аутентификацию, см. в разделе [как: Перехват сообщений службы данных](../../../../docs/framework/data/wcf/how-to-intercept-data-service-messages-wcf-data-services.md).  
  
### <a name="restrict-access-to-the-persisted-data-store-and-local-resources"></a>Ограничение доступа к хранилищу материализованных данных и локальным ресурсам  
 Учетным записям, используемым для доступа к хранилищу материализованных данных, должны быть предоставлены только те права в базе данных или файловой системе, которых достаточно для выполнения требований службы данных. При использовании анонимной проверки подлинности это будет учетная запись, под которой запущено приложение размещения. Дополнительные сведения см. в разделе [Как Разработке службы данных WCF, выполняющегося на сервере IIS](../../../../docs/framework/data/wcf/how-to-develop-a-wcf-data-service-running-on-iis.md). При использовании олицетворения пользователям, прошедшим проверку подлинности, должен предоставляться доступ к этим ресурсам — как правило, в рамках группы Windows.  
  
## <a name="other-security-considerations"></a>Другие вопросы безопасности  
  
### <a name="secure-the-data-in-the-payload"></a>Защита полезных данных  
 В основе [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] лежит протокол HTTP. Заголовок HTTP-сообщения может содержать полезные учетные данные пользователя в зависимости от типа проверки подлинности, реализуемого службой данных. Текст сообщения может также содержать полезные пользовательские данные, которые могут требовать защиты. В обоих случаях рекомендуется защищать передачу этих сведений по сети с помощью SSL.  
  
### <a name="ignored-message-headers-and-cookies"></a>Пропускаемые заголовки сообщений и файлы cookie  
 Заголовки HTTP-запросов, отличные от объявляющих типы содержимого и расположения ресурсов, пропускаются и никогда не задаются службой данных.  
  
 Файлы cookie можно использовать в составе схемы проверки подлинности, например при проверке подлинности [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] с помощью форм. Однако любые файлы cookie HTTP, заданные во входящем запросе, [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] пропускает. Сервер, на котором размещена служба данных, может обрабатывать файл cookie, но среда выполнения [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] никогда не анализирует и не возвращает файлы cookie. Клиентская библиотека [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] также не обрабатывает файлы cookie, присланные в ответе.  
  
### <a name="custom-hosting-requirements"></a>Требования к пользовательскому размещению  
 По умолчанию [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] создается как приложение [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)], размещаемое в службах IIS. Это позволяет службе данных использовать методы защиты этой платформы. Можно определить приложения [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] как размещаемые на пользовательском узле. Дополнительные сведения см. в разделе [размещение служб данных](../../../../docs/framework/data/wcf/hosting-the-data-service-wcf-data-services.md). Компоненты и платформа, на которой размещается служба данных, должны поддерживать приведенные ниже методы защиты для предотвращения атак на службу данных.  
  
-   Ограничение длины URI, принимаемого в запросе к службе данных для всех возможных операций.  
  
-   Ограничение размера как входящих, так и исходящих HTTP-сообщений.  
  
-   Ограничение общего числа необработанных запросов в любой момент времени.  
  
-   Ограничение размера HTTP-заголовков и их значений, а также доступ [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] к данным заголовков.  
  
-   Определение и отражение известных атак, например TCP SYN и атак повторной передачи ранее переданных сообщений.  
  
### <a name="values-are-not-further-encoded"></a>Отсутствие дальнейшего кодирования значений  
 Среда выполнения [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] не выполняет дальнейшего кодирования значений свойств, отправляемых в службу данных. Например, если строковое свойство сущности содержит отформатированное HTML-содержимое, теги не кодируются службой данных в HTML. Кроме того, служба данных не выполняет дальнейшего кодирования значений свойств в ответе. Клиентская библиотека также не выполняет дополнительного кодирования.  
  
### <a name="considerations-for-client-applications"></a>Замечания по клиентским приложениям  
 Следующие замечания по безопасности относятся к приложениям, в которых клиент [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] используется для доступа к службам [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)].  
  
-   Клиентская библиотека предполагает, что протоколы, используемые для доступа к службам данных, обеспечивают требуемый уровень безопасности.  
  
-   Клиентская библиотека использует значения по умолчанию для всех параметров времени ожидания и синтаксического анализа базовых транспортных стеков, предоставленных платформой.  
  
-   Клиентская библиотека не считывает никакие параметры из файлов конфигурации приложения.  
  
-   В клиентской библиотеке не реализовано никаких механизмов междоменного доступа. Вместо этого механизмы предоставляются базовым стеком HTTP.  
  
-   Клиентская библиотека не имеет элементов пользовательского интерфейса и никогда не пытается отобразить или вывести получаемые или отправляемые данные.  
  
-   Рекомендуется, чтобы клиентские приложения всегда проверяли вводимые пользователем данные, а также все данные, принимаемые от недоверенных служб.  
  
## <a name="see-also"></a>См. также
- [Определение служб данных WCF](../../../../docs/framework/data/wcf/defining-wcf-data-services.md)
- [Библиотека клиентов служб данных WCF](../../../../docs/framework/data/wcf/wcf-data-services-client-library.md)
