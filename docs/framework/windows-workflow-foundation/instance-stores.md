---
title: Хранилища экземпляров
ms.date: 03/30/2017
ms.assetid: f2629668-0923-4987-b943-67477131c1e0
ms.openlocfilehash: 69b50942c36406bd29147d243e0501b8048d56dc
ms.sourcegitcommit: 32a575bf4adccc901f00e264f92b759ced633379
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/04/2019
ms.locfileid: "74802561"
---
# <a name="instance-stores"></a><span data-ttu-id="a8b56-102">Хранилища экземпляров</span><span class="sxs-lookup"><span data-stu-id="a8b56-102">Instance Stores</span></span>
<span data-ttu-id="a8b56-103">Хранилище экземпляров - это логический контейнер для экземпляров.</span><span class="sxs-lookup"><span data-stu-id="a8b56-103">An instance store is a logical container of instances.</span></span> <span data-ttu-id="a8b56-104">Здесь хранятся данные и метаданные экземпляра.</span><span class="sxs-lookup"><span data-stu-id="a8b56-104">It is the place where the instance data and metadata is stored.</span></span> <span data-ttu-id="a8b56-105">Хранилище экземпляров не предполагает выделения физического пространства.</span><span class="sxs-lookup"><span data-stu-id="a8b56-105">An instance store does not imply dedicated physical storage.</span></span> <span data-ttu-id="a8b56-106">Хранилище экземпляра может содержать постоянные сведения в базе данных SQL Server или непостоянные сведения о состоянии в памяти.</span><span class="sxs-lookup"><span data-stu-id="a8b56-106">An instance store could contain durable information in a SQL Server database or non-durable state information in a memory.</span></span> <span data-ttu-id="a8b56-107">[!INCLUDE[netfx_current_long](../../../includes/netfx-current-long-md.md)] поставляется с хранилищем экземпляров рабочего процесса SQL - конкретной реализацией хранилища экземпляров, которая позволяет рабочему процессу хранить данные и метаданные в базе данных SQL Server 2005 или SQL Server 2008.</span><span class="sxs-lookup"><span data-stu-id="a8b56-107">The [!INCLUDE[netfx_current_long](../../../includes/netfx-current-long-md.md)] ships with the SQL Workflow Instance Store, which is a concrete implementation of an instance store that allows workflows to persist instance data and metadata into a SQL Server 2005 or SQL Server 2008 database.</span></span> <span data-ttu-id="a8b56-108">Кроме того, Windows Server App Fabric также предоставляет конкретную реализацию хранилища экземпляров.</span><span class="sxs-lookup"><span data-stu-id="a8b56-108">In addition Windows Server App Fabric also provides a concrete implementation of an instance store.</span></span> <span data-ttu-id="a8b56-109">Дополнительные сведения см. в разделе [хранилище экземпляров Windows Server App Fabric, запросы и поставщики элементов управления](https://docs.microsoft.com/previous-versions/appfabric/ff383417(v=azure.10)).</span><span class="sxs-lookup"><span data-stu-id="a8b56-109">For more information, see [Windows Server App Fabric Instance Store, Query, and Control Providers](https://docs.microsoft.com/previous-versions/appfabric/ff383417(v=azure.10)).</span></span>  
  
 <span data-ttu-id="a8b56-110">API сохраняемости - это интерфейс между узлом и хранилищем экземпляров, позволяющим узлу отправлять запросы на команды (например, <xref:System.Activities.DurableInstancing.LoadWorkflowCommand> и <xref:System.Activities.DurableInstancing.SaveWorkflowCommand>) в хранилище экземпляров.</span><span class="sxs-lookup"><span data-stu-id="a8b56-110">The persistence API is the interface between a host and an instance store that allows the host to send command requests (for example, <xref:System.Activities.DurableInstancing.LoadWorkflowCommand> and <xref:System.Activities.DurableInstancing.SaveWorkflowCommand>) to the instance store.</span></span> <span data-ttu-id="a8b56-111">Конкретная реализация данного API-интерфейса называется поставщиком сохраняемости.</span><span class="sxs-lookup"><span data-stu-id="a8b56-111">The concrete implementation of this API is called a persistence provider.</span></span> <span data-ttu-id="a8b56-112">Поставщик сохраняемости получает запросы от узла и изменяет хранилище экземпляров.</span><span class="sxs-lookup"><span data-stu-id="a8b56-112">The persistence provider receives requests from a host and modifies the instance store.</span></span>  
  
 <span data-ttu-id="a8b56-113">Узлы и хранилища экземпляров являются подключаемыми; узел можно использовать с несколькими хранилищами экземпляров, хранилище экземпляров можно использовать с несколькими узлами.</span><span class="sxs-lookup"><span data-stu-id="a8b56-113">Hosts and instance stores are pluggable so that a host can be used with many instance stores, and an instance store can be used with many hosts.</span></span> <span data-ttu-id="a8b56-114">Хранилище экземпляров обычно оптимизируется под шаблоны использования определенного узла, хотя хранилище экземпляров и узел могут обрести независимые жизненные циклы.</span><span class="sxs-lookup"><span data-stu-id="a8b56-114">An instance store is typically optimized for the usage patterns of a particular host, although the instance store and host may evolve on independent life cycles.</span></span> <span data-ttu-id="a8b56-115">Например, **WorkflowServiceHost** и **SqlWorkflowInstanceStore** предназначены для совместной работы.</span><span class="sxs-lookup"><span data-stu-id="a8b56-115">For example, the **WorkflowServiceHost** and the **SqlWorkflowInstanceStore** are designed to work well together.</span></span> <span data-ttu-id="a8b56-116">Вы можете создать собственное хранилище экземпляров для сохранения данных и метаданных экземпляров службы рабочего процесса и использовать это хранилище экземпляров с **WorkflowServiceHost**.</span><span class="sxs-lookup"><span data-stu-id="a8b56-116">You can create your own instance store to persist data and metadata of workflow service instances and use that instance store with the **WorkflowServiceHost**.</span></span> <span data-ttu-id="a8b56-117">Например, можно создать хранилище OracleWorkflowInstanceStore, позволяющее рабочему процессу хранить данные в базе данных Oracle, а не в базе данных SQL Server.</span><span class="sxs-lookup"><span data-stu-id="a8b56-117">For example, you can create an OracleWorkflowInstanceStore that lets workflows persist information into an Oracle database instead of saving them into a SQL Server database.</span></span>  
  
 <span data-ttu-id="a8b56-118">Узлы обычно снабжаются дополнительными функциями, которые модифицируют сохраненные объекты.</span><span class="sxs-lookup"><span data-stu-id="a8b56-118">It is common for hosts to be extended with additional functionality that modifies the persisted objects.</span></span> <span data-ttu-id="a8b56-119">Например, система сохраняемости экземпляров может иметь узел рабочего процесса, расширение, которое поддерживает операцию "приостановки", и хранилище экземпляров SQL.</span><span class="sxs-lookup"><span data-stu-id="a8b56-119">For example, an instance persistence system may have a workflow host, an extension that supports the "Suspend" operation, and an SQL instance store.</span></span>  <span data-ttu-id="a8b56-120">Узел рабочего процесса может отправить стандартную команду, например «Save» или «Load», для сохранения рабочего процесса в хранилище экземпляров или для его загрузки соответственно.</span><span class="sxs-lookup"><span data-stu-id="a8b56-120">The workflow host might send a standard command such as Save or Load to save or load a workflow from an instance store or to save a workflow into an instance store.</span></span> <span data-ttu-id="a8b56-121">Расширение для приостановки может добавить командам сохранения или загрузки экземпляров рабочего процесса такую дополнительную семантику, что приостановленный экземпляр рабочего процесса нельзя будет загрузить.</span><span class="sxs-lookup"><span data-stu-id="a8b56-121">The suspend extension might add additional semantics to the commands for saving and loading workflow instances so that a suspended workflow instance cannot be loaded.</span></span> <span data-ttu-id="a8b56-122">Поставщик сохраняемости для хранилища экземпляров SQL понимает команды сохранения или загрузки экземпляров рабочего процесса и применяет команды путем вызова соответствующих хранимых процедур, которые вносят изменения в таблицы сохраненных объектов в базе данных SQL Server.</span><span class="sxs-lookup"><span data-stu-id="a8b56-122">The persistence provider for the SQL instance store understands the commands for saving and loading workflow instances, and implements the commands by calling appropriate stored procedures that change the tables of persistent objects in an SQL Server database.</span></span>  
  
 <span data-ttu-id="a8b56-123">В хранилище экземпляров узел является владельцем экземпляра.</span><span class="sxs-lookup"><span data-stu-id="a8b56-123">A host acts as an instance owner within an instance store.</span></span> <span data-ttu-id="a8b56-124">Одновременно узел может владеть несколькими экземплярами из нескольких разных хранилищ.</span><span class="sxs-lookup"><span data-stu-id="a8b56-124">A host may act as more than one instance owner with more than one instance store at the same time.</span></span> <span data-ttu-id="a8b56-125">Узел предоставляет идентификаторы GUID для ключей экземпляров, связанных с экземплярами.</span><span class="sxs-lookup"><span data-stu-id="a8b56-125">The host provides GUIDs for instance keys associated with the instances.</span></span> <span data-ttu-id="a8b56-126">Ключ экземпляра - уникальный псевдоним, определяющий экземпляр.</span><span class="sxs-lookup"><span data-stu-id="a8b56-126">An instance key is a unique alias that identifies an instance.</span></span> <span data-ttu-id="a8b56-127">Система сохраняемости создает, обновляет и удаляет сведения о владельце экземпляра, когда выполняет команды, запрошенные узлами.</span><span class="sxs-lookup"><span data-stu-id="a8b56-127">The persistence system creates, updates, and deletes instance owner information as it executes commands requested by hosts.</span></span>  
  
 <span data-ttu-id="a8b56-128">Следующий список содержит важные этапы взаимодействия узла с хранилищем экземпляров.</span><span class="sxs-lookup"><span data-stu-id="a8b56-128">The following list contains the important steps involved in the host’s interaction with the instance store:</span></span>  
  
1. <span data-ttu-id="a8b56-129">Получение **InstanceStore** от поставщика сохраняемости.</span><span class="sxs-lookup"><span data-stu-id="a8b56-129">Obtain an **InstanceStore** from a persistence provider.</span></span>  

2. <span data-ttu-id="a8b56-130">Получите маркер экземпляра, вызвав метод <xref:System.Runtime.DurableInstancing.InstanceStore.CreateInstanceHandle%2A> в **InstanceStore**.</span><span class="sxs-lookup"><span data-stu-id="a8b56-130">Obtain the handle to an instance by calling the <xref:System.Runtime.DurableInstancing.InstanceStore.CreateInstanceHandle%2A> method on the **InstanceStore**.</span></span>  
  
3. <span data-ttu-id="a8b56-131">Вызывайте команды для обработки экземпляра, вызвав метод <xref:System.Runtime.DurableInstancing.InstanceStore.Execute%2A> для **InstanceStore**.</span><span class="sxs-lookup"><span data-stu-id="a8b56-131">Invoke commands against the instance handle by calling the <xref:System.Runtime.DurableInstancing.InstanceStore.Execute%2A> method on the **InstanceStore**.</span></span>  
  
4. <span data-ttu-id="a8b56-132">Изучите <xref:System.Runtime.DurableInstancing.InstanceView>, возвращаемые **InstanceStore. Execute** , чтобы определить результаты выполнения команд.</span><span class="sxs-lookup"><span data-stu-id="a8b56-132">Examine the <xref:System.Runtime.DurableInstancing.InstanceView> returned by **InstanceStore.Execute** to determine the results of the commands.</span></span>
