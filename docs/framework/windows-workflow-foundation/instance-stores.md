---
title: Хранилища экземпляров
ms.date: 03/30/2017
ms.assetid: f2629668-0923-4987-b943-67477131c1e0
ms.openlocfilehash: 69b50942c36406bd29147d243e0501b8048d56dc
ms.sourcegitcommit: 32a575bf4adccc901f00e264f92b759ced633379
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/04/2019
ms.locfileid: "74802561"
---
# <a name="instance-stores"></a>Хранилища экземпляров
Хранилище экземпляров - это логический контейнер для экземпляров. Здесь хранятся данные и метаданные экземпляра. Хранилище экземпляров не предполагает выделения физического пространства. Хранилище экземпляра может содержать постоянные сведения в базе данных SQL Server или непостоянные сведения о состоянии в памяти. [!INCLUDE[netfx_current_long](../../../includes/netfx-current-long-md.md)] поставляется с хранилищем экземпляров рабочего процесса SQL - конкретной реализацией хранилища экземпляров, которая позволяет рабочему процессу хранить данные и метаданные в базе данных SQL Server 2005 или SQL Server 2008. Кроме того, Windows Server App Fabric также предоставляет конкретную реализацию хранилища экземпляров. Дополнительные сведения см. в разделе [хранилище экземпляров Windows Server App Fabric, запросы и поставщики элементов управления](https://docs.microsoft.com/previous-versions/appfabric/ff383417(v=azure.10)).  
  
 API сохраняемости - это интерфейс между узлом и хранилищем экземпляров, позволяющим узлу отправлять запросы на команды (например, <xref:System.Activities.DurableInstancing.LoadWorkflowCommand> и <xref:System.Activities.DurableInstancing.SaveWorkflowCommand>) в хранилище экземпляров. Конкретная реализация данного API-интерфейса называется поставщиком сохраняемости. Поставщик сохраняемости получает запросы от узла и изменяет хранилище экземпляров.  
  
 Узлы и хранилища экземпляров являются подключаемыми; узел можно использовать с несколькими хранилищами экземпляров, хранилище экземпляров можно использовать с несколькими узлами. Хранилище экземпляров обычно оптимизируется под шаблоны использования определенного узла, хотя хранилище экземпляров и узел могут обрести независимые жизненные циклы. Например, **WorkflowServiceHost** и **SqlWorkflowInstanceStore** предназначены для совместной работы. Вы можете создать собственное хранилище экземпляров для сохранения данных и метаданных экземпляров службы рабочего процесса и использовать это хранилище экземпляров с **WorkflowServiceHost**. Например, можно создать хранилище OracleWorkflowInstanceStore, позволяющее рабочему процессу хранить данные в базе данных Oracle, а не в базе данных SQL Server.  
  
 Узлы обычно снабжаются дополнительными функциями, которые модифицируют сохраненные объекты. Например, система сохраняемости экземпляров может иметь узел рабочего процесса, расширение, которое поддерживает операцию "приостановки", и хранилище экземпляров SQL.  Узел рабочего процесса может отправить стандартную команду, например «Save» или «Load», для сохранения рабочего процесса в хранилище экземпляров или для его загрузки соответственно. Расширение для приостановки может добавить командам сохранения или загрузки экземпляров рабочего процесса такую дополнительную семантику, что приостановленный экземпляр рабочего процесса нельзя будет загрузить. Поставщик сохраняемости для хранилища экземпляров SQL понимает команды сохранения или загрузки экземпляров рабочего процесса и применяет команды путем вызова соответствующих хранимых процедур, которые вносят изменения в таблицы сохраненных объектов в базе данных SQL Server.  
  
 В хранилище экземпляров узел является владельцем экземпляра. Одновременно узел может владеть несколькими экземплярами из нескольких разных хранилищ. Узел предоставляет идентификаторы GUID для ключей экземпляров, связанных с экземплярами. Ключ экземпляра - уникальный псевдоним, определяющий экземпляр. Система сохраняемости создает, обновляет и удаляет сведения о владельце экземпляра, когда выполняет команды, запрошенные узлами.  
  
 Следующий список содержит важные этапы взаимодействия узла с хранилищем экземпляров.  
  
1. Получение **InstanceStore** от поставщика сохраняемости.  

2. Получите маркер экземпляра, вызвав метод <xref:System.Runtime.DurableInstancing.InstanceStore.CreateInstanceHandle%2A> в **InstanceStore**.  
  
3. Вызывайте команды для обработки экземпляра, вызвав метод <xref:System.Runtime.DurableInstancing.InstanceStore.Execute%2A> для **InstanceStore**.  
  
4. Изучите <xref:System.Runtime.DurableInstancing.InstanceView>, возвращаемые **InstanceStore. Execute** , чтобы определить результаты выполнения команд.
