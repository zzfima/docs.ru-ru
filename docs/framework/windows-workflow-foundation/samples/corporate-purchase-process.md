---
title: Процесс корпоративных закупок
ms.date: 03/30/2017
ms.assetid: a5e57336-4290-41ea-936d-435593d97055
ms.openlocfilehash: 95fa421ed44cf2d930fb4b80979d1b8bd9fda5ed
ms.sourcegitcommit: 5fb5b6520b06d7f5e6131ec2ad854da302a28f2e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/03/2019
ms.locfileid: "74715213"
---
# <a name="corporate-purchase-process"></a>Процесс корпоративных закупок
Этот образец показывает, как создать очень простой запрос предложений на основе процесса покупки с автоматическим выбором наилучшего предложения. В нем совместно применяются операторы <xref:System.Activities.Statements.Parallel>, <xref:System.Activities.Statements.ParallelForEach%601> и <xref:System.Activities.Statements.ForEach%601>, а также пользовательское действие для создания рабочего потока, который представляет процесс.

 Этот пример содержит клиентское приложение ASP.NET, которое позволяет взаимодействовать с процессом как с другими участниками (как у исходного инициатора или определенного поставщика).

## <a name="requirements"></a>Требования

- Visual Studio 2012.

- [!INCLUDE[netfx_current_long](../../../../includes/netfx-current-long-md.md)].

## <a name="demonstrates"></a>Демонстрации

- Настраиваемые действия.

- Сочетание действий.

- Закладки.

- Сохраняемость.

- Схематизированная сохраняемость.

- Трассировка.

- Отслеживание.

- Размещение [!INCLUDE[wf1](../../../../includes/wf1-md.md)] на разных клиентах (веб-приложения ASP.NET и приложения WinForms).

> [!IMPORTANT]
> Образцы уже могут быть установлены на компьютере. Перед продолжением проверьте следующий каталог (по умолчанию).  
>   
> `<InstallDrive>:\WF_WCF_Samples`  
>   
> Если этот каталог не существует, перейдите к [примерам Windows Communication Foundation (WCF) и Windows Workflow Foundation (WF) для .NET Framework 4](https://www.microsoft.com/download/details.aspx?id=21459) , чтобы скачать все Windows Communication Foundation (WCF) и [!INCLUDE[wf1](../../../../includes/wf1-md.md)] Samples. Этот образец расположен в следующем каталоге.  
>   
> `<InstallDrive>:\WF_WCF_Samples\WF\Application\PurchaseProcess`  
  
## <a name="description-of-the-process"></a>Описание процесса  
 В этом примере показана реализация программы Windows Workflow Foundation (WF) для сбора предложений от поставщиков для универсальной компании.  
  
1. Сотрудник компании X создает запрос предложений.  
  
    1. Сотрудник вводит название и описание запроса предложений.  
  
    2. Сотрудник выбирает поставщиков, которых он желает пригласить для передачи предложений.  
  
2. Сотрудник передает предложение.  
  
    1. Создается экземпляр рабочего процесса.  
  
    2. Рабочий процесс ожидает, чтобы все поставщики передали свои предложения.  
  
3. После получения всех предложений рабочий процесс обрабатывает в цикле все полученные предложения и выбирает наилучшее.  
  
    1. Каждый поставщик имеет репутацию (в этом образце список репутаций сохраняется в VendorRepository.cs).  
  
    2. Общая стоимость предложения определяется по формуле (Стоимость, предложенная поставщиком)*(Зарегистрированный показатель репутации поставщика) / 100.  
  
4. Исходная запрашивающая сторона может видеть все переданные предложения. Наилучшее предложение представлено в специальном разделе отчета.  
  
## <a name="process-definition"></a>Определение процесса  
 В основной логике образца используется действие <xref:System.Activities.Statements.ParallelForEach%601>, которое ожидает предложения от каждого поставщика (с применением пользовательского действия, которое создает закладку) и регистрирует предложение поставщика как запрос предложений (с применением действия <xref:System.Activities.Statements.InvokeMethod>).  
  
 Затем в образце выполняется обработка в цикле всех полученных предложений, сохраненных в `RfpRepository`, вычисление откорректированного значения (с использованием действия <xref:System.Activities.Statements.Assign> и действий <xref:System.Activities.Expressions>), и если откорректированное значение оказывается лучше по сравнению с предыдущим наилучшим предложением, присваивание нового значения как наилучшего предложения (с использованием действий <xref:System.Activities.Statements.If> и <xref:System.Activities.Statements.Assign>).  
  
## <a name="projects-in-this-sample"></a>Проекты в этом образце  
 Этот образец содержит следующие проекты.  
  
|Проект служб   .|Описание|  
|-------------|-----------------|  
|Общие|Объекты сущности, используемые в процессе («Запрос предложения», «Поставщик» и «Предложение поставщика»).|  
|WfDefinition|Определение процесса (как программы [!INCLUDE[wf1](../../../../includes/wf1-md.md)]) и узел (`PurchaseProcessHost`), используемый клиентскими приложениями для создания и использования экземпляров рабочего потока процесса покупки.|  
|WebClient|Клиентское приложение ASP.NET, позволяющее пользователям создавать и принимать участие в экземплярах процесса покупки. Для взаимодействия с подсистемой рабочих процессов используется настраиваемый сервер.|  
|WinFormsClient|Клиентское приложение Windows Forms, которое позволяет пользователям создавать и участвовать в работе экземпляров процесса покупки. Для взаимодействия с подсистемой рабочих процессов используется настраиваемый сервер.|  
  
### <a name="wfdefinition"></a>WfDefinition  
 В следующей таблице содержится описание наиболее важных файлов в проекте WfDefinition.  
  
|File|Описание|  
|----------|-----------------|  
|IPurchaseProcessHost.cs|Интерфейс для узла рабочего процесса.|  
|PurchaseProcessHost.cs|Реализация узла для рабочего процесса. Узел позволяет абстрагироваться от подробных сведений о среде выполнения рабочего процесса и используется во всех клиентских приложениях для загрузки, запуска и взаимодействия с экземплярами рабочего процесса `PurchaseProcess`.|  
|PurchaseProcessWorkflow.cs|Действие, которое содержит определение рабочего процесса покупки (происходит от <xref:System.Activities.Activity>).<br /><br /> Действия, которые происходят от <xref:System.Activities.Activity>, формируют функциональные возможности, выполняя сборку существующих пользовательских действий и действий из библиотеки действий [!INCLUDE[netfx_current_long](../../../../includes/netfx-current-long-md.md)]. Сборка этих действий является наиболее простым способом создания пользовательских функциональных возможностей.|  
|WaitForVendorProposal.cs|Это пользовательское действие происходит от <xref:System.Activities.NativeActivity> и создает именованную закладку, которая должна быть возобновлена в дальнейшем поставщиком путем передачи предложения.<br /><br /> Действия, которые являются производными от <xref:System.Activities.NativeActivity> аналогично производным действиям от <xref:System.Activities.CodeActivity>, создают императивные функции путем переопределения <xref:System.Activities.NativeActivity.Execute%2A>, но также имеют доступ ко всем функциям среды выполнения рабочего процесса благодаря <xref:System.Activities.ActivityContext>, который передается методу `Execute`. Этот контекст поддерживает планирование и отмену дочерних действий, подготовку к работе зон, не обеспечивающих сохраняемость (блоков выполнения, в ходе работы которых среда выполнения не сохраняет данные рабочего потока, как при неразрывных транзакциях), и объекты <xref:System.Activities.Bookmark> (маркеры возобновления приостановленных рабочих процессов).|  
|TrackingParticipant.cs|Участник <xref:System.Activities.Tracking.TrackingParticipant>, который получает все события отслеживания и сохраняет их в текстовом файле.<br /><br /> Участники отслеживания добавляются к экземпляру рабочего процесса как расширения.|  
|XmlWorkflowInstanceStore.cs|Пользовательское хранилище <xref:System.Runtime.DurableInstancing.InstanceStore>, которое сохраняет приложения рабочего процесса в XML-файлах.|  
|XmlPersistenceParticipant.cs|Пользовательское хранилище <xref:System.Activities.Persistence.PersistenceParticipant>, которое сохраняет экземпляр запроса предложения в XML-файле.|  
|AsyncResult.cs / CompletedAsyncResult.cs|Вспомогательные классы для реализации асинхронной технологии в компонентах сохраняемости.|  
  
### <a name="common"></a>Общие  
 В следующей таблице содержится описание наиболее важных классов в проекте Common.  
  
|Класс|Описание|  
|-----------|-----------------|  
|Консоль|Поставщик, который передает предложения в запросе предложений.|  
|RequestForProposal|Запрос предложений представляет собой приглашение для поставщиков, согласно которому они должны передать предложения по конкретному товару или услуге.|  
|VendorProposal|Предложение, переданное поставщиком в ответ на конкретный запрос предложений.|  
|VendorRepository|Репозиторий поставщиков. Эта реализация содержит в оперативной памяти коллекцию экземпляров поставщиков и методов доступа к этим экземплярам.|  
|RfpRepository|Репозиторий запросов предложений. Эта реализация содержит примеры использования Linq to XML для запроса XML-файла запросов предложений, созданного схематизированными средствами обеспечения сохраняемости. |  
|IOHelper|Этот класс разрешает все проблемы, связанные с вводом-выводом (которые касаются папок, путей и т. д.).|  
  
### <a name="web-client"></a>Веб-клиент  
 В следующей таблице содержится описание наиболее важных веб-страниц в проекте веб-клиента.  
  
|File|Описание|  
|-|-|  
|CreateRfp.aspx|Создает и отправляет новый запрос предложений.|  
|Default.aspx|Показывает все активные и завершенные запросы предложений.|  
|GetVendorProposal.aspx|Возвращает предложение от поставщика в конкретном запросе предложений. Эта страница используется только поставщиками.|  
|ShowRfp.aspx|Выводит все сведения о запросе предложений (полученные предложения, даты, стоимость и другие данные). Эта страница используется только создателем запроса предложений.|  
  
### <a name="winforms-client"></a>Клиент WinForms  
 В следующей таблице содержится описание наиболее важных форм в проекте WinForms.  
  
|Form|Описание|  
|-|-|  
|NewRfp|Создает и отправляет новый запрос предложений.|  
|ShowProposals|Показывает все активные и завершенные запросы предложений. **Примечание.**  Может потребоваться нажать кнопку **Обновить** в пользовательском интерфейсе, чтобы увидеть изменения на этом экране после создания или изменения запроса предложения.|  
|SubmitProposal|Возвращает предложение от поставщика в конкретном запросе предложений. Это окно используется только поставщиками.|  
|ViewRfp|Выводит все сведения о запросе предложений (полученные предложения, даты, стоимость и другие данные). Это окно используется только создателем запроса предложений.|  
  
### <a name="persistence-files"></a>Файлы сохраняемости  
 В следующей таблице показаны файлы, созданные поставщиком сохраняемости (`XmlPersistenceProvider`), которые находятся в пути к временной папке текущей системы (использующей <xref:System.IO.Path.GetTempPath%2A>). Файл трассировки создается в текущем пути выполнения.  
  
|Имя файла|Описание|{2&gt;Path&lt;2}|  
|-|-|-|  
|rfps.xml|XML-файл со всеми активными и завершенными запросами предложений.|<xref:System.IO.Path.GetTempPath%2A>|  
|[instanceid]|Этот файл содержит все сведения об экземпляре рабочего процесса.<br /><br /> Этот файл создается схематизированной реализацией сохраняемости (PersistenceParticipant в XmlPersistenceProvider).|<xref:System.IO.Path.GetTempPath%2A>|  
|[instanceId].tracking|Текстовый файл со всеми событиями, которые произошли в конкретном экземпляре.<br /><br /> Этот файл создается объектом TrackingParticipant.|<xref:System.IO.Path.GetTempPath%2A>|  
|PurchaseProcess.Tracing.TraceLog.txt|Файл трассировки, созданный рабочим потоком на основе параметров конфигурации в файлах App.config или Web.config.|Текущий путь выполнения|  
  
#### <a name="to-use-this-sample"></a>Использование этого образца  
  
1. С помощью Visual Studio 2010 откройте файл решения Пурчасепроцесс. sln.  
  
2. Чтобы выполнить проект веб-клиента, откройте **Обозреватель решений** и щелкните правой кнопкой мыши проект **веб-клиента** . Выберите **Назначить запускаемым проектом**.  
  
3. Чтобы выполнить клиентский проект WinForms, откройте **Обозреватель решений** и щелкните правой кнопкой мыши **клиентский проект WinForms** . Выберите **Назначить запускаемым проектом**.  
  
4. Для построения решения нажмите CTRL+SHIFT+B.  
  
5. Чтобы запустить решение, нажмите клавиши CTRL+F5.  
  
### <a name="web-client-options"></a>Параметры веб-клиента  
  
- **Создание нового**запроса на выписку: создает новый запрос предложений (предложений) и запускает процесс покупки.  
  
- **Обновить**: обновляет список активных и завершенных РФПС в главном окне.  
  
- **Просмотр**: отображает содержимое существующего запроса предложений. Поставщики могут передавать свои предложения (если они приглашены или запрос предложений не завершен).  
  
- Просмотреть как: пользователь может получить доступ к запроса предложений с помощью других удостоверений, выбрав нужный участник в поле со списком **Просмотр как** в сетке Active РФПС.  
  
### <a name="winforms-client-options"></a>Параметры клиента WinForms  
  
- **Создание**запроса предложений: создает новый запрос предложений и запускает процесс покупки.  
  
- **Обновить**: обновляет список активных и завершенных РФПС в главном окне.  
  
- **Просмотр запроса предложений**. отображает содержимое существующего запроса предложений. Поставщики могут передавать свои предложения (если они приглашены или запрос предложений не завершен).  
  
- **Connect AS (подключиться как**). пользователь может получить доступ к результатам запроса, используя другие удостоверения, выбрав нужного участника в поле со списком **Просмотреть как** в сетке Active РФПС.
