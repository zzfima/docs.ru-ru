---
title: Управление приостановленным экземпляром
ms.date: 03/30/2017
ms.assetid: f5ca3faa-ba1f-4857-b92c-d927e4b29598
ms.openlocfilehash: 8e8bb40b22633aa83b7a70ee94f37cefe48ba68e
ms.sourcegitcommit: 3d5d33f384eeba41b2dff79d096f47ccc8d8f03d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/04/2018
ms.locfileid: "33519227"
---
# <a name="suspended-instance-management"></a>Управление приостановленным экземпляром
Этот образец демонстрирует управление экземплярами рабочего процесса, которые были приостановлены.  Действием по умолчанию для поведения <xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionBehavior> является `AbandonAndSuspend`. Это означает, что по умолчанию при появлении необработанных исключений, сформированных экземпляром рабочего процесса, который размещен на узле <xref:System.ServiceModel.WorkflowServiceHost>, экземпляр удаляется из памяти (отбрасывается) и устойчивая/сохраненная версия экземпляра отмечается как приостановленная. Приостановленный экземпляр рабочего процесса не будет в состоянии выполняться до отмены приостановки.  
  
 Этот образец показывает, как можно реализовать программу командной строки для выполнения запроса приостановленных экземпляров и как дать пользователю возможность возобновлять или завершать работу экземпляра. В этом образце служба рабочего процесса преднамеренно вызывает исключение, в результате чего она приостанавливается. Затем с помощью программы командной строки можно будет запросить экземпляр, а после этого возобновить или завершить его работу.  
  
## <a name="demonstrates"></a>Демонстрации  
 <xref:System.ServiceModel.WorkflowServiceHost> с <xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionBehavior> и <xref:System.ServiceModel.Activities.WorkflowControlEndpoint> в Windows Workflow Foundation (WF).  
  
## <a name="discussion"></a>Обсуждение  
 Программа командной строки, реализованная в этом образце, предназначена для работы с реализацией хранилища экземпляра SQL Server, который поставляется в [!INCLUDE[netfx_current_long](../../../../includes/netfx-current-long-md.md)]. Если имеется пользовательская реализация хранилища экземпляра, то можно приспособить и эту программу, заменяя в образце реализации `WorkflowInstanceCommand` реализациями, которые относятся к применяемому хранилищу экземпляра.  
  
 Команды SQL в предоставленной реализации запускаются непосредственно по отношению к хранилищу экземпляра SQL для формирования списка приостановленных экземпляров, а для возобновления или завершения работы экземпляров в ней используется конечная точка <xref:System.ServiceModel.Activities.WorkflowControlEndpoint>, добавленная к узлу <xref:System.ServiceModel.WorkflowServiceHost>.  
  
#### <a name="to-set-up-build-and-run-the-sample"></a>Настройка, сборка и выполнение образца  
  
1.  Для этого образца необходимо включить следующие компоненты Windows.  
  
    1.  Сервер очереди сообщений (Майкрософт) (MSMQ)  
  
    2.  SQL Server, экспресс-выпуск  
  
2.  Установка базы данных SQL Server.  
  
    1.  Из [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)] командной строки запустите команду «setup.cmd» из каталога образцов SuspendedInstanceManagement, которая выполняет следующее:  
  
        1.  Создает базу данных сохраняемости с использованием SQL Server Express. Если база данных сохраняемости уже существует, то она будет удалена и создана повторно.  
  
        2.  Настраивает базу данных с учетом требований сохраняемости.  
  
        3.  Добавляет IIS APPPOOL\DefaultAppPool and NT AUTHORITY\Network Service к роли InstanceStoreUsers, которая была определена при настройке базы данных для сохраняемости.  
  
3.  Настройка очереди обслуживания.  
  
    1.  В [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)], щелкните правой кнопкой мыши **SampleWorkflowApp** проекта и нажмите кнопку **Назначить запускаемым проектом**.  
  
    2.  Скомпилируйте и запустите образец SampleWorkflowApp, нажав клавишу **F5**. Будет создана требуемая очередь.  
  
    3.  Нажмите клавишу **ввод** остановить приложение SampleWorkflowApp.  
  
    4.  Откройте консоль «Управление компьютером», выполнив команду Compmgmt.msc из командной строки.  
  
    5.  Разверните **службы и приложения**, **очереди сообщений**, **частные очереди**.  
  
    6.  Щелкните правой кнопкой мыши **ReceiveTx** очередь, а затем выберите **свойства**.  
  
    7.  Выберите **безопасности** вкладку и разрешить **все** могут иметь разрешения на **получение сообщения**, **Просмотр сообщения**, и  **Отправить сообщение**.  
  
4.  После этого выполните образец.  
  
    1.  В [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)], снова запустите проект SampleWorkflowApp без отладки, нажав **Ctrl + F5**. В окне консоли будут выведены два адреса конечных точек: один для конечной точки приложения и еще один из <xref:System.ServiceModel.Activities.WorkflowControlEndpoint>. Затем будет создан экземпляр рабочего процесса и в окне консоли появятся записи отслеживания для этого экземпляра. Экземпляр рабочего процесса вызовет исключение, в результате чего работа экземпляра будет приостановлена и прервана.  
  
    2.  После этого с помощью программы командной строки можно будет выполнить дальнейшие действий с любым из этих экземпляров. Синтаксис аргументов командной строки:  
  
         `SuspendedInstanceManagement -Command:[CommandName] -Server:[ServerName] -Database:[DatabaseName] -InstanceId:[InstanceId]`  
  
         Поддерживаемые команды: `Query`, `Resume` и `Terminate`.  Параметр InstanceId требуется только для операций `Resume` и `Terminate`.  
  
#### <a name="to-cleanup-optional"></a>Очистка (необязательно)  
  
1.  Откройте консоль управления компьютером, запустив команду Compmgmt.msc в командной строке `vs2010`.  
  
2.  Разверните **службы и приложения**, **очереди сообщений**, **частные очереди**.  
  
3.  Удалить **ReceiveTx** очереди.  
  
4.  Для удаления базы данных сохраняемости выполните команду cleanup.cmd.  
  
> [!IMPORTANT]
>  Образцы уже могут быть установлены на компьютере. Перед продолжением проверьте следующий каталог (по умолчанию).  
>   
>  `<InstallDrive>:\WF_WCF_Samples`  
>   
>  Если этот каталог не существует, перейдите к [Windows Communication Foundation (WCF) и образцы Windows Workflow Foundation (WF) для .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) для загрузки всех Windows Communication Foundation (WCF) и [!INCLUDE[wf1](../../../../includes/wf1-md.md)] образцов. Этот образец расположен в следующем каталоге.  
>   
>  `<InstallDrive>:\WF_WCF_Samples\WF\Application\SuspendedInstanceManagement`
