---
title: Помощник по отладке управляемого кода invalidCERCall
ms.date: 03/30/2017
helpviewer_keywords:
- invalid CER calls
- InvalidCERCall MDA
- MDAs (managed debugging assistants), CER calls
- constrained execution regions
- CER calls
- managed debugging assistants (MDAs), CER calls
ms.assetid: c4577410-602e-44e5-9dab-fea7c55bcdfe
ms.openlocfilehash: f8e467401f7c50898613c7cf6eca68a8a705431a
ms.sourcegitcommit: 9c54866bcbdc49dbb981dd55be9bbd0443837aa2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/14/2020
ms.locfileid: "77217384"
---
# <a name="invalidcercall-mda"></a><span data-ttu-id="e09a5-102">Помощник по отладке управляемого кода invalidCERCall</span><span class="sxs-lookup"><span data-stu-id="e09a5-102">invalidCERCall MDA</span></span>
<span data-ttu-id="e09a5-103">Помощник по отладке управляемого кода (MDA) `invalidCERCall` активируется при осуществляемом в графе области ограниченного исполнения (CER) вызове метода, не имеющего контракта надежности или имеющего чрезвычайно слабый контракт.</span><span class="sxs-lookup"><span data-stu-id="e09a5-103">The `invalidCERCall` managed debugging assistant (MDA) is activated when there is a call within the constrained execution region (CER) graph to a method that has no reliability contract or an excessively weak contract.</span></span> <span data-ttu-id="e09a5-104">Слабый контракт представляет собой контракт, который объявляет, что максимальное повреждение состояния имеет большую область, чем экземпляр, переданный в вызов, то есть <xref:System.AppDomain> или состояние процесса может быть повреждено или его результат не всегда является детерминированно вычисляемым при вызове в рамках CER.</span><span class="sxs-lookup"><span data-stu-id="e09a5-104">A weak contract is a contract that declares that the worst case state corruption is of greater scope than the instance passed to the call, that is, the <xref:System.AppDomain> or process state may become corrupted or that its result is not always deterministically computable when called within a CER.</span></span>  
  
## <a name="symptoms"></a><span data-ttu-id="e09a5-105">Симптомы</span><span class="sxs-lookup"><span data-stu-id="e09a5-105">Symptoms</span></span>  
 <span data-ttu-id="e09a5-106">Неожиданные результаты при выполнении кода в CER.</span><span class="sxs-lookup"><span data-stu-id="e09a5-106">Unexpected results when executing code in a CER.</span></span> <span data-ttu-id="e09a5-107">Признаки не являются специфическими.</span><span class="sxs-lookup"><span data-stu-id="e09a5-107">The symptoms are not specific.</span></span> <span data-ttu-id="e09a5-108">Это могут быть непредвиденные <xref:System.OutOfMemoryException>, <xref:System.Threading.ThreadAbortException> или другие исключения при вызове ненадежного метода, так как среда выполнения не подготовила его заранее или не защитила его от исключений <xref:System.Threading.ThreadAbortException> во время выполнения.</span><span class="sxs-lookup"><span data-stu-id="e09a5-108">They could be an unexpected <xref:System.OutOfMemoryException>, a <xref:System.Threading.ThreadAbortException>, or other exceptions at the call into the unreliable method because the runtime did not prepare it ahead of time or protect it from <xref:System.Threading.ThreadAbortException> exceptions at run time.</span></span> <span data-ttu-id="e09a5-109">Гораздо более серьезной угрозой является то, что любое исключение, возникающие в методе во время выполнения, может оставить <xref:System.AppDomain> или процесс в нестабильном состоянии, что противоречит цели CER.</span><span class="sxs-lookup"><span data-stu-id="e09a5-109">A greater threat is that any exception resulting from the method at run time could leave the <xref:System.AppDomain> or process in an unstable state, which is contrary to the objective of a CER.</span></span> <span data-ttu-id="e09a5-110">Причина, по которой создается CER, — необходимость избегать подобных повреждений состояния.</span><span class="sxs-lookup"><span data-stu-id="e09a5-110">The reason a CER is created is to avoid state corruptions such as this.</span></span> <span data-ttu-id="e09a5-111">Признаки поврежденного состояния связаны с конкретным приложением из-за различий определения согласованного состояния между приложениями.</span><span class="sxs-lookup"><span data-stu-id="e09a5-111">The symptoms of corrupt state are application specific because the definition of consistent state is different between applications.</span></span>  
  
## <a name="cause"></a><span data-ttu-id="e09a5-112">Причина</span><span class="sxs-lookup"><span data-stu-id="e09a5-112">Cause</span></span>  
 <span data-ttu-id="e09a5-113">Код внутри CER вызывает функцию без <xref:System.Runtime.ConstrainedExecution.ReliabilityContractAttribute> или со слабым <xref:System.Runtime.ConstrainedExecution.ReliabilityContractAttribute>, который несовместим с работающими в CER.</span><span class="sxs-lookup"><span data-stu-id="e09a5-113">Code within a CER is calling a function with no <xref:System.Runtime.ConstrainedExecution.ReliabilityContractAttribute> or with a weak <xref:System.Runtime.ConstrainedExecution.ReliabilityContractAttribute> that is not compatible with running in a CER.</span></span>  
  
 <span data-ttu-id="e09a5-114">С точки зрения синтаксиса контракта надежности, слабый контракт — это контракт, который не указывает значение перечисления <xref:System.Runtime.ConstrainedExecution.Consistency> или указывает значение <xref:System.Runtime.ConstrainedExecution.Consistency> для <xref:System.Runtime.ConstrainedExecution.Consistency.MayCorruptProcess>, <xref:System.Runtime.ConstrainedExecution.Consistency.MayCorruptAppDomain> или <xref:System.Runtime.ConstrainedExecution.Cer.None>.</span><span class="sxs-lookup"><span data-stu-id="e09a5-114">In terms of reliability contract syntax, a weak contract is a contract that does not specify a <xref:System.Runtime.ConstrainedExecution.Consistency> enumeration value or specifies a <xref:System.Runtime.ConstrainedExecution.Consistency> value of <xref:System.Runtime.ConstrainedExecution.Consistency.MayCorruptProcess>, <xref:System.Runtime.ConstrainedExecution.Consistency.MayCorruptAppDomain>, or <xref:System.Runtime.ConstrainedExecution.Cer.None>.</span></span> <span data-ttu-id="e09a5-115">Любое из этих условий означает, что вызываемый код может отрицательно повлиять на попытки другого кода в CER поддерживать согласованное состояние.</span><span class="sxs-lookup"><span data-stu-id="e09a5-115">Any of these conditions indicates that the code called may impede the efforts of the other code in the CER to maintain consistent state.</span></span>  <span data-ttu-id="e09a5-116">Области CER позволяют коду обрабатывать ошибки детерминированным образом, сохраняя внутренние инварианты, которые важны для приложения, и позволяя ему продолжать выполнение в условиях возникновения временных ошибок, таких как исключения нехватки памяти.</span><span class="sxs-lookup"><span data-stu-id="e09a5-116">CERs allow code to treat errors in a very deterministic manner, maintaining internal invariants that are important to the application and allowing it to continue running in the face of transient errors such as out-of-memory exceptions.</span></span>  
  
 <span data-ttu-id="e09a5-117">Активация данного MDA указывает на возможность сбоя вызова метода в CER неожиданным для вызывающего объекта образом или таким образом, что происходит повреждение или неустранимая ошибка <xref:System.AppDomain> или состояния процесса.</span><span class="sxs-lookup"><span data-stu-id="e09a5-117">The activation of this MDA indicates a possibility the method being called in the CER can fail in a way that the caller did not expect or that leaves the <xref:System.AppDomain> or process state corrupted or unrecoverable.</span></span> <span data-ttu-id="e09a5-118">Конечно, вызываемый код может выполняться правильно, а проблема заключается просто в отсутствии контракта.</span><span class="sxs-lookup"><span data-stu-id="e09a5-118">Of course, the called code might execute correctly and the problem is simply a missing contract.</span></span> <span data-ttu-id="e09a5-119">Однако проблемы, связанные с написанием надежного кода, несущественны, и отсутствие контракта является хорошим показателем вероятности неправильного выполнения кода.</span><span class="sxs-lookup"><span data-stu-id="e09a5-119">However, the issues involved in writing reliable code are subtle and the absence of a contract is a good indicator the code might not execute correctly.</span></span> <span data-ttu-id="e09a5-120">Контракты — это показатели написания надежного кода, а также гарантия сохранения этой надежности при будущих правках кода.</span><span class="sxs-lookup"><span data-stu-id="e09a5-120">The contracts are indicators that the programmer has coded reliably and also promises that these guarantees will not change in future revisions of the code.</span></span>  <span data-ttu-id="e09a5-121">Иными словами, контракты являются заявлениями о намерениях, а не только выражают детали реализации.</span><span class="sxs-lookup"><span data-stu-id="e09a5-121">That is, the contracts are declarations of intent and not just implementation details.</span></span>  
  
 <span data-ttu-id="e09a5-122">Поскольку любой метод со слабым или несуществующим контрактом может привести к сбою целым рядом неожиданных способов, среда выполнения не пытается удалить собственные непредсказуемые сбои из метода, представленные, например, отложенной JIT-компиляцией, заполнением словаря универсальных типов или прерываниями потоков.</span><span class="sxs-lookup"><span data-stu-id="e09a5-122">Because any method with a weak or nonexistent contract can potentially fail in many unpredictable ways, the runtime does not attempt to remove any of its own unpredictable failures from the method  that are introduced by lazy JIT-compiling, generics dictionary population, or thread aborts, for example.</span></span> <span data-ttu-id="e09a5-123">То есть когда данный MDA активируется, он указывает, что среда выполнения не включила вызываемый метода в определенную область CER. Граф вызовов был прерван на этом узле, поскольку дальнейшая подготовка этого поддерева поможет скрыть потенциальную ошибку.</span><span class="sxs-lookup"><span data-stu-id="e09a5-123">That is, when this MDA is activated, it indicates that the runtime did not include the called method in the CER being defined; the call graph was terminated at this node because continuing to prepare this subtree would help mask the potential error.</span></span>  
  
## <a name="resolution"></a><span data-ttu-id="e09a5-124">Решение</span><span class="sxs-lookup"><span data-stu-id="e09a5-124">Resolution</span></span>  
 <span data-ttu-id="e09a5-125">Добавьте в функцию допустимый контракт надежности или избегайте использовать этот вызов функции.</span><span class="sxs-lookup"><span data-stu-id="e09a5-125">Add a valid reliability contract to the function or avoid using that function call.</span></span>  
  
## <a name="effect-on-the-runtime"></a><span data-ttu-id="e09a5-126">Влияние на среду выполнения</span><span class="sxs-lookup"><span data-stu-id="e09a5-126">Effect on the Runtime</span></span>  
 <span data-ttu-id="e09a5-127">В результате вызова слабого контракта из CER может произойти сбой при завершении работы.</span><span class="sxs-lookup"><span data-stu-id="e09a5-127">The effect of calling a weak contract from a CER could be the CER failure to complete its operations.</span></span> <span data-ttu-id="e09a5-128">Это может привести к повреждению состояния процесса <xref:System.AppDomain>.</span><span class="sxs-lookup"><span data-stu-id="e09a5-128">This could lead to corruption of the <xref:System.AppDomain> process state.</span></span>  
  
## <a name="output"></a><span data-ttu-id="e09a5-129">Вывод</span><span class="sxs-lookup"><span data-stu-id="e09a5-129">Output</span></span>  
 <span data-ttu-id="e09a5-130">Ниже представлен пример выходных данных этого MDA.</span><span class="sxs-lookup"><span data-stu-id="e09a5-130">The following is sample output from this MDA.</span></span>  
  
 `Method 'MethodWithCer', while executing within a constrained execution region, makes a call at IL offset 0x000C to 'MethodWithWeakContract', which does not have a sufficiently strong reliability contract and might cause non-deterministic results.`  
  
## <a name="configuration"></a><span data-ttu-id="e09a5-131">Конфигурация</span><span class="sxs-lookup"><span data-stu-id="e09a5-131">Configuration</span></span>  
  
```xml  
<mdaConfig>  
  <assistants>  
    <invalidCERCall />  
  </assistants>  
</mdaConfig>  
```  
  
## <a name="see-also"></a><span data-ttu-id="e09a5-132">См. также:</span><span class="sxs-lookup"><span data-stu-id="e09a5-132">See also</span></span>

- <xref:System.Runtime.CompilerServices.RuntimeHelpers.PrepareMethod%2A>
- <xref:System.Runtime.ConstrainedExecution>
- [<span data-ttu-id="e09a5-133">Диагностика ошибок посредством помощников по отладке управляемого кода</span><span class="sxs-lookup"><span data-stu-id="e09a5-133">Diagnosing Errors with Managed Debugging Assistants</span></span>](diagnosing-errors-with-managed-debugging-assistants.md)
