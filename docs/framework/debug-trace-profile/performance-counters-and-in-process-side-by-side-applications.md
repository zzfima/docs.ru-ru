---
title: "Счетчики производительности и внутрипроцессные параллельные приложения"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology:
- dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
dev_langs:
- VB
- CSharp
- C++
- jsharp
helpviewer_keywords:
- performance counters
- performance counters,and in-process side-by-side applications
- performance,.NET Framework applications
- performance monitoring,counters
ms.assetid: 6888f9be-c65b-4b03-a07b-df7ebdee2436
caps.latest.revision: 26
author: rpetrusha
ms.author: ronpet
manager: wpickett
ms.translationtype: HT
ms.sourcegitcommit: 306c608dc7f97594ef6f72ae0f5aaba596c936e1
ms.openlocfilehash: 713aa3a870c42014de01d6782d7452ab60792cc4
ms.contentlocale: ru-ru
ms.lasthandoff: 08/21/2017

---
# <a name="performance-counters-and-in-process-side-by-side-applications"></a>Счетчики производительности и внутрипроцессные параллельные приложения
С помощью системного монитора (Perfmon.exe) можно различать счетчики производительности на основе среды выполнения. В этом разделе описываются изменения в реестре, необходимые для включения этой функции.  
  
## <a name="the-default-behavior"></a>Поведение по умолчанию  
 По умолчанию системный монитор отображает счетчики производительности по приложениям. Тем не менее в двух случаях это может быть сопряжено с проблемами:  
  
-   Отслеживание двух приложений с одинаковыми именами. Например, если оба приложения называются myapp.exe, они будут отображаться соответственно как **myapp** и **myapp#1** в столбце **Экземпляр**. В этом случае сложно сопоставить счетчик производительности с конкретным приложением. При этом неочевидно, относятся ли данные для **myapp#1** к первому или второму приложению myapp.exe.  
  
-   Приложение, использующее несколько экземпляров общеязыковой среды выполнения. [!INCLUDE[net_v40_long](../../../includes/net-v40-long-md.md)] поддерживает сценарии внутрипроцессного параллельного размещения. Это значит, что отдельные процесс или приложение могут загружать несколько экземпляров общеязыковой среды выполнения. Если одно приложение с именем myapp.exe загружает два экземпляра среды выполнения, по умолчанию они будут обозначены в столбце **Экземпляр** как **myapp** и **myapp#1**. В этом случае также неясно, относятся ли **myapp** и **myapp#1** к двум одноименным приложениям или к одному приложению с двумя средами выполнения. Если несколько приложений загружают несколько сред выполнения, степень неоднозначности только возрастает.  
  
 Чтобы устранить подобное состояние, можно настроить соответствующий раздел реестра. Для приложений, разработанных с помощью [!INCLUDE[net_v40_short](../../../includes/net-v40-short-md.md)], в результате этого изменения реестра в столбец **Экземпляр** добавляется идентификатор процесса, после которого указывается идентификатор экземпляра среды выполнения для имени приложения. Так, вместо *приложение* или *приложение*#1 приложение теперь будет идентифицироваться как *приложение*_`p`*ИД_процесса*\_`r`*ИД_среды_выполнения* в столбце **Экземпляр**. Если приложение было разработано с использованием предыдущей версии среды CLR, этот экземпляр отображается как *приложение\_*`p`*ИД_процесса* при условии, что установлена платформа [!INCLUDE[net_v40_short](../../../includes/net-v40-short-md.md)].  
  
## <a name="performance-counters-for-in-process-side-by-side-applications"></a>Счетчики производительности для внутрипроцессных параллельных приложений  
 Чтобы использовать счетчики производительности для нескольких версий общеязыковой среды выполнения, размещаемых в одном приложении, необходимо изменить один параметр раздела реестра, как показано в следующей таблице.  
  
|||  
|-|-|  
|Имя раздела|HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\\.NETFramework\Performance|  
|Имя значения|ProcessNameFormat|  
|Тип значения|REG_DWORD|  
|Значение|1 (0x00000001)|  
  
 Значение 0 для параметра `ProcessNameFormat` активирует поведение по умолчанию, при котором Perfmon.exe отображает счетчики производительности на основе приложений. Если это значение равно 1, Perfmon.exe проводит различия между несколькими версиями приложения и предоставляет счетчики производительности на основе среды выполнения. Любые другие значения параметра раздела реестра `ProcessNameFormat` не поддерживаются и зарезервированы для будущего использования.  
  
 Для корректной работы функции именования экземпляров после обновления параметра раздела реестра `ProcessNameFormat` необходимо перезапустить Perfmon.exe или любые другие компоненты, использующие счетчики производительности.  
  
 В следующем примере показано изменение значения `ProcessNameFormat` программным способом.  
  
 [!code-csharp[Conceptual.PerfCounters.InProSxS#1](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.perfcounters.inprosxs/cs/regsetting1.cs#1)] [!code-vb[Conceptual.PerfCounters.InProSxS#1](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.perfcounters.inprosxs/vb/regsetting1.vb#1)]  
  
 При внесении этого изменения в реестр программа Perfmon.exe отображает имена приложений, предназначенных для [!INCLUDE[net_v40_short](../../../includes/net-v40-short-md.md)], как *приложение*_`p`*ИД_процесса*\_`r`*ИД_среды_выполнения*, где *приложение* — это имя приложения, *ИД_процесса* — идентификатор процесса, а *ИД_среды_выполнения* — идентификатор общеязыковой среды выполнения. Например, если приложение myapp.exe загружает два экземпляра общеязыковой среды выполнения, программа Perfmon.exe может идентифицировать их как myapp_p1416_r10 и myapp_p3160_r10 соответственно. Идентификатор среды выполнения может использоваться только для различения сред выполнения в рамках процесса и не предоставляет какой-либо другой информации о среде выполнения. (Например, идентификатор среды выполнения не связан с ее версией или номером SKU.)  
  
 Если установлена платформа [!INCLUDE[net_v40_short](../../../includes/net-v40-short-md.md)], это изменение в реестре также будет влиять на приложения, которые были разработаны с использованием более ранних версий .NET Framework. Они отображаются в программе Perfmon.exe как *приложение_*`p`*ИД_процесса*, где *приложение* — это имя приложения, а *ИД_процесса* — идентификатор процесса. Например, при отслеживании счетчиков производительности для двух приложений с именем myapp.exe одно из них может отображаться как myapp_p23900, а другое — как myapp_p24908.  
  
> [!NOTE]
>  Идентификатор процесса позволяет устранить неоднозначность при идентификации двух приложений с одинаковыми именами, использующих более ранние версии среды выполнения. Идентификатор среды выполнения для более ранних версий общеязыковой среды выполнения не нужен, поскольку в них не поддерживаются сценарии параллельного размещения.  
  
 Если платформа [!INCLUDE[net_v40_short](../../../includes/net-v40-short-md.md)] отсутствует или не была установлена, этот параметр раздела реестра не учитывается. Это означает, что два приложения с одинаковым именем будут по-прежнему отображаться в программе Perfmon.exe как *приложение* и *приложение#1* (например, **myapp** и **myapp#1**).

