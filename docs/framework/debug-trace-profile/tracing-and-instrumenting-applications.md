---
title: Трассировка и инструментирование приложений
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- tracing [.NET Framework]
- debugging [.NET Framework], instrumentation
- performance monitoring, instrumentation
- instrumentation, about instrumentation
- tracing [.NET Framework], about tracing
- performance monitoring, tracing code
- Trace class, instrumentation for .NET applications
ms.assetid: 773b6fc4-9013-4322-b728-5dec7a72e743
ms.openlocfilehash: 1dd7317e38b6bee44dda75319c9f7c2a6567e3b4
ms.sourcegitcommit: 9c54866bcbdc49dbb981dd55be9bbd0443837aa2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/14/2020
ms.locfileid: "77216043"
---
# <a name="tracing-and-instrumenting-applications"></a>Трассировка и инструментирование приложений
Трассировка — это мониторинг выполнения запущенного приложения. Вы можете добавить инструментирование трассировки и отладки в свое приложения .NET Framework при его разработке; кроме того, вы можете использовать это инструментирование при разработке приложения и после его развертывания. С помощью классов <xref:System.Diagnostics.Trace?displayProperty=nameWithType>, <xref:System.Diagnostics.Debug?displayProperty=nameWithType> и <xref:System.Diagnostics.TraceSource?displayProperty=nameWithType> можно записывать сведения об ошибках и выполнении приложения в журналы, текстовые файлы или на другие устройства для последующего анализа.  
  
 Термин *инструментирование* относится к возможности мониторинга и измерения уровня производительности продукта и диагностики ошибок. В программировании это означает способность приложения включать следующие возможности.  
  
- **Трассировка кода** — получение информационных сообщений о работе приложения во время выполнения.  
  
- **Отладка** — отслеживание и устранение ошибок программирования в приложении при разработке. Дополнительные сведения см. в разделе [Отладка](/visualstudio/debugger/debugger-feature-tour).  
  
- **Счетчики производительности** — компоненты, позволяющие отслеживать производительность приложения. Дополнительные сведения см. в статье [Performance Counters](performance-counters.md).  
  
- **Журналы событий** — компоненты, позволяющие получать и отслеживать основные события при выполнении приложения. Дополнительную информацию смотрите в классе <xref:System.Diagnostics.EventLog>.  
  
 Инструментирование приложения путем добавления операторов трассировки в стратегически важных местах кода особенно полезно для распределенных приложений. С помощью операторов трассировки можно инструментировать приложение не только для отображения сведений о неправильных моментах, но также отслеживать, насколько хорошо работает приложение.  
  
 Класс <xref:System.Diagnostics.TraceSource> предоставляет улучшенные функции трассировки и может использоваться вместо статических методов более старых классов трассировки <xref:System.Diagnostics.Trace> и <xref:System.Diagnostics.Debug>. Знакомые классы <xref:System.Diagnostics.Trace> и <xref:System.Diagnostics.Debug> по-прежнему широко используются, однако рекомендуется использовать класс <xref:System.Diagnostics.TraceSource> для новых команд трассировки, таких как <xref:System.Diagnostics.TraceSource.TraceEvent%2A> и <xref:System.Diagnostics.TraceSource.TraceData%2A>.  
  
 Классы <xref:System.Diagnostics.Trace> и <xref:System.Diagnostics.Debug> идентичны, за исключением того, что процедуры и функции класса <xref:System.Diagnostics.Trace> по умолчанию компилируются в сборки выпуска, а процедуры и функции класса <xref:System.Diagnostics.Debug> — нет.  
  
 Классы <xref:System.Diagnostics.Trace> и <xref:System.Diagnostics.Debug> предоставляют средства для мониторинга и исследования производительности приложения как во время разработки, так и после развертывания. Например, возможно использование класса <xref:System.Diagnostics.Trace> для отслеживания в развернутом приложении отдельных типов действий по мере их выполнения (например, создание новых подключений к базе данных) и последующего мониторинга производительности приложения.  
  
## <a name="code-tracing-and-debugging"></a>Отладка и трассировка кода  
 Использование методов вывода класса <xref:System.Diagnostics.Debug> при разработке приложения позволяет отображать сообщения в окне вывода, доступном в интегрированной среде разработки Visual Studio. Например:  
  
```vb  
Trace.WriteLine("Hello World!")  
Debug.WriteLine("Hello World!")  
```  
  
```csharp  
System.Diagnostics.Trace.WriteLine("Hello World!");  
System.Diagnostics.Debug.WriteLine("Hello World!");  
```  
  
 В каждом из этих примеров в окне вывода будет отображаться сообщение "Hello World!" при запуске приложения в отладчике.  
  
 Это позволяет отлаживать приложения и оптимизировать их производительность на основе их поведения в среде тестирования. Возможна отладка приложения при отладочном построении с включенным условным атрибутом <xref:System.Diagnostics.Debug>, что позволяет получать все выходные данные отладки. Когда приложение будет готово к выпуску, можно скомпилировать построение выпуска, не включая условный атрибут <xref:System.Diagnostics.Debug>, чтобы код отладки не включался компилятором в конечный исполняемый файл. Дополнительные сведения см. в разделе [Практическое руководство. Условная компиляция с использованием атрибутов Trace и Debug](how-to-compile-conditionally-with-trace-and-debug.md). Дополнительные сведения о различных конфигурациях сборок для приложения см. в разделе [Компиляция и сборка](/visualstudio/ide/compiling-and-building-in-visual-studio).  
  
 С помощью методов класса <xref:System.Diagnostics.Trace> можно отслеживать выполнение кода в установленном приложении. Процессом и масштабом трассировки можно управлять. Для этого добавьте в код [переключатели трассировки](trace-switches.md). Так вы сможете отслеживать состояние приложения в рабочей среде. Это особенно важно в бизнес-приложениях, которые используют различные компоненты, выполняющиеся на нескольких компьютерах. Вы можете управлять порядком использования переключателей после развертывания с помощью файла конфигурации. Дополнительные сведения см. в разделе [Практическое руководство. Создание, инициализация и настройка переключателей трассировки](how-to-create-initialize-and-configure-trace-switches.md).  
  
 При разработке приложения, для которого предполагается использовать трассировку, в код приложения обычно включают сообщения трассировки и отладки. Когда все будет готово для развертывания приложения, можно скомпилировать сборку выпуска без включения условного атрибута **Debug**. Тем не менее можно включить условный атрибут **Trace**, чтобы компилятор включил код трассировки в исполняемый файл. Дополнительные сведения см. в разделе [Практическое руководство. Условная компиляция с использованием атрибутов Trace и Debug](how-to-compile-conditionally-with-trace-and-debug.md).  
  
### <a name="phases-of-code-tracing"></a>Этапы трассировки кода  
 Существует три этапа трассировки кода.  
  
1. **Инструментирование** — добавление кода трассировки в приложение.  
  
2. **Трассировка** — код трассировки записывает сведения в указанный целевой объект.  
  
3. **Анализ** — оценка сведений трассировки для определения и понимания проблем в приложении.  
  
 Во время разработки все методы вывода трассировки и отладки записывают сведения в окне вывода Visual Studio по умолчанию. В развернутом приложении эти методы записывают сведения трассировки в указанные целевые объекты. Дополнительные сведения об указании целевого объекта выходных данных трассировки и отладки см. в разделе [Прослушиватели трассировки](trace-listeners.md).  
  
 Ниже приведен полный обзор основных шагов, обычно выполняемых при использовании трассировки для анализа и исправления возможных проблем в развертываемом приложении. Дополнительные сведения о выполнении этих шагов см. по соответствующей ссылке.  
  
##### <a name="to-use-tracing-in-an-application"></a>Использование трассировки в приложении  
  
1. Обдумайте, какие выходные данные трассировки вы хотите получить на месте после развертывания приложения.  
  
2. Создайте набора переключателей. Дополнительные сведения см. в статье [How to: Configure Trace Switches](how-to-create-initialize-and-configure-trace-switches.md) (Настройка переключателей трассировки).  
  
3. Добавьте операторы трассировки в код приложения.  
  
4. Определите, где вы хотите получать выходные данные трассировки, и добавьте соответствующие прослушиватели. Дополнительные сведения см. в разделе [Создание и инициализация прослушивателей трассировки](how-to-create-and-initialize-trace-listeners.md).  
  
5. Выполните тестирование и отладку своего приложения и содержащегося в нем кода трассировки.  
  
6. Скомпилируйте приложение в исполняемый код с помощью одной из следующих процедур.  
  
    - Используйте меню **Сборка** со страницей **Отладка** диалогового окна **Страницы свойств** в **обозревателе решений**. Используйте эту процедуру при компиляции в Visual Studio.  
  
         \- или -  
  
    - Используйте директивы компилятора **Trace** и **Debug** для компиляции из командной строки. Дополнительные сведения см. в разделе [Условная компиляция с использованием атрибутов Trace и Debug](how-to-compile-conditionally-with-trace-and-debug.md). Используйте эту процедуру при компиляции из командной строки.  
  
7. Если во время выполнения возникает проблема, включите соответствующий переключатель трассировки. Дополнительные сведения см. в разделе [Настройка переключателей трассировки](how-to-create-initialize-and-configure-trace-switches.md).  
  
     Код трассировки записывает сообщения трассировки в указанный целевой объект, например в экран, текстовый файл или журнал событий. Тип прослушивателя, включенного в коллекцию **Trace.Listeners**, определяет целевой объект.  
  
8. Проанализируйте сообщения трассировки, чтобы обнаружить и понять проблемы в приложении.  
  
## <a name="trace-instrumentation-and-distributed-applications"></a>Инструментирование трассировки и распределенные приложения  
 При создании распределенного приложения тестирование приложения способом, которым оно будет использоваться, может показаться сложной задачей. Немногие группы разработчиков имеют возможность протестировать все возможные сочетания операционных систем или веб-браузеров (в том числе все параметры локализованных версий) или смоделировать большое число пользователей, которые будут обращаться к приложению одновременно. В таких обстоятельствах невозможно протестировать реакцию распределенного приложения на большую нагрузку, различные настройки и разные действия конечных пользователей. Кроме того, многие компоненты распределенного приложения не имеют пользовательского интерфейса, с которым можно взаимодействовать напрямую или просматривать активность этих компонентов.  
  
 Однако вы можете компенсировать это, позволив распределенным приложениям описывать определенные события, интересующие системных администраторов, особенно то, что работает неправильно, путем *инструментирования* приложения, то есть путем размещения операторов трассировки в стратегически важных местах кода. Затем, если во время выполнения произойдет что-либо неожиданное (например, слишком большое время отклика), можно будет определить вероятную причину.  
  
 Операторы трассировки помогают избежать сложностей проверки исходного кода, его изменения, перекомпиляции, а также попыток воспроизвести ошибку времени выполнения в среде отладки. Помните, что можно инструментировать приложение не только для отображения ошибок, но также для наблюдения за производительностью.  
  
## <a name="strategic-placement-of-trace-statements"></a>Стратегическое размещение операторов трассировки  
 Необходимо уделить особое внимание при добавлении инструкций trace, которые будут использованы во время выполнения. Необходимо учитывать, какие данные трассировки потребуются в развернутом приложении, чтобы охватить все вероятные сценарии трассировки. Поскольку очень широкий круг приложений может использовать трассировку, общих рекомендаций для стратегического размещения трассировки не существует. Дополнительные сведения о размещении операторов трассировки см. в разделе [Практическое руководство. Добавление операторов трассировки в код приложения](how-to-add-trace-statements-to-application-code.md).  
  
## <a name="output-from-tracing"></a>Выходные данные трассировки  
 Выходные данные трассировки собираются объектами, которые называются *прослушивателями*. Прослушиватель — это объект, который принимает выходные данные трассировки и записывает их в устройство вывода (обычно это окно, журнал или текстовый файл). При создании прослушиватель трассировки, как правило, добавляется к коллекции <xref:System.Diagnostics.Trace.Listeners%2A?displayProperty=nameWithType>, что позволяет ему получать все выходные данные трассировки.  
  
 Сведения трассировки всегда записываются как минимум в целевой объект вывода <xref:System.Diagnostics.Trace> по умолчанию, <xref:System.Diagnostics.DefaultTraceListener>. Если по каким-то причинам объект <xref:System.Diagnostics.DefaultTraceListener> был удален, а другие прослушиватели не были добавлены в коллекцию <xref:System.Diagnostics.Trace.Listeners%2A>, сообщения трассировки получены не будут. Дополнительные сведения см. в разделе [Прослушиватели трассировки](trace-listeners.md).  
  
 В следующей таблице перечислены шесть членов класса <xref:System.Diagnostics.Debug> и методов класса <xref:System.Diagnostics.Trace>, которые записывают сведения трассировки.  
  
|Метод|Вывод|  
|------------|------------|  
|**Assert**|Указанный текст; если ничего не указано, то стек вызовов. Выходные данные записываются, только если условие, заданное в качестве аргумента оператора **Assert** , имеет значение **false**.|  
|**Не пройден**|Указанный текст; если ничего не указано, то стек вызовов.|  
|**запись**|Указанный текст.|  
|**WriteIf**|Указанный текст, если условие, заданное в качестве аргумента в операторе **WriteIf**, удовлетворяется.|  
|**WriteLine**|Заданный текст и возврат каретки.|  
|**WriteLineIf**|Указанный текст, если условие, заданное в качестве аргумента в операторе **WriteLineIf**, удовлетворяется.|  
  
 Все прослушиватели в коллекции <xref:System.Diagnostics.Trace.Listeners%2A> получают сообщения, описанные в приведенной выше таблице, но предпринимаемые ими действия зависят от вида прослушивателя, получившего сообщения. Например, прослушиватель <xref:System.Diagnostics.DefaultTraceListener> открывает диалоговое окно подтверждения при получении уведомления **Fail** или уведомления о сбое оператора **Assert**, а прослушиватель <xref:System.Diagnostics.TextWriterTraceListener> просто записывает выходные данные в свой поток.  
  
 Можно создавать пользовательские результаты путем реализации собственного прослушивателя. Пользовательский прослушиватель трассировки может, например, отображать сообщения в окне сообщения или подключаться к базе данных для добавления сообщений в таблицу. Все пользовательские прослушиватели должны поддерживать шесть вышеупомянутых методов. Дополнительные сведения о создании прослушивателей, определяемых разработчиками, см. в описании <xref:System.Diagnostics.TraceListener> в справочнике по .NET Framework.  
  
 Методы **Write** и **WriteLine** всегда записывают указанный текст. Методам **Assert**, **WriteIf** и **WriteLineIf** требуется логический аргумент, управляющий записью заданного текста. Заданный текст записывается этими методами только в том случае, если выражение имеет значение **true** (для методов **WriteIf** и **WriteLineIf**) или **false** (для метода **Assert**). Метод **Fail** всегда записывает указанный текст. Дополнительные сведения см. в разделе [Практическое руководство. Добавление операторов трассировки в код приложения](how-to-add-trace-statements-to-application-code.md) и в справочнике по .NET Framework.  
  
## <a name="security-concerns"></a>Проблемы безопасности  
 Если не отключить трассировку и отладку перед развертыванием приложения ASP.NET, то приложение может отображать сведения о себе, которые могут использоваться вредоносными программами. Дополнительные сведения см. в разделах [Практическое руководство. Условная компиляция с использованием атрибутов Trace и Debug](how-to-compile-conditionally-with-trace-and-debug.md), [Компиляция и сборка](/visualstudio/ide/compiling-and-building-in-visual-studio) и [Практическое руководство. Создание, инициализация и настройка переключателей трассировки](how-to-create-initialize-and-configure-trace-switches.md). Отладка также настраивается через службы IIS.  
  
## <a name="see-also"></a>См. также:

- <xref:System.Diagnostics.Trace>
- <xref:System.Diagnostics.TraceSource>
- [Контракты для кода](code-contracts.md)
- [Типы проектов C#, F# и Visual Basic](/visualstudio/debugger/debugging-preparation-csharp-f-hash-and-visual-basic-project-types)
- [Практическое руководство. Добавление операторов трассировки в код приложения](how-to-add-trace-statements-to-application-code.md)
- [Практическое руководство. Условная компиляция с использованием атрибутов Trace и Debug](how-to-compile-conditionally-with-trace-and-debug.md)
- [Практическое руководство. Создание, инициализация и настройка переключателей трассировки](how-to-create-initialize-and-configure-trace-switches.md)
- [Практическое руководство. Создание и инициализация источников трассировки](how-to-create-and-initialize-trace-sources.md)
- [Практическое руководство. Использование TraceSource и фильтров с прослушивателями трассировки](how-to-use-tracesource-and-filters-with-trace-listeners.md)
- [Прослушиватели трассировки](trace-listeners.md)
- [Переключатели трассировки](trace-switches.md)
