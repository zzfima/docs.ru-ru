---
title: Помощник по отладке управляемого кода asynchronousThreadAbort
ms.date: 03/30/2017
helpviewer_keywords:
- asynchronous thread aborts
- AsynchronousThreadAbort MDA
- managed debugging assistants (MDAs), asynchronous thread aborts
- threading [.NET Framework], managed debugging assistants
- MDAs (managed debugging assistants), asynchronous thread aborts
ms.assetid: 9ebe40b2-d703-421e-8660-984acc42bfe0
ms.openlocfilehash: d0c78e6d52ae4a5b3a24e0bb4278b2e8a1b98751
ms.sourcegitcommit: 9c54866bcbdc49dbb981dd55be9bbd0443837aa2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/14/2020
ms.locfileid: "77217578"
---
# <a name="asynchronousthreadabort-mda"></a>Помощник по отладке управляемого кода asynchronousThreadAbort
Помощник по отладке управляемого кода (MDA) `asynchronousThreadAbort` активируется в том случае, если поток пытается выполнить асинхронное прерывание в другом потоке. При вызове синхронных прерываний потока помощник `asynchronousThreadAbort` не активируется.

## <a name="symptoms"></a>Симптомы
 При прерывании потока основного приложения приложение аварийно завершает работу с необработанным исключением <xref:System.Threading.ThreadAbortException>. Если выполнение приложения должно было продолжиться, последствия завершения могут быть даже хуже, чем при аварийном завершении, что может привести к обширному повреждению данных.

 Атомарная операция, скорее всего, может быть прервана после частичного выполнения, в результате чего данные приложения будут находиться в непредсказуемом состоянии. Исключение <xref:System.Threading.ThreadAbortException> может возникать в произвольных точках выполняемого кода и чаще всего в самых неожиданных местах. Если в коде не реализована возможность обработки такого исключения, это может привести к повреждению состояния.

 Из-за случайного характера возникновения этой проблемы ее симптомы могут быть самыми разными.

## <a name="cause"></a>Причина
 Код в одном потоке вызвал метод <xref:System.Threading.Thread.Abort%2A?displayProperty=nameWithType> для целевого потока, чтобы выполнить асинхронное прерывание. Прерывание является асинхронным, поскольку код выполняет вызов <xref:System.Threading.Thread.Abort%2A> в потоке, который отличается от целевого потока операции прерывания. При синхронном прерывании проблемы не должны возникать, поскольку поток, выполняющий метод <xref:System.Threading.Thread.Abort%2A>, делает это только в безопасной контрольной точке, в которой состояние приложения является согласованным.

 При асинхронном прерывании проблемы возникают потому, что обработка осуществляется в произвольных точках выполняемого целевого потока. Чтобы предотвратить это, код для выполнения в потоке, который может быть прерван таким образом, должен предусматривать обработку исключения <xref:System.Threading.ThreadAbortException> практически в каждой точке кода, чтобы обеспечить гарантированный возврат данных приложения в согласованное состояние. Естественно, сложно рассчитывать на то, что при написании кода будет учитываться вероятность возникновения этой проблемы, а также реализована защита во всех возможных ситуациях.

 Вызовы неуправляемого кода и блоков `finally` будут прерываться не асинхронно, а непосредственно после выхода из одной из этих категорий.

 Причины этого трудно определить из-за случайного характера возникновения проблемы.

## <a name="resolution"></a>Решение
 Не используйте асинхронные прерывания в коде. Существуют другие способы прерывания в целевом потоке, при которых не требуется вызывать метод <xref:System.Threading.Thread.Abort%2A>. Безопаснее всего реализовать механизм с использованием общего свойства, которое сигнализирует целевому потоку о необходимости запросить прерывание. Целевой поток проверяет эти сигналы в определенных безопасных контрольных точках. Если обнаруживается запрос прерывания, может быть выполнено безопасное завершение потока.

## <a name="effect-on-the-runtime"></a>Влияние на среду выполнения
 Этот помощник отладки управляемого кода не оказывает никакого влияния на среду CLR. Он только выводит данные об асинхронных прерываниях потока.

## <a name="output"></a>Вывод
 В отчете этого помощника указывается идентификатор потока, выполнившего прерывание, а также идентификатор целевого потока для операции прерывания. Они никогда не совпадают, поскольку область применения ограничивается асинхронными прерываниями.

## <a name="configuration"></a>Конфигурация

```xml
<mdaConfig>
  <assistants>
    <asynchronousThreadAbort />
  </assistants>
</mdaConfig>
```

## <a name="example"></a>Пример
 Для активации помощника по отладке управляемого кода `asynchronousThreadAbort` требуется только вызвать метод <xref:System.Threading.Thread.Abort%2A> для отдельного выполняющегося потока. Проанализируйте последствия ситуаций, в которых функция запуска потока содержит набор более сложных операций, которые могут быть прерваны в любой произвольной точке.

```csharp
using System.Threading;
void FireMda()
{
    Thread t = new Thread(delegate() { Thread.Sleep(1000); });
    t.Start();
    // The following line activates the MDA.
    t.Abort();
    t.Join();
}
```

## <a name="see-also"></a>См. также:

- <xref:System.Threading.Thread>
- [Диагностика ошибок посредством помощников по отладке управляемого кода](diagnosing-errors-with-managed-debugging-assistants.md)
