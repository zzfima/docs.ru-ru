---
title: "Оптимизация производительности: разметка и разработка"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-wpf
ms.tgt_pltfrm: 
ms.topic: article
dev_langs:
- csharp
- vb
helpviewer_keywords:
- layout [WPF], optimizing performance
- design considerations [WPF]
- layout pass [WPF]
ms.assetid: 005f4cda-a849-448b-916b-38d14d9a96fe
caps.latest.revision: "8"
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.workload: dotnet
ms.openlocfilehash: df87170b05f830916ef2f77fd4cb5a4abab42faa
ms.sourcegitcommit: 16186c34a957fdd52e5db7294f291f7530ac9d24
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/22/2017
---
# <a name="optimizing-performance-layout-and-design"></a><span data-ttu-id="4c574-102">Оптимизация производительности: разметка и разработка</span><span class="sxs-lookup"><span data-stu-id="4c574-102">Optimizing Performance: Layout and Design</span></span>
<span data-ttu-id="4c574-103">Разработка приложения [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] может повлиять на его производительность в результате создания ненужных служебных данных при вычислении макета и проверки ссылок на объекты.</span><span class="sxs-lookup"><span data-stu-id="4c574-103">The design of your [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] application can impact its performance by creating unnecessary overhead in calculating layout and validating object references.</span></span> <span data-ttu-id="4c574-104">Конструирование объектов, особенно во время выполнения, может повлиять на характеристики производительности приложения.</span><span class="sxs-lookup"><span data-stu-id="4c574-104">The construction of objects, particularly at run time, can affect the performance characteristics of your application.</span></span>  
  
 <span data-ttu-id="4c574-105">В этом разделе даются рекомендации по производительности в этих областях.</span><span class="sxs-lookup"><span data-stu-id="4c574-105">This topic provides performance recommendations in these areas.</span></span>  
  
## <a name="layout"></a><span data-ttu-id="4c574-106">Макет</span><span class="sxs-lookup"><span data-stu-id="4c574-106">Layout</span></span>  
 <span data-ttu-id="4c574-107">Термин «проход разметки» описывает процесс измерения и упорядочения объекта <xref:System.Windows.Controls.Panel>-коллекции производного объекта дочерних элементов, и затем рисование их на экране.</span><span class="sxs-lookup"><span data-stu-id="4c574-107">The term "layout pass" describes the process of measuring and arranging the members of a <xref:System.Windows.Controls.Panel>-derived object's collection of children, and then drawing them onscreen.</span></span> <span data-ttu-id="4c574-108">Проход разметки представляет собой процесс интенсивной математической нагрузки: чем больше число дочерних объектов в коллекции, тем больше требуется вычислений.</span><span class="sxs-lookup"><span data-stu-id="4c574-108">The layout pass is a mathematically-intensive process—the larger the number of children in the collection, the greater the number of calculations required.</span></span> <span data-ttu-id="4c574-109">Например, при каждом запуске дочернего <xref:System.Windows.UIElement> объекта в коллекции изменяет свое положение, он имеет возможность запустить новый проход системы макета.</span><span class="sxs-lookup"><span data-stu-id="4c574-109">For example, each time a child <xref:System.Windows.UIElement> object in the collection changes its position, it has the potential to trigger a new pass by the layout system.</span></span> <span data-ttu-id="4c574-110">Из-за разрыва отношения между характеристиками объекта и поведением разметки важно понимать тип событий, которые могут запустить систему разметки.</span><span class="sxs-lookup"><span data-stu-id="4c574-110">Because of the close relationship between object characteristics and layout behavior, it's important to understand the type of events that can invoke the layout system.</span></span> <span data-ttu-id="4c574-111">Приложение будет выполняться лучше, если уменьшить, насколько возможно, ненужные вызовы прохода разметки.</span><span class="sxs-lookup"><span data-stu-id="4c574-111">Your application will perform better by reducing as much as possible any unnecessary invocations of the layout pass.</span></span>  
  
 <span data-ttu-id="4c574-112">Система разметки выполняет два прохода для каждого дочернего члена в коллекции: проход измерений и проход компоновки.</span><span class="sxs-lookup"><span data-stu-id="4c574-112">The layout system completes two passes for each child member in a collection: a measure pass, and an arrange pass.</span></span> <span data-ttu-id="4c574-113">Каждый дочерний объект предоставляет собственную реализацию переопределенный <xref:System.Windows.UIElement.Measure%2A> и <xref:System.Windows.UIElement.Arrange%2A> методов, чтобы предоставить свои собственные определенного поведения макета.</span><span class="sxs-lookup"><span data-stu-id="4c574-113">Each child object provides its own overridden implementation of the <xref:System.Windows.UIElement.Measure%2A> and <xref:System.Windows.UIElement.Arrange%2A> methods in order to provide its own specific layout behavior.</span></span> <span data-ttu-id="4c574-114">В самом простом случае макет является рекурсивной системой, в процессе которой программа изменяет размер и расположение элемента и отображает его на экране.</span><span class="sxs-lookup"><span data-stu-id="4c574-114">At its simplest, layout is a recursive system that leads to an element being sized, positioned, and drawn onscreen.</span></span>  
  
-   <span data-ttu-id="4c574-115">Дочерний элемент <xref:System.Windows.UIElement> объект начинает процесс разметки первым, задав его основные измеряемые свойства.</span><span class="sxs-lookup"><span data-stu-id="4c574-115">A child <xref:System.Windows.UIElement> object begins the layout process by first having its core properties measured.</span></span>  
  
-   <span data-ttu-id="4c574-116">Объект <xref:System.Windows.FrameworkElement> свойства, связанные с размером, таких как <xref:System.Windows.FrameworkElement.Width%2A>, <xref:System.Windows.FrameworkElement.Height%2A>, и <xref:System.Windows.FrameworkElement.Margin%2A>, вычисляются.</span><span class="sxs-lookup"><span data-stu-id="4c574-116">The object's <xref:System.Windows.FrameworkElement> properties that are related to size, such as <xref:System.Windows.FrameworkElement.Width%2A>, <xref:System.Windows.FrameworkElement.Height%2A>, and <xref:System.Windows.FrameworkElement.Margin%2A>, are evaluated.</span></span>  
  
-   <span data-ttu-id="4c574-117"><xref:System.Windows.Controls.Panel>-применяется логика, таких как <xref:System.Windows.Controls.DockPanel.Dock%2A> свойство <xref:System.Windows.Controls.DockPanel>, или <xref:System.Windows.Controls.StackPanel.Orientation%2A> свойство <xref:System.Windows.Controls.StackPanel>.</span><span class="sxs-lookup"><span data-stu-id="4c574-117"><xref:System.Windows.Controls.Panel>-specific logic is applied, such as the <xref:System.Windows.Controls.DockPanel.Dock%2A> property of the <xref:System.Windows.Controls.DockPanel>, or the <xref:System.Windows.Controls.StackPanel.Orientation%2A> property of the <xref:System.Windows.Controls.StackPanel>.</span></span>  
  
-   <span data-ttu-id="4c574-118">Содержимое компонуется или размещается после всех дочерних объектов, которые были измерены.</span><span class="sxs-lookup"><span data-stu-id="4c574-118">Content is arranged, or positioned, after all child objects have been measured.</span></span>  
  
-   <span data-ttu-id="4c574-119">На экране отображается коллекция дочерних объектов.</span><span class="sxs-lookup"><span data-stu-id="4c574-119">The collection of child objects is drawn to the screen.</span></span>  
  
 <span data-ttu-id="4c574-120">Процесс прохода разметки вызывается снова при возникновении любого из следующих событий.</span><span class="sxs-lookup"><span data-stu-id="4c574-120">The layout pass process is invoked again if any of the following actions occur:</span></span>  
  
-   <span data-ttu-id="4c574-121">Дочерний объект добавляется в коллекцию.</span><span class="sxs-lookup"><span data-stu-id="4c574-121">A child object is added to the collection.</span></span>  
  
-   <span data-ttu-id="4c574-122">Объект <xref:System.Windows.FrameworkElement.LayoutTransform%2A> применяется к дочернему объекту.</span><span class="sxs-lookup"><span data-stu-id="4c574-122">A <xref:System.Windows.FrameworkElement.LayoutTransform%2A> is applied to the child object.</span></span>  
  
-   <span data-ttu-id="4c574-123"><xref:System.Windows.UIElement.UpdateLayout%2A> Метод вызывается для дочернего объекта.</span><span class="sxs-lookup"><span data-stu-id="4c574-123">The <xref:System.Windows.UIElement.UpdateLayout%2A> method is called for the child object.</span></span>  
  
-   <span data-ttu-id="4c574-124">При изменении значения свойства зависимости, которое помечено метаданными, влияющими на проход измерения и компоновки.</span><span class="sxs-lookup"><span data-stu-id="4c574-124">When a change occurs to the value of a dependency property that is marked with metadata affecting the measure or arrange passes.</span></span>  
  
### <a name="use-the-most-efficient-panel-where-possible"></a><span data-ttu-id="4c574-125">Используйте наиболее эффективную панель там, где возможно</span><span class="sxs-lookup"><span data-stu-id="4c574-125">Use the Most Efficient Panel where Possible</span></span>  
 <span data-ttu-id="4c574-126">Сложность процесса макета напрямую зависит от поведения <xref:System.Windows.Controls.Panel>-используемых элементов, производных.</span><span class="sxs-lookup"><span data-stu-id="4c574-126">The complexity of the layout process is directly based on the layout behavior of the <xref:System.Windows.Controls.Panel>-derived elements you use.</span></span> <span data-ttu-id="4c574-127">Например <xref:System.Windows.Controls.Grid> или <xref:System.Windows.Controls.StackPanel> управления предоставляет гораздо более эффективны, чем <xref:System.Windows.Controls.Canvas> элемента управления.</span><span class="sxs-lookup"><span data-stu-id="4c574-127">For example, a <xref:System.Windows.Controls.Grid> or <xref:System.Windows.Controls.StackPanel> control provides much more functionality than a <xref:System.Windows.Controls.Canvas> control.</span></span> <span data-ttu-id="4c574-128">Ценой этого значительного увеличения функциональности является увеличение затрат производительности.</span><span class="sxs-lookup"><span data-stu-id="4c574-128">The price for this greater increase in functionality is a greater increase in performance costs.</span></span> <span data-ttu-id="4c574-129">Тем не менее если не требуется функциональность, <xref:System.Windows.Controls.Grid> предоставляет элемент управления, следует использовать менее затратные варианты, такие как <xref:System.Windows.Controls.Canvas> или настраиваемую панель.</span><span class="sxs-lookup"><span data-stu-id="4c574-129">However, if you do not require the functionality that a <xref:System.Windows.Controls.Grid> control provides, you should use the less costly alternatives, such as a <xref:System.Windows.Controls.Canvas> or a custom panel.</span></span>  
  
 <span data-ttu-id="4c574-130">Дополнительные сведения см. в разделе [Общие сведения о панелях](../../../../docs/framework/wpf/controls/panels-overview.md).</span><span class="sxs-lookup"><span data-stu-id="4c574-130">For more information, see [Panels Overview](../../../../docs/framework/wpf/controls/panels-overview.md).</span></span>  
  
### <a name="update-rather-than-replace-a-rendertransform"></a><span data-ttu-id="4c574-131">Обновление вместо замены RenderTransform</span><span class="sxs-lookup"><span data-stu-id="4c574-131">Update Rather than Replace a RenderTransform</span></span>  
 <span data-ttu-id="4c574-132">Вы сможете обновить <xref:System.Windows.Media.Transform> вместо его замены как значение <xref:System.Windows.UIElement.RenderTransform%2A> свойства.</span><span class="sxs-lookup"><span data-stu-id="4c574-132">You may be able to update a <xref:System.Windows.Media.Transform> rather than replacing it as the value of a <xref:System.Windows.UIElement.RenderTransform%2A> property.</span></span> <span data-ttu-id="4c574-133">Это особенно актуально в скриптах, включающих анимацию.</span><span class="sxs-lookup"><span data-stu-id="4c574-133">This is particularly true in scenarios that involve animation.</span></span> <span data-ttu-id="4c574-134">Обновление существующего <xref:System.Windows.Media.Transform>, позволяет избежать инициирования ненужных вычислений разметки.</span><span class="sxs-lookup"><span data-stu-id="4c574-134">By updating an existing <xref:System.Windows.Media.Transform>, you avoid initiating an unnecessary layout calculation.</span></span>  
  
### <a name="build-your-tree-top-down"></a><span data-ttu-id="4c574-135">Построение дерева сверху вниз</span><span class="sxs-lookup"><span data-stu-id="4c574-135">Build Your Tree Top-Down</span></span>  
 <span data-ttu-id="4c574-136">При добавлении или удалении узла из логического дерева свойство аннулирования вызывается на родительском узле и всех дочерних узлах.</span><span class="sxs-lookup"><span data-stu-id="4c574-136">When a node is added or removed from the logical tree, property invalidations are raised on the node's parent and all its children.</span></span> <span data-ttu-id="4c574-137">В результате всегда требуется следовать шаблону структуры сверху вниз, во избежание ненужных аннулирований на узлах, которые уже были проверены.</span><span class="sxs-lookup"><span data-stu-id="4c574-137">As a result, a top-down construction pattern should always be followed to avoid the cost of unnecessary invalidations on nodes that have already been validated.</span></span> <span data-ttu-id="4c574-138">В следующей таблице показаны различия в скорости выполнения между построением дерева сверху вниз или снизу вверх, где в дереве 150 уровней с одним <xref:System.Windows.Controls.TextBlock> и <xref:System.Windows.Controls.DockPanel> на каждом уровне.</span><span class="sxs-lookup"><span data-stu-id="4c574-138">The following table shows the difference in execution speed between building a tree top-down versus bottom-up, where the tree is 150 levels deep with a single <xref:System.Windows.Controls.TextBlock> and <xref:System.Windows.Controls.DockPanel> at each level.</span></span>  
  
|<span data-ttu-id="4c574-139">**Действие**</span><span class="sxs-lookup"><span data-stu-id="4c574-139">**Action**</span></span>|<span data-ttu-id="4c574-140">**Построение дерева (мс)**</span><span class="sxs-lookup"><span data-stu-id="4c574-140">**Tree building (in ms)**</span></span>|<span data-ttu-id="4c574-141">**Отображение — включает построение дерева (мс)**</span><span class="sxs-lookup"><span data-stu-id="4c574-141">**Render—includes tree building (in ms)**</span></span>|  
|----------------|---------------------------------|-------------------------------------------------|  
|<span data-ttu-id="4c574-142">Снизу вверх</span><span class="sxs-lookup"><span data-stu-id="4c574-142">Bottom-up</span></span>|<span data-ttu-id="4c574-143">366</span><span class="sxs-lookup"><span data-stu-id="4c574-143">366</span></span>|<span data-ttu-id="4c574-144">454</span><span class="sxs-lookup"><span data-stu-id="4c574-144">454</span></span>|  
|<span data-ttu-id="4c574-145">Сверху вниз</span><span class="sxs-lookup"><span data-stu-id="4c574-145">Top-down</span></span>|<span data-ttu-id="4c574-146">11</span><span class="sxs-lookup"><span data-stu-id="4c574-146">11</span></span>|<span data-ttu-id="4c574-147">96</span><span class="sxs-lookup"><span data-stu-id="4c574-147">96</span></span>|  
  
 <span data-ttu-id="4c574-148">В следующем примере кода демонстрируется создание дерева сверху вниз.</span><span class="sxs-lookup"><span data-stu-id="4c574-148">The following code example demonstrates how to create a tree top down.</span></span>  
  
 [!code-csharp[Performance#PerformanceSnippet1](../../../../samples/snippets/csharp/VS_Snippets_Wpf/Performance/CSharp/Window1.xaml.cs#performancesnippet1)]
 [!code-vb[Performance#PerformanceSnippet1](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/Performance/visualbasic/window1.xaml.vb#performancesnippet1)]  
  
 <span data-ttu-id="4c574-149">Дополнительные сведения о логическом дереве см. в разделе [Деревья в WPF](../../../../docs/framework/wpf/advanced/trees-in-wpf.md).</span><span class="sxs-lookup"><span data-stu-id="4c574-149">For more information on the logical tree, see [Trees in WPF](../../../../docs/framework/wpf/advanced/trees-in-wpf.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="4c574-150">См. также</span><span class="sxs-lookup"><span data-stu-id="4c574-150">See Also</span></span>  
 [<span data-ttu-id="4c574-151">Улучшение производительности приложений WPF</span><span class="sxs-lookup"><span data-stu-id="4c574-151">Optimizing WPF Application Performance</span></span>](../../../../docs/framework/wpf/advanced/optimizing-wpf-application-performance.md)  
 [<span data-ttu-id="4c574-152">Планирование производительности приложения</span><span class="sxs-lookup"><span data-stu-id="4c574-152">Planning for Application Performance</span></span>](../../../../docs/framework/wpf/advanced/planning-for-application-performance.md)  
 [<span data-ttu-id="4c574-153">Использование преимуществ оборудования</span><span class="sxs-lookup"><span data-stu-id="4c574-153">Taking Advantage of Hardware</span></span>](../../../../docs/framework/wpf/advanced/optimizing-performance-taking-advantage-of-hardware.md)  
 [<span data-ttu-id="4c574-154">Двумерная графика и изображения</span><span class="sxs-lookup"><span data-stu-id="4c574-154">2D Graphics and Imaging</span></span>](../../../../docs/framework/wpf/advanced/optimizing-performance-2d-graphics-and-imaging.md)  
 [<span data-ttu-id="4c574-155">Поведение объекта</span><span class="sxs-lookup"><span data-stu-id="4c574-155">Object Behavior</span></span>](../../../../docs/framework/wpf/advanced/optimizing-performance-object-behavior.md)  
 [<span data-ttu-id="4c574-156">Ресурсы приложений</span><span class="sxs-lookup"><span data-stu-id="4c574-156">Application Resources</span></span>](../../../../docs/framework/wpf/advanced/optimizing-performance-application-resources.md)  
 [<span data-ttu-id="4c574-157">Text</span><span class="sxs-lookup"><span data-stu-id="4c574-157">Text</span></span>](../../../../docs/framework/wpf/advanced/optimizing-performance-text.md)  
 [<span data-ttu-id="4c574-158">Привязка данных</span><span class="sxs-lookup"><span data-stu-id="4c574-158">Data Binding</span></span>](../../../../docs/framework/wpf/advanced/optimizing-performance-data-binding.md)  
 [<span data-ttu-id="4c574-159">Дополнительные рекомендации по повышению производительности</span><span class="sxs-lookup"><span data-stu-id="4c574-159">Other Performance Recommendations</span></span>](../../../../docs/framework/wpf/advanced/optimizing-performance-other-recommendations.md)  
 [<span data-ttu-id="4c574-160">Макет</span><span class="sxs-lookup"><span data-stu-id="4c574-160">Layout</span></span>](../../../../docs/framework/wpf/advanced/layout.md)
