---
title: Общие сведения о свойствах зависимости
description: Свойство, поддерживаемое системой свойств WPF, называется свойством зависимостей. В этом обзоре описывается система свойств WPF и возможности свойства зависимостей.
ms.date: 06/06/2018
dev_langs:
- csharp
- vb
helpviewer_keywords:
- properties [WPF], attached
- properties [WPF], overview
- styles [WPF]
- attached properties [WPF]
- data binding [WPF]
- dependency properties [WPF]
- resources [WPF], references to
ms.assetid: d119d00c-3afb-48d6-87a0-c4da4f83dee5
ms.openlocfilehash: 9bf0b168633bbf9f56694e79cf81f8051f9b8ac0
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/12/2020
ms.locfileid: "79186383"
---
# <a name="dependency-properties-overview"></a>Общие сведения о свойствах зависимости

Windows Presentation Foundation (WPF) предоставляет набор служб, которые можно использовать для расширения функциональных возможностей [свойства](../../../standard/base-types/common-type-system.md#Properties). В совокупности эти службы обычно называются системой свойств WPF. Свойство, поддерживаемое системой свойств WPF, называется свойством зависимостей. В этом обзоре описывается система свойств WPF и возможности свойства зависимостей. В обзоре также описывается использование существующих свойств зависимостей в языке XAML и коде. Кроме того, в обзоре представлены общие сведения о специальных аспектах свойств зависимостей, таких как метаданные свойств зависимостей и способы создания собственного свойства зависимостей в пользовательском классе.

## <a name="prerequisites"></a>Предварительные требования
В этом разделе предполагается, что у вас есть базовые знания о системе типа .NET и объектно-ориентированном программировании. Чтобы выполнить примеры в этом разделе, следует также иметь представление о XAML и написании простых приложений WPF. Для получения дополнительной информации [см.](../getting-started/walkthrough-my-first-wpf-desktop-application.md)  
  
## <a name="dependency-properties-and-clr-properties"></a>Свойства зависимостей и свойства CLR
 В WPF свойства обычно представляются как стандартные [свойства](../../../standard/base-types/common-type-system.md#Properties) .NET. На базовом уровне можно взаимодействовать с этими свойствами непосредственно и не знать, что они реализуются как свойства зависимостей. Тем не менее настоятельно рекомендуется ознакомиться с некоторыми, а лучше со всеми, функциями системы свойств WPF, чтобы воспользоваться преимуществами этих функций.

Свойства зависимостей предназначены для предоставления способа вычисления значения свойства по значениям других входных данных. Эти входные данные могут включать в себя системные свойства, такие как темы и пользовательские параметры, JIT-механизмы определения свойств, такие как привязка данных и анимации (раскадровки), шаблоны многократного использования, например ресурсы и стили, а также значения, известные благодаря отношениям между родительскими и дочерними элементами с другими элементами в дереве. Кроме того, свойство зависимостей может быть реализовано для обеспечения автономной проверки, значений по умолчанию, обратных вызовов, отслеживающих изменения других свойств, и системы, которая может приводить значения свойств на основе информации потенциальной среды выполнения. Производные классы также могут изменять некоторые специфические характеристики существующего свойства путем переопределения метаданных свойства зависимостей вместо того, чтобы переопределять фактические реализации существующих свойств или создавать новые свойства.

В справочнике по SDK можно определить, что это свойство является свойством зависимостей по наличию раздела сведений о свойстве зависимостей на странице управляемой ссылки для этого свойства. В разделе сведений о свойстве зависимостей есть ссылка на идентификатор поля для этого свойства зависимостей <xref:System.Windows.DependencyProperty>, список параметров метаданных, заданных для этого свойства, информацию по переопределению для каждого класса и другие сведения.

## <a name="dependency-properties-back-clr-properties"></a>Свойства зависимостей поддерживают свойства CLR
Свойства зависимостей и система свойств WPF расширяют функциональные возможности свойства, предоставляя тип, который поддерживает свойство, в качестве альтернативной реализации для стандартного способа обеспечения свойства с помощью закрытого поля. Имя этого типа — <xref:System.Windows.DependencyProperty>. Другим важным типом, который определяет систему свойств WPF, является <xref:System.Windows.DependencyObject>. Тип <xref:System.Windows.DependencyObject> определяет базовый класс для регистрации свойства зависимостей и использования в качестве его владельца.

Далее перечислены термины, используемые для свойств зависимостей.

- **Свойство зависимостей** — свойство, поддерживаемое <xref:System.Windows.DependencyProperty>.

- **Идентификатор свойства зависимостей**. Экземпляр <xref:System.Windows.DependencyProperty>, который получается в результате регистрации свойства зависимостей и затем сохраняется как статический член класса. Этот идентификатор используется в качестве параметра для многих API, взаимодействующих с системой свойств WPF.

- **CLR-оболочка.** Фактические реализации получения и задания свойства. Эти реализации включают идентификатор свойства зависимостей, используя его в вызовах <xref:System.Windows.DependencyObject.GetValue%2A> и <xref:System.Windows.DependencyObject.SetValue%2A> и, таким образом, обеспечивая поддержку для свойства с помощью системы свойств WPF.

В следующем примере определяется свойство зависимостей `IsSpinning` и демонстрируется связь между идентификатором <xref:System.Windows.DependencyProperty> и свойством, которое он поддерживает.

[!code-csharp[PropertiesOvwSupport#DPFormBasic](~/samples/snippets/csharp/VS_Snippets_Wpf/PropertiesOvwSupport/CSharp/page4.xaml.cs#dpformbasic)]
[!code-vb[PropertiesOvwSupport#DPFormBasic](~/samples/snippets/visualbasic/VS_Snippets_Wpf/PropertiesOvwSupport/visualbasic/page4.xaml.vb#dpformbasic)]  
  
Соглашение об именовании свойства и его поддерживающего поля <xref:System.Windows.DependencyProperty> имеет важное значение. Имя поля всегда определяется как имя свойства с добавленным суффиксом `Property`. Дополнительные сведения об этом соглашении и разъяснения по нему см. в разделе [Пользовательские свойства зависимостей](custom-dependency-properties.md).  

## <a name="setting-property-values"></a>Задание значений свойств
Свойства можно задать с помощью кода или XAML.

### <a name="setting-property-values-in-xaml"></a>Задание значений свойств с помощью XAML
В следующем примере на XAML задается красный цвет фона кнопки. В этом примере показан случай, когда простое строковое значение атрибута на языке XAML преобразуется синтаксическим анализатором WPF XAML в тип WPF (<xref:System.Windows.Media.Color> посредством <xref:System.Windows.Media.SolidColorBrush>) в созданном коде.

[!code-xaml[PropertiesOvwSupport#MostBasicProperty](~/samples/snippets/csharp/VS_Snippets_Wpf/PropertiesOvwSupport/CSharp/Page1.xaml#mostbasicproperty)]

Язык XAML поддерживает различные синтаксические формы для задания свойств. Выбор синтаксиса для конкретного свойства зависит от типа значения, которое использует свойство, а также других факторов, например наличия преобразователя типов. Дополнительные сведения об использовании синтаксиса XAML для задания свойств см. в разделе [Общие сведения о XAML (WPF)](../../../desktop-wpf/fundamentals/xaml.md) и [Подробное описание синтаксиса XAML](xaml-syntax-in-detail.md).

В следующем примере на языке XAML в качестве примера синтаксиса без атрибутов показан другой цвет фона кнопки. Здесь вместо задания простой заливки цветом в качестве фона определяется изображение. Это делается с помощью элемента, представляющего изображение, и источника изображения, указанного как атрибут вложенного элемента. Это пример синтаксиса элемента свойства.

[!code-xaml[PropertiesOvwSupport#PESyntaxProperty](~/samples/snippets/csharp/VS_Snippets_Wpf/PropertiesOvwSupport/CSharp/Page1.xaml#pesyntaxproperty)]

### <a name="setting-properties-in-code"></a>Задание свойств с помощью кода
 Установка значений свойств зависимости в коде обычно является просто вызовом к установленной реализации, разоблачаемым "оберткой" CLR.

[!code-csharp[PropertiesOvwSupport#ProceduralPropertySet](~/samples/snippets/csharp/VS_Snippets_Wpf/PropertiesOvwSupport/CSharp/Page1.xaml.cs#proceduralpropertyset)]
[!code-vb[PropertiesOvwSupport#ProceduralPropertySet](~/samples/snippets/visualbasic/VS_Snippets_Wpf/PropertiesOvwSupport/visualbasic/page1.xaml.vb#proceduralpropertyset)]

Получение значения свойства также является фактически вызовом реализации метода получения, имеющегося в "оболочке":

[!code-csharp[PropertiesOvwSupport#ProceduralPropertyGet](~/samples/snippets/csharp/VS_Snippets_Wpf/PropertiesOvwSupport/CSharp/Page1.xaml.cs#proceduralpropertyget)]
 [!code-vb[PropertiesOvwSupport#ProceduralPropertyGet](~/samples/snippets/visualbasic/VS_Snippets_Wpf/PropertiesOvwSupport/visualbasic/page1.xaml.vb#proceduralpropertyget)]

Вы также можете позвонить <xref:System.Windows.DependencyObject.GetValue%2A> в <xref:System.Windows.DependencyObject.SetValue%2A> систему свойств AIS и напрямую. Это обычно не является необходимым, если вы используете существующие свойства (обертки более удобны, и обеспечивают лучшую экспозицию свойства для инструментов разработчика), но вызов AI непосредственно подходит для определенных сценариев.

Свойства можно задать на языке XAML, а затем использовать их в коде, с помощью кода программной части. Дополнительные сведения см. в разделе [Код программной части и XAML в WPF](code-behind-and-xaml-in-wpf.md).

## <a name="property-functionality-provided-by-a-dependency-property"></a>Функциональные возможности свойства, предоставленные свойством зависимостей
Свойство зависимостей предоставляет дополнительные функциональные возможности в сравнении с теми, которые предоставляются свойством, поддерживаемым полем. Часто такая функция представляет или поддерживает одну из следующих возможностей:

- [Ресурсы](#resources)

- [Связывание данных](#data-binding)

- [Стили](#styles)

- [Анимации](#animations)

- [Переопределения метаданных](#metadata-overrides)

- [Наследование значения свойства](#property-value-inheritance)

- [Интеграция конструкторов WPF](#wpf-designer-integration)

### <a name="resources"></a>Ресурсы
Значение свойства зависимостей можно задать ссылкой на ресурс. Ресурсы обычно указываются как значение свойства `Resources` корневого элемента страницы или приложения. (Эти расположения делают возможным наиболее удобный доступ к ресурсу.) В следующем примере показано, как определить ресурс <xref:System.Windows.Media.SolidColorBrush>.

[!code-xaml[PropertiesOvwSupport#ResourcesResource](~/samples/snippets/csharp/VS_Snippets_Wpf/PropertiesOvwSupport/CSharp/page2.xaml#resourcesresource)]

После определения ресурса можно ссылаться на него и использовать для предоставления значения свойства:

[!code-xaml[PropertiesOvwSupport#ResourcesReference](~/samples/snippets/csharp/VS_Snippets_Wpf/PropertiesOvwSupport/CSharp/page2.xaml#resourcesreference)]

Этот конкретный ресурс называется [Расширение разметки DynamicResource](dynamicresource-markup-extension.md) (в WPF XAML можно использовать статическую или динамическую ссылку на ресурс). Чтобы использовать динамическую ссылку на ресурс, необходимо задать значение для свойства зависимостей. Это явное использование динамической ссылки на ресурс, разрешенное системой свойств WPF. Дополнительные сведения см. в разделе [Ресурсы XAML](xaml-resources.md).

> [!NOTE]
> Ресурсы считаются локальными значениями. Это означает, что если задается другое локальное значение, ссылка на ресурс удаляется. Дополнительные сведения см. в разделе [Приоритет значений свойств зависимостей](dependency-property-value-precedence.md).

### <a name="data-binding"></a>привязка данных,
Свойства зависимостей могут ссылаться на значения через привязки данных. Привязка данных использует специальный синтаксис расширения разметки на языке XAML или объект <xref:System.Windows.Data.Binding> в коде. Благодаря функции привязки данных определение окончательного значения свойства откладывается до времени выполнения. Затем значение извлекается из источника данных.

В следующем примере свойство <xref:System.Windows.Controls.ContentControl.Content%2A> задается для <xref:System.Windows.Controls.Button> с помощью привязки, объявленной в XAML. Привязка использует наследуемый контекст данных и источник данных <xref:System.Windows.Data.XmlDataProvider> (не показан). Привязка сама определяет нужный источник с помощью свойства <xref:System.Windows.Data.Binding.XPath%2A> в источнике данных.

[!code-xaml[PropertiesOvwSupport#BasicInlineBinding](~/samples/snippets/csharp/VS_Snippets_Wpf/PropertiesOvwSupport/CSharp/page3.xaml#basicinlinebinding)]

> [!NOTE]
> Привязки считаются локальными значениями. Это означает, что если задается другое локальное значение, привязка удаляется. Дополнительные сведения см. в разделе [Приоритет значений свойств зависимостей](dependency-property-value-precedence.md).

Для свойств зависимостей (или класса <xref:System.Windows.DependencyObject>) не предусмотрена собственная поддержка <xref:System.ComponentModel.INotifyPropertyChanged> для формирования уведомлений об изменениях в исходном значении свойства <xref:System.Windows.DependencyObject> для операций привязки данных. Дополнительные сведения о создании свойств для использования в привязках данных, которые могут передавать сообщения об изменениях в целевой объект привязки данных, см. в разделе [Общие сведения о привязках данных](../data/data-binding-overview.md).

### <a name="styles"></a>Стили
Существует два основных направления применения свойств зависимостей — стили и шаблоны. Стили особенно полезны для настройки свойств, определяющих приложение [!INCLUDE[TLA#tla_ui](../../../../includes/tlasharptla-ui-md.md)]. Обычно стили определяются в XAML в качестве ресурсов. Стили взаимодействуют с системой свойств, так как они обычно содержат код для задания значения конкретного свойства, а также "правила срабатывания", которые определяют изменение значения свойства в зависимости от значения другого свойства в режиме реального времени.

В следующем примере создается очень простой стиль, который будет определяться внутри словаря <xref:System.Windows.FrameworkElement.Resources%2A> (не показан). Затем этот стиль применяется непосредственно к свойству <xref:System.Windows.FrameworkElement.Style%2A> для <xref:System.Windows.Controls.Button>. Метод задания в стиле задает для свойства <xref:System.Windows.Controls.Control.Background%2A> элемента управления <xref:System.Windows.Controls.Button> значение "зеленый".

[!code-xaml[PropertiesOvwSupport#SimpleStyleDef](~/samples/snippets/csharp/VS_Snippets_Wpf/PropertiesOvwSupport/CSharp/page3.xaml#simplestyledef)]

[!code-xaml[PropertiesOvwSupport#SimpleStyle](~/samples/snippets/csharp/VS_Snippets_Wpf/PropertiesOvwSupport/CSharp/page3.xaml#simplestyle)]

Более подробную информацию см. в разделе [Стилизация и использование шаблонов](../controls/styling-and-templating.md).

### <a name="animations"></a>Анимации
Свойства зависимостей могут быть анимированы. При выполнении анимации анимированное значение действует с более высоким приоритетом, чем любое другое значение (например, локальное значение), которое имелось бы у свойства.

В следующем примере <xref:System.Windows.Controls.Control.Background%2A> анимируется для свойства <xref:System.Windows.Controls.Button> (с технической точки зрения <xref:System.Windows.Controls.Control.Background%2A> анимируется с помощью синтаксиса элемента свойства для указания пустого <xref:System.Windows.Media.SolidColorBrush> в качестве <xref:System.Windows.Controls.Control.Background%2A>, тогда свойство <xref:System.Windows.Media.SolidColorBrush.Color%2A> этого элемента <xref:System.Windows.Media.SolidColorBrush> — это свойство, которое непосредственно анимируется).

[!code-xaml[PropertiesOvwSupport#MiniAnimate](~/samples/snippets/csharp/VS_Snippets_Wpf/PropertiesOvwSupport/CSharp/page3.xaml#minianimate)]

Дополнительные сведения об анимации свойств см. в разделах [Общие сведения об анимации](../graphics-multimedia/animation-overview.md) и [Общие сведения о раскадровках](../graphics-multimedia/storyboards-overview.md).

### <a name="metadata-overrides"></a>Переопределения метаданных
Правила взаимодействия свойства зависимостей можно изменять путем переопределения метаданных свойства при наследовании от класса, в котором это свойство зависимостей было изначально зарегистрировано. Переопределение метаданных зависит от идентификатора <xref:System.Windows.DependencyProperty>. Переопределение метаданных не требует повторной реализации свойства. Изменение метаданных изначально обрабатывается системой свойств. Каждый класс потенциально содержит отдельные метаданные для всех свойств, которые наследуются от базовых классов, отдельно по каждому типу.

В следующем примере метаданные переопределяются для свойства зависимостей <xref:System.Windows.FrameworkElement.DefaultStyleKey%2A>. Переопределение метаданных этого конкретного свойства зависимостей включено в состав шаблона реализации, с помощью которого создаются элементы управления, которые могут использовать стили, заданные по умолчанию в темах.

[!code-csharp[PropertiesOvwSupport#OverrideMetadata](~/samples/snippets/csharp/VS_Snippets_Wpf/PropertiesOvwSupport/CSharp/page3.xaml.cs#overridemetadata)]
[!code-vb[PropertiesOvwSupport#OverrideMetadata](~/samples/snippets/visualbasic/VS_Snippets_Wpf/PropertiesOvwSupport/visualbasic/page3.xaml.vb#overridemetadata)]

Дополнительные сведения о переопределении или получении метаданных свойства см. в разделе [Метаданные свойств зависимостей](dependency-property-metadata.md).

### <a name="property-value-inheritance"></a>Наследование значения свойства
Элемент может наследовать значение свойства зависимостей от своего родительского элемента в дереве объектов.

> [!NOTE]
> Наследование значений свойств не включено глобально для всех свойств зависимостей, потому что выполнение вычислений при наследовании отрицательно сказывается на производительности. Наследование значений свойств обычно включается только для тех свойств, для которых в конкретном сценарии предполагается, что это наследование является оправданным. Определить, наследуется ли данное свойство зависимостей, можно, просмотрев раздел **Сведения о свойствах зависимостей** для этого свойства в справочнике по SDK.

В следующем примере показано, как для привязки задается свойство <xref:System.Windows.FrameworkElement.DataContext%2A>, указывающее источник привязки, который не был показан в предыдущем примере. Все последующие привязки в дочерних объектах не должны указывать источник: они могут использовать унаследованное значение из <xref:System.Windows.FrameworkElement.DataContext%2A> в родительском объекте <xref:System.Windows.Controls.StackPanel>. (Кроме того, вместо этого дочерний объект может напрямую указывать свой собственный контекст <xref:System.Windows.FrameworkElement.DataContext%2A> или <xref:System.Windows.Data.Binding.Source%2A> в <xref:System.Windows.Data.Binding> и намеренно не использовать унаследованное значение для контекста данных своих привязок.)

[!code-xaml[PropertiesOvwSupport#InheritanceContext](~/samples/snippets/csharp/VS_Snippets_Wpf/PropertiesOvwSupport/CSharp/page3.xaml#inheritancecontext)]

Дополнительные сведения см. в разделе [Наследование значения свойства](property-value-inheritance.md).

### <a name="wpf-designer-integration"></a>Интеграция конструктора WPF
Пользовательский контроль с свойствами, реализованными в качестве свойств зависимости, получит соответствующий конструктор WPF для поддержки Visual Studio. Один из примеров этого — возможность редактирования прямых и присоединенных свойств зависимостей с помощью окна **Свойства**. Дополнительные сведения см. в разделе [Общие сведения о разработке элементов управления](../controls/control-authoring-overview.md).

## <a name="dependency-property-value-precedence"></a>Приоритет значения свойств зависимостей
Получая значение свойства зависимостей, вы, вероятно, получаете значение, которое было установлено для этого свойства с использованием какого-либо другого свойства, дающего входное значение и участвующего в системе свойств WPF. Для значений свойств зависимостей установлена система приоритетов, благодаря чему различные сценарии получения свойствами своих значений могут выполняться вполне предсказуемо.

Рассмотрим следующий пример. В примере представлен стиль, применяемый ко всем кнопкам и их свойствам <xref:System.Windows.Controls.Control.Background%2A>, однако также указывается одна кнопка с локально заданным значением <xref:System.Windows.Controls.Control.Background%2A>.

> [!NOTE]
> В документации по SDK при описании свойств зависимостей используется термин "локальное значение" или иногда "локально заданное значение". Локально заданное значение — это значение свойства, которое задается непосредственно для экземпляра объекта в коде или как атрибут элемента на языке XAML.  
  
Фактически для первой кнопки свойство задано дважды, но применяется только одно значение, то, у которого наивысший приоритет. Локально заданное значение имеет наивысший приоритет (исключение — выполняющаяся анимация, но анимаций нет в этом примере), поэтому вместо значения цвета фона первой кнопки, определенного стилем, используется локально заданное значение. Для второй кнопки не задано локальное значение (или другое значение с более высоким приоритетом, чем у стиля), поэтому цвет фона для этой кнопки определяется стилем.

[!code-xaml[PropertiesOvwSupport#MiniPrecedence](~/samples/snippets/csharp/VS_Snippets_Wpf/PropertiesOvwSupport/CSharp/page3.xaml#miniprecedence)]  

### <a name="why-does-dependency-property-precedence-exist"></a>Для чего нужны приоритеты свойств зависимостей?
Обычно не требуется постоянное применение стиля, переопределяющее локально заданные значения отдельных элементов (в противном случае было бы вообще очень сложно использовать стили и элементы). Поэтому значения, определяемые стилем, имеют более низкий приоритет, чем локально заданные значения. Более полный список свойств зависимостей и порядок определения их действующих значений см. в разделе [Приоритет значений свойств зависимостей](dependency-property-value-precedence.md).

> [!NOTE]
> Не все свойства, определенные для элементов WPF, являются свойствами зависимостей. Как правило, свойства реализуются в виде свойств зависимостей только в тех случаях, когда возникает потребность поддерживать по крайней мере один из сценариев, реализуемых системой свойств (привязку данных, применение стилей, анимацию, поддержку значений по умолчанию, наследование, присоединенные свойства или проверку).

## <a name="learning-more-about-dependency-properties"></a>Дополнительные сведения о свойствах зависимостей  

- Присоединенное свойство — это тип свойства, поддерживающий специализированный синтаксис на языке XAML. Прилагаемое свойство часто не имеет корреспонденции 1:1 с свойством общего времени выполнения языка (CLR) и не обязательно является свойством зависимости. Обычным назначением присоединенного свойства является разрешение дочерним элементам передавать значения свойств родительским элементам, даже если это свойство не включено в список элементов класса обоих элементов — родительского и дочернего. Как правило, требуется разрешить дочерним элементам уведомлять родительский элемент о том, как они должны быть представлены в [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] (пример см. в разделе <xref:System.Windows.Controls.DockPanel.Dock%2A> или <xref:System.Windows.Controls.Canvas.Left%2A>). Дополнительные сведения см. в разделе [Общие сведения о вложенных свойствах зависимостей](attached-properties-overview.md).

- У разработчиков компонентов и разработчиков приложений может возникнуть потребность в создании собственных свойств зависимостей для получения таких возможностей, как привязка данных, поддержка стилей, проверка и приведение данных. Дополнительные сведения см. в разделе [Пользовательские свойства зависимостей](custom-dependency-properties.md).

- Обычно свойства зависимостей определяются как открытые свойства, доступные или, по крайней мере, видимые любому вызывающему объекту, имеющему доступ к экземпляру. Дополнительные сведения см. в разделе [Безопасность свойств зависимостей](dependency-property-security.md).

## <a name="see-also"></a>См. также раздел

- [Пользовательские свойства зависимостей](custom-dependency-properties.md)
- [Свойства зависимости "только для чтения"](read-only-dependency-properties.md)
- [Обзор XAML (WPF)](../../../desktop-wpf/fundamentals/xaml.md)
- [Архитектура WPF](wpf-architecture.md)
