---
title: Архитектура WPF
ms.date: 03/30/2017
helpviewer_keywords:
- properties [WPF], attached
- attached properties [WPF]
- architecture [WPF]
- unmanaged components [WPF]
- affinity thread [WPF]
- Storyboards [WPF]
- milcore [WPF]
- components [WPF], unmanaged
- painter's algorithm
- interfaces [WPF], INotifyPropertyChange
- CommandBindings [WPF]
- data templates [WPF]
- thread [WPF], affinity
ms.assetid: 8579c10b-76ab-4c52-9691-195ce02333c8
ms.openlocfilehash: 02a70e65cd53a8998395987770cd32efc82293d0
ms.sourcegitcommit: 944ddc52b7f2632f30c668815f92b378efd38eea
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/03/2019
ms.locfileid: "73459604"
---
# <a name="wpf-architecture"></a><span data-ttu-id="921aa-102">Архитектура WPF</span><span class="sxs-lookup"><span data-stu-id="921aa-102">WPF Architecture</span></span>
<span data-ttu-id="921aa-103">В этом разделе представлен обзор иерархии классов Windows Presentation Foundation (WPF).</span><span class="sxs-lookup"><span data-stu-id="921aa-103">This topic provides a guided tour of the Windows Presentation Foundation (WPF) class hierarchy.</span></span> <span data-ttu-id="921aa-104">Он охватывает большую часть основных подсистем [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] и описывает их взаимодействие.</span><span class="sxs-lookup"><span data-stu-id="921aa-104">It covers most of the major subsystems of [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)], and describes how they interact.</span></span> <span data-ttu-id="921aa-105">Здесь также подробно рассматриваются некоторые архитектурные решения [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)].</span><span class="sxs-lookup"><span data-stu-id="921aa-105">It also details some of the choices made by the architects of [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)].</span></span>  

<a name="System_Object"></a>   
## <a name="systemobject"></a><span data-ttu-id="921aa-106">System.Object</span><span class="sxs-lookup"><span data-stu-id="921aa-106">System.Object</span></span>  
 <span data-ttu-id="921aa-107">Основная модель программирования [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] доступна через управляемый код.</span><span class="sxs-lookup"><span data-stu-id="921aa-107">The primary [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] programming model is exposed through managed code.</span></span> <span data-ttu-id="921aa-108">Ранее, на этапе проектирования [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)], несколько раз обсуждалось, где следует провести черту между управляемыми и неуправляемыми компонентами системы.</span><span class="sxs-lookup"><span data-stu-id="921aa-108">Early in the design phase of [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] there were a number of debates about where the line should be drawn between the managed components of the system and the unmanaged ones.</span></span> <span data-ttu-id="921aa-109">Среда CLR предоставляет ряд функций, повышающих производительность и надежность разработки (включая управление памятью, обработку ошибок, систему общих типов и т. д.), но они поставляются по цене.</span><span class="sxs-lookup"><span data-stu-id="921aa-109">The CLR provides a number of features that make development more productive and robust (including memory management, error handling, common type system, etc.) but they come at a cost.</span></span>  
  
 <span data-ttu-id="921aa-110">Основные компоненты [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] показаны на приведенном ниже рисунке.</span><span class="sxs-lookup"><span data-stu-id="921aa-110">The major components of [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] are illustrated in the figure below.</span></span> <span data-ttu-id="921aa-111">Красные разделы диаграммы (PresentationFramework, PresentationCore и milcore) представляют собой основные части кода [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)].</span><span class="sxs-lookup"><span data-stu-id="921aa-111">The red sections of the diagram (PresentationFramework, PresentationCore, and milcore) are the major code portions of [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)].</span></span> <span data-ttu-id="921aa-112">Только один из этих компонентов является неуправляемым — milcore.</span><span class="sxs-lookup"><span data-stu-id="921aa-112">Of these, only one is an unmanaged component – milcore.</span></span> <span data-ttu-id="921aa-113">Milcore написан на неуправляемом коде, чтобы обеспечить тесную интеграцию с DirectX.</span><span class="sxs-lookup"><span data-stu-id="921aa-113">Milcore is written in unmanaged code in order to enable tight integration with DirectX.</span></span> <span data-ttu-id="921aa-114">Все дисплеи в [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] выполняются с помощью механизма DirectX, что обеспечивает эффективную визуализацию оборудования и программного обеспечения.</span><span class="sxs-lookup"><span data-stu-id="921aa-114">All display in [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] is done through the DirectX engine, allowing for efficient hardware and software rendering.</span></span> <span data-ttu-id="921aa-115">Для [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] также необходим тонкий контроль над памятью и выполнением.</span><span class="sxs-lookup"><span data-stu-id="921aa-115">[!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] also required fine control over memory and execution.</span></span> <span data-ttu-id="921aa-116">Механизм композиции в milcore чрезвычайно чувствителен к производительности, и для повышения производительности требуется предоставить множество преимуществ среды CLR.</span><span class="sxs-lookup"><span data-stu-id="921aa-116">The composition engine in milcore is extremely performance sensitive, and required giving up many advantages of the CLR to gain performance.</span></span>  
  
 <span data-ttu-id="921aa-117">![Расположение WPF в .NET Framework.](./media/wpf-architect1.PNG "wpf_architect1")</span><span class="sxs-lookup"><span data-stu-id="921aa-117">![The position of WPF within the .NET Framework.](./media/wpf-architect1.PNG "wpf_architect1")</span></span>  
  
 <span data-ttu-id="921aa-118">Связь между управляемыми и неуправляемыми частями [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] обсуждается далее в этом разделе.</span><span class="sxs-lookup"><span data-stu-id="921aa-118">Communication between the managed and unmanaged portions of [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] is discussed later in this topic.</span></span> <span data-ttu-id="921aa-119">Остальная часть управляемой модели программирования описана ниже.</span><span class="sxs-lookup"><span data-stu-id="921aa-119">The remainder of the managed programming model is described below.</span></span>  
  
<a name="System_Threading_DispatcherObject"></a>   
## <a name="systemthreadingdispatcherobject"></a><span data-ttu-id="921aa-120">System.Threading.DispatcherObject</span><span class="sxs-lookup"><span data-stu-id="921aa-120">System.Threading.DispatcherObject</span></span>  
 <span data-ttu-id="921aa-121">Большинство объектов в [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] являются производными от <xref:System.Windows.Threading.DispatcherObject>, который предоставляет базовые конструкции для работы с параллелизмом и многопоточностью.</span><span class="sxs-lookup"><span data-stu-id="921aa-121">Most objects in [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] derive from <xref:System.Windows.Threading.DispatcherObject>, which provides the basic constructs for dealing with concurrency and threading.</span></span> [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] <span data-ttu-id="921aa-122">базируется на системе обмена сообщениями, реализуемой диспетчером.</span><span class="sxs-lookup"><span data-stu-id="921aa-122">is based on a messaging system implemented by the dispatcher.</span></span> <span data-ttu-id="921aa-123">Его работа очень похожа на работу обычного генератора сообщений в [!INCLUDE[TLA#tla_win32](../../../../includes/tlasharptla-win32-md.md)]. В действительности диспетчер [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] использует сообщения User32 для выполнения межпоточных вызовов.</span><span class="sxs-lookup"><span data-stu-id="921aa-123">This works much like the familiar [!INCLUDE[TLA#tla_win32](../../../../includes/tlasharptla-win32-md.md)] message pump; in fact, the [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] dispatcher uses User32 messages for performing cross thread calls.</span></span>  
  
 <span data-ttu-id="921aa-124">Существует два основных понятия при обсуждении параллелизма в [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)]: диспетчер и сходство потоков.</span><span class="sxs-lookup"><span data-stu-id="921aa-124">There are really two core concepts to understand when discussing concurrency in [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] – the dispatcher and thread affinity.</span></span>  
  
 <span data-ttu-id="921aa-125">На этапе проектирования [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] основной целью был переход к одному потоку выполнения при непотоковой модели "со сходством".</span><span class="sxs-lookup"><span data-stu-id="921aa-125">During the design phase of [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)], the goal was to move to a single thread of execution, but a non-thread "affinitized" model.</span></span> <span data-ttu-id="921aa-126">Сходство потоков случается, когда компонент использует идентификатор выполняемого потока для сохранения некоторых типов состояния.</span><span class="sxs-lookup"><span data-stu-id="921aa-126">Thread affinity happens when a component uses the identity of the executing thread to store some type of state.</span></span> <span data-ttu-id="921aa-127">Наиболее распространенной формой этого является использование локальной памяти потока (TLS) для сохранения состояния.</span><span class="sxs-lookup"><span data-stu-id="921aa-127">The most common form of this is to use the thread local store (TLS) to store state.</span></span> <span data-ttu-id="921aa-128">Сходство потоков требует, чтобы каждый логический поток выполнения принадлежал только одному физическому потоку в операционной системе, что создает большую нагрузку на память.</span><span class="sxs-lookup"><span data-stu-id="921aa-128">Thread affinity requires that each logical thread of execution be owned by only one physical thread in the operating system, which can become memory intensive.</span></span> <span data-ttu-id="921aa-129">В итоге потоковая модель WPF осталась согласованной с существующей потоковой моделью User32 однопотокового выполнения со сходством потоков.</span><span class="sxs-lookup"><span data-stu-id="921aa-129">In the end, WPF’s threading model was kept in sync with the existing User32 threading model of single threaded execution with thread affinity.</span></span> <span data-ttu-id="921aa-130">Основной причиной этого явилась возможность взаимодействия — для всех систем, таких как [!INCLUDE[TLA2#tla_ole2.0](../../../../includes/tla2sharptla-ole2-0-md.md)], буфер обмена и Internet Explorer, требуется выполнение в одном сходном потоке (STA).</span><span class="sxs-lookup"><span data-stu-id="921aa-130">The primary reason for this was interoperability – systems like [!INCLUDE[TLA2#tla_ole2.0](../../../../includes/tla2sharptla-ole2-0-md.md)], the clipboard, and Internet Explorer all require single thread affinity (STA) execution.</span></span>  
  
 <span data-ttu-id="921aa-131">При наличии объектов с организацией потоковой обработки STA необходим способ связи между потоками и проверки нахождения в правильном потоке.</span><span class="sxs-lookup"><span data-stu-id="921aa-131">Given that you have objects with STA threading, you need a way to communicate between threads, and validate that you are on the correct thread.</span></span> <span data-ttu-id="921aa-132">В этом заключается роль диспетчера.</span><span class="sxs-lookup"><span data-stu-id="921aa-132">Herein lies the role of the dispatcher.</span></span> <span data-ttu-id="921aa-133">Диспетчер — это основная система управления сообщениями, включающая несколько очередей с назначенными приоритетами.</span><span class="sxs-lookup"><span data-stu-id="921aa-133">The dispatcher is a basic message dispatching system, with multiple prioritized queues.</span></span> <span data-ttu-id="921aa-134">Примеры сообщений включают необработанные входящие уведомления (перемещение мыши), функции платформы (макет) или пользовательские команды (выполнение этого метода).</span><span class="sxs-lookup"><span data-stu-id="921aa-134">Examples of messages include raw input notifications (mouse moved), framework functions (layout), or user commands (execute this method).</span></span> <span data-ttu-id="921aa-135">Производя от <xref:System.Windows.Threading.DispatcherObject>, вы создаете объект CLR, имеющий поведение STA, и ему присваивается указатель на Dispatcher во время создания.</span><span class="sxs-lookup"><span data-stu-id="921aa-135">By deriving from <xref:System.Windows.Threading.DispatcherObject>, you create a CLR object that has STA behavior, and will be given a pointer to a dispatcher at creation time.</span></span>  
  
<a name="System_Windows_DependencyObject"></a>   
## <a name="systemwindowsdependencyobject"></a><span data-ttu-id="921aa-136">System.Windows.DependencyObject</span><span class="sxs-lookup"><span data-stu-id="921aa-136">System.Windows.DependencyObject</span></span>  
 <span data-ttu-id="921aa-137">Одним из основных архитектурных принципов, использовавшихся в построении [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)], является предпочтение свойств методам или событиям.</span><span class="sxs-lookup"><span data-stu-id="921aa-137">One of the primary architectural philosophies used in building [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] was a preference for properties over methods or events.</span></span> <span data-ttu-id="921aa-138">Свойства являются декларативными, и с их помощью проще указать цель, а не действие.</span><span class="sxs-lookup"><span data-stu-id="921aa-138">Properties are declarative and allow you to more easily specify intent instead of action.</span></span> <span data-ttu-id="921aa-139">Поддерживается также система для отображения содержимого пользовательского интерфейса на основе моделей (или данных).</span><span class="sxs-lookup"><span data-stu-id="921aa-139">This also supported a model driven, or data driven, system for displaying user interface content.</span></span> <span data-ttu-id="921aa-140">Такой подход обусловил создание дополнительных свойств, к которым можно осуществить привязку в целях лучшего управления поведением приложения.</span><span class="sxs-lookup"><span data-stu-id="921aa-140">This philosophy had the intended effect of creating more properties that you could bind to, in order to better control the behavior of an application.</span></span>  
  
 <span data-ttu-id="921aa-141">Для обеспечения большей части системы, управляемой свойствами, более обширная система свойств, чем нужна среда CLR.</span><span class="sxs-lookup"><span data-stu-id="921aa-141">In order to have more of the system driven by properties, a richer property system than what the CLR provides was needed.</span></span> <span data-ttu-id="921aa-142">Простым примером такой полноты являются уведомления об изменении.</span><span class="sxs-lookup"><span data-stu-id="921aa-142">A simple example of this richness is change notifications.</span></span> <span data-ttu-id="921aa-143">Для двусторонней привязки необходимо, чтобы обе стороны привязки поддерживали уведомления об изменениях.</span><span class="sxs-lookup"><span data-stu-id="921aa-143">In order to enable two way binding, you need both sides of the bind to support change notification.</span></span> <span data-ttu-id="921aa-144">Чтобы поведение зависело от значений свойств, необходимо получать уведомление в случае изменения значения свойства.</span><span class="sxs-lookup"><span data-stu-id="921aa-144">In order to have behavior tied to property values, you need to be notified when the property value changes.</span></span> <span data-ttu-id="921aa-145">Платформа Microsoft .NET имеет интерфейс **INotifyPropertyChange**, позволяющий объекту публиковать уведомления об изменениях, однако это необязательно.</span><span class="sxs-lookup"><span data-stu-id="921aa-145">The Microsoft .NET Framework has an interface, **INotifyPropertyChange**, which allows an object to publish change notifications, however it is optional.</span></span>  
  
 [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] <span data-ttu-id="921aa-146">предоставляет более обширную систему свойств, производную от типа <xref:System.Windows.DependencyObject>.</span><span class="sxs-lookup"><span data-stu-id="921aa-146">provides a richer property system, derived from the <xref:System.Windows.DependencyObject> type.</span></span> <span data-ttu-id="921aa-147">Система свойств действительно является системой свойств "зависимостей" в том смысле, что она отслеживает зависимости между выражениями свойств и автоматически проверяет значение свойства при изменении зависимости.</span><span class="sxs-lookup"><span data-stu-id="921aa-147">The property system is truly a "dependency" property system in that it tracks dependencies between property expressions and automatically revalidates property values when dependencies change.</span></span> <span data-ttu-id="921aa-148">Например, если имеется свойство, наследуемое (например, <xref:System.Windows.Controls.Control.FontSize%2A>), система автоматически обновляется, если свойство изменяется в родительском элементе элемента, который наследует значение.</span><span class="sxs-lookup"><span data-stu-id="921aa-148">For example, if you have a property that inherits (like <xref:System.Windows.Controls.Control.FontSize%2A>), the system is automatically updated if the property changes on a parent of an element that inherits the value.</span></span>  
  
 <span data-ttu-id="921aa-149">Основой системы свойств [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] является понятие "выражение свойства".</span><span class="sxs-lookup"><span data-stu-id="921aa-149">The foundation of the [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] property system is the concept of a property expression.</span></span> <span data-ttu-id="921aa-150">В этом первом выпуске [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] система выражений свойств закрыта и все выражения предоставлены как часть платформы.</span><span class="sxs-lookup"><span data-stu-id="921aa-150">In this first release of [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)], the property expression system is closed, and the expressions are all provided as part of the framework.</span></span> <span data-ttu-id="921aa-151">Выражения объясняют, почему система свойств не поддерживает привязку к данным, создание стилей или жестко заданное наследование, но вместо этого представлена слоями более поздних версий в платформе.</span><span class="sxs-lookup"><span data-stu-id="921aa-151">Expressions are why the property system doesn’t have data binding, styling, or inheritance hard coded, but rather provided by later layers within the framework.</span></span>  
  
 <span data-ttu-id="921aa-152">Система свойств также предоставляет способ разреженного хранения значений свойств.</span><span class="sxs-lookup"><span data-stu-id="921aa-152">The property system also provides for sparse storage of property values.</span></span> <span data-ttu-id="921aa-153">Так как объекты могут иметь десятки (если не сотни) свойств и большинство значений находится в состоянии по умолчанию (унаследованы, задаются стилем и т. д.), не каждый экземпляр объекта должен иметь все определенные в нем свойства в полном объеме.</span><span class="sxs-lookup"><span data-stu-id="921aa-153">Because objects can have dozens (if not hundreds) of properties, and most of the values are in their default state (inherited, set by styles, etc.), not every instance of an object needs to have the full weight of every property defined on it.</span></span>  
  
 <span data-ttu-id="921aa-154">Наконец, последняя новая особенность системы свойств — это понятие присоединенных свойств.</span><span class="sxs-lookup"><span data-stu-id="921aa-154">The final new feature of the property system is the notion of attached properties.</span></span> <span data-ttu-id="921aa-155">Элементы [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] базируются на принципе композиции и многократного использования компонентов.</span><span class="sxs-lookup"><span data-stu-id="921aa-155">[!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] elements are built on the principle of composition and component reuse.</span></span> <span data-ttu-id="921aa-156">Часто бывает так, что некоторым содержащим элементом (например, элементу макета <xref:System.Windows.Controls.Grid>) требуются дополнительные данные дочерних элементов, чтобы управлять его поведением (например, сведениями о строках и столбцах).</span><span class="sxs-lookup"><span data-stu-id="921aa-156">It is often the case that some containing element (like a <xref:System.Windows.Controls.Grid> layout element) needs additional data on child elements to control its behavior (like the Row/Column information).</span></span> <span data-ttu-id="921aa-157">Вместо того чтобы сопоставлять все эти свойства с каждым элементом, любой объект может предоставить определения свойств для любого другого объекта.</span><span class="sxs-lookup"><span data-stu-id="921aa-157">Instead of associating all of these properties with every element, any object is allowed to provide property definitions for any other object.</span></span> <span data-ttu-id="921aa-158">Это похоже на возможности expando в JavaScript.</span><span class="sxs-lookup"><span data-stu-id="921aa-158">This is similar to the "expando" features of JavaScript.</span></span>  
  
<a name="System_Windows_Media_Visual"></a>   
## <a name="systemwindowsmediavisual"></a><span data-ttu-id="921aa-159">System.Windows.Media.Visual</span><span class="sxs-lookup"><span data-stu-id="921aa-159">System.Windows.Media.Visual</span></span>  
 <span data-ttu-id="921aa-160">После определения системы следующим шагом является рисование пикселей на экране.</span><span class="sxs-lookup"><span data-stu-id="921aa-160">With a system defined, the next step is getting pixels drawn to the screen.</span></span> <span data-ttu-id="921aa-161">Класс <xref:System.Windows.Media.Visual> предоставляет для создания дерева визуальных объектов, каждый из которых при необходимости содержит инструкции по рисованию и метаданные о том, как визуализировать эти инструкции (обрезка, преобразование и т. д.).</span><span class="sxs-lookup"><span data-stu-id="921aa-161">The <xref:System.Windows.Media.Visual> class provides for building a tree of visual objects, each optionally containing drawing instructions and metadata about how to render those instructions (clipping, transformation, etc.).</span></span> <span data-ttu-id="921aa-162"><xref:System.Windows.Media.Visual> является чрезвычайно упрощенной и гибкой, поэтому большинство функций не имеют открытых интерфейсов API и сильно зависят от защищенных функций обратного вызова.</span><span class="sxs-lookup"><span data-stu-id="921aa-162"><xref:System.Windows.Media.Visual> is designed to be extremely lightweight and flexible, so most of the features have no public API exposure and rely heavily on protected callback functions.</span></span>  
  
 <span data-ttu-id="921aa-163"><xref:System.Windows.Media.Visual> на самом деле является точкой входа в систему [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] компоновки.</span><span class="sxs-lookup"><span data-stu-id="921aa-163"><xref:System.Windows.Media.Visual> is really the entry point to the [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] composition system.</span></span> <span data-ttu-id="921aa-164"><xref:System.Windows.Media.Visual> является точкой подключения между этими двумя подсистемами, управляемым API и неуправляемым milcore.</span><span class="sxs-lookup"><span data-stu-id="921aa-164"><xref:System.Windows.Media.Visual> is the point of connection between these two subsystems, the managed API and the unmanaged milcore.</span></span>  
  
 [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] <span data-ttu-id="921aa-165">отображает данные, проходя по неуправляемым структурам данных под управлением milcore.</span><span class="sxs-lookup"><span data-stu-id="921aa-165">displays data by traversing the unmanaged data structures managed by the milcore.</span></span> <span data-ttu-id="921aa-166">Эти структуры, называемые узлами композиции, представляют собой иерархическое дерево отображения с инструкциями по отрисовке в каждом узле.</span><span class="sxs-lookup"><span data-stu-id="921aa-166">These structures, called composition nodes, represent a hierarchical display tree with rendering instructions at each node.</span></span> <span data-ttu-id="921aa-167">Это дерево, показанное в правой части расположенного ниже рисунка, доступно только через протокол обмена сообщениями.</span><span class="sxs-lookup"><span data-stu-id="921aa-167">This tree, illustrated on the right hand side of the figure below, is only accessible through a messaging protocol.</span></span>  
  
 <span data-ttu-id="921aa-168">При программировании [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)]создаются <xref:System.Windows.Media.Visual> элементы и производные типы, которые внутренне взаимодействуют с деревом композиции через этот протокол обмена сообщениями.</span><span class="sxs-lookup"><span data-stu-id="921aa-168">When programming [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)], you create <xref:System.Windows.Media.Visual> elements, and derived types, which internally communicate to the composition tree through this messaging protocol.</span></span> <span data-ttu-id="921aa-169">Каждый <xref:System.Windows.Media.Visual> в [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] может создать один или несколько узлов композиции.</span><span class="sxs-lookup"><span data-stu-id="921aa-169">Each <xref:System.Windows.Media.Visual> in [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] may create one, none, or several composition nodes.</span></span>  
  
 <span data-ttu-id="921aa-170">![Визуальное дерево Windows Presentation Foundation.](./media/wpf-architecture2.PNG "wpf_architecture2")</span><span class="sxs-lookup"><span data-stu-id="921aa-170">![The Windows Presentation Foundation Visual Tree.](./media/wpf-architecture2.PNG "wpf_architecture2")</span></span>  
  
 <span data-ttu-id="921aa-171">Здесь имеется один очень важный архитектурный момент — все дерево визуальных объектов и инструкций по рисованию кэшируется.</span><span class="sxs-lookup"><span data-stu-id="921aa-171">There is a very important architectural detail to notice here – the entire tree of visuals and drawing instructions is cached.</span></span> <span data-ttu-id="921aa-172">С графической точки зрения, [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] использует систему сохраненной отрисовки.</span><span class="sxs-lookup"><span data-stu-id="921aa-172">In graphics terms, [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] uses a retained rendering system.</span></span> <span data-ttu-id="921aa-173">Это позволяет системе осуществлять перерисовку с высокой частотой без блокирования системы композиции при обратных вызовах, обращенных к коду пользователя.</span><span class="sxs-lookup"><span data-stu-id="921aa-173">This enables the system to repaint at high refresh rates without the composition system blocking on callbacks to user code.</span></span> <span data-ttu-id="921aa-174">Это помогает предотвратить признаки неотвечающего приложения.</span><span class="sxs-lookup"><span data-stu-id="921aa-174">This helps prevent the appearance of an unresponsive application.</span></span>  
  
 <span data-ttu-id="921aa-175">Другим важным моментом, который не заметен на схеме, является то, как система в действительности выполняет композицию.</span><span class="sxs-lookup"><span data-stu-id="921aa-175">Another important detail that isn’t really noticeable in the diagram is how the system actually performs composition.</span></span>  
  
 <span data-ttu-id="921aa-176">В user32 и GDI система работает в режиме немедленной обрезки системы.</span><span class="sxs-lookup"><span data-stu-id="921aa-176">In User32 and GDI, the system works on an immediate mode clipping system.</span></span> <span data-ttu-id="921aa-177">Когда требуется визуализация компонента, система устанавливает границы обрезки, вне которых компонент не может изменять пиксели, а затем компонент запрашивает рисование пикселей в этой области.</span><span class="sxs-lookup"><span data-stu-id="921aa-177">When a component needs to be rendered, the system establishes a clipping bounds outside of which the component isn’t allowed to touch the pixels, and then the component is asked to paint pixels in that box.</span></span> <span data-ttu-id="921aa-178">Эта система работает очень хорошо в системах с ограниченной памятью, так как в случае каких-либо изменений приходится иметь дело только с измененным компонентом — два компонента никогда не воздействуют на цвет одного пикселя.</span><span class="sxs-lookup"><span data-stu-id="921aa-178">This system works very well in memory constrained systems because when something changes you only have to touch the affected component – no two components ever contribute to the color of a single pixel.</span></span>  
  
 [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] <span data-ttu-id="921aa-179">использует "алгоритм рисования" для модели рисования.</span><span class="sxs-lookup"><span data-stu-id="921aa-179">uses a "painter's algorithm" painting model.</span></span> <span data-ttu-id="921aa-180">Это означает, что вместо обрезки каждого компонента каждый компонент запрашивается для отрисовки, начиная с заднего плана и до переднего плана отображения.</span><span class="sxs-lookup"><span data-stu-id="921aa-180">This means that instead of clipping each component, each component is asked to render from the back to the front of the display.</span></span> <span data-ttu-id="921aa-181">Это позволяет рисовать каждый компонент поверх отображения предыдущего компонента.</span><span class="sxs-lookup"><span data-stu-id="921aa-181">This allows each component to paint over the previous component's display.</span></span> <span data-ttu-id="921aa-182">Преимуществом этой модели является то, что можно создавать сложные полупрозрачные фигуры.</span><span class="sxs-lookup"><span data-stu-id="921aa-182">The advantage of this model is that you can have complex, partially transparent shapes.</span></span> <span data-ttu-id="921aa-183">Благодаря современной современного графического оборудования эта модель относительно быстра (что не так, когда создавалась user32 или GDI).</span><span class="sxs-lookup"><span data-stu-id="921aa-183">With today’s modern graphics hardware, this model is relatively fast (which wasn’t the case when User32/ GDI were created).</span></span>  
  
 <span data-ttu-id="921aa-184">Как упоминалось ранее, основным принципом [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] является переход к более декларативной, "ориентированной на свойства" модели программирования.</span><span class="sxs-lookup"><span data-stu-id="921aa-184">As mentioned previously, a core philosophy of [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] is to move to a more declarative, "property centric" model of programming.</span></span> <span data-ttu-id="921aa-185">В визуальной системе это проявляется в паре любопытных моментов.</span><span class="sxs-lookup"><span data-stu-id="921aa-185">In the visual system, this shows up in a couple of interesting places.</span></span>  
  
 <span data-ttu-id="921aa-186">Во-первых, если говорить о сохраненном режиме графической системы, он действительно отражает переход от императивной модели DrawLine/DrawLine к модели, ориентированной на данные, — new Line()/new Line().</span><span class="sxs-lookup"><span data-stu-id="921aa-186">First, if you think about the retained mode graphic system, this is really moving away from an imperative DrawLine/DrawLine type model, to a data oriented model – new Line()/new Line().</span></span> <span data-ttu-id="921aa-187">Этот переход к управляемой данными отрисовке позволяет выполнять сложные операции в инструкциях по рисованию, выражаемых с помощью свойств.</span><span class="sxs-lookup"><span data-stu-id="921aa-187">This move to data driven rendering allows complex operations on the drawing instructions to be expressed using properties.</span></span> <span data-ttu-id="921aa-188">Типы, производные от <xref:System.Windows.Media.Drawing>, фактически являются объектной моделью для подготовки к просмотру.</span><span class="sxs-lookup"><span data-stu-id="921aa-188">The types deriving from <xref:System.Windows.Media.Drawing> are effectively the object model for rendering.</span></span>  
  
 <span data-ttu-id="921aa-189">Во-вторых, оценивая систему анимации, можно увидеть, что она является практически полностью декларативной.</span><span class="sxs-lookup"><span data-stu-id="921aa-189">Second, if you evaluate the animation system, you'll see that it is almost completely declarative.</span></span> <span data-ttu-id="921aa-190">Вместо обязательного вычисления разработчиком следующего положения или цвета можно выразить анимации как набор свойств для объекта анимации.</span><span class="sxs-lookup"><span data-stu-id="921aa-190">Instead of requiring a developer to compute the next location, or next color, you can express animations as a set of properties on an animation object.</span></span> <span data-ttu-id="921aa-191">Эти анимации могут выражать замыслы разработчика или проектировщика (переместить эту кнопку отсюда туда в течение 5 секунд), и система может определить наиболее эффективный способ для их выполнения.</span><span class="sxs-lookup"><span data-stu-id="921aa-191">These animations can then express the intent of the developer or designer (move this button from here to there in 5 seconds), and the system can determine the most efficient way to accomplish that.</span></span>  
  
<a name="System_Windows_UIElement"></a>   
## <a name="systemwindowsuielement"></a><span data-ttu-id="921aa-192">System.Windows.UIElement</span><span class="sxs-lookup"><span data-stu-id="921aa-192">System.Windows.UIElement</span></span>  
 <span data-ttu-id="921aa-193"><xref:System.Windows.UIElement> определяет основные подсистемы, включая макет, ввод и события.</span><span class="sxs-lookup"><span data-stu-id="921aa-193"><xref:System.Windows.UIElement> defines core subsystems including Layout, Input, and Events.</span></span>  
  
 <span data-ttu-id="921aa-194">Макет представляет собой основное понятие в [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)].</span><span class="sxs-lookup"><span data-stu-id="921aa-194">Layout is a core concept in [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)].</span></span> <span data-ttu-id="921aa-195">Во многих системах либо присутствует фиксированный набор моделей для макетов (HTML поддерживает три модели для макетов: поток, абсолютное значение и таблицы), либо вообще нет модели для макета (User32 в действительности поддерживает только абсолютное размещение).</span><span class="sxs-lookup"><span data-stu-id="921aa-195">In many systems there is either a fixed set of layout models (HTML supports three models for layout; flow, absolute, and tables) or no model for layout (User32 really only supports absolute positioning).</span></span> <span data-ttu-id="921aa-196">Предпосылкой для создания [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] стало желание разработчиков и конструкторов иметь гибкую, расширяемую модель макета, которая управлялась бы значениями свойств, а не императивной логикой.</span><span class="sxs-lookup"><span data-stu-id="921aa-196">[!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] started with the assumption that developers and designers wanted a flexible, extensible layout model, which could be driven by property values rather than imperative logic.</span></span> <span data-ttu-id="921aa-197">На уровне <xref:System.Windows.UIElement> доступен базовый контракт для макета — модель из двух этапов с <xref:System.Windows.UIElement.Measure%2A> и <xref:System.Windows.UIElement.Arrange%2A>.</span><span class="sxs-lookup"><span data-stu-id="921aa-197">At the <xref:System.Windows.UIElement> level, the basic contract for layout is introduced – a two phase model with <xref:System.Windows.UIElement.Measure%2A> and <xref:System.Windows.UIElement.Arrange%2A> passes.</span></span>  
  
 <span data-ttu-id="921aa-198"><xref:System.Windows.UIElement.Measure%2A> позволяет компоненту определить размер, который должен быть занят.</span><span class="sxs-lookup"><span data-stu-id="921aa-198"><xref:System.Windows.UIElement.Measure%2A> allows a component to determine how much size it would like to take.</span></span> <span data-ttu-id="921aa-199">Это отдельный этап от <xref:System.Windows.UIElement.Arrange%2A>, так как существует множество ситуаций, когда родительский элемент запрашивает у дочернего элемента несколько раз, чтобы определить его оптимальное расположение и размер.</span><span class="sxs-lookup"><span data-stu-id="921aa-199">This is a separate phase from <xref:System.Windows.UIElement.Arrange%2A> because there are many situations where a parent element will ask a child to measure several times to determine its optimal position and size.</span></span> <span data-ttu-id="921aa-200">Тот факт, что родительские элементы запрашивают измерение дочерних, демонстрирует еще один ключевой принцип [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] — размер по содержимому.</span><span class="sxs-lookup"><span data-stu-id="921aa-200">The fact that parent elements ask child elements to measure demonstrates another key philosophy of [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] – size to content.</span></span> <span data-ttu-id="921aa-201">Все элементы управления в [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] поддерживают возможность изменения размера по размеру их содержимого.</span><span class="sxs-lookup"><span data-stu-id="921aa-201">All controls in [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] support the ability to size to the natural size of their content.</span></span> <span data-ttu-id="921aa-202">Это значительно упрощает локализацию и позволяет осуществлять динамическую компоновку элементов в соответствии с изменением размеров.</span><span class="sxs-lookup"><span data-stu-id="921aa-202">This makes localization much easier, and allows for dynamic layout of elements as things resize.</span></span> <span data-ttu-id="921aa-203">Этап <xref:System.Windows.UIElement.Arrange%2A> позволяет родительскому элементу позиционировать и определять конечный размер каждого дочернего элемента.</span><span class="sxs-lookup"><span data-stu-id="921aa-203">The <xref:System.Windows.UIElement.Arrange%2A> phase allows a parent to position and determine the final size of each child.</span></span>  
  
 <span data-ttu-id="921aa-204">Часто приходится говорить о части выходных данных [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] – <xref:System.Windows.Media.Visual> и связанных с ними объектов.</span><span class="sxs-lookup"><span data-stu-id="921aa-204">A lot of time is often spent talking about the output side of [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] – <xref:System.Windows.Media.Visual> and related objects.</span></span> <span data-ttu-id="921aa-205">Однако существует также множество новшеств со стороны ввода данных.</span><span class="sxs-lookup"><span data-stu-id="921aa-205">However there is a tremendous amount of innovation on the input side as well.</span></span> <span data-ttu-id="921aa-206">Вероятно, наиболее фундаментальным изменением в модели ввода для [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] является согласованная модель, в соответствии с которой события ввода направляются через систему.</span><span class="sxs-lookup"><span data-stu-id="921aa-206">Probably the most fundamental change in the input model for [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] is the consistent model by which input events are routed through the system.</span></span>  
  
 <span data-ttu-id="921aa-207">Ввод возникает как сигнал драйверу устройства режима ядра и направляется в нужный процесс и поток через сложный процесс, в котором участвуют ядро Windows и User32.</span><span class="sxs-lookup"><span data-stu-id="921aa-207">Input originates as a signal on a kernel mode device driver and gets routed to the correct process and thread through an intricate process involving the Windows kernel and User32.</span></span> <span data-ttu-id="921aa-208">После того как сообщение User32, соответствующее входным данным, направлено в [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)], оно преобразуется в сообщение с необработанными входными данными [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] и отправляется диспетчеру.</span><span class="sxs-lookup"><span data-stu-id="921aa-208">Once the User32 message corresponding to the input is routed to [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)], it is converted into a [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] raw input message and sent to the dispatcher.</span></span> [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] <span data-ttu-id="921aa-209">позволяет преобразовывать события с необработанными входными данными в несколько фактических событий, обеспечивая реализацию таких функций, как MouseEnter, на низких уровнях системы с гарантированной доставкой.</span><span class="sxs-lookup"><span data-stu-id="921aa-209">allows for raw input events to be converted to multiple actual events, enabling features like "MouseEnter" to be implemented at a low level of the system with guaranteed delivery.</span></span>  
  
 <span data-ttu-id="921aa-210">Каждое событие ввода преобразуется по крайней мере в два события: событие предварительное и событие фактическое.</span><span class="sxs-lookup"><span data-stu-id="921aa-210">Each input event is converted to at least two events – a "preview" event and the actual event.</span></span> <span data-ttu-id="921aa-211">Все события в [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] имеют представление о маршрутизации через дерево элементов.</span><span class="sxs-lookup"><span data-stu-id="921aa-211">All events in [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] have a notion of routing through the element tree.</span></span> <span data-ttu-id="921aa-212">События говорят «пузырьковой», если они переходят от конечной папки к корневому элементу, и говорят о «туннеле», если они начинаются с корня и проходят до целевого объекта.</span><span class="sxs-lookup"><span data-stu-id="921aa-212">Events are said to "bubble" if they traverse from a target up the tree to the root, and are said to "tunnel" if they start at the root and traverse down to a target.</span></span> <span data-ttu-id="921aa-213">Предварительные события ввода перемещаются по нисходящей, причем любые элементы в дереве могут фильтровать или обрабатывать событие.</span><span class="sxs-lookup"><span data-stu-id="921aa-213">Input preview events tunnel, enabling any element in the tree an opportunity to filter or take action on the event.</span></span> <span data-ttu-id="921aa-214">Обычные события (не предварительные) перемещаются по восходящей от конечной точки вверх к корню.</span><span class="sxs-lookup"><span data-stu-id="921aa-214">The regular (non-preview) events then bubble from the target up to the root.</span></span>  
  
 <span data-ttu-id="921aa-215">Это разделение между нисходящим и восходящими этапами делает возможным согласованную реализацию таких возможностей, как сочетания клавиш.</span><span class="sxs-lookup"><span data-stu-id="921aa-215">This split between the tunnel and bubble phase makes implementation of features like keyboard accelerators work in a consistent fashion in a composite world.</span></span> <span data-ttu-id="921aa-216">В User32 сочетания клавиш реализуются посредством одной глобальной таблицы, содержащей все необходимые сочетания клавиш (CTRL+N сопоставляется с командой "Создать").</span><span class="sxs-lookup"><span data-stu-id="921aa-216">In User32 you would implement keyboard accelerators by having a single global table containing all the accelerators you wanted to support (Ctrl+N mapping to "New").</span></span> <span data-ttu-id="921aa-217">В диспетчере приложения вызывается метод **TranslateAccelerator**, который будет анализировать сообщения ввода в User32 и определять их соответствие зарегистрированному сочетанию клавиш.</span><span class="sxs-lookup"><span data-stu-id="921aa-217">In the dispatcher for your application you would call **TranslateAccelerator** which would sniff the input messages in User32 and determine if any matched a registered accelerator.</span></span> <span data-ttu-id="921aa-218">В [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] это не работает, так как система полностью "компонуема" — любой элемент может обрабатывать и использовать любые сочетания клавиш.</span><span class="sxs-lookup"><span data-stu-id="921aa-218">In [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] this wouldn’t work because the system is fully "composable" – any element can handle and use any keyboard accelerator.</span></span> <span data-ttu-id="921aa-219">Наличие такой двухэтапной модели для ввода позволяет компонентам реализовать собственные методы TranslateAccelerator.</span><span class="sxs-lookup"><span data-stu-id="921aa-219">Having this two phase model for input allows components to implement their own "TranslateAccelerator".</span></span>  
  
 <span data-ttu-id="921aa-220">Чтобы выполнить этот шаг дальше, <xref:System.Windows.UIElement> также познакомится с понятием CommandBindings.</span><span class="sxs-lookup"><span data-stu-id="921aa-220">To take this one step further, <xref:System.Windows.UIElement> also introduces the notion of CommandBindings.</span></span> <span data-ttu-id="921aa-221">Система команд [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] позволяет разработчикам определять функциональные возможности в терминах конечной точки команды — что-то, которое реализует <xref:System.Windows.Input.ICommand>.</span><span class="sxs-lookup"><span data-stu-id="921aa-221">The [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] command system allows developers to define functionality in terms of a command end point – something that implements <xref:System.Windows.Input.ICommand>.</span></span> <span data-ttu-id="921aa-222">Привязки команд позволяют элементу определять соответствие между действием ввода (CTRL+N) и командой ("Создать").</span><span class="sxs-lookup"><span data-stu-id="921aa-222">Command bindings enable an element to define a mapping between an input gesture (Ctrl+N) and a command (New).</span></span> <span data-ttu-id="921aa-223">И действия ввода, и определения команд являются расширяемыми и могут быть связаны вместе во время использования.</span><span class="sxs-lookup"><span data-stu-id="921aa-223">Both the input gestures and command definitions are extensible, and can be wired together at usage time.</span></span> <span data-ttu-id="921aa-224">Это делается, например, для того чтобы конечный пользователь мог легко настраивать привязки клавиш, которые ему необходимо использовать в приложении.</span><span class="sxs-lookup"><span data-stu-id="921aa-224">This makes it trivial, for example, to allow an end user to customize the key bindings that they want to use within an application.</span></span>  
  
 <span data-ttu-id="921aa-225">До этого момента в разделе рассматривались "основные" возможности [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] — возможности, реализованные в сборке PresentationCore.</span><span class="sxs-lookup"><span data-stu-id="921aa-225">To this point in the topic, "core" features of [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] – features implemented in the PresentationCore assembly, have been the focus.</span></span> <span data-ttu-id="921aa-226">При создании [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)]нужно четкое разделение между базовыми частями (например, контрактом для макета с **мерами** и структурой **) и**элементами платформы (например, реализация определенного макета, например <xref:System.Windows.Controls.Grid>), была желаемым результатом.</span><span class="sxs-lookup"><span data-stu-id="921aa-226">When building [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)], a clean separation between foundational pieces (like the contract for layout with **Measure** and **Arrange**) and framework pieces (like the implementation of a specific layout like <xref:System.Windows.Controls.Grid>) was the desired outcome.</span></span> <span data-ttu-id="921aa-227">Целью являлось предоставление точки расширяемости внизу стека, что позволило бы внешним разработчикам при необходимости создавать свои собственные платформы.</span><span class="sxs-lookup"><span data-stu-id="921aa-227">The goal was to provide an extensibility point low in the stack that would allow external developers to create their own frameworks if needed.</span></span>  
  
<a name="System_Windows_FrameworkElement"></a>   
## <a name="systemwindowsframeworkelement"></a><span data-ttu-id="921aa-228">System.Windows.FrameworkElement</span><span class="sxs-lookup"><span data-stu-id="921aa-228">System.Windows.FrameworkElement</span></span>  
 <span data-ttu-id="921aa-229"><xref:System.Windows.FrameworkElement> можно рассматривать двумя разными способами.</span><span class="sxs-lookup"><span data-stu-id="921aa-229"><xref:System.Windows.FrameworkElement> can be looked at in two different ways.</span></span> <span data-ttu-id="921aa-230">Он предоставляет набор политик и настроек для подсистем, введенных на нижнем уровне [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)].</span><span class="sxs-lookup"><span data-stu-id="921aa-230">It introduces a set of policies and customizations on the subsystems introduced in lower layers of [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)].</span></span> <span data-ttu-id="921aa-231">В нем также вводится набор новых подсистем.</span><span class="sxs-lookup"><span data-stu-id="921aa-231">It also introduces a set of new subsystems.</span></span>  
  
 <span data-ttu-id="921aa-232">Основная политика, появившаяся <xref:System.Windows.FrameworkElement>, связана с макетом приложения.</span><span class="sxs-lookup"><span data-stu-id="921aa-232">The primary policy introduced by <xref:System.Windows.FrameworkElement> is around application layout.</span></span> <span data-ttu-id="921aa-233"><xref:System.Windows.FrameworkElement> основан на базовом контракте макета, представленном <xref:System.Windows.UIElement>, и добавляет понятие "слот" макета, что упрощает авторам макетов единообразный набор семантик макетов, управляемых свойствами.</span><span class="sxs-lookup"><span data-stu-id="921aa-233"><xref:System.Windows.FrameworkElement> builds on the basic layout contract introduced by <xref:System.Windows.UIElement> and adds the notion of a layout "slot" that makes it easier for layout authors to have a consistent set of property driven layout semantics.</span></span> <span data-ttu-id="921aa-234">Такие свойства, как <xref:System.Windows.FrameworkElement.HorizontalAlignment%2A>, <xref:System.Windows.FrameworkElement.VerticalAlignment%2A>, <xref:System.Windows.FrameworkElement.MinWidth%2A>и <xref:System.Windows.FrameworkElement.Margin%2A> (несколько имен), предоставляют всем компонентам, производным от <xref:System.Windows.FrameworkElement>, единообразное поведение в контейнерах макета.</span><span class="sxs-lookup"><span data-stu-id="921aa-234">Properties like <xref:System.Windows.FrameworkElement.HorizontalAlignment%2A>, <xref:System.Windows.FrameworkElement.VerticalAlignment%2A>, <xref:System.Windows.FrameworkElement.MinWidth%2A>, and <xref:System.Windows.FrameworkElement.Margin%2A> (to name a few) give all components derived from <xref:System.Windows.FrameworkElement> consistent behavior inside of layout containers.</span></span>  
  
 <span data-ttu-id="921aa-235"><xref:System.Windows.FrameworkElement> также предоставляет более простой интерфейс API для многих функций, имеющихся в основных уровнях [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)].</span><span class="sxs-lookup"><span data-stu-id="921aa-235"><xref:System.Windows.FrameworkElement> also provides easier API exposure to many features found in the core layers of [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)].</span></span> <span data-ttu-id="921aa-236">Например, <xref:System.Windows.FrameworkElement> предоставляет прямой доступ к анимации с помощью метода <xref:System.Windows.FrameworkElement.BeginStoryboard%2A>.</span><span class="sxs-lookup"><span data-stu-id="921aa-236">For example, <xref:System.Windows.FrameworkElement> provides direct access to animation through the <xref:System.Windows.FrameworkElement.BeginStoryboard%2A> method.</span></span> <span data-ttu-id="921aa-237"><xref:System.Windows.Media.Animation.Storyboard> предоставляет способ создания скрипта для нескольких анимаций по набору свойств.</span><span class="sxs-lookup"><span data-stu-id="921aa-237">A <xref:System.Windows.Media.Animation.Storyboard> provides a way to script multiple animations against a set of properties.</span></span>  
  
 <span data-ttu-id="921aa-238">Две наиболее важные вещи, которые <xref:System.Windows.FrameworkElement> представляют, являются привязкой и стилями данных.</span><span class="sxs-lookup"><span data-stu-id="921aa-238">The two most critical things that <xref:System.Windows.FrameworkElement> introduces are data binding and styles.</span></span>  
  
 <span data-ttu-id="921aa-239">Подсистема привязки данных в [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] должна быть относительно знакома всем, кто использовал [!INCLUDE[TLA#tla_winforms](../../../../includes/tlasharptla-winforms-md.md)] или ASP.NET для создания [!INCLUDE[TLA#tla_ui](../../../../includes/tlasharptla-ui-md.md)]приложений.</span><span class="sxs-lookup"><span data-stu-id="921aa-239">The data binding subsystem in [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] should be relatively familiar to anyone that has used [!INCLUDE[TLA#tla_winforms](../../../../includes/tlasharptla-winforms-md.md)] or ASP.NET for creating an application [!INCLUDE[TLA#tla_ui](../../../../includes/tlasharptla-ui-md.md)].</span></span> <span data-ttu-id="921aa-240">В каждой из этих систем есть простой способ выразить, что одно или несколько свойств данного элемента необходимо привязать к элементу данных.</span><span class="sxs-lookup"><span data-stu-id="921aa-240">In each of these systems, there is a simple way to express that you want one or more properties from a given element to be bound to a piece of data.</span></span> [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] <span data-ttu-id="921aa-241">обладает полным набором возможностей для привязки свойств, преобразования и привязки списков.</span><span class="sxs-lookup"><span data-stu-id="921aa-241">has full support for property binding, transformation, and list binding.</span></span>  
  
 <span data-ttu-id="921aa-242">Одной из наиболее интересных возможностей привязки данных в [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] является введение шаблонов данных.</span><span class="sxs-lookup"><span data-stu-id="921aa-242">One of the most interesting features of data binding in [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] is the introduction of data templates.</span></span> <span data-ttu-id="921aa-243">Шаблоны данных позволяют декларативно указывать способ визуализации фрагмента данных.</span><span class="sxs-lookup"><span data-stu-id="921aa-243">Data templates allow you to declaratively specify how a piece of data should be visualized.</span></span> <span data-ttu-id="921aa-244">Вместо создания настраиваемого пользовательского интерфейса, который может быть привязан к данным, можно обойти проблему и позволить данным определять способ отображения.</span><span class="sxs-lookup"><span data-stu-id="921aa-244">Instead of creating a custom user interface that can be bound to data, you can instead turn the problem around and let the data determine the display that will be created.</span></span>  
  
 <span data-ttu-id="921aa-245">Создание стилей — это облегченная форма привязки данных.</span><span class="sxs-lookup"><span data-stu-id="921aa-245">Styling is really a lightweight form of data binding.</span></span> <span data-ttu-id="921aa-246">Посредством создания стилей можно привязать набор свойств из общего определения к одному или нескольким экземплярам элемента.</span><span class="sxs-lookup"><span data-stu-id="921aa-246">Using styling you can bind a set of properties from a shared definition to one or more instances of an element.</span></span> <span data-ttu-id="921aa-247">Стили применяются к элементу посредством явной ссылки (путем установки свойства <xref:System.Windows.FrameworkElement.Style%2A>) или неявно путем связывания стиля с типом CLR элемента.</span><span class="sxs-lookup"><span data-stu-id="921aa-247">Styles get applied to an element either by explicit reference (by setting the <xref:System.Windows.FrameworkElement.Style%2A> property) or implicitly by associating a style with the CLR type of the element.</span></span>  
  
<a name="System_Windows_Controls_Control"></a>   
## <a name="systemwindowscontrolscontrol"></a><span data-ttu-id="921aa-248">System.Windows.Controls.Control</span><span class="sxs-lookup"><span data-stu-id="921aa-248">System.Windows.Controls.Control</span></span>  
 <span data-ttu-id="921aa-249">Наиболее значимая возможность для элемента управления — это использование шаблонов.</span><span class="sxs-lookup"><span data-stu-id="921aa-249">Control’s most significant feature is templating.</span></span> <span data-ttu-id="921aa-250">Если представлять себе систему композиции WPF как систему отрисовки сохраненного режима, то шаблоны позволяют элементу управления описывать свою отрисовку в параметризированной, декларативной форме.</span><span class="sxs-lookup"><span data-stu-id="921aa-250">If you think about WPF’s composition system as a retained mode rendering system, templating allows a control to describe its rendering in a parameterized, declarative manner.</span></span> <span data-ttu-id="921aa-251"><xref:System.Windows.Controls.ControlTemplate>, на самом деле, является лишь сценарием создания набора дочерних элементов с привязками к свойствам, предлагаемым элементом управления.</span><span class="sxs-lookup"><span data-stu-id="921aa-251">A <xref:System.Windows.Controls.ControlTemplate> is really nothing more than a script to create a set of child elements, with bindings to properties offered by the control.</span></span>  
  
 <span data-ttu-id="921aa-252"><xref:System.Windows.Controls.Control> предоставляет набор стандартных свойств, <xref:System.Windows.Controls.Control.Foreground%2A>, <xref:System.Windows.Controls.Control.Background%2A>, <xref:System.Windows.Controls.Control.Padding%2A>, для названия нескольких, которые авторы шаблонов могут использовать для настройки представления элемента управления.</span><span class="sxs-lookup"><span data-stu-id="921aa-252"><xref:System.Windows.Controls.Control> provides a set of stock properties, <xref:System.Windows.Controls.Control.Foreground%2A>, <xref:System.Windows.Controls.Control.Background%2A>, <xref:System.Windows.Controls.Control.Padding%2A>, to name a few, which template authors can then use to customize the display of a control.</span></span> <span data-ttu-id="921aa-253">Реализация элемента управления обеспечивает модель данных и модель взаимодействия.</span><span class="sxs-lookup"><span data-stu-id="921aa-253">The implementation of a control provides a data model and interaction model.</span></span> <span data-ttu-id="921aa-254">Модель взаимодействия определяет набор команд (таких как "Закрыть" для окна) и привязки к действиям ввода (таким как нажатие красного символа X в верхнем углу окна).</span><span class="sxs-lookup"><span data-stu-id="921aa-254">The interaction model defines a set of commands (like Close for a window) and bindings to input gestures (like clicking the red X in the upper corner of the window).</span></span> <span data-ttu-id="921aa-255">Модель данных предоставляет набор свойств либо для настройки модели взаимодействия, либо для настройки отображения (определяется шаблоном).</span><span class="sxs-lookup"><span data-stu-id="921aa-255">The data model provides a set of properties to either customize the interaction model or customize the display (determined by the template).</span></span>  
  
 <span data-ttu-id="921aa-256">Это разделение между моделью данных (свойства), моделью взаимодействия (команды и события) и моделью отображения (шаблоны) позволяет полностью настроить внешний вид и поведение элемента управления.</span><span class="sxs-lookup"><span data-stu-id="921aa-256">This split between the data model (properties), interaction model (commands and events), and display model (templates) enables complete customization of a control’s look and behavior.</span></span>  
  
 <span data-ttu-id="921aa-257">Типичным аспектом модели данных элементов управления является модель содержимого.</span><span class="sxs-lookup"><span data-stu-id="921aa-257">A common aspect of the data model of controls is the content model.</span></span> <span data-ttu-id="921aa-258">Если взглянуть на элемент управления, например <xref:System.Windows.Controls.Button>, вы увидите, что у него есть свойство с именем "Content" типа <xref:System.Object>.</span><span class="sxs-lookup"><span data-stu-id="921aa-258">If you look at a control like <xref:System.Windows.Controls.Button>, you will see that it has a property named "Content" of type <xref:System.Object>.</span></span> <span data-ttu-id="921aa-259">В [!INCLUDE[TLA#tla_winforms](../../../../includes/tlasharptla-winforms-md.md)] и ASP.NET это свойство обычно является строкой, но ограничивает тип содержимого, которое можно добавить в кнопку.</span><span class="sxs-lookup"><span data-stu-id="921aa-259">In [!INCLUDE[TLA#tla_winforms](../../../../includes/tlasharptla-winforms-md.md)] and ASP.NET, this property would typically be a string – however that limits the type of content you can put in a button.</span></span> <span data-ttu-id="921aa-260">Содержимое для кнопки может представлять собой простую строку, сложный объект данных или все дерево элементов.</span><span class="sxs-lookup"><span data-stu-id="921aa-260">Content for a button can either be a simple string, a complex data object, or an entire element tree.</span></span> <span data-ttu-id="921aa-261">В случае объекта данных используется шаблон данных для создания отображения.</span><span class="sxs-lookup"><span data-stu-id="921aa-261">In the case of a data object, the data template is used to construct a display.</span></span>  
  
<a name="Summary"></a>   
## <a name="summary"></a><span data-ttu-id="921aa-262">Сводка</span><span class="sxs-lookup"><span data-stu-id="921aa-262">Summary</span></span>  
 [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] <span data-ttu-id="921aa-263">предназначается для создания динамических, управляемых данными систем представления.</span><span class="sxs-lookup"><span data-stu-id="921aa-263">is designed to allow you to create dynamic, data driven presentation systems.</span></span> <span data-ttu-id="921aa-264">Каждая часть системы предназначена для создания объектов с помощью наборов свойств, которые определяют их поведение.</span><span class="sxs-lookup"><span data-stu-id="921aa-264">Every part of the system is designed to create objects through property sets that drive behavior.</span></span> <span data-ttu-id="921aa-265">Привязка данных является основополагающей частью системы и интегрирована на каждом уровне.</span><span class="sxs-lookup"><span data-stu-id="921aa-265">Data binding is a fundamental part of the system, and is integrated at every layer.</span></span>  
  
 <span data-ttu-id="921aa-266">Традиционные приложения создают отображение, а затем привязывают его к некоторым данным.</span><span class="sxs-lookup"><span data-stu-id="921aa-266">Traditional applications create a display and then bind to some data.</span></span> <span data-ttu-id="921aa-267">В [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] все, что касается элемента управления, каждый аспект отображения, создается посредством некоторого типа привязки данных.</span><span class="sxs-lookup"><span data-stu-id="921aa-267">In [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)], everything about the control, every aspect of the display, is generated by some type of data binding.</span></span> <span data-ttu-id="921aa-268">Текст внутри кнопки отображается путем создания составного элемента управления внутри кнопки и привязки его отображения к свойству содержимого кнопки.</span><span class="sxs-lookup"><span data-stu-id="921aa-268">The text found inside a button is displayed by creating a composed control inside of the button and binding its display to the button’s content property.</span></span>  
  
 <span data-ttu-id="921aa-269">В начале разработки приложений на основе [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] все должно быть знакомо.</span><span class="sxs-lookup"><span data-stu-id="921aa-269">When you begin developing [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] based applications, it should feel very familiar.</span></span> <span data-ttu-id="921aa-270">Можно задать свойства, использовать объекты и привязывать данные во многом так же, как можно использовать [!INCLUDE[TLA#tla_winforms](../../../../includes/tlasharptla-winforms-md.md)] или ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="921aa-270">You can set properties, use objects, and data bind in much the same way that you can using [!INCLUDE[TLA#tla_winforms](../../../../includes/tlasharptla-winforms-md.md)] or ASP.NET.</span></span> <span data-ttu-id="921aa-271">При углублении в архитектуру [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] вы обнаружите, что можно создавать значительно более сложные приложения, которые фундаментально обрабатывают данные, как драйвер ядра приложения.</span><span class="sxs-lookup"><span data-stu-id="921aa-271">With a deeper investigation into the architecture of [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)], you'll find that the possibility exists for creating much richer applications that fundamentally treat data as the core driver of the application.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="921aa-272">См. также</span><span class="sxs-lookup"><span data-stu-id="921aa-272">See also</span></span>

- <xref:System.Windows.Media.Visual>
- <xref:System.Windows.UIElement>
- <xref:System.Windows.Input.ICommand>
- <xref:System.Windows.FrameworkElement>
- <xref:System.Windows.Threading.DispatcherObject>
- <xref:System.Windows.Input.CommandBinding>
- <xref:System.Windows.Controls.Control>
- [<span data-ttu-id="921aa-273">Общие сведения о привязке данных</span><span class="sxs-lookup"><span data-stu-id="921aa-273">Data Binding Overview</span></span>](../../../desktop-wpf/data/data-binding-overview.md)
- [<span data-ttu-id="921aa-274">Макет</span><span class="sxs-lookup"><span data-stu-id="921aa-274">Layout</span></span>](layout.md)
- [<span data-ttu-id="921aa-275">Общие сведения об эффектах анимации</span><span class="sxs-lookup"><span data-stu-id="921aa-275">Animation Overview</span></span>](../graphics-multimedia/animation-overview.md)
