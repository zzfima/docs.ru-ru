---
title: Время запуска приложения
ms.date: 03/30/2017
helpviewer_keywords:
- splash screen [WPF], startup time
- WPF [WPF], startup time
- startup time [WPF]
- application startup [WPF]
- performance [WPF], startup time
ms.assetid: f0ec58d8-626f-4d8a-9873-c20f95e08b96
ms.openlocfilehash: 0fae3ac1769163101dcdb183f4c5c2135354b1fc
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/12/2020
ms.locfileid: "79145427"
---
# <a name="application-startup-time"></a>Время запуска приложения
Время, необходимое для запуска WPF-приложения, может сильно варьироваться. В этом разделе описаны различные способы, позволяющие сократить воспринимаемое и фактическое время запуска приложений Windows Presentation Foundation (WPF).  
  
## <a name="understanding-cold-startup-and-warm-startup"></a>Общее представление о холодном и горячем запуске  
 Холодный запуск происходит, когда вы запускаете приложение в первый раз после перезагрузки системы либо когда вы запускаете приложение, закрываете его и запускаете снова после длительного периода времени. Если при запуске приложения в списке ожидания диспетчера памяти WIndows не окажется необходимых страниц (кода, статических данных, реестра и т. д.), возникнет ошибка страницы. Для загрузки таких страниц в память требуется доступ к диску.  
  
 Горячий запуск происходит, когда большинство страниц для основных компонентов среды CLR уже загружены в память, что экономит дорогостоящее время доступа к диску. Вот почему при повторном запуске управляемое приложение запускается быстрее.  
  
## <a name="implement-a-splash-screen"></a>Реализация экрана-заставки  
 В случаях когда между запуском приложения и отображением первого графического интерфейса происходит значительная неизбежная задержка, можно оптимизировать воспринимаемое время запуска с помощью *экрана-заставки*. В этом случае изображение появляется практически сразу после того, как пользователь запустит приложение. Когда приложение будет готово к отображению первого пользовательского интерфейса, экран-заставка исчезнет. Начиная с .NET Framework 3.5 SP1, <xref:System.Windows.SplashScreen> вы можете использовать класс для реализации экрана всплеска. Дополнительные сведения см. в разделе [Практическое руководство. Добавление в WPF-приложение экрана-заставки](../app-development/how-to-add-a-splash-screen-to-a-wpf-application.md).  
  
 Кроме того, используя собственные графические средства Win32, вы можете реализовать свой собственный экран заставки. Отобразить <xref:System.Windows.Application.Run%2A> реализацию до вызова метода.  
  
## <a name="analyze-the-startup-code"></a>Анализ кода запуска  
 Определите причину задержки холодного запуска. Она может быть связана с дисковым вводом-выводом, но необязательно. В целом использование внешних ресурсов, таких как сеть, веб-службы или диск, следует минимизировать.  
  
 Перед проверкой убедитесь, что управляемый или WPF-код не используют другие выполняемые приложения.  
  
 Сразу после перезагрузки перезапустите WPF-приложение и определите, сколько времени занимает его отображение. Если последующие запуски приложения (горячий запуск) будут происходить быстрее, то проблема холодного запуска, скорее всего, была связана с вводом-выводом.  
  
 Если проблема холодного запуска не связана с вводом-выводом, возможно, ваше приложение выполняет какую-либо длительную инициализацию или вычисление, ожидает завершения какого-либо события или требует существенной JIT-компиляции при запуске. В следующих разделах эти ситуации описываются более подробно.  
  
## <a name="optimize-module-loading"></a>Оптимизация загрузки модулей  
 Чтобы определить, какие модули загружает ваше приложение, воспользуйтесь такими средствами, как обозреватель процессов (Procexp.exe) и Tlist.exe. Команда `Tlist <pid>` показывает все модули, загруженные процессом.  
  
 Например, если вы не подключаетесь к Интернету, но видите, что загружается процесс System.Web.dll, значит, в приложение есть модуль, который ссылается на эту сборку. Убедитесь, что эта ссылка действительно необходима.  
  
 Если в приложении несколько модулей, объедините их в один. В этом случае загрузка сборок CLR займет меньше времени. Меньшее количество сборок также означает, что в CLR хранится меньше состояний.  
  
## <a name="defer-initialization-operations"></a>Приостановка операций инициализации  
 Код инициализации можно отложить до тех пор, пока обработка основного окна приложения не будет завершена.  
  
 Помните, что инициализация может выполняться в конструкторе классов, а в случае если код инициализации ссылается на другие классы, это может привести к каскадному выполнению многих конструкторов классов.  
  
## <a name="avoid-application-configuration"></a>Предотвращение конфигурации приложения  
 Конфигурации приложения можно избежать. Например, если приложение имеет простые требования к конфигурации и строгое плановое время запуска, для запуска лучше использовать записи реестров или простой INI-файл.  
  
## <a name="utilize-the-gac"></a>Использование GAC  
 Если сборка не установлена в глобальном кэше сборок (GAC), возникают задержки, связанные с проверкой хэша сборок со строгими именами, а также с проверкой образа Ngen (если на компьютере доступен машинный образ для этой сборки). Для всех сборок, установленных в GAC, проверка строгих имен пропускается. Дополнительные сведения см. в разделе [Gacutil.exe (средство глобального кэша сборок)](../../tools/gacutil-exe-gac-tool.md).  
  
## <a name="use-ngenexe"></a>Применение Ngen.exe  
 В приложении можно использовать генератор образов в машинном коде (Ngen.exe). При использовании Ngen.exe вы меняете потребление ресурсов ЦП на улучшение доступа к диску, поскольку машинный образ, созданный Ngen.exe, скорее всего, будет больше, чем образ MSIL.  
  
 Чтобы сократить время горячего запуска, всегда используйте Ngen.exe в своем приложении, поскольку при этом JIT-компиляция кода приложения не влияет на потребление ресурсов ЦП.  
  
 Ngen.exe может также пригодиться в некоторых сценариях холодного запуска, поскольку в этом случае загрузка JIT-компилятора (mscorjit.dll) не требуется.  
  
 Одновременное присутствие модулей Ngen и JIT может вызвать противоположный эффект. Это связано с тем, что при этом требуется загрузка mscorjit.dll, а когда JIT-компилятор работает с вашим кодом и считывает метаданные сборок, происходит обращение к многим страницам в образах Ngen.  
  
### <a name="ngen-and-clickonce"></a>NGen и ClickOnce  
 Время загрузки вашего приложения может также зависеть от выбранного способа его развертывания. Развертывание приложения ClickOnce не поддерживает Ngen. Если вы решите использовать Ngen.exe для своего приложения, выберите другой механизм развертывания, например установщик Windows.  
  
 См. дополнительные сведения о [файле Ngen.exe (генераторе образов в машинном коде)](../../tools/ngen-exe-native-image-generator.md).  
  
### <a name="rebasing-and-dll-address-collisions"></a>Изменение базового адреса и конфликты DLL-адресов  
 При использовании Ngen.exe следует учитывать, что при загрузке машинных образов в память может измениться базовый адрес. Если DLL не загружается по предпочтительному базовому адресу, поскольку этот диапазон адресов уже распределен, загрузчик Windows загрузит файл по другому адресу, что может потребовать много времени.  
  
 Проверить наличие модулей, в которых все страницы являются закрытыми, можно с помощью средства Virtual Address Dump (Vadump.exe). Если такой модуль имеется, его адрес может измениться. После этого его страницы станут недоступны.  
  
 Дополнительные сведения о настройке базового адреса см. в разделе [Ngen.exe (генератор образов в машинном коде)](../../tools/ngen-exe-native-image-generator.md).  
  
## <a name="optimize-authenticode"></a>Оптимизация Authenticode  
 Проверка Authenticode увеличивает время запуска. Сборки, подписанные с помощью Authenticode, должны проверяться центром сертификации (ЦС). Такая проверка может занять много времени, поскольку требует многократного подключения к сети для загрузки текущих списков отзыва сертификатов. Она также обеспечивает всю цепочку действительных сертификатов на пути к доверенному корневому центру. В результате загрузка сборки может задержаться на несколько секунд.  
  
 Вы можете установить сертификат CA на клиентский компьютер или не использовать Authenticode, когда это возможно. Если вашему приложению не требуется свидетельство издателя, платить за проверку подписи вам не нужно.  
  
 Начиная с .NET Framework 3.5, есть опция конфигурации, которая позволяет обойти проверку Authenticode. Для этого добавьте в файл конфигурации app.exe следующий параметр.  
  
```xml  
<configuration>  
    <runtime>  
        <generatePublisherEvidence enabled="false"/>
    </runtime>  
</configuration>  
```  
  
 Для получения дополнительной информации см [ \<>.](../../configure-apps/file-schema/runtime/generatepublisherevidence-element.md)  
  
## <a name="compare-performance-on-windows-vista"></a>Сравнение производительности в Windows Vista  
 Диспетчер памяти в Windows Vista включает технологию, которая называется SuperFetch. SuperFetch анализирует шаблоны использования памяти с течением времени, определяя оптимальное содержимое памяти для конкретного пользователя. Она работает постоянно, поддерживая содержимое памяти в любой момент времени.  
  
 Этот подход отличается от технологии Windows XP, которая выполняет предварительную загрузку данных в память без анализа шаблонов использования. Если пользователь часто работает с вашим приложением WPF в Windows Vista, время холодного запуска вашего приложения может сократиться.  
  
## <a name="use-appdomains-efficiently"></a>Эффективное использование доменов приложения  
 По возможности загружайте сборки в область кода с нейтральным доменом, чтобы машинный образ, если таковой существует, использовался во всех созданных в приложении доменах.  
  
 Чтобы повысить производительность, необходимо обеспечить взаимодействие между доменами, сократив число междоменных вызовов. По возможности используйте вызовы без аргументов или с аргументами примитивного типа.  
  
## <a name="use-the-neutralresourceslanguage-attribute"></a>Использование атрибута NeutralResourcesLanguage  
 Используйте <xref:System.Resources.NeutralResourcesLanguageAttribute> для указания нейтральной <xref:System.Resources.ResourceManager>культуры для . Этот подход позволяет избежать неудачного поиска сборок.  
  
## <a name="use-the-binaryformatter-class-for-serialization"></a>Использование класса BinaryFormatter для сериализации  
 Если необходимо использовать сериализацию, <xref:System.Runtime.Serialization.Formatters.Binary.BinaryFormatter> используйте <xref:System.Xml.Serialization.XmlSerializer> класс вместо класса. Класс <xref:System.Runtime.Serialization.Formatters.Binary.BinaryFormatter> реализован в библиотеке базового класса (BCL) в сборке mscorlib.dll. Реализованв <xref:System.Xml.Serialization.XmlSerializer> сборка System.Xml.dll, которая может стать дополнительной DLL для загрузки.  
  
 Если вы должны <xref:System.Xml.Serialization.XmlSerializer> использовать класс, вы можете достичь более высокой производительности, если вы предварительно создать сборку сериализации.  
  
## <a name="configure-clickonce-to-check-for-updates-after-startup"></a>Настройка технологии ClickOnce на проверку обновлений после запуска  
 Если приложение использует ClickOnce, избегайте доступа к сети при запуске, настраивая ClickOnce для проверки места развертывания на наличие обновлений после запуска приложения.  
  
 Если вы используете модель браузерного приложения XAML (XBAP), имейте в виду, что ClickOnce проверяет сайт развертывания на наличие обновлений, даже если XBAP уже находится в кэше ClickOnce. Для получения дополнительной информации см. [ClickOnce Security and Deployment](/visualstudio/deployment/clickonce-security-and-deployment).  
  
## <a name="configure-the-presentationfontcache-service-to-start-automatically"></a>Настройка автоматического запуска службы PresentationFontCache  
 Первым WPF-приложением, которое загружается после перезагрузки, является служба PresentationFontCache. Служба кэширует системные шрифты, делает их более доступными и повышает общую производительность. Поскольку с запуском службы, а также с некоторыми управляемыми средами связаны временные задержки, службу можно настроить на автоматический запуск при перезагрузке системы.  
  
## <a name="set-data-binding-programmatically"></a>Настройка программной привязки данных  
 Вместо того, чтобы использовать <xref:System.Windows.FrameworkElement.DataContext%2A> XAML для декларативного набора для основного окна, рассмотрите возможность программного установки в методе. <xref:System.Windows.Application.OnActivated%2A>  
  
## <a name="see-also"></a>См. также раздел

- <xref:System.Windows.SplashScreen>
- <xref:System.AppDomain>
- <xref:System.Resources.NeutralResourcesLanguageAttribute>
- <xref:System.Resources.ResourceManager>
- [Добавление в WPF-приложение экрана-заставки](../app-development/how-to-add-a-splash-screen-to-a-wpf-application.md)
- [Ngen.exe (генератор образов в машинном коде)](../../tools/ngen-exe-native-image-generator.md)
- [\<генерироватьPublisherEvidence> элемент](../../configure-apps/file-schema/runtime/generatepublisherevidence-element.md)
