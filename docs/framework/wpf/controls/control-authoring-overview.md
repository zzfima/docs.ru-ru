---
title: Общие сведения о разработке управления
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- controls [WPF], authoring overview
- authoring overview for controls [WPF]
ms.assetid: 3d864748-cff0-4e63-9b23-d8e5a635b28f
ms.openlocfilehash: 503e9cb0ea0fcfb34b326e80930f5ac829c3b4db
ms.sourcegitcommit: 6b308cf6d627d78ee36dbbae8972a310ac7fd6c8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/23/2019
ms.locfileid: "54585202"
---
# <a name="control-authoring-overview"></a><span data-ttu-id="107c2-102">Общие сведения о разработке элементов управления</span><span class="sxs-lookup"><span data-stu-id="107c2-102">Control Authoring Overview</span></span>
<span data-ttu-id="107c2-103">Расширяемость модели элементов управления [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] значительно уменьшает необходимость создания новых элементов управления.</span><span class="sxs-lookup"><span data-stu-id="107c2-103">The extensibility of the [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] control model greatly reduces the need to create a new control.</span></span> <span data-ttu-id="107c2-104">Однако в некоторых случаях может потребоваться создать пользовательский элемент управления.</span><span class="sxs-lookup"><span data-stu-id="107c2-104">However, in certain cases you may still need to create a custom control.</span></span> <span data-ttu-id="107c2-105">В этом разделе обсуждаются функции, которые уменьшают необходимость создания пользовательских элементов управления, а также различные модели создания элементов управления в [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)].</span><span class="sxs-lookup"><span data-stu-id="107c2-105">This topic discusses the features that minimize your need to create a custom control and the different control authoring models in [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)].</span></span> <span data-ttu-id="107c2-106">Также здесь демонстрируется создание нового элемента управления.</span><span class="sxs-lookup"><span data-stu-id="107c2-106">This topic also demonstrates how to create a new control.</span></span>  
  
 
  
<a name="when_to_write_a_new_control"></a>   
## <a name="alternatives-to-writing-a-new-control"></a><span data-ttu-id="107c2-107">Альтернативы написанию нового элемента управления</span><span class="sxs-lookup"><span data-stu-id="107c2-107">Alternatives to Writing a New Control</span></span>  
 <span data-ttu-id="107c2-108">Исторически сложилось, что если нужно настроить вид существующего элемента управления, то ограничиваются изменением его стандартных свойств, таких как цвет фона, ширина границы и размер шрифта.</span><span class="sxs-lookup"><span data-stu-id="107c2-108">Historically, if you wanted to get a customized experience from an existing control, you were limited to changing the standard properties of the control, such as background color, border width, and font size.</span></span> <span data-ttu-id="107c2-109">Если необходимо расширить внешний вид или поведение элемента управления за пределы этих предопределенных параметров, то необходимо создать новый элемент управления, как правило, путем наследования от существующего элемента управления и переопределения метода, ответственного за отрисовку элемента управления.</span><span class="sxs-lookup"><span data-stu-id="107c2-109">If you wished to extend the appearance or behavior of a control beyond these predefined parameters, you would need to create a new control, usually by inheriting from an existing control and overriding the method responsible for drawing the control.</span></span>  <span data-ttu-id="107c2-110">Кроме того, [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] позволяет настраивать существующие элементы управления с помощью модели форматированного содержимого, стилей, шаблонов и триггеров.</span><span class="sxs-lookup"><span data-stu-id="107c2-110">Although that is still an option, [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] enables to you customize existing controls by using its rich content model, styles, templates, and triggers.</span></span> <span data-ttu-id="107c2-111">Ниже представлены примеры использования этих функций для создания настраиваемых и согласованных функциональных возможностей без необходимости создания нового элемента управления.</span><span class="sxs-lookup"><span data-stu-id="107c2-111">The following list gives examples of how these features can be used to create custom and consistent experiences without having to create a new control.</span></span>  
  
-   <span data-ttu-id="107c2-112">**Форматированное содержимое.**</span><span class="sxs-lookup"><span data-stu-id="107c2-112">**Rich Content.**</span></span> <span data-ttu-id="107c2-113">Многие стандартные элементы управления [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] поддерживают форматированное содержимое.</span><span class="sxs-lookup"><span data-stu-id="107c2-113">Many of the standard [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] controls support rich content.</span></span> <span data-ttu-id="107c2-114">Например, свойство содержимого <xref:System.Windows.Controls.Button> имеет тип <xref:System.Object>, поэтому теоретически все может отображаться на <xref:System.Windows.Controls.Button>.</span><span class="sxs-lookup"><span data-stu-id="107c2-114">For example, the content property of a <xref:System.Windows.Controls.Button> is of type <xref:System.Object>, so theoretically anything can be displayed on a <xref:System.Windows.Controls.Button>.</span></span>  <span data-ttu-id="107c2-115">Чтобы в кнопке отображалось изображение и текст, можно добавить изображение и <xref:System.Windows.Controls.TextBlock> для <xref:System.Windows.Controls.StackPanel> и назначить <xref:System.Windows.Controls.StackPanel> для <xref:System.Windows.Controls.ContentControl.Content%2A> свойство.</span><span class="sxs-lookup"><span data-stu-id="107c2-115">To have a button display an image and text, you can add an image and a <xref:System.Windows.Controls.TextBlock> to a <xref:System.Windows.Controls.StackPanel> and assign the <xref:System.Windows.Controls.StackPanel> to the <xref:System.Windows.Controls.ContentControl.Content%2A> property.</span></span> <span data-ttu-id="107c2-116">Поскольку элементы управления могут отображать визуальные элементы [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] и произвольные данные, это уменьшает необходимость создания нового элемента управления или изменения существующего для поддержки сложной визуализации.</span><span class="sxs-lookup"><span data-stu-id="107c2-116">Because the controls can display [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] visual elements and arbitrary data, there is less need to create a new control or to modify an existing control to support a complex visualization.</span></span> <span data-ttu-id="107c2-117">Дополнительные сведения о модели содержимого для <xref:System.Windows.Controls.Button> и других моделях содержимого в [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)], см. в разделе [модель содержимого WPF](../../../../docs/framework/wpf/controls/wpf-content-model.md).</span><span class="sxs-lookup"><span data-stu-id="107c2-117">For more information about the content model for <xref:System.Windows.Controls.Button> and other content models in [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)], see [WPF Content Model](../../../../docs/framework/wpf/controls/wpf-content-model.md).</span></span>  
  
-   <span data-ttu-id="107c2-118">**Стили.**</span><span class="sxs-lookup"><span data-stu-id="107c2-118">**Styles.**</span></span> <span data-ttu-id="107c2-119">Объект <xref:System.Windows.Style> — это совокупность значений, представляющих свойства для элемента управления.</span><span class="sxs-lookup"><span data-stu-id="107c2-119">A <xref:System.Windows.Style> is a collection of values that represent properties for a control.</span></span> <span data-ttu-id="107c2-120">С помощью стилей можно создать повторно используемое представление нужного внешнего вида и поведения элемента управления без написания нового элемента управления.</span><span class="sxs-lookup"><span data-stu-id="107c2-120">By using styles, you can create a reusable representation of a desired control appearance and behavior without writing a new control.</span></span> <span data-ttu-id="107c2-121">Например, предположим, что все ваши <xref:System.Windows.Controls.TextBlock> элементам управления иметь красный, сделанные шрифтом Arial с размером шрифта из 14.</span><span class="sxs-lookup"><span data-stu-id="107c2-121">For example, assume that you want all of your <xref:System.Windows.Controls.TextBlock> controls to have red, Arial font with a font size of 14.</span></span> <span data-ttu-id="107c2-122">Можно создать стиль как ресурс и задать соответствующие свойства.</span><span class="sxs-lookup"><span data-stu-id="107c2-122">You can create a style as a resource and set the appropriate properties accordingly.</span></span> <span data-ttu-id="107c2-123">Каждый <xref:System.Windows.Controls.TextBlock> добавить в приложение будет выглядеть одинаково.</span><span class="sxs-lookup"><span data-stu-id="107c2-123">Then every <xref:System.Windows.Controls.TextBlock> that you add to your application will have the same appearance.</span></span>  
  
-   <span data-ttu-id="107c2-124">**Шаблоны данных.**</span><span class="sxs-lookup"><span data-stu-id="107c2-124">**Data Templates.**</span></span> <span data-ttu-id="107c2-125">Объект <xref:System.Windows.DataTemplate> позволяет настроить способ отображения данных в элементе управления.</span><span class="sxs-lookup"><span data-stu-id="107c2-125">A <xref:System.Windows.DataTemplate> enables you to customize how data is displayed on a control.</span></span> <span data-ttu-id="107c2-126">Например <xref:System.Windows.DataTemplate> может использоваться для указания способа отображения данных в <xref:System.Windows.Controls.ListBox>.</span><span class="sxs-lookup"><span data-stu-id="107c2-126">For example, a <xref:System.Windows.DataTemplate> can be used to specify how data is displayed in a <xref:System.Windows.Controls.ListBox>.</span></span>  <span data-ttu-id="107c2-127">Пример см. в разделе [Общие сведения о шаблонах данных](../../../../docs/framework/wpf/data/data-templating-overview.md).</span><span class="sxs-lookup"><span data-stu-id="107c2-127">For an example of this, see [Data Templating Overview](../../../../docs/framework/wpf/data/data-templating-overview.md).</span></span>  <span data-ttu-id="107c2-128">В дополнение к настройке внешнего вида данных, <xref:System.Windows.DataTemplate> может включать элементы пользовательского интерфейса, который обеспечивает большую гибкость в пользовательских интерфейсах.</span><span class="sxs-lookup"><span data-stu-id="107c2-128">In addition to customizing the appearance of data, a <xref:System.Windows.DataTemplate> can include UI elements, which gives you a lot of flexibility in custom UIs.</span></span>  <span data-ttu-id="107c2-129">Например, с помощью <xref:System.Windows.DataTemplate>, можно создать <xref:System.Windows.Controls.ComboBox> в котором каждый элемент содержит типа "флажок".</span><span class="sxs-lookup"><span data-stu-id="107c2-129">For example, by using a <xref:System.Windows.DataTemplate>, you can create a <xref:System.Windows.Controls.ComboBox> in which each item contains a check box.</span></span>  
  
-   <span data-ttu-id="107c2-130">**Шаблоны элементов управления.**</span><span class="sxs-lookup"><span data-stu-id="107c2-130">**Control Templates.**</span></span> <span data-ttu-id="107c2-131">Многие элементы управления в [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] использовать <xref:System.Windows.Controls.ControlTemplate> для определения структуры элемента управления и внешний вид, который отделяет внешний вид элемента управления от функциональности элемента управления.</span><span class="sxs-lookup"><span data-stu-id="107c2-131">Many controls in [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] use a <xref:System.Windows.Controls.ControlTemplate> to define the control's structure and appearance, which separates the appearance of a control from the functionality of the control.</span></span> <span data-ttu-id="107c2-132">Можно существенно изменить внешний вид элемента управления путем переопределения его <xref:System.Windows.Controls.ControlTemplate>.</span><span class="sxs-lookup"><span data-stu-id="107c2-132">You can drastically change the appearance of a control by redefining its <xref:System.Windows.Controls.ControlTemplate>.</span></span>  <span data-ttu-id="107c2-133">Предположим, что нужен элемент управления, который выглядит как светофор.</span><span class="sxs-lookup"><span data-stu-id="107c2-133">For example, suppose you want a control that looks like a stoplight.</span></span> <span data-ttu-id="107c2-134">Этот элемент управления имеет простой пользовательский интерфейс и функциональные возможности.</span><span class="sxs-lookup"><span data-stu-id="107c2-134">This control has a simple user interface and functionality.</span></span>  <span data-ttu-id="107c2-135">Элемент управления состоит из трех кругов, из которых одновременно загорается только один.</span><span class="sxs-lookup"><span data-stu-id="107c2-135">The control is three circles, only one of which can be lit up at a time.</span></span> <span data-ttu-id="107c2-136">Позже вы можете осознать, <xref:System.Windows.Controls.RadioButton> предлагает функциональные возможности выбора только один раз, но внешний вид по умолчанию <xref:System.Windows.Controls.RadioButton> похож индикаторы на светофор.</span><span class="sxs-lookup"><span data-stu-id="107c2-136">After some reflection, you might realize that a <xref:System.Windows.Controls.RadioButton> offers the functionality of only one being selected at a time, but the default appearance of the <xref:System.Windows.Controls.RadioButton> looks nothing like the lights on a stoplight.</span></span>  <span data-ttu-id="107c2-137">Так как <xref:System.Windows.Controls.RadioButton> использует шаблон элемента управления для определения внешнего вида, он может легко переопределить <xref:System.Windows.Controls.ControlTemplate> согласно требованиям элемента управления и использовать переключатели, чтобы сделать Светофор.</span><span class="sxs-lookup"><span data-stu-id="107c2-137">Because the <xref:System.Windows.Controls.RadioButton> uses a control template to define its appearance, it is easy to redefine the <xref:System.Windows.Controls.ControlTemplate> to fit the requirements of the control, and use radio buttons to make your stoplight.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="107c2-138">Несмотря на то что <xref:System.Windows.Controls.RadioButton> можно использовать <xref:System.Windows.DataTemplate>, <xref:System.Windows.DataTemplate> не хватает в этом примере.</span><span class="sxs-lookup"><span data-stu-id="107c2-138">Although a <xref:System.Windows.Controls.RadioButton> can use a <xref:System.Windows.DataTemplate>, a <xref:System.Windows.DataTemplate> is not sufficient in this example.</span></span>  <span data-ttu-id="107c2-139"><xref:System.Windows.DataTemplate> Определяет внешний вид содержимого элемента управления.</span><span class="sxs-lookup"><span data-stu-id="107c2-139">The <xref:System.Windows.DataTemplate> defines the appearance of the content of a control.</span></span> <span data-ttu-id="107c2-140">В случае использования <xref:System.Windows.Controls.RadioButton>, содержимое отображается справа от круга, который указывает ли <xref:System.Windows.Controls.RadioButton> выбран.</span><span class="sxs-lookup"><span data-stu-id="107c2-140">In the case of a <xref:System.Windows.Controls.RadioButton>, the content is whatever appears to the right of the circle that indicates whether the <xref:System.Windows.Controls.RadioButton> is selected.</span></span>  <span data-ttu-id="107c2-141">В примере светофора переключатель должен быть тем кругом, который может "загораться".</span><span class="sxs-lookup"><span data-stu-id="107c2-141">In the example of the stoplight, the radio button needs just be a circle that can "light up."</span></span> <span data-ttu-id="107c2-142">Так как требования к внешнему вида для светофора отличаются от внешнего вида по умолчанию <xref:System.Windows.Controls.RadioButton>, необходимо переопределить <xref:System.Windows.Controls.ControlTemplate>.</span><span class="sxs-lookup"><span data-stu-id="107c2-142">Because the appearance requirement for the stoplight is so different than the default appearance of the <xref:System.Windows.Controls.RadioButton>, it is necessary to redefine the <xref:System.Windows.Controls.ControlTemplate>.</span></span>  <span data-ttu-id="107c2-143">В целом <xref:System.Windows.DataTemplate> используется для определения содержимого (или данных) элемента управления, а также <xref:System.Windows.Controls.ControlTemplate> используется для определения того, как структурирован элемент управления.</span><span class="sxs-lookup"><span data-stu-id="107c2-143">In general a <xref:System.Windows.DataTemplate> is used for defining the content (or data) of a control, and a <xref:System.Windows.Controls.ControlTemplate> is used for defining how a control is structured.</span></span>  
  
-   <span data-ttu-id="107c2-144">**Триггеры.**</span><span class="sxs-lookup"><span data-stu-id="107c2-144">**Triggers.**</span></span> <span data-ttu-id="107c2-145">Объект <xref:System.Windows.Trigger> позволяет динамически изменять внешний вид и поведение элемента управления без создания нового элемента управления.</span><span class="sxs-lookup"><span data-stu-id="107c2-145">A <xref:System.Windows.Trigger> allows you to dynamically change the appearance and behavior of a control without creating a new control.</span></span> <span data-ttu-id="107c2-146">Например, предположим, имеется несколько <xref:System.Windows.Controls.ListBox> элементы управления в приложении и элементы в каждом <xref:System.Windows.Controls.ListBox> должен выделяться полужирным красным при их выборе.</span><span class="sxs-lookup"><span data-stu-id="107c2-146">For example, suppose you have multiple <xref:System.Windows.Controls.ListBox> controls in your application and want the items in each <xref:System.Windows.Controls.ListBox> to be bold and red when they are selected.</span></span> <span data-ttu-id="107c2-147">Очевидным может быть попытка создать класс, наследующий от <xref:System.Windows.Controls.ListBox> и переопределить <xref:System.Windows.Controls.Primitives.Selector.OnSelectionChanged%2A> способ изменения внешнего вида выбранного элемента, но более эффективный подход — добавить триггер к стилю <xref:System.Windows.Controls.ListBoxItem> , изменяет внешний вид Выбранный элемент.</span><span class="sxs-lookup"><span data-stu-id="107c2-147">Your first instinct might be to create a class that inherits from <xref:System.Windows.Controls.ListBox> and override the <xref:System.Windows.Controls.Primitives.Selector.OnSelectionChanged%2A> method to change the appearance of the selected item, but a better approach is to add a trigger to a style of a <xref:System.Windows.Controls.ListBoxItem> that changes the appearance of the selected item.</span></span> <span data-ttu-id="107c2-148">Триггер позволяет изменять значения свойств или выполнять действия в зависимости от значения свойства.</span><span class="sxs-lookup"><span data-stu-id="107c2-148">A trigger enables you to change property values or take actions based on the value of a property.</span></span> <span data-ttu-id="107c2-149"><xref:System.Windows.EventTrigger> Позволяет выполнять действия при возникновении события.</span><span class="sxs-lookup"><span data-stu-id="107c2-149">An <xref:System.Windows.EventTrigger> enables you to take actions when an event occurs.</span></span>  
  
 <span data-ttu-id="107c2-150">Дополнительные сведения о стилях, шаблонах и триггерах см. в разделе [Использование стилей и шаблонов](../../../../docs/framework/wpf/controls/styling-and-templating.md).</span><span class="sxs-lookup"><span data-stu-id="107c2-150">For more information about styles, templates, and triggers, see [Styling and Templating](../../../../docs/framework/wpf/controls/styling-and-templating.md).</span></span>  
  
 <span data-ttu-id="107c2-151">В целом, если элемент управления отражает функциональность существующего элемента управления, но должен выглядеть по-другому, сначала следует рассмотреть возможность использования какого-либо из методов, описанных в этом разделе, для изменения внешнего вида существующего элемента.</span><span class="sxs-lookup"><span data-stu-id="107c2-151">In general, if your control mirrors the functionality of an existing control, but you want the control to look different, you should first consider whether you can use any of the methods discussed in this section to change the existing control's appearance.</span></span>  
  
<a name="models_for_control_authoring"></a>   
## <a name="models-for-control-authoring"></a><span data-ttu-id="107c2-152">Модели для создания элементов управления</span><span class="sxs-lookup"><span data-stu-id="107c2-152">Models for Control Authoring</span></span>  
 <span data-ttu-id="107c2-153">Модель форматированного содержимого, стили, шаблоны и триггеры уменьшают необходимость создания новых элементов управления.</span><span class="sxs-lookup"><span data-stu-id="107c2-153">The rich content model, styles, templates, and triggers minimize the need for you to create a new control.</span></span> <span data-ttu-id="107c2-154">Тем не менее, если необходимо создать новый элемент управления, важно понимать различные модели создания элементов управления в [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)].</span><span class="sxs-lookup"><span data-stu-id="107c2-154">However, if you do need to create a new control, it is important to understand the different control authoring models in [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)].</span></span> [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] <span data-ttu-id="107c2-155">предоставляет три общих модели для создания элемента управления, которые имеют различный набор функций и уровень гибкости.</span><span class="sxs-lookup"><span data-stu-id="107c2-155">provides three general models for creating a control, each of which provides a different set of features and level of flexibility.</span></span> <span data-ttu-id="107c2-156">Базовыми классами для трех моделей <xref:System.Windows.Controls.UserControl>, <xref:System.Windows.Controls.Control>, и <xref:System.Windows.FrameworkElement>.</span><span class="sxs-lookup"><span data-stu-id="107c2-156">The base classes for the three models are <xref:System.Windows.Controls.UserControl>, <xref:System.Windows.Controls.Control>, and <xref:System.Windows.FrameworkElement>.</span></span>  
  
### <a name="deriving-from-usercontrol"></a><span data-ttu-id="107c2-157">Создание производных классов от UserControl</span><span class="sxs-lookup"><span data-stu-id="107c2-157">Deriving from UserControl</span></span>  
 <span data-ttu-id="107c2-158">Самый простой способ создания элемента управления в [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] является наследование от <xref:System.Windows.Controls.UserControl>.</span><span class="sxs-lookup"><span data-stu-id="107c2-158">The simplest way to create a control in [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] is to derive from <xref:System.Windows.Controls.UserControl>.</span></span> <span data-ttu-id="107c2-159">При создании элемента управления, который наследует от <xref:System.Windows.Controls.UserControl>, вы добавляете существующие компоненты к <xref:System.Windows.Controls.UserControl>компонентам имя и ссылки на обработчики событий в [!INCLUDE[TLA#tla_xaml](../../../../includes/tlasharptla-xaml-md.md)].</span><span class="sxs-lookup"><span data-stu-id="107c2-159">When you build a control that inherits from <xref:System.Windows.Controls.UserControl>, you add existing components to the <xref:System.Windows.Controls.UserControl>, name the components, and reference event handlers in [!INCLUDE[TLA#tla_xaml](../../../../includes/tlasharptla-xaml-md.md)].</span></span> <span data-ttu-id="107c2-160">Затем можно ссылаться на именованные элементы и определять обработчики событий в коде.</span><span class="sxs-lookup"><span data-stu-id="107c2-160">You can then reference the named elements and define the event handlers in code.</span></span> <span data-ttu-id="107c2-161">Эта модель разработки очень схожа с моделью, используемой для разработки приложений в [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)].</span><span class="sxs-lookup"><span data-stu-id="107c2-161">This development model is very similar to the model used for application development in [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)].</span></span>  
  
 <span data-ttu-id="107c2-162">При правильном, построении <xref:System.Windows.Controls.UserControl> можно воспользоваться преимуществами форматированного содержимого, стилей и триггеров.</span><span class="sxs-lookup"><span data-stu-id="107c2-162">If built correctly, a <xref:System.Windows.Controls.UserControl> can take advantage of the benefits of rich content, styles, and triggers.</span></span> <span data-ttu-id="107c2-163">Тем не менее если элемент управления наследуется из <xref:System.Windows.Controls.UserControl>, люди, использующие элемент управления не будет иметь возможность использовать <xref:System.Windows.DataTemplate> или <xref:System.Windows.Controls.ControlTemplate> для настройки внешнего вида.</span><span class="sxs-lookup"><span data-stu-id="107c2-163">However, if your control inherits from <xref:System.Windows.Controls.UserControl>, people who use your control will not be able to use a <xref:System.Windows.DataTemplate> or <xref:System.Windows.Controls.ControlTemplate> to customize its appearance.</span></span>  <span data-ttu-id="107c2-164">Это необходимо для являются производными от <xref:System.Windows.Controls.Control> класс или один из его производных классов (отличное от <xref:System.Windows.Controls.UserControl>) для создания пользовательского элемента управления, поддерживающего шаблоны.</span><span class="sxs-lookup"><span data-stu-id="107c2-164">It is necessary to derive from the <xref:System.Windows.Controls.Control> class or one of its derived classes (other than <xref:System.Windows.Controls.UserControl>) to create a custom control that supports templates.</span></span>  
  
#### <a name="benefits-of-deriving-from-usercontrol"></a><span data-ttu-id="107c2-165">Преимущества использования производного класса от UserControl</span><span class="sxs-lookup"><span data-stu-id="107c2-165">Benefits of Deriving from UserControl</span></span>  
 <span data-ttu-id="107c2-166">Рассмотрите возможность наследования от <xref:System.Windows.Controls.UserControl> применимости всем следующим условиям:</span><span class="sxs-lookup"><span data-stu-id="107c2-166">Consider deriving from <xref:System.Windows.Controls.UserControl> if all of the following apply:</span></span>  
  
-   <span data-ttu-id="107c2-167">Нужно создать элемент управления аналогично созданию приложения.</span><span class="sxs-lookup"><span data-stu-id="107c2-167">You want to build your control similarly to how you build an application.</span></span>  
  
-   <span data-ttu-id="107c2-168">Элемент управления состоит только из существующих компонентов.</span><span class="sxs-lookup"><span data-stu-id="107c2-168">Your control consists only of existing components.</span></span>  
  
-   <span data-ttu-id="107c2-169">Не нужно поддерживать сложные настройки.</span><span class="sxs-lookup"><span data-stu-id="107c2-169">You don't need to support complex customization.</span></span>  
  
### <a name="deriving-from-control"></a><span data-ttu-id="107c2-170">Создание производного от элемента управления</span><span class="sxs-lookup"><span data-stu-id="107c2-170">Deriving from Control</span></span>  
 <span data-ttu-id="107c2-171">Наследование от <xref:System.Windows.Controls.Control> класс является модель, используемая в большинстве существующих [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] элементов управления.</span><span class="sxs-lookup"><span data-stu-id="107c2-171">Deriving from the <xref:System.Windows.Controls.Control> class is the model used by most of the existing [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] controls.</span></span> <span data-ttu-id="107c2-172">При создании элемента управления, который наследует от <xref:System.Windows.Controls.Control> класса, его внешний вид определяется с помощью шаблонов.</span><span class="sxs-lookup"><span data-stu-id="107c2-172">When you create a control that inherits from the <xref:System.Windows.Controls.Control> class, you define its appearance by using templates.</span></span> <span data-ttu-id="107c2-173">Таким образом, можно отделить рабочую логику от визуального представления.</span><span class="sxs-lookup"><span data-stu-id="107c2-173">By doing so, you separate the operational logic from the visual representation.</span></span> <span data-ttu-id="107c2-174">Также можно обеспечить разделение пользовательского интерфейса и логики с помощью команд и привязок вместо событий и использования ссылок на элементы в <xref:System.Windows.Controls.ControlTemplate> по возможности.</span><span class="sxs-lookup"><span data-stu-id="107c2-174">You can also ensure the decoupling of the UI and logic by using commands and bindings instead of events and avoiding referencing elements in the <xref:System.Windows.Controls.ControlTemplate> whenever possible.</span></span>  <span data-ttu-id="107c2-175">Если пользовательский Интерфейс и логика элемента управления правильно разделены, пользователи элемента управления могут переопределить элемент управления <xref:System.Windows.Controls.ControlTemplate> для настройки внешнего вида.</span><span class="sxs-lookup"><span data-stu-id="107c2-175">If the UI and logic of your control are properly decoupled, a user of your control can redefine the control's <xref:System.Windows.Controls.ControlTemplate> to customize its appearance.</span></span> <span data-ttu-id="107c2-176">Несмотря на то, что построение пользовательского <xref:System.Windows.Controls.Control> не так просто, как строительные <xref:System.Windows.Controls.UserControl>, пользовательский <xref:System.Windows.Controls.Control> обеспечивает наибольшую гибкость.</span><span class="sxs-lookup"><span data-stu-id="107c2-176">Although building a custom <xref:System.Windows.Controls.Control> is not as simple as building a <xref:System.Windows.Controls.UserControl>, a custom <xref:System.Windows.Controls.Control> provides the most flexibility.</span></span>  
  
#### <a name="benefits-of-deriving-from-control"></a><span data-ttu-id="107c2-177">Преимущества использования производного от элемента управления</span><span class="sxs-lookup"><span data-stu-id="107c2-177">Benefits of Deriving from Control</span></span>  
 <span data-ttu-id="107c2-178">Рассмотрите возможность наследования от <xref:System.Windows.Controls.Control> вместо использования <xref:System.Windows.Controls.UserControl> класса, если выполняется одно из следующих условий:</span><span class="sxs-lookup"><span data-stu-id="107c2-178">Consider deriving from <xref:System.Windows.Controls.Control> instead of using the <xref:System.Windows.Controls.UserControl> class if any of the following apply:</span></span>  
  
-   <span data-ttu-id="107c2-179">Внешний вид элемента управления нужно настраивать через <xref:System.Windows.Controls.ControlTemplate>.</span><span class="sxs-lookup"><span data-stu-id="107c2-179">You want the appearance of your control to be customizable via the <xref:System.Windows.Controls.ControlTemplate>.</span></span>  
  
-   <span data-ttu-id="107c2-180">Элемент управления должен поддерживать различные темы.</span><span class="sxs-lookup"><span data-stu-id="107c2-180">You want your control to support different themes.</span></span>  
  
### <a name="deriving-from-frameworkelement"></a><span data-ttu-id="107c2-181">Создание производного от FrameworkElement</span><span class="sxs-lookup"><span data-stu-id="107c2-181">Deriving from FrameworkElement</span></span>  
 <span data-ttu-id="107c2-182">Элементы управления, которые являются производными от <xref:System.Windows.Controls.UserControl> или <xref:System.Windows.Controls.Control> основываются на сочетании существующих элементов.</span><span class="sxs-lookup"><span data-stu-id="107c2-182">Controls that derive from <xref:System.Windows.Controls.UserControl> or <xref:System.Windows.Controls.Control> rely upon composing existing elements.</span></span> <span data-ttu-id="107c2-183">Во многих сценариях это приемлемое решение, так как любой объект, который наследует <xref:System.Windows.FrameworkElement> может находиться в <xref:System.Windows.Controls.ControlTemplate>.</span><span class="sxs-lookup"><span data-stu-id="107c2-183">For many scenarios, this is an acceptable solution, because any object that inherits from <xref:System.Windows.FrameworkElement> can be in a <xref:System.Windows.Controls.ControlTemplate>.</span></span> <span data-ttu-id="107c2-184">Однако бывают случаи, когда для внешнего вида элемента управления требуется больше, чем функциональность простой композиции элементов.</span><span class="sxs-lookup"><span data-stu-id="107c2-184">However, there are times when a control's appearance requires more than the functionality of simple element composition.</span></span> <span data-ttu-id="107c2-185">В таких случаях компонент создание на основе <xref:System.Windows.FrameworkElement> является правильным выбором.</span><span class="sxs-lookup"><span data-stu-id="107c2-185">For these scenarios, basing a component on <xref:System.Windows.FrameworkElement> is the right choice.</span></span>  
  
 <span data-ttu-id="107c2-186">Существует два стандартных метода построения <xref:System.Windows.FrameworkElement>-компонентов на основе: прямая отрисовка и пользовательская композиция элемента.</span><span class="sxs-lookup"><span data-stu-id="107c2-186">There are two standard methods for building <xref:System.Windows.FrameworkElement>-based components: direct rendering and custom element composition.</span></span> <span data-ttu-id="107c2-187">Прямая отрисовка включает переопределение <xref:System.Windows.UIElement.OnRender%2A> метод <xref:System.Windows.FrameworkElement> и предоставляя <xref:System.Windows.Media.DrawingContext> операций, которые явно определяют графические параметры компонента.</span><span class="sxs-lookup"><span data-stu-id="107c2-187">Direct rendering involves overriding the <xref:System.Windows.UIElement.OnRender%2A> method of <xref:System.Windows.FrameworkElement> and providing <xref:System.Windows.Media.DrawingContext> operations that explicitly define the component visuals.</span></span> <span data-ttu-id="107c2-188">Это метод, используемый <xref:System.Windows.Controls.Image> и <xref:System.Windows.Controls.Border>.</span><span class="sxs-lookup"><span data-stu-id="107c2-188">This is the method used by <xref:System.Windows.Controls.Image> and <xref:System.Windows.Controls.Border>.</span></span> <span data-ttu-id="107c2-189">Пользовательская композиция элемента включает использование объектов типа <xref:System.Windows.Media.Visual> для создания внешнего вида компонента.</span><span class="sxs-lookup"><span data-stu-id="107c2-189">Custom element composition involves using objects of type <xref:System.Windows.Media.Visual> to compose the appearance of your component.</span></span> <span data-ttu-id="107c2-190">Например, см. раздел [Использование объектов DrawingVisual](../../../../docs/framework/wpf/graphics-multimedia/using-drawingvisual-objects.md).</span><span class="sxs-lookup"><span data-stu-id="107c2-190">For an example, see [Using DrawingVisual Objects](../../../../docs/framework/wpf/graphics-multimedia/using-drawingvisual-objects.md).</span></span> <span data-ttu-id="107c2-191"><xref:System.Windows.Controls.Primitives.Track> является примером элемента управления в [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] , использует пользовательскую композицию элемента.</span><span class="sxs-lookup"><span data-stu-id="107c2-191"><xref:System.Windows.Controls.Primitives.Track> is an example of a control in [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] that uses custom element composition.</span></span> <span data-ttu-id="107c2-192">Можно также комбинировать прямую отрисовку и пользовательскую композицию элемента в одном элементе управления.</span><span class="sxs-lookup"><span data-stu-id="107c2-192">It is also possible to mix direct rendering and custom element composition in the same control.</span></span>  
  
#### <a name="benefits-of-deriving-from-frameworkelement"></a><span data-ttu-id="107c2-193">Преимущества использования производного от FrameworkElement</span><span class="sxs-lookup"><span data-stu-id="107c2-193">Benefits of Deriving from FrameworkElement</span></span>  
 <span data-ttu-id="107c2-194">Рассмотрите возможность наследования от <xref:System.Windows.FrameworkElement> Если какой-либо из указанных ниже условий:</span><span class="sxs-lookup"><span data-stu-id="107c2-194">Consider deriving from <xref:System.Windows.FrameworkElement> if any of the following apply:</span></span>  
  
-   <span data-ttu-id="107c2-195">Требуется точный контроль над внешним видом элемента управления помимо того, который обеспечивается простой композицией элемента.</span><span class="sxs-lookup"><span data-stu-id="107c2-195">You want to have precise control over the appearance of your control beyond what is provided by simple element composition.</span></span>  
  
-   <span data-ttu-id="107c2-196">Необходимо определить внешний вид элемента управления путем определения собственной логики отрисовки.</span><span class="sxs-lookup"><span data-stu-id="107c2-196">You want to define the appearance of your control by defining your own render logic.</span></span>  
  
-   <span data-ttu-id="107c2-197">Требуется построить существующие элементы нестандартными способами, выходящими за рамки возможностей в средстве <xref:System.Windows.Controls.UserControl> и <xref:System.Windows.Controls.Control>.</span><span class="sxs-lookup"><span data-stu-id="107c2-197">You want to compose existing elements in novel ways that go beyond what is possible with <xref:System.Windows.Controls.UserControl> and <xref:System.Windows.Controls.Control>.</span></span>  
  
<a name="control_authoring_basics"></a>   
## <a name="control-authoring-basics"></a><span data-ttu-id="107c2-198">Основы создания элементов управления</span><span class="sxs-lookup"><span data-stu-id="107c2-198">Control Authoring Basics</span></span>  
 <span data-ttu-id="107c2-199">Как обсуждалось выше, одной из наиболее мощных функций [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] является возможность выхода за пределы задания базовых свойств элемента управления, чтобы изменить его внешний вид и поведение, но без необходимости создания пользовательского элемента управления.</span><span class="sxs-lookup"><span data-stu-id="107c2-199">As discussed earlier, one of the most powerful features of [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] is the ability to go beyond setting basic properties of a control to change its appearance and behavior, yet still not needing to create a custom control.</span></span> <span data-ttu-id="107c2-200">Функции стилей, привязки данных и триггеров предоставляются системой свойств [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] и системой событий [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)].</span><span class="sxs-lookup"><span data-stu-id="107c2-200">The styling, data binding, and trigger features are made possible by the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] property system and the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] event system.</span></span> <span data-ttu-id="107c2-201">В следующих разделах описаны некоторые рекомендации, которым нужно следовать независимо от модели, используемой для создания пользовательского элемента управления. Это необходимо, чтобы пользователи вашего пользовательского элемента управления могли использовать эти функции точно так же, как для элемента управления, входящего в [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)].</span><span class="sxs-lookup"><span data-stu-id="107c2-201">The following sections describe some practices that you should follow, regardless of the model you use to create the custom control, so that users of your custom control can use these features just as they would for a control that is included with [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)].</span></span>  
  
### <a name="use-dependency-properties"></a><span data-ttu-id="107c2-202">Использование свойств зависимостей</span><span class="sxs-lookup"><span data-stu-id="107c2-202">Use Dependency Properties</span></span>  
 <span data-ttu-id="107c2-203">Если свойство является свойством зависимостей, то можно сделать следующее:</span><span class="sxs-lookup"><span data-stu-id="107c2-203">When a property is a dependency property, it is possible to do the following:</span></span>  
  
-   <span data-ttu-id="107c2-204">Установить свойство в стиле.</span><span class="sxs-lookup"><span data-stu-id="107c2-204">Set the property in a style.</span></span>  
  
-   <span data-ttu-id="107c2-205">Привязать свойство к источнику данных.</span><span class="sxs-lookup"><span data-stu-id="107c2-205">Bind the property to a data source.</span></span>  
  
-   <span data-ttu-id="107c2-206">Использовать динамический ресурс в качестве значения свойства.</span><span class="sxs-lookup"><span data-stu-id="107c2-206">Use a dynamic resource as the property's value.</span></span>  
  
-   <span data-ttu-id="107c2-207">Анимировать свойство.</span><span class="sxs-lookup"><span data-stu-id="107c2-207">Animate the property.</span></span>  
  
 <span data-ttu-id="107c2-208">Если свойство элемента управления должно поддерживать подобную функциональность, то следует реализовать его как свойство зависимостей.</span><span class="sxs-lookup"><span data-stu-id="107c2-208">If you want a property of your control to support any of this functionality, you should implement it as a dependency property.</span></span> <span data-ttu-id="107c2-209">В следующем примере определяется свойство зависимостей с именем `Value` следующим способом:</span><span class="sxs-lookup"><span data-stu-id="107c2-209">The following example defines a dependency property named `Value` by doing the following:</span></span>  
  
-   <span data-ttu-id="107c2-210">Определение <xref:System.Windows.DependencyProperty> идентификатор с именем `ValueProperty` как `public` `static` `readonly` поля.</span><span class="sxs-lookup"><span data-stu-id="107c2-210">Define a <xref:System.Windows.DependencyProperty> identifier named `ValueProperty` as a `public` `static` `readonly` field.</span></span>  
  
-   <span data-ttu-id="107c2-211">Зарегистрируйте имя свойства в системе свойств с помощью метода <xref:System.Windows.DependencyProperty.Register%2A?displayProperty=nameWithType>, чтобы указать следующее:</span><span class="sxs-lookup"><span data-stu-id="107c2-211">Register the property name with the property system, by calling <xref:System.Windows.DependencyProperty.Register%2A?displayProperty=nameWithType>, to specify the following:</span></span>  
  
    -   <span data-ttu-id="107c2-212">Имя свойства.</span><span class="sxs-lookup"><span data-stu-id="107c2-212">The name of the property.</span></span>  
  
    -   <span data-ttu-id="107c2-213">Тип свойства.</span><span class="sxs-lookup"><span data-stu-id="107c2-213">The type of the property.</span></span>  
  
    -   <span data-ttu-id="107c2-214">Тип, к которому принадлежит это свойство.</span><span class="sxs-lookup"><span data-stu-id="107c2-214">The type that owns the property.</span></span>  
  
    -   <span data-ttu-id="107c2-215">Метаданные для свойства.</span><span class="sxs-lookup"><span data-stu-id="107c2-215">The metadata for the property.</span></span> <span data-ttu-id="107c2-216">Метаданные содержат значение свойства по умолчанию, <xref:System.Windows.CoerceValueCallback> и <xref:System.Windows.PropertyChangedCallback>.</span><span class="sxs-lookup"><span data-stu-id="107c2-216">The metadata contains the property's default value, a <xref:System.Windows.CoerceValueCallback> and a <xref:System.Windows.PropertyChangedCallback>.</span></span>  
  
-   <span data-ttu-id="107c2-217">Определите свойство программы-оболочки [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)] с именем `Value`, которое используется для регистрации свойства зависимостей, путем реализации методов доступа `get` и `set` свойства.</span><span class="sxs-lookup"><span data-stu-id="107c2-217">Define a [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)] wrapper property named `Value`, which is the same name that is used to register the dependency property, by implementing the property's `get` and `set` accessors.</span></span> <span data-ttu-id="107c2-218">Обратите внимание, что `get` и `set` вызывать только методы доступа <xref:System.Windows.DependencyObject.GetValue%2A> и <xref:System.Windows.DependencyObject.SetValue%2A> соответственно.</span><span class="sxs-lookup"><span data-stu-id="107c2-218">Note that the `get` and `set` accessors only call <xref:System.Windows.DependencyObject.GetValue%2A> and <xref:System.Windows.DependencyObject.SetValue%2A> respectively.</span></span> <span data-ttu-id="107c2-219">Рекомендуется, чтобы методы доступа свойств зависимостей не содержали дополнительной логики, так как клиенты и [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] может обойти методы доступа и вызов <xref:System.Windows.DependencyObject.GetValue%2A> и <xref:System.Windows.DependencyObject.SetValue%2A> напрямую.</span><span class="sxs-lookup"><span data-stu-id="107c2-219">It is recommended that the accessors of dependency properties not contain additional logic because clients and [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] can bypass the accessors and call <xref:System.Windows.DependencyObject.GetValue%2A> and <xref:System.Windows.DependencyObject.SetValue%2A> directly.</span></span> <span data-ttu-id="107c2-220">Например, если свойство привязано к источнику данных, то метод доступа `set` свойства не вызывается.</span><span class="sxs-lookup"><span data-stu-id="107c2-220">For example, when a property is bound to a data source, the property's `set` accessor is not called.</span></span>  <span data-ttu-id="107c2-221">Вместо добавления дополнительной логики для получения и установки методов доступа, используйте <xref:System.Windows.ValidateValueCallback>, <xref:System.Windows.CoerceValueCallback>, и <xref:System.Windows.PropertyChangedCallback> реагировать на них или проверьте значение, при его изменении делегаты.</span><span class="sxs-lookup"><span data-stu-id="107c2-221">Instead of adding additional logic to the get and set accessors, use the <xref:System.Windows.ValidateValueCallback>, <xref:System.Windows.CoerceValueCallback>, and <xref:System.Windows.PropertyChangedCallback> delegates to respond to or check the value when it changes.</span></span>  <span data-ttu-id="107c2-222">Дополнительные сведения об этих обратных вызовах см. в разделе [Проверка и обратные вызовы свойства зависимостей](../../../../docs/framework/wpf/advanced/dependency-property-callbacks-and-validation.md).</span><span class="sxs-lookup"><span data-stu-id="107c2-222">For more information on these callbacks, see [Dependency Property Callbacks and Validation](../../../../docs/framework/wpf/advanced/dependency-property-callbacks-and-validation.md).</span></span>  
  
-   <span data-ttu-id="107c2-223">Определите метод для <xref:System.Windows.CoerceValueCallback> с именем `CoerceValue`.</span><span class="sxs-lookup"><span data-stu-id="107c2-223">Define a method for the <xref:System.Windows.CoerceValueCallback> named `CoerceValue`.</span></span> <span data-ttu-id="107c2-224">`CoerceValue` гарантирует, что `Value` больше или равно `MinValue` и меньше или равно `MaxValue`.</span><span class="sxs-lookup"><span data-stu-id="107c2-224">`CoerceValue` ensures that `Value` is greater or equal to `MinValue` and less than or equal to `MaxValue`.</span></span>  
  
-   <span data-ttu-id="107c2-225">Определите метод для <xref:System.Windows.PropertyChangedCallback>с именем `OnValueChanged`.</span><span class="sxs-lookup"><span data-stu-id="107c2-225">Define a method for the <xref:System.Windows.PropertyChangedCallback>, named `OnValueChanged`.</span></span> <span data-ttu-id="107c2-226">`OnValueChanged` Создает <xref:System.Windows.RoutedPropertyChangedEventArgs%601> объекта и готовится к `ValueChanged` перенаправленного события.</span><span class="sxs-lookup"><span data-stu-id="107c2-226">`OnValueChanged` creates a <xref:System.Windows.RoutedPropertyChangedEventArgs%601> object and prepares to raise the `ValueChanged` routed event.</span></span> <span data-ttu-id="107c2-227">Перенаправляемые события рассматриваются в следующем разделе.</span><span class="sxs-lookup"><span data-stu-id="107c2-227">Routed events are discussed in the next section.</span></span>  
  
 [!code-csharp[UserControlNumericUpDown#DependencyProperty](../../../../samples/snippets/csharp/VS_Snippets_Wpf/UserControlNumericUpDown/CSharp/NumericUpDown.xaml.cs#dependencyproperty)]
 [!code-vb[UserControlNumericUpDown#DependencyProperty](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/UserControlNumericUpDown/visualbasic/numericupdown.xaml.vb#dependencyproperty)]  
  
 <span data-ttu-id="107c2-228">Дополнительные сведения см. в разделе [Пользовательские свойства зависимостей](../../../../docs/framework/wpf/advanced/custom-dependency-properties.md).</span><span class="sxs-lookup"><span data-stu-id="107c2-228">For more information, see [Custom Dependency Properties](../../../../docs/framework/wpf/advanced/custom-dependency-properties.md).</span></span>  
  
### <a name="use-routed-events"></a><span data-ttu-id="107c2-229">Использование перенаправляемых событий</span><span class="sxs-lookup"><span data-stu-id="107c2-229">Use Routed Events</span></span>  
 <span data-ttu-id="107c2-230">Аналогично тому, как свойства зависимостей расширяют представление свойств [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)] дополнительной функциональностью, перенаправляемые события расширяют представление стандартных событий [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)].</span><span class="sxs-lookup"><span data-stu-id="107c2-230">Just as dependency properties extend the notion of [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)] properties with additional functionality, routed events extend the notion of standard [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)] events.</span></span> <span data-ttu-id="107c2-231">При создании нового элемента управления [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] рекомендуется также реализовывать событие как перенаправляемое, так как такие события поддерживают следующее поведение:</span><span class="sxs-lookup"><span data-stu-id="107c2-231">When you create a new [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] control, it is also good practice to implement your event as a routed event because a routed event supports the following behavior:</span></span>  
  
-   <span data-ttu-id="107c2-232">События могут обрабатываться в родительском элементе нескольких элементов управления.</span><span class="sxs-lookup"><span data-stu-id="107c2-232">Events can be handled on a parent of multiple controls.</span></span> <span data-ttu-id="107c2-233">Если событие является событием восходящей маршрутизации, то один родительский элемент в дереве элементов может подписаться на это событие.</span><span class="sxs-lookup"><span data-stu-id="107c2-233">If an event is a bubbling event, a single parent in the element tree can subscribe to the event.</span></span> <span data-ttu-id="107c2-234">Разработчики приложений могут использовать один обработчик для реагирования на событие нескольких элементов управления.</span><span class="sxs-lookup"><span data-stu-id="107c2-234">Then application authors can use one handler to respond to the event of multiple controls.</span></span> <span data-ttu-id="107c2-235">Например, если элемент управления является частью каждого элемента в <xref:System.Windows.Controls.ListBox> (так как он включен в <xref:System.Windows.DataTemplate>), разработчик приложения может определить обработчик событий для события элемента управления на <xref:System.Windows.Controls.ListBox>.</span><span class="sxs-lookup"><span data-stu-id="107c2-235">For example, if your control is a part of each item in a <xref:System.Windows.Controls.ListBox> (because it is included in a <xref:System.Windows.DataTemplate>), the application developer can define the event handler for your control's event on the <xref:System.Windows.Controls.ListBox>.</span></span> <span data-ttu-id="107c2-236">Обработчик событий вызывается при возникновении события в любом элементе управления.</span><span class="sxs-lookup"><span data-stu-id="107c2-236">Whenever the event occurs on any of the controls, the event handler is called.</span></span>  
  
-   <span data-ttu-id="107c2-237">Перенаправленные события могут использоваться в <xref:System.Windows.EventSetter>, что позволяет разработчикам приложений указать обработчик события в стиле.</span><span class="sxs-lookup"><span data-stu-id="107c2-237">Routed events can be used in an <xref:System.Windows.EventSetter>, which enables application developers to specify the handler of an event within a style.</span></span>  
  
-   <span data-ttu-id="107c2-238">Перенаправленные события могут использоваться в <xref:System.Windows.EventTrigger>, что удобно для анимации свойств с помощью [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)].</span><span class="sxs-lookup"><span data-stu-id="107c2-238">Routed events can be used in an <xref:System.Windows.EventTrigger>, which is useful for animating properties by using [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)].</span></span> <span data-ttu-id="107c2-239">Более подробную информацию см. в разделе [Общие сведения об эффектах анимации](../../../../docs/framework/wpf/graphics-multimedia/animation-overview.md).</span><span class="sxs-lookup"><span data-stu-id="107c2-239">For more information, see [Animation Overview](../../../../docs/framework/wpf/graphics-multimedia/animation-overview.md).</span></span>  
  
 <span data-ttu-id="107c2-240">Следующий пример определяет перенаправляемое событие:</span><span class="sxs-lookup"><span data-stu-id="107c2-240">The following example defines a routed event by doing the following:</span></span>  
  
-   <span data-ttu-id="107c2-241">Определение <xref:System.Windows.RoutedEvent> идентификатор с именем `ValueChangedEvent` как `public` `static` `readonly` поля.</span><span class="sxs-lookup"><span data-stu-id="107c2-241">Define a <xref:System.Windows.RoutedEvent> identifier named `ValueChangedEvent` as a `public` `static` `readonly` field.</span></span>  
  
-   <span data-ttu-id="107c2-242">Зарегистрируйте перенаправляемое событие путем вызова <xref:System.Windows.EventManager.RegisterRoutedEvent%2A?displayProperty=nameWithType> метод.</span><span class="sxs-lookup"><span data-stu-id="107c2-242">Register the routed event by calling the <xref:System.Windows.EventManager.RegisterRoutedEvent%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="107c2-243">В примере указывается следующие сведения при вызове <xref:System.Windows.EventManager.RegisterRoutedEvent%2A>:</span><span class="sxs-lookup"><span data-stu-id="107c2-243">The example specifies the following information when it calls <xref:System.Windows.EventManager.RegisterRoutedEvent%2A>:</span></span>  
  
    -   <span data-ttu-id="107c2-244">Имя события `ValueChanged`.</span><span class="sxs-lookup"><span data-stu-id="107c2-244">The name of the event is `ValueChanged`.</span></span>  
  
    -   <span data-ttu-id="107c2-245">Стратегия маршрутизации <xref:System.Windows.RoutingStrategy.Bubble>, что означает, что сначала вызывается обработчик событий в источнике (объект, вызывающий событие) и затем вызываются обработчики событий родительских элементов источника подряд, начиная с обработчика события для ближайшего родительский элемент.</span><span class="sxs-lookup"><span data-stu-id="107c2-245">The routing strategy is <xref:System.Windows.RoutingStrategy.Bubble>, which means that an event handler on the source (the object that raises the event) is called first, and then event handlers on the source's parent elements are called in succession, starting with the event handler on the closest parent element.</span></span>  
  
    -   <span data-ttu-id="107c2-246">Тип обработчика событий — <xref:System.Windows.RoutedPropertyChangedEventHandler%601>, созданный с <xref:System.Decimal> типа.</span><span class="sxs-lookup"><span data-stu-id="107c2-246">The type of the event handler is <xref:System.Windows.RoutedPropertyChangedEventHandler%601>, constructed with a <xref:System.Decimal> type.</span></span>  
  
    -   <span data-ttu-id="107c2-247">Тип — владелец события — `NumericUpDown`.</span><span class="sxs-lookup"><span data-stu-id="107c2-247">The owning type of the event is `NumericUpDown`.</span></span>  
  
-   <span data-ttu-id="107c2-248">Объявите общее событие с именем `ValueChanged`, которое включает объявления метода доступа к событию.</span><span class="sxs-lookup"><span data-stu-id="107c2-248">Declare a public event named `ValueChanged` and includes event-accessor declarations.</span></span> <span data-ttu-id="107c2-249">В примере вызывается <xref:System.Windows.UIElement.AddHandler%2A> в `add` объявление метода доступа и <xref:System.Windows.UIElement.RemoveHandler%2A> в `remove` объявление метода доступа для использования [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] служб событий.</span><span class="sxs-lookup"><span data-stu-id="107c2-249">The example calls <xref:System.Windows.UIElement.AddHandler%2A> in the `add` accessor declaration and <xref:System.Windows.UIElement.RemoveHandler%2A> in the `remove` accessor declaration to use the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] event services.</span></span>  
  
-   <span data-ttu-id="107c2-250">Создайте защищенный виртуальный метод с именем `OnValueChanged`, вызывающий событие `ValueChanged`.</span><span class="sxs-lookup"><span data-stu-id="107c2-250">Create a protected, virtual method named `OnValueChanged` that raises the `ValueChanged` event.</span></span>  
  
 [!code-csharp[UserControlNumericUpDown#RoutedEvent](../../../../samples/snippets/csharp/VS_Snippets_Wpf/UserControlNumericUpDown/CSharp/NumericUpDown.xaml.cs#routedevent)]
 [!code-vb[UserControlNumericUpDown#RoutedEvent](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/UserControlNumericUpDown/visualbasic/numericupdown.xaml.vb#routedevent)]  
  
 <span data-ttu-id="107c2-251">Дополнительные сведения см. в разделах [Общие сведения о перенаправляемых событиях](../../../../docs/framework/wpf/advanced/routed-events-overview.md) и [Создание пользовательских перенаправляемых событий](../../../../docs/framework/wpf/advanced/how-to-create-a-custom-routed-event.md).</span><span class="sxs-lookup"><span data-stu-id="107c2-251">For more information, see [Routed Events Overview](../../../../docs/framework/wpf/advanced/routed-events-overview.md) and [Create a Custom Routed Event](../../../../docs/framework/wpf/advanced/how-to-create-a-custom-routed-event.md).</span></span>  
  
### <a name="use-binding"></a><span data-ttu-id="107c2-252">Использование привязки</span><span class="sxs-lookup"><span data-stu-id="107c2-252">Use Binding</span></span>  
 <span data-ttu-id="107c2-253">Для отделения пользовательского интерфейса от логики элемента управления можно использовать привязку данных.</span><span class="sxs-lookup"><span data-stu-id="107c2-253">To decouple the UI of your control from its logic, consider using data binding.</span></span> <span data-ttu-id="107c2-254">Это особенно важно в том случае, если внешний вид элемента управления с помощью <xref:System.Windows.Controls.ControlTemplate>.</span><span class="sxs-lookup"><span data-stu-id="107c2-254">This is particularly important if you define the appearance of your control by using a <xref:System.Windows.Controls.ControlTemplate>.</span></span> <span data-ttu-id="107c2-255">При использовании привязки данных можно избавиться от необходимости ссылаться на определенные части пользовательского интерфейса из кода.</span><span class="sxs-lookup"><span data-stu-id="107c2-255">When you use data binding, you might be able to eliminate the need to reference specific parts of the UI from the code.</span></span> <span data-ttu-id="107c2-256">Рекомендуется избегать ссылок на элементы в <xref:System.Windows.Controls.ControlTemplate> потому, что если код ссылается на элементы в <xref:System.Windows.Controls.ControlTemplate> и <xref:System.Windows.Controls.ControlTemplate> изменяется, указанный ссылками элемент должен быть включен в новом <xref:System.Windows.Controls.ControlTemplate>.</span><span class="sxs-lookup"><span data-stu-id="107c2-256">It's a good idea to avoid referencing elements that are in the <xref:System.Windows.Controls.ControlTemplate> because when the code references elements that are in the <xref:System.Windows.Controls.ControlTemplate> and the <xref:System.Windows.Controls.ControlTemplate> is changed, the referenced element needs to be included in the new <xref:System.Windows.Controls.ControlTemplate>.</span></span>  
  
 <span data-ttu-id="107c2-257">В следующем примере обновляется <xref:System.Windows.Controls.TextBlock> из `NumericUpDown` элемента управления, присвоение имени и ссылается на текстовое поле по имени в коде.</span><span class="sxs-lookup"><span data-stu-id="107c2-257">The following example updates the <xref:System.Windows.Controls.TextBlock> of the `NumericUpDown` control, assigning a name to it and referencing the textbox by name in code.</span></span>  
  
 [!code-xaml[UserControlNumericUpDownSimple#UIRefMarkup](../../../../samples/snippets/csharp/VS_Snippets_Wpf/UserControlNumericUpDownSimple/CSharp/NumericUpDown.xaml#uirefmarkup)]  
  
 [!code-csharp[UserControlNumericUpDownSimple#UIRefCode](../../../../samples/snippets/csharp/VS_Snippets_Wpf/UserControlNumericUpDownSimple/CSharp/NumericUpDown.xaml.cs#uirefcode)]
 [!code-vb[UserControlNumericUpDownSimple#UIRefCode](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/UserControlNumericUpDownSimple/VisualBasic/NumericUpDown.xaml.vb#uirefcode)]  
  
 <span data-ttu-id="107c2-258">Следующий пример использует привязку для достижения такого же результата.</span><span class="sxs-lookup"><span data-stu-id="107c2-258">The following example uses binding to accomplish the same thing.</span></span>  
  
 [!code-xaml[UserControlNumericUpDown#Binding](../../../../samples/snippets/csharp/VS_Snippets_Wpf/UserControlNumericUpDown/CSharp/NumericUpDown.xaml#binding)]  
  
 <span data-ttu-id="107c2-259">Дополнительные сведения о привязке данных см. в разделе [Общие сведения о привязке данных](../../../../docs/framework/wpf/data/data-binding-overview.md).</span><span class="sxs-lookup"><span data-stu-id="107c2-259">For more information about data binding, see [Data Binding Overview](../../../../docs/framework/wpf/data/data-binding-overview.md).</span></span>  
  
### <a name="design-for-designers"></a><span data-ttu-id="107c2-260">Разработка для конструкторов</span><span class="sxs-lookup"><span data-stu-id="107c2-260">Design for Designers</span></span>  
 <span data-ttu-id="107c2-261">Чтобы получить поддержку пользовательских элементов управления WPF в [!INCLUDE[wpfdesigner_current_long](../../../../includes/wpfdesigner-current-long-md.md)] (например, редактирование свойства с помощью окна "Свойства"), следуйте приведенным ниже рекомендациям.</span><span class="sxs-lookup"><span data-stu-id="107c2-261">To receive support for custom WPF controls in the [!INCLUDE[wpfdesigner_current_long](../../../../includes/wpfdesigner-current-long-md.md)] (for example, property editing with the Properties window), follow these guidelines.</span></span>  <span data-ttu-id="107c2-262">Дополнительные сведения о разработке для [!INCLUDE[wpfdesigner_current_short](../../../../includes/wpfdesigner-current-short-md.md)], см. в разделе [конструктора XAML в Visual Studio](/visualstudio/designers/designing-xaml-in-visual-studio).</span><span class="sxs-lookup"><span data-stu-id="107c2-262">For more information on developing for the [!INCLUDE[wpfdesigner_current_short](../../../../includes/wpfdesigner-current-short-md.md)], see [Design XAML in Visual Studio](/visualstudio/designers/designing-xaml-in-visual-studio).</span></span>  
  
#### <a name="dependency-properties"></a><span data-ttu-id="107c2-263">Свойства зависимостей</span><span class="sxs-lookup"><span data-stu-id="107c2-263">Dependency Properties</span></span>  
 <span data-ttu-id="107c2-264">Следует реализовать методы доступа [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)] `get` и `set`, как описано ранее в разделе "Использование свойств зависимостей".</span><span class="sxs-lookup"><span data-stu-id="107c2-264">Be sure to implement [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)] `get` and `set` accessors as described earlier, in "Use Dependency Properties."</span></span> <span data-ttu-id="107c2-265">Конструкторы могут использовать программы-оболочки для обнаружения свойства зависимостей, но им, как [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] и клиентам элемента управления, не требуется вызывать методы доступа при получении или настройке свойства.</span><span class="sxs-lookup"><span data-stu-id="107c2-265">Designers may use the wrapper to detect the presence of a dependency property, but they, like [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] and clients of the control, are not required to call the accessors when getting or setting the property.</span></span>  
  
#### <a name="attached-properties"></a><span data-ttu-id="107c2-266">Вложенные свойства</span><span class="sxs-lookup"><span data-stu-id="107c2-266">Attached Properties</span></span>  
 <span data-ttu-id="107c2-267">При реализации вложенных свойств в пользовательских элементах управления учитывайте следующие рекомендации:</span><span class="sxs-lookup"><span data-stu-id="107c2-267">You should implement attached properties on custom controls using the following guidelines:</span></span>  
  
-   <span data-ttu-id="107c2-268">У `public` `static` `readonly` <xref:System.Windows.DependencyProperty> формы *PropertyName* `Property` , создании с помощью <xref:System.Windows.DependencyProperty.RegisterAttached%2A> метод.</span><span class="sxs-lookup"><span data-stu-id="107c2-268">Have a `public` `static` `readonly` <xref:System.Windows.DependencyProperty> of the form *PropertyName*`Property` that was creating using the <xref:System.Windows.DependencyProperty.RegisterAttached%2A> method.</span></span> <span data-ttu-id="107c2-269">Имя свойства, которое передается <xref:System.Windows.DependencyProperty.RegisterAttached%2A> должно соответствовать *PropertyName*.</span><span class="sxs-lookup"><span data-stu-id="107c2-269">The property name that is passed to <xref:System.Windows.DependencyProperty.RegisterAttached%2A> must match *PropertyName*.</span></span>  
  
-   <span data-ttu-id="107c2-270">Реализуйте пару методов CLR `public` `static` с именем `Set`*PropertyName* и `Get`*PropertyName*.</span><span class="sxs-lookup"><span data-stu-id="107c2-270">Implement a pair of `public` `static` CLR methods named `Set`*PropertyName* and `Get`*PropertyName*.</span></span> <span data-ttu-id="107c2-271">Оба метода должны принимать производный класс от <xref:System.Windows.DependencyProperty> качестве первого аргумента.</span><span class="sxs-lookup"><span data-stu-id="107c2-271">Both methods should accept a class derived from <xref:System.Windows.DependencyProperty> as their first argument.</span></span> <span data-ttu-id="107c2-272">Метод `Set`*PropertyName* также принимает аргумент, тип которого соответствует зарегистрированному типу данных для свойства.</span><span class="sxs-lookup"><span data-stu-id="107c2-272">The `Set`*PropertyName* method also accepts an argument whose type matches the registered data type for the property.</span></span> <span data-ttu-id="107c2-273">Метод `Get`*PropertyName* должен возвращать значение такого же типа.</span><span class="sxs-lookup"><span data-stu-id="107c2-273">The `Get`*PropertyName* method should return a value of the same type.</span></span> <span data-ttu-id="107c2-274">Если метод `Set` *PropertyName* отсутствует, свойство отмечается как "только для чтения".</span><span class="sxs-lookup"><span data-stu-id="107c2-274">If the `Set`*PropertyName* method is missing, the property is marked read-only.</span></span>  
  
-   <span data-ttu-id="107c2-275">`Set` *PropertyName* и `Get` *PropertyName* должны перенаправляться непосредственно в <xref:System.Windows.DependencyObject.GetValue%2A> и <xref:System.Windows.DependencyObject.SetValue%2A> методы от зависимости целевого объекта, соответственно.</span><span class="sxs-lookup"><span data-stu-id="107c2-275">`Set` *PropertyName* and `Get`*PropertyName* must route directly to the <xref:System.Windows.DependencyObject.GetValue%2A> and <xref:System.Windows.DependencyObject.SetValue%2A> methods on the target dependency object, respectively.</span></span> <span data-ttu-id="107c2-276">Разработчики могут получить доступ к вложенному свойству, вызвав программу-оболочку метода или с помощью прямого вызова целевого объекта зависимостей.</span><span class="sxs-lookup"><span data-stu-id="107c2-276">Designers may access the attached property by calling through the method wrapper or making a direct call to the target dependency object.</span></span>  
  
 <span data-ttu-id="107c2-277">Дополнительные сведения о вложенных свойствах см. в разделе [Общие сведения о вложенных свойствах](../../../../docs/framework/wpf/advanced/attached-properties-overview.md).</span><span class="sxs-lookup"><span data-stu-id="107c2-277">For more information on attached properties, see [Attached Properties Overview](../../../../docs/framework/wpf/advanced/attached-properties-overview.md).</span></span>  
  
### <a name="define-and-use-shared-resources"></a><span data-ttu-id="107c2-278">Определение и использование общих ресурсов</span><span class="sxs-lookup"><span data-stu-id="107c2-278">Define and Use Shared Resources</span></span>  
 <span data-ttu-id="107c2-279">Можно включить элемент управления в ту же сборку, что и приложение, или упаковать его в отдельную сборку, которая может использоваться в нескольких приложениях.</span><span class="sxs-lookup"><span data-stu-id="107c2-279">You can include your control in the same assembly as your application, or you can package your control in a separate assembly that can be used in multiple applications.</span></span> <span data-ttu-id="107c2-280">В большинстве случаев сведения, рассматриваемые в данном разделе, применяются независимо от используемого метода.</span><span class="sxs-lookup"><span data-stu-id="107c2-280">For the most part, the information discussed in this topic applies regardless of the method you use.</span></span>  <span data-ttu-id="107c2-281">Однако есть одно отличие, о котором следует упомянуть.</span><span class="sxs-lookup"><span data-stu-id="107c2-281">There is one difference worth noting, however.</span></span>  <span data-ttu-id="107c2-282">При помещении элемента управления в ту же сборку, что и приложение, можно добавить глобальные ресурсы в файл App.xaml.</span><span class="sxs-lookup"><span data-stu-id="107c2-282">When you put a control in the same assembly as an application, you are free to add global resources to the App.xaml file.</span></span> <span data-ttu-id="107c2-283">Но не сборку, содержащую только элементы управления <xref:System.Windows.Application> объект, связанный с ним, поэтому файл App.xaml недоступно.</span><span class="sxs-lookup"><span data-stu-id="107c2-283">But an assembly that contains only controls does not have an <xref:System.Windows.Application> object associated with it, so an App.xaml file is not available.</span></span>  
  
 <span data-ttu-id="107c2-284">Приложение выполняет поиск ресурса на трех уровнях в следующем порядке:</span><span class="sxs-lookup"><span data-stu-id="107c2-284">When an application looks for a resource, it looks at three levels in the following order:</span></span>  
  
1.  <span data-ttu-id="107c2-285">Уровень элемента.</span><span class="sxs-lookup"><span data-stu-id="107c2-285">The element level.</span></span>  
  
     <span data-ttu-id="107c2-286">Система начинает с элемента, который ссылается на ресурс, а затем ищет ресурсы логического родительского элемента и так далее, пока не будет достигнут корневой элемент.</span><span class="sxs-lookup"><span data-stu-id="107c2-286">The system starts with the element that references the resource and then searches resources of the logical parent and so forth until the root element is reached.</span></span>  
  
2.  <span data-ttu-id="107c2-287">Уровень приложения.</span><span class="sxs-lookup"><span data-stu-id="107c2-287">The application level.</span></span>  
  
     <span data-ttu-id="107c2-288">Ресурсы, определенные в <xref:System.Windows.Application> объекта.</span><span class="sxs-lookup"><span data-stu-id="107c2-288">Resources defined by the <xref:System.Windows.Application> object.</span></span>  
  
3.  <span data-ttu-id="107c2-289">Уровень темы.</span><span class="sxs-lookup"><span data-stu-id="107c2-289">The theme level.</span></span>  
  
     <span data-ttu-id="107c2-290">Словари уровня темы хранятся в подпапке "Темы".</span><span class="sxs-lookup"><span data-stu-id="107c2-290">Theme-level dictionaries are stored in a subfolder named Themes.</span></span>  <span data-ttu-id="107c2-291">Файлы в папке "Темы" соответствуют темам.</span><span class="sxs-lookup"><span data-stu-id="107c2-291">The files in the Themes folder correspond to themes.</span></span>  <span data-ttu-id="107c2-292">Например, могут присутствовать файлы Aero.NormalColor.xaml, Luna.NormalColor.xaml, Royale.NormalColor.xaml и т. д.</span><span class="sxs-lookup"><span data-stu-id="107c2-292">For example, you might have Aero.NormalColor.xaml, Luna.NormalColor.xaml, Royale.NormalColor.xaml, and so on.</span></span>  <span data-ttu-id="107c2-293">Также может присутствовать файл с именем generic.xaml.</span><span class="sxs-lookup"><span data-stu-id="107c2-293">You can also have a file named generic.xaml.</span></span>  <span data-ttu-id="107c2-294">Когда система ищет ресурс на уровне темы, она сначала ищет его в файле конкретной темы, а затем в файле generic.xaml.</span><span class="sxs-lookup"><span data-stu-id="107c2-294">When the system looks for a resource at the themes level, it first looks for it in the theme-specific file and then looks for it in generic.xaml.</span></span>  
  
 <span data-ttu-id="107c2-295">Если элемент управления находится в сборке отдельно от приложения, глобальные ресурсы необходимо поместить на уровень элемента или на уровень темы.</span><span class="sxs-lookup"><span data-stu-id="107c2-295">When your control is in an assembly that is separate from the application, you must put your global resources at the element level or at the theme level.</span></span> <span data-ttu-id="107c2-296">Оба метода имеют свои преимущества.</span><span class="sxs-lookup"><span data-stu-id="107c2-296">Both methods have their advantages.</span></span>  
  
#### <a name="defining-resources-at-the-element-level"></a><span data-ttu-id="107c2-297">Определение ресурсов на уровне элемента</span><span class="sxs-lookup"><span data-stu-id="107c2-297">Defining Resources at the Element Level</span></span>  
 <span data-ttu-id="107c2-298">Общие ресурсы на уровне элемента можно определить путем создания пользовательского словаря ресурсов и его объединения со словарем ресурсов элемента управления.</span><span class="sxs-lookup"><span data-stu-id="107c2-298">You can define shared resources at the element level by creating a custom resource dictionary and merging it with your control’s resource dictionary.</span></span>  <span data-ttu-id="107c2-299">При использовании этого метода можно присвоить файлу ресурсов любое имя и его можно поместить в одну папку с элементами управления.</span><span class="sxs-lookup"><span data-stu-id="107c2-299">When you use this method, you can name your resource file anything you want, and it can be in the same folder as your controls.</span></span> <span data-ttu-id="107c2-300">Ресурсы на уровне элемента также могут использовать простые строки как ключи.</span><span class="sxs-lookup"><span data-stu-id="107c2-300">Resources at the element level can also use simple strings as keys.</span></span> <span data-ttu-id="107c2-301">В следующем примере создается <xref:System.Windows.Media.LinearGradientBrush> файл ресурсов с именем Dictionary1.xaml.</span><span class="sxs-lookup"><span data-stu-id="107c2-301">The following example creates a <xref:System.Windows.Media.LinearGradientBrush> resource file named Dictionary1.xaml.</span></span>  
  
 [!code-xaml[SharedResources#1](../../../../samples/snippets/csharp/VS_Snippets_Wpf/SharedResources/CS/Dictionary1.xaml#1)]  
  
 <span data-ttu-id="107c2-302">После определения словаря необходимо его объединить со словарем ресурсов элемента управления.</span><span class="sxs-lookup"><span data-stu-id="107c2-302">Once you have defined your dictionary, you need to merge it with your control's resource dictionary.</span></span>  <span data-ttu-id="107c2-303">Это можно сделать с помощью [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] или кода.</span><span class="sxs-lookup"><span data-stu-id="107c2-303">You can do this by using [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] or code.</span></span>  
  
 <span data-ttu-id="107c2-304">Следующий пример объединяет словарь ресурса с помощью [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)].</span><span class="sxs-lookup"><span data-stu-id="107c2-304">The following example merges a resource dictionary by using [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)].</span></span>  
  
 [!code-xaml[SharedResources#2](../../../../samples/snippets/csharp/VS_Snippets_Wpf/SharedResources/CS/ShapeResizer.xaml#2)]  
  
 <span data-ttu-id="107c2-305">Недостаток этого подхода заключается в том, <xref:System.Windows.ResourceDictionary> создается каждый раз, ссылки на объект.</span><span class="sxs-lookup"><span data-stu-id="107c2-305">The disadvantage to this approach is that a <xref:System.Windows.ResourceDictionary> object is created each time you reference it.</span></span>  <span data-ttu-id="107c2-306">Например, если у вас 10 пользовательских элементов управления в библиотеке и объединение словарей общих ресурсов для каждого элемента управления с помощью XAML, будут созданы 10 идентичных <xref:System.Windows.ResourceDictionary> объектов.</span><span class="sxs-lookup"><span data-stu-id="107c2-306">For example, if you have 10 custom controls in your library and merge the shared resource dictionaries for each control by using XAML, you create 10 identical <xref:System.Windows.ResourceDictionary> objects.</span></span>  <span data-ttu-id="107c2-307">Этого можно избежать, создав статический класс, который объединяет ресурсы в коде и возвращает результат в виде <xref:System.Windows.ResourceDictionary>.</span><span class="sxs-lookup"><span data-stu-id="107c2-307">You can avoid this by creating a static class that merges the resources in code and returns the resulting <xref:System.Windows.ResourceDictionary>.</span></span>  
  
 <span data-ttu-id="107c2-308">В следующем примере создается класс, который возвращает общий <xref:System.Windows.ResourceDictionary>.</span><span class="sxs-lookup"><span data-stu-id="107c2-308">The following example creates a class that returns a shared <xref:System.Windows.ResourceDictionary>.</span></span>  
  
 [!code-csharp[SharedResources#3](../../../../samples/snippets/csharp/VS_Snippets_Wpf/SharedResources/CS/SharedDictionaryManager.cs#3)]  
  
 <span data-ttu-id="107c2-309">В следующем примере общий ресурс объединяется с ресурсами пользовательского элемента управления в конструкторе элемента управления, прежде чем он вызывает `InitializeComponent`.</span><span class="sxs-lookup"><span data-stu-id="107c2-309">The following example merges the shared resource with the resources of a custom control in the control's constructor before it calls `InitializeComponent`.</span></span>  <span data-ttu-id="107c2-310">Так как `SharedDictionaryManager.SharedDictionary` является статическим свойством, <xref:System.Windows.ResourceDictionary> создается только один раз.</span><span class="sxs-lookup"><span data-stu-id="107c2-310">Because the `SharedDictionaryManager.SharedDictionary` is a static property, the <xref:System.Windows.ResourceDictionary> is created only once.</span></span> <span data-ttu-id="107c2-311">Поскольку словарь ресурсов был объединен до вызова `InitializeComponent`, ресурсы доступны для элемента управления в его файле [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)].</span><span class="sxs-lookup"><span data-stu-id="107c2-311">Because the resource dictionary was merged before `InitializeComponent` was called, the resources are available to the control in its [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] file.</span></span>  
  
 [!code-csharp[SharedResources#4](../../../../samples/snippets/csharp/VS_Snippets_Wpf/SharedResources/CS/ShapeResizer.xaml.cs#4)]  
  
#### <a name="defining-resources-at-the-theme-level"></a><span data-ttu-id="107c2-312">Определение ресурсов на уровне темы</span><span class="sxs-lookup"><span data-stu-id="107c2-312">Defining Resources at the Theme Level</span></span>  
 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] <span data-ttu-id="107c2-313">позволяет создавать ресурсы для разных тем Windows.</span><span class="sxs-lookup"><span data-stu-id="107c2-313">enables you to create resources for different Windows themes.</span></span>  <span data-ttu-id="107c2-314">Как разработчик элемента управления, вы можете определить ресурс для определенной темы, чтобы изменить внешний вид элемента управления в зависимости от того, какая тема используется.</span><span class="sxs-lookup"><span data-stu-id="107c2-314">As a control author, you can define a resource for a specific theme to change your control's appearance depending on what theme is in use.</span></span> <span data-ttu-id="107c2-315">Например, внешний вид <xref:System.Windows.Controls.Button> в классическом Windows темы (тема по умолчанию для Windows 2000) отличается от <xref:System.Windows.Controls.Button> в теме Windows Luna (тема по умолчанию для Windows XP) так как <xref:System.Windows.Controls.Button> использует другое <xref:System.Windows.Controls.ControlTemplate> для каждой темы.</span><span class="sxs-lookup"><span data-stu-id="107c2-315">For example, the appearance of a <xref:System.Windows.Controls.Button> in the Windows Classic theme (the default theme for Windows 2000) differs from a <xref:System.Windows.Controls.Button> in the Windows Luna theme (the default theme for Windows XP) because the <xref:System.Windows.Controls.Button> uses a different <xref:System.Windows.Controls.ControlTemplate> for each theme.</span></span>  
  
 <span data-ttu-id="107c2-316">Ресурсы, относящиеся к теме, хранятся в словаре ресурсов с заданным именем файла.</span><span class="sxs-lookup"><span data-stu-id="107c2-316">Resources that are specific to a theme are kept in a resource dictionary with a specific file name.</span></span> <span data-ttu-id="107c2-317">Эти файлы должны находиться в папке с именем `Themes`, которая является подпапкой папки, содержащей элемент управления.</span><span class="sxs-lookup"><span data-stu-id="107c2-317">These files must be in a folder named `Themes` that is a subfolder of the folder that contains the control.</span></span> <span data-ttu-id="107c2-318">В следующей таблице перечислены файлы словаря ресурсов и темы, связанные с каждым файлом.</span><span class="sxs-lookup"><span data-stu-id="107c2-318">The following table lists the resource dictionary files and the theme that is associated with each file:</span></span>  
  
|<span data-ttu-id="107c2-319">Имя файла словаря ресурсов</span><span class="sxs-lookup"><span data-stu-id="107c2-319">Resource dictionary file name</span></span>|<span data-ttu-id="107c2-320">Тема Windows</span><span class="sxs-lookup"><span data-stu-id="107c2-320">Windows theme</span></span>|  
|-----------------------------------|-------------------|  
|`Classic.xaml`|<span data-ttu-id="107c2-321">Классический вид Windows 9x/2000 для Windows XP</span><span class="sxs-lookup"><span data-stu-id="107c2-321">Classic Windows 9x/2000 look on Windows XP</span></span>|  
|`Luna.NormalColor.xaml`|<span data-ttu-id="107c2-322">Синяя тема по умолчанию в Windows XP</span><span class="sxs-lookup"><span data-stu-id="107c2-322">Default blue theme on Windows XP</span></span>|  
|`Luna.Homestead.xaml`|<span data-ttu-id="107c2-323">Оливковая тема в Windows XP</span><span class="sxs-lookup"><span data-stu-id="107c2-323">Olive theme on Windows XP</span></span>|  
|`Luna.Metallic.xaml`|<span data-ttu-id="107c2-324">Серебристая тема в Windows XP</span><span class="sxs-lookup"><span data-stu-id="107c2-324">Silver theme on Windows XP</span></span>|  
|`Royale.NormalColor.xaml`|<span data-ttu-id="107c2-325">Тема по умолчанию в Windows XP Media Center Edition</span><span class="sxs-lookup"><span data-stu-id="107c2-325">Default theme on Windows XP Media Center Edition</span></span>|  
|`Aero.NormalColor.xaml`|<span data-ttu-id="107c2-326">Тема по умолчанию в Windows Vista</span><span class="sxs-lookup"><span data-stu-id="107c2-326">Default theme on Windows Vista</span></span>|  
  
 <span data-ttu-id="107c2-327">Не нужно определять ресурс для каждой темы.</span><span class="sxs-lookup"><span data-stu-id="107c2-327">You do not need to define a resource for every theme.</span></span> <span data-ttu-id="107c2-328">Если ресурс не определен для конкретной темы, элемент управления проверяет `Classic.xaml` для ресурса.</span><span class="sxs-lookup"><span data-stu-id="107c2-328">If a resource is not defined for a specific theme, then the control checks `Classic.xaml` for the resource.</span></span> <span data-ttu-id="107c2-329">Если ресурс не определен в файле, соответствующем текущей теме, или в `Classic.xaml`, то элемент управления использует общий ресурс, который находится в файле словаря ресурса с именем `generic.xaml`.</span><span class="sxs-lookup"><span data-stu-id="107c2-329">If the resource is not defined in the file that corresponds to the current theme or in `Classic.xaml`, the control uses the generic resource, which is in a resource dictionary file named `generic.xaml`.</span></span>  <span data-ttu-id="107c2-330">Файл `generic.xaml` расположен в той же папке, что и файлы словаря ресурсов, связанные с темами.</span><span class="sxs-lookup"><span data-stu-id="107c2-330">The `generic.xaml` file is located in the same folder as the theme-specific resource dictionary files.</span></span> <span data-ttu-id="107c2-331">Хотя `generic.xaml` не соответствует конкретной теме Windows, он по-прежнему является словарем уровня темы.</span><span class="sxs-lookup"><span data-stu-id="107c2-331">Although `generic.xaml` does not correspond to a specific Windows theme, it is still a theme-level dictionary.</span></span>  
  
 <span data-ttu-id="107c2-332">[Пример пользовательского элемента управления NumericUpDown с темами и поддержкой автоматизации пользовательского интерфейса](https://go.microsoft.com/fwlink/?LinkID=160025) содержит два словаря ресурсов для элемента управления `NumericUpDown`: один — в файле generic.xaml, а второй — в Luna.NormalColor.xaml.</span><span class="sxs-lookup"><span data-stu-id="107c2-332">[NumericUpDown Custom Control with Theme and UI Automation Support Sample](https://go.microsoft.com/fwlink/?LinkID=160025) contains two resource dictionaries for the `NumericUpDown` control: one is in generic.xaml and one is in Luna.NormalColor.xaml.</span></span>  <span data-ttu-id="107c2-333">Можно запустить приложение и переключаться между серебристой темой в Windows XP и другой темой, чтобы увидеть разницу между двумя шаблонами элемента управления.</span><span class="sxs-lookup"><span data-stu-id="107c2-333">You can run the application and switch between the Silver theme in Windows XP and another theme to see the difference between the two control templates.</span></span> <span data-ttu-id="107c2-334">(Если вы используете Windows Vista, можно переименовать Luna.NormalColor.xaml в Aero.NormalColor.xaml и переключаться между двумя темами, например между классической и темой по умолчанию для Windows Vista.)</span><span class="sxs-lookup"><span data-stu-id="107c2-334">(If you are running Windows Vista, you can rename Luna.NormalColor.xaml to Aero.NormalColor.xaml and switch between two themes, such as Windows Classic and the default theme for Windows Vista.)</span></span>  
  
 <span data-ttu-id="107c2-335">При переводе <xref:System.Windows.Controls.ControlTemplate> в любом из файлы словарей тематических ресурсов, необходимо создать статический конструктор для элемента управления и вызвать <xref:System.Windows.DependencyProperty.OverrideMetadata%28System.Type%2CSystem.Windows.PropertyMetadata%29> метод <xref:System.Windows.FrameworkElement.DefaultStyleKey%2A>, как показано в следующем примере.</span><span class="sxs-lookup"><span data-stu-id="107c2-335">When you put a <xref:System.Windows.Controls.ControlTemplate> in any of the theme-specific resource dictionary files, you must create a static constructor for your control and call the <xref:System.Windows.DependencyProperty.OverrideMetadata%28System.Type%2CSystem.Windows.PropertyMetadata%29> method on the <xref:System.Windows.FrameworkElement.DefaultStyleKey%2A>, as shown in the following example.</span></span>  
  
 [!code-csharp[CustomControlNumericUpDownOneProject#StaticConstructor](../../../../samples/snippets/csharp/VS_Snippets_Wpf/CustomControlNumericUpDownOneProject/CSharp/NumericUpDown.cs#staticconstructor)]
 [!code-vb[CustomControlNumericUpDownOneProject#StaticConstructor](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/CustomControlNumericUpDownOneProject/visualbasic/numericupdown.vb#staticconstructor)]  
  
##### <a name="defining-and-referencing-keys-for-theme-resources"></a><span data-ttu-id="107c2-336">Определение и создание ссылок на ключи для ресурсов тем</span><span class="sxs-lookup"><span data-stu-id="107c2-336">Defining and Referencing Keys for Theme Resources</span></span>  
 <span data-ttu-id="107c2-337">При определении ресурса на уровне элемента можно назначить строку в качестве его ключа и получить доступ к ресурсу через эту строку.</span><span class="sxs-lookup"><span data-stu-id="107c2-337">When you define a resource at the element level, you can assign a string as its key and access the resource via the string.</span></span> <span data-ttu-id="107c2-338">При определении ресурса на уровне темы необходимо использовать <xref:System.Windows.ComponentResourceKey> как ключ.</span><span class="sxs-lookup"><span data-stu-id="107c2-338">When you define a resource at the theme level, you must use a <xref:System.Windows.ComponentResourceKey> as the key.</span></span>  <span data-ttu-id="107c2-339">В следующем примере определяется ресурс в файле generic.xaml.</span><span class="sxs-lookup"><span data-stu-id="107c2-339">The following example defines a resource in generic.xaml.</span></span>  
  
 [!code-xaml[ThemeResourcesControlLibrary#5](../../../../samples/snippets/csharp/VS_Snippets_Wpf/ThemeResourcesControlLibrary/CS/Themes/generic.xaml#5)]  
  
 <span data-ttu-id="107c2-340">Следующий пример ссылается на ресурс, указав <xref:System.Windows.ComponentResourceKey> как ключ.</span><span class="sxs-lookup"><span data-stu-id="107c2-340">The following example references the resource by specifying the <xref:System.Windows.ComponentResourceKey> as the key.</span></span>  
  
 [!code-xaml[ThemeResourcesControlLibrary#6](../../../../samples/snippets/csharp/VS_Snippets_Wpf/ThemeResourcesControlLibrary/CS/NumericUpDown.xaml#6)]  
  
##### <a name="specifying-the-location-of-theme-resources"></a><span data-ttu-id="107c2-341">Определение местоположения ресурсов тем</span><span class="sxs-lookup"><span data-stu-id="107c2-341">Specifying the Location of Theme Resources</span></span>  
 <span data-ttu-id="107c2-342">Чтобы найти ресурсы для элемента управления, ведущее приложение должно знать, что сборка содержит ресурсы для элемента управления.</span><span class="sxs-lookup"><span data-stu-id="107c2-342">To find the resources for a control, the hosting application needs to know that the assembly contains control-specific resources.</span></span> <span data-ttu-id="107c2-343">Можно сделать, добавив <xref:System.Windows.ThemeInfoAttribute> на сборку, содержащую элемент управления.</span><span class="sxs-lookup"><span data-stu-id="107c2-343">You can accomplish that by adding the <xref:System.Windows.ThemeInfoAttribute> to the assembly that contains the control.</span></span> <span data-ttu-id="107c2-344"><xref:System.Windows.ThemeInfoAttribute> Имеет <xref:System.Windows.ThemeInfoAttribute.GenericDictionaryLocation%2A> свойство, указывающее местоположение общих ресурсов и <xref:System.Windows.ThemeInfoAttribute.ThemeDictionaryLocation%2A> свойство, указывающее расположение тематических ресурсов.</span><span class="sxs-lookup"><span data-stu-id="107c2-344">The <xref:System.Windows.ThemeInfoAttribute> has a <xref:System.Windows.ThemeInfoAttribute.GenericDictionaryLocation%2A> property that specifies the location of generic resources, and a <xref:System.Windows.ThemeInfoAttribute.ThemeDictionaryLocation%2A> property that specifies the location of the theme-specific resources.</span></span>  
  
 <span data-ttu-id="107c2-345">В следующем примере задается <xref:System.Windows.ThemeInfoAttribute.GenericDictionaryLocation%2A> и <xref:System.Windows.ThemeInfoAttribute.ThemeDictionaryLocation%2A> свойства <xref:System.Windows.ResourceDictionaryLocation.SourceAssembly>, чтобы указать, что универсальных и тематических ресурсы находятся в той же сборке, в качестве элемента управления.</span><span class="sxs-lookup"><span data-stu-id="107c2-345">The following example sets the <xref:System.Windows.ThemeInfoAttribute.GenericDictionaryLocation%2A> and <xref:System.Windows.ThemeInfoAttribute.ThemeDictionaryLocation%2A> properties to <xref:System.Windows.ResourceDictionaryLocation.SourceAssembly>, to specify that the generic and theme-specific resources are in the same assembly as the control.</span></span>  
  
 [!code-csharp[CustomControlNumericUpDown#ThemesSection](../../../../samples/snippets/csharp/VS_Snippets_Wpf/CustomControlNumericUpDown/CSharp/CustomControlLibrary/Properties/AssemblyInfo.cs#themessection)]
 [!code-vb[CustomControlNumericUpDown#ThemesSection](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/CustomControlNumericUpDown/visualbasic/customcontrollibrary/my project/assemblyinfo.vb#themessection)]  
  
## <a name="see-also"></a><span data-ttu-id="107c2-346">См. также</span><span class="sxs-lookup"><span data-stu-id="107c2-346">See also</span></span>
- [<span data-ttu-id="107c2-347">Проектирование XAML в Visual Studio</span><span class="sxs-lookup"><span data-stu-id="107c2-347">Design XAML in Visual Studio</span></span>](/visualstudio/designers/designing-xaml-in-visual-studio)
- [<span data-ttu-id="107c2-348">URI типа "pack" в WPF</span><span class="sxs-lookup"><span data-stu-id="107c2-348">Pack URIs in WPF</span></span>](../../../../docs/framework/wpf/app-development/pack-uris-in-wpf.md)
- [<span data-ttu-id="107c2-349">Настройка элементов управления</span><span class="sxs-lookup"><span data-stu-id="107c2-349">Control Customization</span></span>](../../../../docs/framework/wpf/controls/control-customization.md)
