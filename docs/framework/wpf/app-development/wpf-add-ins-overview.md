---
title: Общие сведения о надстройках WPF
ms.date: 03/30/2017
helpviewer_keywords:
- add-ins and XAML browser applications [WPF]
- add-ins overview [WPF]
- add-ins [WPF], performance
- add-ins [WPF], benefits
- .NET Framework add-in model [WPF]
- add-ins [WPF], user interface
- add-ins and the user interface [WPF]
- add-ins [WPF], architecture
- add-ins [WPF], limitations
ms.assetid: 00b4c776-29a8-4dba-b603-280a0cdc2ade
ms.openlocfilehash: 859e586d6cb0b334a7ad766de5d3aabb0e1864ac
ms.sourcegitcommit: 0c48191d6d641ce88d7510e319cf38c0e35697d0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/05/2019
ms.locfileid: "57365845"
---
# <a name="wpf-add-ins-overview"></a><span data-ttu-id="5fd3d-102">Общие сведения о надстройках WPF</span><span class="sxs-lookup"><span data-stu-id="5fd3d-102">WPF Add-Ins Overview</span></span>
<a name="Introduction"></a> <span data-ttu-id="5fd3d-103">.NET Framework включает модель надстроек, разработчики могут использовать для создания приложений, поддерживающих расширяемость надстроек.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-103">The .NET Framework includes an add-in model that developers can use to create applications that support add-in extensibility.</span></span> <span data-ttu-id="5fd3d-104">Эта модель позволяет создавать надстройки, которые интегрируются с функциональностью приложения и расширяют ее.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-104">This add-in model allows the creation of add-ins that integrate with and extend application functionality.</span></span> <span data-ttu-id="5fd3d-105">В некоторых сценариях приложения также должны отображать пользовательские интерфейсы, которые предоставляются надстройками. В этом разделе показано, как WPF расширяет модель надстроек платформы .NET Framework для поддержки таких сценариев, архитектуры, его преимущества и ограничения.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-105">In some scenarios, applications also need to display user interfaces that are provided by add-ins. This topic shows how WPF augments the .NET Framework add-in model to enable these scenarios, the architecture behind it, its benefits, and its limitations.</span></span>  
  

  
<a name="Requirements"></a>   
## <a name="prerequisites"></a><span data-ttu-id="5fd3d-106">Предварительные требования</span><span class="sxs-lookup"><span data-stu-id="5fd3d-106">Prerequisites</span></span>  
 <span data-ttu-id="5fd3d-107">Знание модели надстроек платформы .NET Framework является обязательным.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-107">Familiarity with the .NET Framework add-in model is required.</span></span> <span data-ttu-id="5fd3d-108">Дополнительные сведения см. в разделе [Надстройки и расширяемость](/previous-versions/dotnet/netframework-4.0/bb384200(v%3dvs.100)).</span><span class="sxs-lookup"><span data-stu-id="5fd3d-108">For more information, see [Add-ins and Extensibility](/previous-versions/dotnet/netframework-4.0/bb384200(v%3dvs.100)).</span></span>  
  
<a name="AddInsOverview"></a>   
## <a name="add-ins-overview"></a><span data-ttu-id="5fd3d-109">Общие сведения о надстройках</span><span class="sxs-lookup"><span data-stu-id="5fd3d-109">Add-Ins Overview</span></span>  
 <span data-ttu-id="5fd3d-110">Чтобы избежать сложностей повторной компиляции и развертывания приложений для включения новых функциональных возможностей, приложения реализуют механизмы расширяемости, которые позволяют разработчикам (как собственным, так и сторонним) создавать другие приложения с поддержкой интеграции.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-110">In order to avoid the complexities of application recompilation and redeployment to incorporate new functionality, applications implement extensibility mechanisms that allow developers (both first-party and third-party) to create other applications that integrate with them.</span></span> <span data-ttu-id="5fd3d-111">Наиболее распространенным способом поддержки этого типа расширяемости является использование надстроек (также называемых "подключаемыми модулями").</span><span class="sxs-lookup"><span data-stu-id="5fd3d-111">The most common way to support this type of extensibility is through the use of add-ins (also known as "add-ons" and "plug-ins").</span></span> <span data-ttu-id="5fd3d-112">Примеры реальных приложений, которые обеспечивают расширяемость с помощью надстроек:</span><span class="sxs-lookup"><span data-stu-id="5fd3d-112">Examples of real-world applications that expose extensibility with add-ins include:</span></span>  
  
-   <span data-ttu-id="5fd3d-113">Надстройки Internet Explorer.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-113">Internet Explorer add-ons.</span></span>  
  
-   <span data-ttu-id="5fd3d-114">Надстройки проигрывателя Windows Media.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-114">Windows Media Player plug-ins.</span></span>  
  
-   <span data-ttu-id="5fd3d-115">Надстройки Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-115">Visual Studio add-ins.</span></span>  
  
 <span data-ttu-id="5fd3d-116">Например, модель надстроек проигрывателя Windows Media позволяет сторонним разработчикам реализовать "подключаемые модули", расширяющие возможности проигрывателя Windows Media различными способами, включая создание декодеров и кодировщиков для форматов мультимедиа, изначально не поддерживаемых проигрывателем Windows Media (например: DVD, MP3), а также звуковых эффектов и обложек.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-116">For example, the Windows Media Player add-in model allows third-party developers to implement "plug-ins" that extend Windows Media Player in a variety of ways, including creating decoders and encoders for media formats that are not supported natively by Windows Media Player (for example, DVD, MP3), audio effects, and skins.</span></span> <span data-ttu-id="5fd3d-117">Каждая модель надстройки создается для предоставления функций, уникальных для приложения, хотя существует несколько элементов и поведений, общих для всех моделей.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-117">Each add-in model is built to expose the functionality that is unique to an application, although there are several entities and behaviors that are common to all add-in models.</span></span>  
  
 <span data-ttu-id="5fd3d-118">Тремя основными сущностями типичных решений расширяемости являются *контракты*, *надстройки* и *ведущие приложения*.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-118">The three main entities of typical add-in extensibility solutions are *contracts*, *add-ins*, and *host applications*.</span></span> <span data-ttu-id="5fd3d-119">Контракты определяют интеграцию надстроек с ведущими приложениями двумя способами:</span><span class="sxs-lookup"><span data-stu-id="5fd3d-119">Contracts define how add-ins integrate with host applications in two ways:</span></span>  
  
-   <span data-ttu-id="5fd3d-120">Надстройки интегрируются с функциональными возможностями, реализуемыми ведущими приложениями.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-120">Add-ins integrate with functionality that is implemented by host applications.</span></span>  
  
-   <span data-ttu-id="5fd3d-121">Ведущие приложения предоставляют функциональные возможности для надстроек, с которыми интегрируются.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-121">Host applications expose functionality for add-ins to integrate with.</span></span>  
  
 <span data-ttu-id="5fd3d-122">Чтобы использовать надстройки, ведущие приложения должны найти их и загрузить во время выполнения.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-122">In order for add-ins to be used, host applications need to find them and load them at run time.</span></span> <span data-ttu-id="5fd3d-123">Следовательно, приложения, поддерживающие надстройки, имеют следующие дополнительные обязанности:</span><span class="sxs-lookup"><span data-stu-id="5fd3d-123">Consequently, applications that support add-ins have the following additional responsibilities:</span></span>  
  
-   <span data-ttu-id="5fd3d-124">**Обнаружение**: Поиск надстроек, которые соответствуют контрактам, поддерживаемым ведущими приложениями.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-124">**Discovery**: Finding add-ins that adhere to contracts supported by host applications.</span></span>  
  
-   <span data-ttu-id="5fd3d-125">**Активация**: Загрузка, запуск и установка связи с надстройками.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-125">**Activation**: Loading, running, and establishing communication with add-ins.</span></span>  
  
-   <span data-ttu-id="5fd3d-126">**Изоляция**: Использование доменов приложений или процессов для установления границ изоляции, защищающих приложения от потенциальных безопасности и выполнения проблем с надстройками.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-126">**Isolation**: Using either application domains or processes to establish isolation boundaries that protect applications from potential security and execution problems with add-ins.</span></span>  
  
-   <span data-ttu-id="5fd3d-127">**Обмен данными**: Разрешение надстройкам и ведущим приложениям взаимодействовать друг с другом через границы изоляции путем вызова методов и передачи данных.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-127">**Communication**: Allowing add-ins and host applications to communicate with each other across isolation boundaries by calling methods and passing data.</span></span>  
  
-   <span data-ttu-id="5fd3d-128">**Управление жизненным циклом**: Загрузка и выгрузка доменов приложений и процессов ясным, прогнозируемым способом (см. в разделе [домены приложений](../../app-domains/application-domains.md)).</span><span class="sxs-lookup"><span data-stu-id="5fd3d-128">**Lifetime Management**: Loading and unloading application domains and processes in a clean, predictable manner (see [Application Domains](../../app-domains/application-domains.md)).</span></span>  
  
-   <span data-ttu-id="5fd3d-129">**Управление версиями**: Проверка того, что размещать приложения и надстройки могут взаимодействовать при создании новых версий.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-129">**Versioning**: Ensuring that host applications and add-ins can still communicate when new versions of either are created.</span></span>  
  
 <span data-ttu-id="5fd3d-130">В конечном счете разработка надежной модели надстройки является нетривиальный задачей.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-130">Ultimately, developing a robust add-in model is a non-trivial undertaking.</span></span> <span data-ttu-id="5fd3d-131">По этой причине .NET Framework предоставляет инфраструктуру для построения моделей надстроек.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-131">For this reason, the .NET Framework provides an infrastructure for building add-in models.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="5fd3d-132">Более подробные сведения о надстройках см. в разделе [Надстройки и расширения среды](/previous-versions/dotnet/netframework-4.0/bb384200(v%3dvs.100)).</span><span class="sxs-lookup"><span data-stu-id="5fd3d-132">For more detailed information on add-ins, see [Add-ins and Extensibility](/previous-versions/dotnet/netframework-4.0/bb384200(v%3dvs.100)).</span></span>  
  
<a name="NETFrameworkAddInModelOverview"></a>   
## <a name="net-framework-add-in-model-overview"></a><span data-ttu-id="5fd3d-133">Общие сведения о модели надстроек платформы .NET Framework</span><span class="sxs-lookup"><span data-stu-id="5fd3d-133">.NET Framework Add-In Model Overview</span></span>  
 <span data-ttu-id="5fd3d-134">Добавить в модель, найден в <xref:System.AddIn> пространство имен, содержит набор типов, которые предназначены для упрощения разработки расширяемости.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-134">The .NET Framework add-in model, found in the <xref:System.AddIn> namespace, contains a set of types that are designed to simplify the development of add-in extensibility.</span></span> <span data-ttu-id="5fd3d-135">Основной единицей модели надстроек платформы .NET Framework является *контракта*, который определяет, как ведущее приложение и надстройка взаимодействуют друг с другом.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-135">The fundamental unit of the .NET Framework add-in model is the *contract*, which defines how a host application and an add-in communicate with each other.</span></span> <span data-ttu-id="5fd3d-136">Контракт предоставляется ведущему приложению с помощью специфичного для ведущего приложения *представления* контракта.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-136">A contract is exposed to a host application using a host-application-specific *view* of the contract.</span></span> <span data-ttu-id="5fd3d-137">Аналогичным образом надстройке предоставляется специфичное для нее *представление* контракта.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-137">Likewise, an add-in-specific *view* of the contract is exposed to the add-in.</span></span> <span data-ttu-id="5fd3d-138">*Адаптер* позволяет ведущему приложению и надстройке обмениваться данными между соответствующими представлениями контракта.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-138">An *adapter* is used to allow a host application and an add-in to communicate between their respective views of the contract.</span></span> <span data-ttu-id="5fd3d-139">Контракты, представления и адаптеры называются сегментами, а набор связанных сегментов составляет *конвейер*.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-139">Contracts, views, and adapters are referred to as segments, and a set of related segments constitutes a *pipeline*.</span></span> <span data-ttu-id="5fd3d-140">Конвейеры — это основа, на которой модель надстроек платформы .NET Framework поддерживает обнаружение, активации, изоляции и безопасности, изоляцию выполнения (с использованием доменов приложений и процессов), обмен данными, управление жизненным циклом и управление версиями.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-140">Pipelines are the foundation upon which the .NET Framework add-in model supports discovery, activation, security isolation, execution isolation (using both application domains and processes), communication, lifetime management, and versioning.</span></span>  
  
 <span data-ttu-id="5fd3d-141">Эта поддержка в целом позволяет разработчикам создавать надстройки, которые интегрируются с функциональностью ведущего приложения.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-141">The sum of this support allows developers to build add-ins that integrate with the functionality of a host application.</span></span> <span data-ttu-id="5fd3d-142">Однако в некоторых сценариях требуется ведущее приложение должно отображать интерфейс пользователя надстройки. Поскольку каждая технология представления в .NET Framework имеет свою собственную модель для реализации пользовательских интерфейсов, модель надстроек платформы .NET Framework не поддерживает любой определенную технологию представления.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-142">However, some scenarios require host applications to display user interfaces provided by add-ins. Because each presentation technology in the .NET Framework has its own model for implementing user interfaces, the .NET Framework add-in model does not support any particular presentation technology.</span></span> <span data-ttu-id="5fd3d-143">Вместо этого WPF расширяет модель надстроек платформы .NET Framework с поддержкой пользовательского интерфейса для надстройки.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-143">Instead, WPF extends the .NET Framework add-in model with UI support for add-ins.</span></span>  
  
<a name="WPFAddInModel"></a>   
## <a name="wpf-add-ins"></a><span data-ttu-id="5fd3d-144">Надстройки WPF</span><span class="sxs-lookup"><span data-stu-id="5fd3d-144">WPF Add-Ins</span></span>  
 <span data-ttu-id="5fd3d-145">WPF, в сочетании с .NET Framework модель надстроек, позволяет решить широкий спектр сценариев, требующих ведущее приложение отображало пользовательских интерфейсов из надстройки. В частности эти сценарии реализованы в WPF с помощью следующих двух моделей программирования:</span><span class="sxs-lookup"><span data-stu-id="5fd3d-145">WPF, in conjunction with the .NET Framework add-in model, allows you to address a wide variety of scenarios that require host applications to display user interfaces from add-ins. In particular, these scenarios are addressed by WPF with the following two programming models:</span></span>  
  
1.  <span data-ttu-id="5fd3d-146">**Надстройка возвращает пользовательский интерфейс**.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-146">**The add-in returns a UI**.</span></span> <span data-ttu-id="5fd3d-147">Надстройка возвращает пользовательский Интерфейс ведущему приложению с помощью вызова метода, как определено в контракте.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-147">An add-in returns a UI to the host application via a method call, as defined by the contract.</span></span> <span data-ttu-id="5fd3d-148">Этот сценарий используется в следующих случаях.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-148">This scenario is used in the following cases:</span></span>  
  
    -   <span data-ttu-id="5fd3d-149">Внешний вид пользовательского интерфейса, который возвращается надстройке зависит от данных или условий, которые существуют только во время выполнения, такие как динамически создаваемые отчеты.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-149">The appearance of a UI that is returned by an add-in is dependent on either data or conditions that exist only at run time, such as dynamically generated reports.</span></span>  
  
    -   <span data-ttu-id="5fd3d-150">Пользовательский Интерфейс для службы, предоставляемые надстройки отличается от ведущих приложений, которые можно использовать надстройки пользовательского интерфейса.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-150">The UI for services provided by an add-in differs from the UI of the host applications that can use the add-in.</span></span>  
  
    -   <span data-ttu-id="5fd3d-151">Надстройки в основном выполняет службу для ведущего приложения и сообщает о состоянии ведущему приложению с пользовательским Интерфейсом.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-151">The add-in primarily performs a service for the host application, and reports status to the host application with a UI.</span></span>  
  
2.  <span data-ttu-id="5fd3d-152">**Надстройка — это пользовательский интерфейс**.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-152">**The add-in is a UI**.</span></span> <span data-ttu-id="5fd3d-153">Надстройка является пользовательским Интерфейсом, как определено в контракте.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-153">An add-in is a UI, as defined by the contract.</span></span> <span data-ttu-id="5fd3d-154">Этот сценарий используется в следующих случаях.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-154">This scenario is used in the following cases:</span></span>  
  
    -   <span data-ttu-id="5fd3d-155">Надстройка не предоставляет службы помимо отображения, например рекламного объявления.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-155">An add-in doesn't provide services other than being displayed, such as an advertisement.</span></span>  
  
    -   <span data-ttu-id="5fd3d-156">Пользовательский Интерфейс для службы, предоставляемые надстройки являются общими для всех ведущих приложений, которые могут использовать эту надстройку, например калькулятор или палитру цветов.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-156">The UI for services provided by an add-in is common to all host applications that can use that add-in, such as a calculator or color picker.</span></span>  
  
 <span data-ttu-id="5fd3d-157">Эти сценарии требуют, что объекты пользовательского интерфейса могут передаваться между ведущим приложением и доменами приложений надстроек.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-157">These scenarios require that UI objects can be passed between host application and add-in application domains.</span></span> <span data-ttu-id="5fd3d-158">Поскольку платформа .NET Framework, модель надстроек использует удаленное взаимодействие между доменами приложений объекты, которые передаются между ними должны поддерживать удаленную обработку.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-158">Since the .NET Framework add-in model relies on remoting to communicate between application domains, the objects that are passed between them must be remotable.</span></span>  
  
 <span data-ttu-id="5fd3d-159">Объект, поддерживающий удаленную обработку, является экземпляром класса, который выполняет одну или несколько из следующих функций:</span><span class="sxs-lookup"><span data-stu-id="5fd3d-159">A remotable object is an instance of a class that does one or more of the following:</span></span>  
  
-   <span data-ttu-id="5fd3d-160">Является производным от <xref:System.MarshalByRefObject> класса.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-160">Derives from the <xref:System.MarshalByRefObject> class.</span></span>  
  
-   <span data-ttu-id="5fd3d-161">Реализует интерфейс <xref:System.Runtime.Serialization.ISerializable>.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-161">Implements the <xref:System.Runtime.Serialization.ISerializable> interface.</span></span>  
  
-   <span data-ttu-id="5fd3d-162">Имеет <xref:System.SerializableAttribute> применен атрибут.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-162">Has the <xref:System.SerializableAttribute> attribute applied.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="5fd3d-163">Дополнительные сведения о создании объектов удаленного взаимодействия .NET Framework, см. в разделе [внесения поддержки удаленного взаимодействия объектами](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/wcf3swha(v=vs.100)).</span><span class="sxs-lookup"><span data-stu-id="5fd3d-163">For more information regarding the creation of remotable .NET Framework objects, see [Making Objects Remotable](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/wcf3swha(v=vs.100)).</span></span>  
  
 <span data-ttu-id="5fd3d-164">Типы пользовательского интерфейса WPF, не поддерживающие удаленное взаимодействие.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-164">The WPF UI types are not remotable.</span></span> <span data-ttu-id="5fd3d-165">Чтобы решить проблему, WPF расширяет модель надстроек платформы .NET Framework для включения пользовательского интерфейса WPF созданные надстройки для отображения из ведущих приложений.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-165">To solve the problem, WPF extends the .NET Framework add-in model to enable WPF UI created by add-ins to be displayed from host applications.</span></span> <span data-ttu-id="5fd3d-166">Эта поддержка обеспечивается WPF с двух типов: <xref:System.AddIn.Contract.INativeHandleContract> интерфейс и два статических метода, реализуемый <xref:System.AddIn.Pipeline.FrameworkElementAdapters> класса: <xref:System.AddIn.Pipeline.FrameworkElementAdapters.ContractToViewAdapter%2A> и <xref:System.AddIn.Pipeline.FrameworkElementAdapters.ViewToContractAdapter%2A>.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-166">This support is provided by WPF by two types: the <xref:System.AddIn.Contract.INativeHandleContract> interface and two static methods implemented by the <xref:System.AddIn.Pipeline.FrameworkElementAdapters> class: <xref:System.AddIn.Pipeline.FrameworkElementAdapters.ContractToViewAdapter%2A> and <xref:System.AddIn.Pipeline.FrameworkElementAdapters.ViewToContractAdapter%2A>.</span></span> <span data-ttu-id="5fd3d-167">На высоком уровне эти типы и методы используются следующим образом:</span><span class="sxs-lookup"><span data-stu-id="5fd3d-167">At a high level, these types and methods are used in the following manner:</span></span>  
  
1.  <span data-ttu-id="5fd3d-168">Технология WPF требует, что пользовательские интерфейсы, предоставляемые надстройки являются классами, которые прямо или косвенно наследующие от <xref:System.Windows.FrameworkElement>, таких как фигуры, элементы управления, пользовательские элементы управления, панели макета и страницы.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-168">WPF requires that user interfaces provided by add-ins are classes that derive directly or indirectly from <xref:System.Windows.FrameworkElement>, such as shapes, controls, user controls, layout panels, and pages.</span></span>  
  
2.  <span data-ttu-id="5fd3d-169">Везде, где в контракте объявляется, что пользовательский Интерфейс будет передаваться между надстройкой и ведущим приложением, он должен быть объявлен как <xref:System.AddIn.Contract.INativeHandleContract> (не <xref:System.Windows.FrameworkElement>); <xref:System.AddIn.Contract.INativeHandleContract> является удаленным представлением надстройки пользовательского интерфейса, могут передаваться через границы изоляции.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-169">Wherever the contract declares that a UI will be passed between the add-in and the host application, it must be declared as an <xref:System.AddIn.Contract.INativeHandleContract> (not a <xref:System.Windows.FrameworkElement>); <xref:System.AddIn.Contract.INativeHandleContract> is a remotable representation of the add-in UI that can be passed across isolation boundaries.</span></span>  
  
3.  <span data-ttu-id="5fd3d-170">Перед передачей из домена приложения надстройки <xref:System.Windows.FrameworkElement> входит в состав <xref:System.AddIn.Contract.INativeHandleContract> путем вызова <xref:System.AddIn.Pipeline.FrameworkElementAdapters.ViewToContractAdapter%2A>.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-170">Before being passed from the add-in's application domain, a <xref:System.Windows.FrameworkElement> is packaged as an <xref:System.AddIn.Contract.INativeHandleContract> by calling <xref:System.AddIn.Pipeline.FrameworkElementAdapters.ViewToContractAdapter%2A>.</span></span>  
  
4.  <span data-ttu-id="5fd3d-171">После передачи домен приложения ведущего приложения, <xref:System.AddIn.Contract.INativeHandleContract> нужно упаковать в <xref:System.Windows.FrameworkElement> путем вызова <xref:System.AddIn.Pipeline.FrameworkElementAdapters.ContractToViewAdapter%2A>.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-171">After being passed to the host application's application domain, the <xref:System.AddIn.Contract.INativeHandleContract> must be repackaged as a <xref:System.Windows.FrameworkElement> by calling <xref:System.AddIn.Pipeline.FrameworkElementAdapters.ContractToViewAdapter%2A>.</span></span>  
  
 <span data-ttu-id="5fd3d-172">Как <xref:System.AddIn.Contract.INativeHandleContract>, <xref:System.AddIn.Pipeline.FrameworkElementAdapters.ContractToViewAdapter%2A>, и <xref:System.AddIn.Pipeline.FrameworkElementAdapters.ViewToContractAdapter%2A> используются зависит от конкретного сценария.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-172">How <xref:System.AddIn.Contract.INativeHandleContract>, <xref:System.AddIn.Pipeline.FrameworkElementAdapters.ContractToViewAdapter%2A>, and <xref:System.AddIn.Pipeline.FrameworkElementAdapters.ViewToContractAdapter%2A> are used depends on the specific scenario.</span></span> <span data-ttu-id="5fd3d-173">В следующих разделах содержатся сведения о каждой модели программирования.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-173">The following sections provide details for each programming model.</span></span>  
  
<a name="ReturnUIFromAddInContract"></a>   
## <a name="add-in-returns-a-user-interface"></a><span data-ttu-id="5fd3d-174">Надстройка возвращает пользовательский интерфейс</span><span class="sxs-lookup"><span data-stu-id="5fd3d-174">Add-In Returns a User Interface</span></span>  
 <span data-ttu-id="5fd3d-175">Для надстройки для возврата пользовательского интерфейса ведущего приложения необходимы следующие компоненты:</span><span class="sxs-lookup"><span data-stu-id="5fd3d-175">For an add-in to return a UI to a host application, the following are required:</span></span>  
  
1.  <span data-ttu-id="5fd3d-176">Ведущее приложение, надстройка и конвейер должны создаваться, как описано в .NET Framework [надстройки и расширения](/previous-versions/dotnet/netframework-4.0/bb384200(v%3dvs.100)) документации.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-176">The host application, add-in, and pipeline must be created, as described by the .NET Framework [Add-ins and Extensibility](/previous-versions/dotnet/netframework-4.0/bb384200(v%3dvs.100)) documentation.</span></span>  
  
2.  <span data-ttu-id="5fd3d-177">Контракт должен реализовывать <xref:System.AddIn.Contract.IContract> и, чтобы вернуть пользовательского интерфейса, контракт должен быть объявлен метод с возвращаемым значением типа <xref:System.AddIn.Contract.INativeHandleContract>.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-177">The contract must implement <xref:System.AddIn.Contract.IContract> and, to return a UI, the contract must declare a method with a return value of type <xref:System.AddIn.Contract.INativeHandleContract>.</span></span>  
  
3.  <span data-ttu-id="5fd3d-178">Пользовательский Интерфейс, который передается между надстройкой и ведущим приложением должен прямо или косвенно быть производным от <xref:System.Windows.FrameworkElement>.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-178">The UI that is passed between the add-in and the host application must directly or indirectly derive from <xref:System.Windows.FrameworkElement>.</span></span>  
  
4.  <span data-ttu-id="5fd3d-179">Пользовательский Интерфейс, который возвращается методом надстройка должна быть преобразована из <xref:System.Windows.FrameworkElement> для <xref:System.AddIn.Contract.INativeHandleContract> перед пересечением границы изоляции.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-179">The UI that is returned by the add-in must be converted from a <xref:System.Windows.FrameworkElement> to an <xref:System.AddIn.Contract.INativeHandleContract> before crossing the isolation boundary.</span></span>  
  
5.  <span data-ttu-id="5fd3d-180">Пользовательский Интерфейс, который возвращается должны преобразовываться из <xref:System.AddIn.Contract.INativeHandleContract> для <xref:System.Windows.FrameworkElement> после пересечения границы изоляции.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-180">The UI that is returned must be converted from an <xref:System.AddIn.Contract.INativeHandleContract> to a <xref:System.Windows.FrameworkElement> after crossing the isolation boundary.</span></span>  
  
6.  <span data-ttu-id="5fd3d-181">Ведущее приложение отображает возвращаемый <xref:System.Windows.FrameworkElement>.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-181">The host application displays the returned <xref:System.Windows.FrameworkElement>.</span></span>  
  
 <span data-ttu-id="5fd3d-182">Пример, демонстрирующий реализацию надстройки, возвращающей пользовательский Интерфейс, см. в разделе [создание надстройки, возвращающей пользовательский Интерфейс](how-to-create-an-add-in-that-returns-a-ui.md).</span><span class="sxs-lookup"><span data-stu-id="5fd3d-182">For an example that demonstrates how to implement an add-in that returns a UI, see [Create an Add-In That Returns a UI](how-to-create-an-add-in-that-returns-a-ui.md).</span></span>  
  
<a name="AddInIsAUI"></a>   
## <a name="add-in-is-a-user-interface"></a><span data-ttu-id="5fd3d-183">Надстройка является пользовательским интерфейсом</span><span class="sxs-lookup"><span data-stu-id="5fd3d-183">Add-In Is a User Interface</span></span>  
 <span data-ttu-id="5fd3d-184">Если надстройка является пользовательским Интерфейсом, необходимы следующие компоненты:</span><span class="sxs-lookup"><span data-stu-id="5fd3d-184">When an add-in is a UI, the following are required:</span></span>  
  
1.  <span data-ttu-id="5fd3d-185">Ведущее приложение, надстройка и конвейер должны создаваться, как описано в .NET Framework [надстройки и расширения](/previous-versions/dotnet/netframework-4.0/bb384200(v%3dvs.100)) документации.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-185">The host application, add-in, and pipeline must be created, as described by the .NET Framework [Add-ins and Extensibility](/previous-versions/dotnet/netframework-4.0/bb384200(v%3dvs.100)) documentation.</span></span>  
  
2.  <span data-ttu-id="5fd3d-186">Интерфейс контракта для надстройки должен реализовывать <xref:System.AddIn.Contract.INativeHandleContract>.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-186">The contract interface for the add-in must implement <xref:System.AddIn.Contract.INativeHandleContract>.</span></span>  
  
3.  <span data-ttu-id="5fd3d-187">Надстройка, которая передается ведущему приложению должен прямо или косвенно быть производным от <xref:System.Windows.FrameworkElement>.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-187">The add-in that is passed to the host application must directly or indirectly derive from <xref:System.Windows.FrameworkElement>.</span></span>  
  
4.  <span data-ttu-id="5fd3d-188">Надстройка должна быть преобразована из <xref:System.Windows.FrameworkElement> для <xref:System.AddIn.Contract.INativeHandleContract> перед пересечением границы изоляции.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-188">The add-in must be converted from a <xref:System.Windows.FrameworkElement> to an <xref:System.AddIn.Contract.INativeHandleContract> before crossing the isolation boundary.</span></span>  
  
5.  <span data-ttu-id="5fd3d-189">Надстройка должна быть преобразована из <xref:System.AddIn.Contract.INativeHandleContract> для <xref:System.Windows.FrameworkElement> после пересечения границы изоляции.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-189">The add-in must be converted from an <xref:System.AddIn.Contract.INativeHandleContract> to a <xref:System.Windows.FrameworkElement> after crossing the isolation boundary.</span></span>  
  
6.  <span data-ttu-id="5fd3d-190">Ведущее приложение отображает возвращаемый <xref:System.Windows.FrameworkElement>.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-190">The host application displays the returned <xref:System.Windows.FrameworkElement>.</span></span>  
  
 <span data-ttu-id="5fd3d-191">Пример, демонстрирующий реализацию надстройки, являющейся пользовательским Интерфейсом, см. в разделе [надстройка — то есть создание пользовательского интерфейса](how-to-create-an-add-in-that-is-a-ui.md).</span><span class="sxs-lookup"><span data-stu-id="5fd3d-191">For an example that demonstrates how to implement an add-in that is a UI, see [Create an Add-In That Is a UI](how-to-create-an-add-in-that-is-a-ui.md).</span></span>  
  
<a name="ReturningMultipleUIsFromAnAddIn"></a>   
## <a name="returning-multiple-uis-from-an-add-in"></a><span data-ttu-id="5fd3d-192">Возвращение нескольких пользовательских интерфейсов из надстройки</span><span class="sxs-lookup"><span data-stu-id="5fd3d-192">Returning Multiple UIs from an Add-In</span></span>  
 <span data-ttu-id="5fd3d-193">Надстройки часто предоставляют несколько пользовательских интерфейсов для отображения ведущими приложениями.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-193">Add-ins often provide multiple user interfaces for host applications to display.</span></span> <span data-ttu-id="5fd3d-194">Например рассмотрим надстройки, являющейся пользовательским Интерфейсом, которая предоставляет сведения о состоянии ведущему приложению, также как пользовательский Интерфейс.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-194">For example, consider an add-in that is a UI that also provides status information to the host application, also as a UI.</span></span> <span data-ttu-id="5fd3d-195">Такие надстройки можно реализовать с помощью сочетания методов из моделей [Надстройка возвращает пользовательский интерфейс](#ReturnUIFromAddInContract) и [Надстройка является пользовательским интерфейсом](#AddInIsAUI).</span><span class="sxs-lookup"><span data-stu-id="5fd3d-195">An add-in like this can be implemented by using a combination of techniques from both the [Add-In Returns a User Interface](#ReturnUIFromAddInContract) and [Add-In Is a User Interface](#AddInIsAUI) models.</span></span>  
  
<a name="AddInsAndXBAPs"></a>   
## <a name="add-ins-and-xaml-browser-applications"></a><span data-ttu-id="5fd3d-196">Надстройки и приложения браузера XAML</span><span class="sxs-lookup"><span data-stu-id="5fd3d-196">Add-Ins and XAML Browser Applications</span></span>  
 <span data-ttu-id="5fd3d-197">В приведенных примерах ведущее приложение было установленным автономным приложением.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-197">In the examples so far, the host application has been an installed standalone application.</span></span> <span data-ttu-id="5fd3d-198">Однако [!INCLUDE[TLA#tla_xbap#plural](../../../../includes/tlasharptla-xbapsharpplural-md.md)] также может размещать надстройки, хотя при этом применяются следующие дополнительные требования к сборке и реализации.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-198">But [!INCLUDE[TLA#tla_xbap#plural](../../../../includes/tlasharptla-xbapsharpplural-md.md)] can also host add-ins, albeit with the following additional build and implementation requirements:</span></span>  
  
-   <span data-ttu-id="5fd3d-199">Манифест приложения [!INCLUDE[TLA2#tla_xbap](../../../../includes/tla2sharptla-xbap-md.md)] должен быть настроен специально для загрузки конвейера (папок и сборок) и сборки надстройки в кэш приложения [!INCLUDE[TLA#tla_clickonce](../../../../includes/tlasharptla-clickonce-md.md)] на клиентской машине в той же папке, где находится [!INCLUDE[TLA2#tla_xbap](../../../../includes/tla2sharptla-xbap-md.md)].</span><span class="sxs-lookup"><span data-stu-id="5fd3d-199">The [!INCLUDE[TLA2#tla_xbap](../../../../includes/tla2sharptla-xbap-md.md)] application manifest must be configured specially to download the pipeline (folders and assemblies) and add-in assembly to the [!INCLUDE[TLA#tla_clickonce](../../../../includes/tlasharptla-clickonce-md.md)] application cache on the client machine, in the same folder as the [!INCLUDE[TLA2#tla_xbap](../../../../includes/tla2sharptla-xbap-md.md)].</span></span>  
  
-   <span data-ttu-id="5fd3d-200">Код [!INCLUDE[TLA2#tla_xbap](../../../../includes/tla2sharptla-xbap-md.md)] для обнаружения и загрузки надстроек должен использовать кэш приложения [!INCLUDE[TLA2#tla_clickonce](../../../../includes/tla2sharptla-clickonce-md.md)] для [!INCLUDE[TLA2#tla_xbap](../../../../includes/tla2sharptla-xbap-md.md)] в качестве расположения конвейера и надстройки.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-200">The [!INCLUDE[TLA2#tla_xbap](../../../../includes/tla2sharptla-xbap-md.md)] code to discover and load add-ins must use the [!INCLUDE[TLA2#tla_clickonce](../../../../includes/tla2sharptla-clickonce-md.md)] application cache for the [!INCLUDE[TLA2#tla_xbap](../../../../includes/tla2sharptla-xbap-md.md)] as the pipeline and add-in location.</span></span>  
  
-   <span data-ttu-id="5fd3d-201">[!INCLUDE[TLA2#tla_xbap](../../../../includes/tla2sharptla-xbap-md.md)] должен загрузить надстройку в специальный контекст безопасности, если надстройка ссылается на свободные файлы, расположенные на исходном узле. Если они размещаются в [!INCLUDE[TLA2#tla_xbap#plural](../../../../includes/tla2sharptla-xbapsharpplural-md.md)], надстройки могут ссылаться только на свободные файлы, расположенные на исходном узле ведущего приложения.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-201">The [!INCLUDE[TLA2#tla_xbap](../../../../includes/tla2sharptla-xbap-md.md)] must load the add-in into a special security context if the add-in references loose files that are located at the site of origin; when hosted by [!INCLUDE[TLA2#tla_xbap#plural](../../../../includes/tla2sharptla-xbapsharpplural-md.md)], add-ins can only reference loose files that are located at the host application's site of origin.</span></span>  
  
 <span data-ttu-id="5fd3d-202">Эти задачи подробно описаны в следующих подразделах.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-202">These tasks are described in detail in the following subsections.</span></span>  
  
### <a name="configuring-the-pipeline-and-add-in-for-clickonce-deployment"></a><span data-ttu-id="5fd3d-203">Настройка конвейера и надстройки для развертывания ClickOnce</span><span class="sxs-lookup"><span data-stu-id="5fd3d-203">Configuring the Pipeline and Add-In for ClickOnce Deployment</span></span>  
 [!INCLUDE[TLA2#tla_xbap#plural](../../../../includes/tla2sharptla-xbapsharpplural-md.md)] <span data-ttu-id="5fd3d-204">загружается в безопасную папку в [!INCLUDE[TLA2#tla_clickonce](../../../../includes/tla2sharptla-clickonce-md.md)] кэше развертывания и запускается из нее.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-204">are downloaded to and run from a safe folder in the [!INCLUDE[TLA2#tla_clickonce](../../../../includes/tla2sharptla-clickonce-md.md)] deployment cache.</span></span> <span data-ttu-id="5fd3d-205">Для размещения надстройки в [!INCLUDE[TLA2#tla_xbap](../../../../includes/tla2sharptla-xbap-md.md)] конвейер и сборка надстройки также должны быть загружены в безопасную папку.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-205">In order for an [!INCLUDE[TLA2#tla_xbap](../../../../includes/tla2sharptla-xbap-md.md)] to host an add-in, the pipeline and add-in assembly must also be downloaded to the safe folder.</span></span> <span data-ttu-id="5fd3d-206">Для этого нужно настроить манифест приложения для включения и конвейера и сборки надстройки для загрузки.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-206">To achieve this, you need to configure the application manifest to include both the pipeline and add-in assembly for download.</span></span> <span data-ttu-id="5fd3d-207">Проще всего это сделать в [!INCLUDE[TLA2#tla_visualstu](../../../../includes/tla2sharptla-visualstu-md.md)], хотя сборка конвейера и надстройки должна находиться в корневой папке проекта [!INCLUDE[TLA2#tla_xbap](../../../../includes/tla2sharptla-xbap-md.md)], чтобы [!INCLUDE[TLA2#tla_visualstu](../../../../includes/tla2sharptla-visualstu-md.md)] мог обнаружить сборочные узлы конвейера.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-207">This is most easily done in [!INCLUDE[TLA2#tla_visualstu](../../../../includes/tla2sharptla-visualstu-md.md)], although the pipeline and add-in assembly needs to be in the host [!INCLUDE[TLA2#tla_xbap](../../../../includes/tla2sharptla-xbap-md.md)] project's root folder in order for [!INCLUDE[TLA2#tla_visualstu](../../../../includes/tla2sharptla-visualstu-md.md)] to detect the pipeline assemblies.</span></span>  
  
 <span data-ttu-id="5fd3d-208">Следовательно, первый шаг — создать сборку конвейера и надстройки в корне проекта [!INCLUDE[TLA2#tla_xbap](../../../../includes/tla2sharptla-xbap-md.md)], настроив выходные данные построения для каждого проекта сборки конвейера и сборки надстройки.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-208">Consequently, the first step is to build the pipeline and add-in assembly to the [!INCLUDE[TLA2#tla_xbap](../../../../includes/tla2sharptla-xbap-md.md)] project's root by setting the build output of each pipeline assembly and add-in assembly projects.</span></span> <span data-ttu-id="5fd3d-209">В следующей таблице показаны выходные пути построения для проектов сборки конвейера и проекта сборки надстройки, которые находятся в том же решении и корневой папке, что и проект ведущего приложения [!INCLUDE[TLA2#tla_xbap](../../../../includes/tla2sharptla-xbap-md.md)].</span><span class="sxs-lookup"><span data-stu-id="5fd3d-209">The following table shows the build output paths for pipeline assembly projects and add-in assembly project that are in the same solution and root folder as the host [!INCLUDE[TLA2#tla_xbap](../../../../includes/tla2sharptla-xbap-md.md)] project.</span></span>  
  
 <span data-ttu-id="5fd3d-210">Таблица 1. Создание выходных путей построения для сборок конвейера, размещенных в XBAP</span><span class="sxs-lookup"><span data-stu-id="5fd3d-210">Table 1: Build Output Paths for the Pipeline Assemblies That Are Hosted by an XBAP</span></span>  
  
|<span data-ttu-id="5fd3d-211">Проект сборки конвейера</span><span class="sxs-lookup"><span data-stu-id="5fd3d-211">Pipeline assembly project</span></span>|<span data-ttu-id="5fd3d-212">Выходной путь сборки</span><span class="sxs-lookup"><span data-stu-id="5fd3d-212">Build output path</span></span>|  
|-------------------------------|-----------------------|  
|<span data-ttu-id="5fd3d-213">Контракт</span><span class="sxs-lookup"><span data-stu-id="5fd3d-213">Contract</span></span>|`..\HostXBAP\Contracts\`|  
|<span data-ttu-id="5fd3d-214">Представление надстройки</span><span class="sxs-lookup"><span data-stu-id="5fd3d-214">Add-In View</span></span>|`..\HostXBAP\AddInViews\`|  
|<span data-ttu-id="5fd3d-215">Адаптер надстройки</span><span class="sxs-lookup"><span data-stu-id="5fd3d-215">Add-In-Side Adapter</span></span>|`..\HostXBAP\AddInSideAdapters\`|  
|<span data-ttu-id="5fd3d-216">Адаптер приложения</span><span class="sxs-lookup"><span data-stu-id="5fd3d-216">Host-Side Adapter</span></span>|`..\HostXBAP\HostSideAdapters\`|  
|<span data-ttu-id="5fd3d-217">Надстройка</span><span class="sxs-lookup"><span data-stu-id="5fd3d-217">Add-In</span></span>|`..\HostXBAP\AddIns\WPFAddIn1`|  
  
 <span data-ttu-id="5fd3d-218">Следующим шагом является указание сборок конвейера и сборки надстройки как файлов содержимого [!INCLUDE[TLA2#tla_xbap#plural](../../../../includes/tla2sharptla-xbapsharpplural-md.md)] в [!INCLUDE[TLA2#tla_visualstu](../../../../includes/tla2sharptla-visualstu-md.md)] следующим образом.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-218">The next step is to specify the pipeline assemblies and add-in assembly as the [!INCLUDE[TLA2#tla_xbap#plural](../../../../includes/tla2sharptla-xbapsharpplural-md.md)] content files in [!INCLUDE[TLA2#tla_visualstu](../../../../includes/tla2sharptla-visualstu-md.md)] by doing the following:</span></span>  
  
1.  <span data-ttu-id="5fd3d-219">Включение сборки конвейера и надстройки в проект. Для этого следует щелкнуть правой кнопкой мыши каждую папку конвейера в обозревателе решений и выбрать вариант **Включить в проект**.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-219">Including the pipeline and add-in assembly in the project by right-clicking each pipeline folder in Solution Explorer and choosing **Include In Project**.</span></span>  
  
2.  <span data-ttu-id="5fd3d-220">Установка для **Действия при построении** для каждой сборки конвейера и надстройки значения **Содержимое** в окне **Свойства**.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-220">Setting the **Build Action** of each pipeline assembly and add-in assembly to **Content** from the **Properties** window.</span></span>  
  
 <span data-ttu-id="5fd3d-221">Последним шагом является настройка манифеста приложения для включения файлов сборки конвейера и файла сборки надстройки для загрузки.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-221">The final step is to configure the application manifest to include the pipeline assembly files and add-in assembly file for download.</span></span> <span data-ttu-id="5fd3d-222">Файлы должны располагаться в папках в корне папки в кэше [!INCLUDE[TLA2#tla_clickonce](../../../../includes/tla2sharptla-clickonce-md.md)], занимаемом приложением [!INCLUDE[TLA2#tla_xbap](../../../../includes/tla2sharptla-xbap-md.md)].</span><span class="sxs-lookup"><span data-stu-id="5fd3d-222">The files should be located in folders at the root of the folder in the [!INCLUDE[TLA2#tla_clickonce](../../../../includes/tla2sharptla-clickonce-md.md)] cache that the [!INCLUDE[TLA2#tla_xbap](../../../../includes/tla2sharptla-xbap-md.md)] application occupies.</span></span> <span data-ttu-id="5fd3d-223">Эта конфигурация может реализовываться в [!INCLUDE[TLA2#tla_visualstu](../../../../includes/tla2sharptla-visualstu-md.md)] следующим образом:</span><span class="sxs-lookup"><span data-stu-id="5fd3d-223">The configuration can be achieved in [!INCLUDE[TLA2#tla_visualstu](../../../../includes/tla2sharptla-visualstu-md.md)] by doing the following:</span></span>  
  
1.  <span data-ttu-id="5fd3d-224">Щелкните правой кнопкой мыши проект [!INCLUDE[TLA2#tla_xbap](../../../../includes/tla2sharptla-xbap-md.md)], выберите **Свойства**, **Публиковать**, а затем нажмите кнопку **Файлы приложения**.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-224">Right-click the [!INCLUDE[TLA2#tla_xbap](../../../../includes/tla2sharptla-xbap-md.md)] project, click **Properties**, click **Publish**, and then click the **Application Files** button.</span></span>  
  
2.  <span data-ttu-id="5fd3d-225">В диалоговом окне **Файлы приложения** установите для параметра **Состояния публикации** каждой DLL конвейера и надстройки значение **Включить (авто)**, а для **Группы загрузки** для каждой DLL конвейера и надстройки — значение **(обязательно)**.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-225">In the **Application Files** dialog, set the **Publish Status** of each pipeline and add-in DLL to **Include (Auto)**, and set the **Download Group** for each pipeline and add-in DLL to **(Required)**.</span></span>  
  
### <a name="using-the-pipeline-and-add-in-from-the-application-base"></a><span data-ttu-id="5fd3d-226">Использование конвейера и надстройки из базовой папки приложения</span><span class="sxs-lookup"><span data-stu-id="5fd3d-226">Using the Pipeline and Add-In from the Application Base</span></span>  
 <span data-ttu-id="5fd3d-227">Если конвейер и надстройка настроены для развертывания [!INCLUDE[TLA2#tla_clickonce](../../../../includes/tla2sharptla-clickonce-md.md)], они загружаются в ту же папку кэша [!INCLUDE[TLA2#tla_clickonce](../../../../includes/tla2sharptla-clickonce-md.md)], что и [!INCLUDE[TLA2#tla_xbap](../../../../includes/tla2sharptla-xbap-md.md)].</span><span class="sxs-lookup"><span data-stu-id="5fd3d-227">When the pipeline and add-in are configured for [!INCLUDE[TLA2#tla_clickonce](../../../../includes/tla2sharptla-clickonce-md.md)] deployment, they are downloaded to the same [!INCLUDE[TLA2#tla_clickonce](../../../../includes/tla2sharptla-clickonce-md.md)] cache folder as the [!INCLUDE[TLA2#tla_xbap](../../../../includes/tla2sharptla-xbap-md.md)].</span></span> <span data-ttu-id="5fd3d-228">Чтобы использовать конвейер и надстройку из [!INCLUDE[TLA2#tla_xbap](../../../../includes/tla2sharptla-xbap-md.md)], код [!INCLUDE[TLA2#tla_xbap](../../../../includes/tla2sharptla-xbap-md.md)] должен получить их из базовой папки приложения.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-228">To use the pipeline and add-in from the [!INCLUDE[TLA2#tla_xbap](../../../../includes/tla2sharptla-xbap-md.md)], the [!INCLUDE[TLA2#tla_xbap](../../../../includes/tla2sharptla-xbap-md.md)] code must get them from the application base.</span></span> <span data-ttu-id="5fd3d-229">Различные типы и члены модели надстроек платформы .NET Framework для использования конвейеров и надстроек обеспечивают специальную поддержку для этого сценария.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-229">The various types and members of the .NET Framework add-in model for using pipelines and add-ins provide special support for this scenario.</span></span> <span data-ttu-id="5fd3d-230">Во-первых, определяется путь <xref:System.AddIn.Hosting.PipelineStoreLocation.ApplicationBase> значение перечисления.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-230">Firstly, the path is identified by the <xref:System.AddIn.Hosting.PipelineStoreLocation.ApplicationBase> enumeration value.</span></span> <span data-ttu-id="5fd3d-231">Это значение используется при перегрузках соответствующих элементов надстройки для использования конвейеров, которые включают следующее:</span><span class="sxs-lookup"><span data-stu-id="5fd3d-231">You use this value with overloads of the pertinent add-in members for using pipelines that include the following:</span></span>  
  
-   <xref:System.AddIn.Hosting.AddInStore.FindAddIns%28System.Type%2CSystem.AddIn.Hosting.PipelineStoreLocation%29?displayProperty=nameWithType>  
  
-   <xref:System.AddIn.Hosting.AddInStore.FindAddIns%28System.Type%2CSystem.AddIn.Hosting.PipelineStoreLocation%2CSystem.String%5B%5D%29?displayProperty=nameWithType>  
  
-   <xref:System.AddIn.Hosting.AddInStore.Rebuild%28System.AddIn.Hosting.PipelineStoreLocation%29?displayProperty=nameWithType>  
  
-   <xref:System.AddIn.Hosting.AddInStore.Update%28System.AddIn.Hosting.PipelineStoreLocation%29?displayProperty=nameWithType>  
  
### <a name="accessing-the-hosts-site-of-origin"></a><span data-ttu-id="5fd3d-232">Доступ к исходному узлу ведущего приложения</span><span class="sxs-lookup"><span data-stu-id="5fd3d-232">Accessing the Host's Site of Origin</span></span>  
 <span data-ttu-id="5fd3d-233">Чтобы надстройка могла ссылаться на файлы с исходного узла, она должна быть загружена с изоляцией безопасности, эквивалентной ведущему приложению.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-233">To ensure that an add-in can reference files from the site of origin, the add-in must be loaded with security isolation that is equivalent to the host application.</span></span> <span data-ttu-id="5fd3d-234">Этот уровень безопасности определяется <xref:System.AddIn.Hosting.AddInSecurityLevel.Host?displayProperty=nameWithType> значение перечисления и передается <xref:System.AddIn.Hosting.AddInToken.Activate%2A> метод при активации надстройки.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-234">This security level is identified by the <xref:System.AddIn.Hosting.AddInSecurityLevel.Host?displayProperty=nameWithType> enumeration value, and passed to the <xref:System.AddIn.Hosting.AddInToken.Activate%2A> method when an add-in is activated.</span></span>  
  
<a name="WPFAddInModelArchitecture"></a>   
## <a name="wpf-add-in-architecture"></a><span data-ttu-id="5fd3d-235">Архитектура надстроек WPF</span><span class="sxs-lookup"><span data-stu-id="5fd3d-235">WPF Add-In Architecture</span></span>  
 <span data-ttu-id="5fd3d-236">На самом высоком уровне, как мы уже видели, WPF включает надстроек .NET Framework для реализации пользовательских интерфейсов (который непосредственно или косвенно наследующие от <xref:System.Windows.FrameworkElement>) с помощью <xref:System.AddIn.Contract.INativeHandleContract>, <xref:System.AddIn.Pipeline.FrameworkElementAdapters.ViewToContractAdapter%2A> и <xref:System.AddIn.Pipeline.FrameworkElementAdapters.ContractToViewAdapter%2A>.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-236">At the highest level, as we've seen, WPF enables .NET Framework add-ins to implement user interfaces (that derive directly or indirectly from <xref:System.Windows.FrameworkElement>) using <xref:System.AddIn.Contract.INativeHandleContract>, <xref:System.AddIn.Pipeline.FrameworkElementAdapters.ViewToContractAdapter%2A> and <xref:System.AddIn.Pipeline.FrameworkElementAdapters.ContractToViewAdapter%2A>.</span></span> <span data-ttu-id="5fd3d-237">Результатом является то, что ведущее приложение возвращается <xref:System.Windows.FrameworkElement> , отображаемыми в пользовательском Интерфейсе в ведущем приложении.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-237">The result is that the host application is returned a <xref:System.Windows.FrameworkElement> that is displayed from UI in the host application.</span></span>  
  
 <span data-ttu-id="5fd3d-238">Для простых сценариев пользовательского интерфейса надстройки это максимально подробно, достаточно для разработчиков.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-238">For simple UI add-in scenarios, this is as much detail as a developer needs.</span></span> <span data-ttu-id="5fd3d-239">Для более сложных сценариев, особенно тех, которые пытаются использовать дополнительных служб WPF, таких как макет, ресурсы и привязки данных, необходимо понять ее преимущества более подробная информация о том, как WPF расширяет модель надстроек платформы .NET Framework с поддержкой пользовательского интерфейса и ограничения.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-239">For more complex scenarios, particularly those that try to utilize additional WPF services such as layout, resources, and data binding, more detailed knowledge of how WPF extends the .NET Framework add-in model with UI support is required to understand its benefits and limitations.</span></span>  
  
 <span data-ttu-id="5fd3d-240">По существу WPF не передавать пользовательского интерфейса из надстройки в ведущее приложение. Вместо этого WPF передает дескриптор окна Win32 для пользовательского интерфейса с помощью взаимодействие с WPF.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-240">Fundamentally, WPF doesn't pass a UI from an add-in to a host application; instead, WPF passes the Win32 window handle for the UI by using WPF interoperability.</span></span> <span data-ttu-id="5fd3d-241">Таким образом когда пользовательский Интерфейс из надстройки передается в ведущее приложение, происходит следующее:</span><span class="sxs-lookup"><span data-stu-id="5fd3d-241">As such, when a UI from an add-in is passed to a host application, the following occurs:</span></span>  
  
-   <span data-ttu-id="5fd3d-242">На стороне надстройки WPF Получает дескриптор окна для пользовательского интерфейса, который будет отображаться ведущим приложением.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-242">On the add-in side, WPF acquires a window handle for the UI that will be displayed by the host application.</span></span> <span data-ttu-id="5fd3d-243">Дескриптор окна инкапсулируется внутренний класс WPF, который является производным от <xref:System.Windows.Interop.HwndSource> и реализует <xref:System.AddIn.Contract.INativeHandleContract>.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-243">The window handle is encapsulated by an internal WPF class that derives from <xref:System.Windows.Interop.HwndSource> and implements <xref:System.AddIn.Contract.INativeHandleContract>.</span></span> <span data-ttu-id="5fd3d-244">Экземпляр этого класса возвращается с <xref:System.AddIn.Pipeline.FrameworkElementAdapters.ViewToContractAdapter%2A> и упаковывается из домена приложения надстройки в домен приложения ведущего приложения.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-244">An instance of this class is returned by <xref:System.AddIn.Pipeline.FrameworkElementAdapters.ViewToContractAdapter%2A> and is marshaled from the add-in's application domain to the host application's application domain.</span></span>  
  
-   <span data-ttu-id="5fd3d-245">На стороне ведущего приложения WPF переупаковывает <xref:System.Windows.Interop.HwndSource> как внутренний класс WPF, который является производным от <xref:System.Windows.Interop.HwndHost> и использует <xref:System.AddIn.Contract.INativeHandleContract>.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-245">On the host application side, WPF repackages the <xref:System.Windows.Interop.HwndSource> as an internal WPF class that derives from <xref:System.Windows.Interop.HwndHost> and consumes <xref:System.AddIn.Contract.INativeHandleContract>.</span></span> <span data-ttu-id="5fd3d-246">Экземпляр этого класса возвращается с <xref:System.AddIn.Pipeline.FrameworkElementAdapters.ContractToViewAdapter%2A> ведущему приложению.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-246">An instance of this class is returned by <xref:System.AddIn.Pipeline.FrameworkElementAdapters.ContractToViewAdapter%2A> to the host application.</span></span>  
  
 <span data-ttu-id="5fd3d-247"><xref:System.Windows.Interop.HwndHost> существует для отображения пользовательских интерфейсов, определенных с помощью дескрипторов окон, пользовательских интерфейсах WPF.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-247"><xref:System.Windows.Interop.HwndHost> exists to display user interfaces, identified by window handles, from WPF user interfaces.</span></span> <span data-ttu-id="5fd3d-248">Более подробную информацию см. в разделе [Взаимодействие WPF и Win32](../advanced/wpf-and-win32-interoperation.md).</span><span class="sxs-lookup"><span data-stu-id="5fd3d-248">For more information, see [WPF and Win32 Interoperation](../advanced/wpf-and-win32-interoperation.md).</span></span>  
  
 <span data-ttu-id="5fd3d-249">Таким образом <xref:System.AddIn.Contract.INativeHandleContract>, <xref:System.AddIn.Pipeline.FrameworkElementAdapters.ViewToContractAdapter%2A>, и <xref:System.AddIn.Pipeline.FrameworkElementAdapters.ContractToViewAdapter%2A> позволяют использовать дескриптор окна для пользовательского интерфейса, WPF, передается из надстройки в ведущее приложение, где он инкапсулируется <xref:System.Windows.Interop.HwndHost> и отображения пользовательского интерфейса ведущего приложения.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-249">In summary, <xref:System.AddIn.Contract.INativeHandleContract>, <xref:System.AddIn.Pipeline.FrameworkElementAdapters.ViewToContractAdapter%2A>, and <xref:System.AddIn.Pipeline.FrameworkElementAdapters.ContractToViewAdapter%2A> exist to allow the window handle for a WPF UI to be passed from an add-in to a host application, where it is encapsulated by a <xref:System.Windows.Interop.HwndHost> and displayed the host application's UI.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="5fd3d-250">Поскольку ведущее приложение получает <xref:System.Windows.Interop.HwndHost>, ведущее приложение не может преобразовать объект, который возвращается методом <xref:System.AddIn.Pipeline.FrameworkElementAdapters.ContractToViewAdapter%2A> к типу она реализуется как надстройки (например, <xref:System.Windows.Controls.UserControl>).</span><span class="sxs-lookup"><span data-stu-id="5fd3d-250">Because the host application gets an <xref:System.Windows.Interop.HwndHost>, the host application cannot convert the object that is returned by <xref:System.AddIn.Pipeline.FrameworkElementAdapters.ContractToViewAdapter%2A> to the type it is implemented as by the add-in (for example, a <xref:System.Windows.Controls.UserControl>).</span></span>  
  
 <span data-ttu-id="5fd3d-251">По своей природе <xref:System.Windows.Interop.HwndHost> имеет определенные ограничения, которые влияют на то, как ведущие приложения могут их использовать.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-251">By its nature, <xref:System.Windows.Interop.HwndHost> has certain limitations that affect how host applications can use them.</span></span> <span data-ttu-id="5fd3d-252">Тем не менее, расширяет WPF <xref:System.Windows.Interop.HwndHost> несколькими возможностями для сценариев надстройки.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-252">However, WPF extends <xref:System.Windows.Interop.HwndHost> with several capabilities for add-in scenarios.</span></span> <span data-ttu-id="5fd3d-253">Эти преимущества и ограничения описаны ниже.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-253">These benefits and limitations are described below.</span></span>  
  
<a name="WPFAddInModelBenefits"></a>   
## <a name="wpf-add-in-benefits"></a><span data-ttu-id="5fd3d-254">Преимущества надстройки WPF</span><span class="sxs-lookup"><span data-stu-id="5fd3d-254">WPF Add-In Benefits</span></span>  
 <span data-ttu-id="5fd3d-255">Поскольку надстройка пользователя интерфейсов WPF отображаются из ведущих приложений, используя внутренний класс, производный от <xref:System.Windows.Interop.HwndHost>, эти пользовательские интерфейсы, ограничены возможности <xref:System.Windows.Interop.HwndHost> с точки зрения службы пользовательского интерфейса WPF, такие как макет, отрисовки, привязка данных, стили, шаблоны и ресурсы.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-255">Because WPF add-in user interfaces are displayed from host applications using an internal class that derives from <xref:System.Windows.Interop.HwndHost>, those user interfaces are constrained by the capabilities of <xref:System.Windows.Interop.HwndHost> with respect to WPF UI services such as layout, rendering, data binding, styles, templates, and resources.</span></span> <span data-ttu-id="5fd3d-256">Тем не менее, дополняет свой внутренний WPF <xref:System.Windows.Interop.HwndHost> подкласс дополнительными возможностями, которые включают следующее:</span><span class="sxs-lookup"><span data-stu-id="5fd3d-256">However, WPF augments its internal <xref:System.Windows.Interop.HwndHost> subclass with additional capabilities that include the following:</span></span>  
  
-   <span data-ttu-id="5fd3d-257">Переход между пользовательского интерфейса ведущего приложения и надстройки пользовательского интерфейса.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-257">Tabbing between a host application's UI and an add-in's UI.</span></span> <span data-ttu-id="5fd3d-258">Обратите внимание, что модель программирования «надстройка является пользовательским Интерфейсом» add-адаптер надстройки для переопределения <xref:System.AddIn.Pipeline.ContractBase.QueryContract%2A> для поддержки переходов по табуляции надстройки полным доверием или с частичным доверием.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-258">Note that the "add-in is a UI" programming model requires the add-in-side adapter to override <xref:System.AddIn.Pipeline.ContractBase.QueryContract%2A> to enable tabbing, whether the add-in is fully trusted or partially trusted.</span></span>  
  
-   <span data-ttu-id="5fd3d-259">Учитывая требований по специальным возможностям для надстройки пользовательские интерфейсы, которые выводятся из пользовательских интерфейсов приложений узла.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-259">Honoring accessibility requirements for add-in user interfaces that are displayed from host application user interfaces.</span></span>  
  
-   <span data-ttu-id="5fd3d-260">Включение приложений WPF для безопасной работы в нескольких сценариях домена приложений.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-260">Enabling WPF applications to run safely in multiple application domain scenarios.</span></span>  
  
-   <span data-ttu-id="5fd3d-261">Предотвращение незаконного доступа к интерфейс пользователя надстройки окно обрабатывает при запуске надстройки в режиме изоляции безопасности (то есть изолированной среде безопасности частичного доверия).</span><span class="sxs-lookup"><span data-stu-id="5fd3d-261">Preventing illegal access to add-in UI window handles when add-ins run with security isolation (that is, a partial-trust security sandbox).</span></span> <span data-ttu-id="5fd3d-262">Вызов <xref:System.AddIn.Pipeline.FrameworkElementAdapters.ViewToContractAdapter%2A> гарантирует эту безопасность:</span><span class="sxs-lookup"><span data-stu-id="5fd3d-262">Calling <xref:System.AddIn.Pipeline.FrameworkElementAdapters.ViewToContractAdapter%2A> ensures this security:</span></span>  
  
    -   <span data-ttu-id="5fd3d-263">Для «Надстройка возвращает пользовательский Интерфейс» модель программирования, единственным способом передачи дескриптора окна для пользовательского интерфейса надстройки через границы изоляции является вызов <xref:System.AddIn.Pipeline.FrameworkElementAdapters.ViewToContractAdapter%2A>.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-263">For the "add-in returns a UI" programming model, the only way to pass the window handle for an add-in UI across the isolation boundary is to call <xref:System.AddIn.Pipeline.FrameworkElementAdapters.ViewToContractAdapter%2A>.</span></span>  
  
    -   <span data-ttu-id="5fd3d-264">Для «надстройка является пользовательским Интерфейсом» модель программирования Переопределяя <xref:System.AddIn.Pipeline.ContractBase.QueryContract%2A> на адаптер на стороне надстройки и вызов <xref:System.AddIn.Pipeline.FrameworkElementAdapters.ViewToContractAdapter%2A> (как показано в предыдущих примерах) является обязательным, так как вызывается адаптер на стороне надстройки `QueryContract` реализации от адаптер на стороне узла.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-264">For the "add-in is a UI" programming model, overriding <xref:System.AddIn.Pipeline.ContractBase.QueryContract%2A> on the add-in-side adapter and calling <xref:System.AddIn.Pipeline.FrameworkElementAdapters.ViewToContractAdapter%2A> (as shown in the preceding examples) is required, as is calling the add-in-side adapter's `QueryContract` implementation from the host-side adapter.</span></span>  
  
-   <span data-ttu-id="5fd3d-265">Предоставление защиты выполнения нескольких доменов приложений.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-265">Providing multiple application domain execution protection.</span></span> <span data-ttu-id="5fd3d-266">Из-за ограничений, связанных с доменами приложений, необработанные исключения, которые появляются в доменах приложений надстроек, вызывают сбой всего приложения, несмотря на наличие границы изоляции.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-266">Due to limitations with application domains, unhandled exceptions that are thrown in add-in application domains cause the entire application to crash, even though the isolation boundary exists.</span></span> <span data-ttu-id="5fd3d-267">Тем не менее WPF и модель надстроек платформы .NET Framework предоставляют простой способ решения этой проблемы и повышают стабильность работы приложения.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-267">However, WPF and the .NET Framework add-in model provide a simple way to work around this problem and improve application stability.</span></span> <span data-ttu-id="5fd3d-268">Надстройки WPF, который отображает пользовательский Интерфейс создает <xref:System.Windows.Threading.Dispatcher> для потока, который выполняется домен приложения, если ведущее приложение является приложением WPF.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-268">A WPF add-in that displays a UI creates a <xref:System.Windows.Threading.Dispatcher> for the thread that the application domain runs on, if the host application is a WPF application.</span></span> <span data-ttu-id="5fd3d-269">Можно обнаружить все необработанные исключения, возникающие в домене приложения, обрабатывая <xref:System.Windows.Threading.Dispatcher.UnhandledException> события WPF надстройки <xref:System.Windows.Threading.Dispatcher>.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-269">You can detect all unhandled exceptions that occur in the application domain by handling the <xref:System.Windows.Threading.Dispatcher.UnhandledException> event of the WPF add-in's <xref:System.Windows.Threading.Dispatcher>.</span></span> <span data-ttu-id="5fd3d-270">Вы можете получить <xref:System.Windows.Threading.Dispatcher> из <xref:System.Windows.Threading.Dispatcher.CurrentDispatcher%2A> свойство.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-270">You can get the <xref:System.Windows.Threading.Dispatcher> from the <xref:System.Windows.Threading.Dispatcher.CurrentDispatcher%2A> property.</span></span>  
  
<a name="WPFAddInModelLimitations"></a>   
## <a name="wpf-add-in-limitations"></a><span data-ttu-id="5fd3d-271">Ограничения надстройки WPF</span><span class="sxs-lookup"><span data-stu-id="5fd3d-271">WPF Add-In Limitations</span></span>  
 <span data-ttu-id="5fd3d-272">Помимо преимуществ, WPF добавляет к поведениям по умолчанию, предоставляемые <xref:System.Windows.Interop.HwndSource>, <xref:System.Windows.Interop.HwndHost>и дескрипторами окон, существуют также ограничения для надстройки пользовательские интерфейсы, которые отображаются из ведущих приложений:</span><span class="sxs-lookup"><span data-stu-id="5fd3d-272">Beyond the benefits that WPF adds to the default behaviors supplied by <xref:System.Windows.Interop.HwndSource>, <xref:System.Windows.Interop.HwndHost>, and window handles, there are also limitations for add-in user interfaces that are displayed from host applications:</span></span>  
  
-   <span data-ttu-id="5fd3d-273">Добавьте в пользовательские интерфейсы, отображаемых из ведущего приложения не влияют на поведение при обрезке ведущего приложения.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-273">Add-in user interfaces displayed from a host application do not respect the host application's clipping behavior.</span></span>  
  
-   <span data-ttu-id="5fd3d-274">Концепция *свободного пространства* в сценариях взаимодействия также применяется к надстройкам (см. [Общие сведения о технологических областях](../advanced/technology-regions-overview.md)).</span><span class="sxs-lookup"><span data-stu-id="5fd3d-274">The concept of *airspace* in interoperability scenarios also applies to add-ins (see [Technology Regions Overview](../advanced/technology-regions-overview.md)).</span></span>  
  
-   <span data-ttu-id="5fd3d-275">Пользовательского интерфейса ведущего приложения служб, таких как наследование ресурса, привязка данных и команды, недоступны автоматически для пользовательских интерфейсов.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-275">A host application's UI services, such as resource inheritance, data binding, and commanding, are not automatically available to add-in user interfaces.</span></span> <span data-ttu-id="5fd3d-276">Чтобы предоставить эти службы для надстройки, необходимо обновить конвейер.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-276">To provide these services to the add-in, you need to update the pipeline.</span></span>  
  
-   <span data-ttu-id="5fd3d-277">Пользовательского интерфейса надстройки нельзя (повернутый), масштабировать, наклонять или в противном случае преобразование влияет (см. в разделе [Общие сведения о преобразованиях](../graphics-multimedia/transforms-overview.md)).</span><span class="sxs-lookup"><span data-stu-id="5fd3d-277">An add-in UI cannot be rotated, scaled, skewed, or otherwise affected by a transformation (see [Transforms Overview](../graphics-multimedia/transforms-overview.md)).</span></span>  
  
-   <span data-ttu-id="5fd3d-278">Содержимое внутри надстройки пользовательские интерфейсы, которые визуализируется посредством операций из рисования <xref:System.Drawing> пространство имен может включать альфа-смешение.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-278">Content inside add-in user interfaces that is rendered by drawing operations from the <xref:System.Drawing> namespace can include alpha blending.</span></span> <span data-ttu-id="5fd3d-279">Тем не менее пользовательского интерфейса надстройки и ведущего приложения пользовательского интерфейса, содержащего его должны быть 100% непрозрачный; Другими словами `Opacity` свойства должно быть установлено в 1.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-279">However, both an add-in UI and the host application UI that contains it must be 100% opaque; in other words, the `Opacity` property on both must be set to 1.</span></span>  
  
-   <span data-ttu-id="5fd3d-280">Если <xref:System.Windows.Window.AllowsTransparency%2A> окна в ведущем приложении, содержащий пользовательский Интерфейс свойству `true`, надстройка невидим.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-280">If the <xref:System.Windows.Window.AllowsTransparency%2A> property of a window in the host application that contains an add-in UI is set to `true`, the add-in is invisible.</span></span> <span data-ttu-id="5fd3d-281">Это справедливо, даже при 100% непрозрачный надстройке пользовательского интерфейса (то есть `Opacity` свойство имеет значение 1).</span><span class="sxs-lookup"><span data-stu-id="5fd3d-281">This is true even if the add-in UI is 100% opaque (that is, the `Opacity` property has a value of 1).</span></span>  
  
-   <span data-ttu-id="5fd3d-282">Пользовательского интерфейса надстройки должно появляться поверх других элементов WPF, в том же окне верхнего уровня.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-282">An add-in UI must appear on top of other WPF elements in the same top-level window.</span></span>  
  
-   <span data-ttu-id="5fd3d-283">Часть пользовательского интерфейса надстройки может визуализироваться с помощью <xref:System.Windows.Media.VisualBrush>.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-283">No portion of an add-in's UI can be rendered using a <xref:System.Windows.Media.VisualBrush>.</span></span> <span data-ttu-id="5fd3d-284">Вместо этого надстройка может сделать снимок произведенный пользовательский Интерфейс для создания точечного рисунка, который может быть передан в ведущее приложение, используя методы, определенные в контракте.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-284">Instead, the add-in may take a snapshot of the generated UI to create a bitmap that can be passed to the host application using methods defined by the contract.</span></span>  
  
-   <span data-ttu-id="5fd3d-285">Файлы мультимедиа невозможно воспроизвести из <xref:System.Windows.Controls.MediaElement> в пользовательском Интерфейсе.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-285">Media files cannot be played from a <xref:System.Windows.Controls.MediaElement> in an add-in UI.</span></span>  
  
-   <span data-ttu-id="5fd3d-286">События мыши, созданные для пользовательского интерфейса надстройки не получаются и не вызываются ведущим приложением и `IsMouseOver` свойство для ведущего приложения пользовательского интерфейса имеет значение `false`.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-286">Mouse events generated for the add-in UI are neither received nor raised by the host application, and the `IsMouseOver` property for host application UI has a value of `false`.</span></span>  
  
-   <span data-ttu-id="5fd3d-287">Когда фокус перемещается между элементами управления в надстройке пользовательского интерфейса, `GotFocus` и `LostFocus` события не получены, или вызывается ведущим приложением.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-287">When focus shifts between controls in an add-in UI, the `GotFocus` and `LostFocus` events are neither received nor raised by the host application.</span></span>  
  
-   <span data-ttu-id="5fd3d-288">Часть ведущего приложения, содержащий пользовательский Интерфейс выглядит пустой при печати.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-288">The portion of a host application that contains an add-in UI appears white when printed.</span></span>  
  
-   <span data-ttu-id="5fd3d-289">Все диспетчеры (см. в разделе <xref:System.Windows.Threading.Dispatcher>) созданные надстройки пользовательского интерфейса необходимо завершить работу вручную перед надстройка владельца будет выгружена, если ведущее приложение продолжит выполнение.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-289">All dispatchers (see <xref:System.Windows.Threading.Dispatcher>) created by the add-in UI must be shut down manually before the owner add-in is unloaded if the host application continues execution.</span></span> <span data-ttu-id="5fd3d-290">Контракт может реализовывать методы, позволяющие ведущему приложению оповещать надстройку, прежде чем надстройка выгружается, тем самым позволяя надстройки пользовательского интерфейса, чтобы закрыть свои диспетчеры.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-290">The contract can implement methods that allow the host application to signal the add-in before the add-in is unloaded, thereby allowing the add-in UI to shut down its dispatchers.</span></span>  
  
-   <span data-ttu-id="5fd3d-291">Если интерфейс пользователя надстройки <xref:System.Windows.Controls.InkCanvas> или содержит <xref:System.Windows.Controls.InkCanvas>, вы не сможете выгрузить надстройку.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-291">If an add-in UI is an <xref:System.Windows.Controls.InkCanvas> or contains an <xref:System.Windows.Controls.InkCanvas>, you cannot unload the add-in.</span></span>  
  
<a name="PerformanceOptimization"></a>   
## <a name="performance-optimization"></a><span data-ttu-id="5fd3d-292">Оптимизация производительности</span><span class="sxs-lookup"><span data-stu-id="5fd3d-292">Performance Optimization</span></span>  
 <span data-ttu-id="5fd3d-293">По умолчанию при использовании нескольких доменов приложений различные сборки .NET Framework, необходимые для каждого приложения все загружаются в домен приложения.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-293">By default, when multiple application domains are used, the various .NET Framework assemblies required by each application are all loaded into that application's domain.</span></span> <span data-ttu-id="5fd3d-294">В результате время, необходимое для создания новых доменов приложений и запуска приложений в них, может повлиять на производительность.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-294">As a result, the time required for creating new application domains and starting applications in them might affect performance.</span></span> <span data-ttu-id="5fd3d-295">Тем не менее платформа .NET Framework предоставляет способ сократить время запуска, предписывая приложения для совместного использования сборок в доменах приложений, если они уже загружены.</span><span class="sxs-lookup"><span data-stu-id="5fd3d-295">However, the .NET Framework provides a way for you to reduce start times by instructing applications to share assemblies across application domains if they are already loaded.</span></span> <span data-ttu-id="5fd3d-296">Это делается с помощью <xref:System.LoaderOptimizationAttribute> атрибут, который должен применяться к методу точки входа (`Main`).</span><span class="sxs-lookup"><span data-stu-id="5fd3d-296">You do this by using the <xref:System.LoaderOptimizationAttribute> attribute, which must be applied to the entry point method (`Main`).</span></span> <span data-ttu-id="5fd3d-297">В данном случае необходимо использовать только код для реализации определения приложения (см. [Общие сведения об управлении приложением](application-management-overview.md)).</span><span class="sxs-lookup"><span data-stu-id="5fd3d-297">In this case, you must use only code to implement your application definition (see [Application Management Overview](application-management-overview.md)).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="5fd3d-298">См. также</span><span class="sxs-lookup"><span data-stu-id="5fd3d-298">See also</span></span>
- <xref:System.LoaderOptimizationAttribute>
- <span data-ttu-id="5fd3d-299">[Надстройки и расширения среды](/previous-versions/dotnet/netframework-4.0/bb384200(v%3dvs.100))</span><span class="sxs-lookup"><span data-stu-id="5fd3d-299">[Add-ins and Extensibility](/previous-versions/dotnet/netframework-4.0/bb384200(v%3dvs.100))</span></span>
- [<span data-ttu-id="5fd3d-300">Домены приложений</span><span class="sxs-lookup"><span data-stu-id="5fd3d-300">Application Domains</span></span>](../../app-domains/application-domains.md)
- <span data-ttu-id="5fd3d-301">[Обзор удаленного взаимодействия .NET framework](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/kwdt6w2k(v=vs.100))</span><span class="sxs-lookup"><span data-stu-id="5fd3d-301">[.NET Framework Remoting Overview](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/kwdt6w2k(v=vs.100))</span></span>
- <span data-ttu-id="5fd3d-302">[Обеспечение поддержки удаленного взаимодействия объектами](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/wcf3swha(v=vs.100))</span><span class="sxs-lookup"><span data-stu-id="5fd3d-302">[Making Objects Remotable](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/wcf3swha(v=vs.100))</span></span>
- [<span data-ttu-id="5fd3d-303">Разделы практического руководства</span><span class="sxs-lookup"><span data-stu-id="5fd3d-303">How-to Topics</span></span>](how-to-topics.md)
