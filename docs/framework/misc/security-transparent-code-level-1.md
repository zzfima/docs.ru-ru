---
title: Прозрачный код безопасности, уровень 1
ms.date: 03/30/2017
helpviewer_keywords:
- transparent
- SecurityTreatAsSafeAttribute
- SecurityTransparentAttribute
- SecurityCriticalAttribute
- security-transparent code
- security [.NET Framework], security-transparent code
ms.assetid: 5fd8f46d-3961-46a7-84af-2eb1f48e75cf
ms.openlocfilehash: 980c684bced685a61ad82ff5713ccff2b974028f
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/12/2020
ms.locfileid: "79181128"
---
# <a name="security-transparent-code-level-1"></a>Прозрачный код безопасности, уровень 1
[!INCLUDE[net_security_note](../../../includes/net-security-note-md.md)]  
  
 Прозрачность позволяет разработчикам создавать более безопасные библиотеки .NET Framework, предоставляющие частично доверенному коду доступ к функциям. Прозрачность уровня 1 появилась в платформе .NET Framework версии 2.0 и в основном использовалась только корпорацией Майкрософт. Начиная с .NET Framework 4, вы можете использовать [прозрачность уровня 2.](security-transparent-code-level-2.md) При этом прозрачность уровня 1 была сохранена, что позволяет определить устаревший код, который необходимо запускать с прежними правилами безопасности.  
  
> [!IMPORTANT]
> Прозрачность уровня 1 следует указывать только для совместимости, то есть уровень 1 следует задавать только для кода, разработанного на платформе .NET Framework 3.5 или более ранней версии и использующего <xref:System.Security.AllowPartiallyTrustedCallersAttribute> или не использующего модель прозрачности. Например, используйте прозрачность уровня 1 для сборок .NET Framework 2.0, которые допускают вызовы из частично доверенных вызывающих объектов (APTCA). Для кода, разработанного для .NET Framework 4, всегда используйте прозрачность уровня 2.  
  
 Этот раздел состоит из следующих подразделов.  
  
- [Модель прозрачности уровня 1](#the_level_1_transparency_model)  
  
- [Атрибуты прозрачности](#transparency_attributes)  
  
- [Примеры использования прозрачности безопасности](#security_transparency_examples)  
  
<a name="the_level_1_transparency_model"></a>
## <a name="the-level-1-transparency-model"></a>Модель прозрачности уровня 1  
 При использовании прозрачности уровня 1 применяемая модель безопасности разделяет весь код на прозрачные, надежные и критические с точки зрения безопасности методы.  
  
 Пометить как прозрачную с точки зрения безопасности можно всю сборку, некоторые ее классы или некоторые методы класса. Прозрачный с точки зрения безопасности код не может повышать уровень привилегий. Это ограничение имеет три последствия.  
  
- Прозрачный с точки зрения безопасности код не может выполнять действия <xref:System.Security.Permissions.SecurityAction.Assert>.  
  
- Требования связывания, которым должен удовлетворять прозрачный с точки зрения безопасности код, становятся полными требованиями.  
  
- Небезопасный (непроверяемый) код, который должен выполняться в рамках прозрачного с точки зрения безопасности кода, вызывает полное требование для разрешения безопасности <xref:System.Security.Permissions.SecurityPermissionFlag.UnmanagedCode>.  
  
 Применение этих правил во время выполнения обеспечивается средой CLR. Прозрачный с точки зрения безопасности код передает все требования безопасности вызываемого кода вызывающим объектам. Требования, которые обрабатываются прозрачным с точки зрения безопасности кодом, не могут повышать уровень привилегий. Если приложение с низким уровнем доверия обращается к прозрачному с точки зрения безопасности коду и вызывает требование высокой привилегии, это требование будет перенаправлено обратно в код с низким уровнем доверия и не будет удовлетворено. Прозрачный с точки зрения безопасности код не может приостановить действие требования, так как он не может осуществлять действия Assert. При вызове того же прозрачного с точки зрения безопасности кода из кода с полным доверием требование будет удовлетворено.  
  
 Критические с точки зрения безопасности методы являются противоположностью прозрачных с точки зрения безопасности. Критический с точки зрения безопасности код выполняется с полным доверием и может выполнять операции с любым уровнем привилегий. Надежный с точки зрения безопасности код является привилегированным кодом, прошедшим расширенный аудит безопасности, в результате которого было подтверждено, что он не позволяет частично доверенным вызывающим объектам использовать ресурсы, на доступ к которым у них нет разрешения.  
  
 Прозрачность необходимо применять явно. Большая часть кода, отвечающая за обработку данных и логику, обычно может быть помечена как прозрачная с точки зрения безопасности, в то время как меньшая часть, выполняющая повышение привилегий, помечается как критическая или надежная с точки зрения безопасности.  
  
> [!IMPORTANT]
> Прозрачность уровня 1 ограничена областью сборки; она не применяется между сборками. Прозрачность уровня 1 первоначально использовалась в продуктах Майкрософт в целях аудита безопасности. К критическим с точки зрения безопасности типам и членам сборки уровня 1 может получать доступ прозрачный с точки зрения безопасности код из других сборок. Очень важно выполнять запросы компоновки с полным доверием во всех критических с точки зрения безопасности типах и членах уровня 1. Надежные с точки зрения безопасности типы и члены также должны подтверждать, что вызывающие объекты обладают разрешениями в отношении защищенных ресурсов, доступ к которым осуществляется типом или членом.  
  
 Для обеспечения обратной совместимости с предыдущими версиями .NET Framework все члены, не помеченные атрибутами прозрачности, считаются надежными с точки зрения безопасности. Все непомеченные типы считаются прозрачными. Для проверки прозрачности не существует правил статического анализа. Поэтому может потребоваться отладка ошибок времени выполнения, связанных с прозрачностью.  
  
<a name="transparency_attributes"></a>
## <a name="transparency-attributes"></a>Атрибуты прозрачности  
 В таблице ниже описываются три атрибута, используемые для указания прозрачности кода.  
  
|attribute|Описание|  
|---------------|-----------------|  
|<xref:System.Security.SecurityTransparentAttribute>|Применяется только на уровне сборки. Помечает все типы и члены внутри сборки как прозрачные с точки зрения безопасности. При этом сборка не может содержать критический с точки зрения безопасности код.|  
|<xref:System.Security.SecurityCriticalAttribute>|При использовании на уровне сборки без свойства <xref:System.Security.SecurityCriticalAttribute.Scope%2A> помечает весь код внутри сборки как прозрачный с точки зрения безопасности по умолчанию, однако показывает, что сборка может содержать критический с точки зрения безопасности код.<br /><br /> При использовании на уровне класса помечает класс или метод как критический с точки зрения безопасности. Чтобы пометить все члены как критические с точки зрения безопасности, установите для свойства <xref:System.Security.SecurityCriticalAttribute.Scope%2A> значение <xref:System.Security.SecurityCriticalScope.Everything>.<br /><br /> При использовании на уровне члена атрибут применяется только к этому члену.<br /><br /> Класс или метод, помеченный как критический с точки зрения безопасности, может осуществлять повышение привилегий. **Важно:**  В уровне 1 прозрачности, критически важные типы и члены, критически настроенные по безопасности, рассматриваются как безопасные, критически ели, когда они вызваны из-за пределов сборки. Чтобы предотвратить несанкционированное повышение привилегий, нужно защитить критические с точки зрения безопасности типы и члены запросом компоновки с полным доверием.|  
|<xref:System.Security.SecuritySafeCriticalAttribute>|Помечает критический с точки зрения безопасности код, доступ к которому может получить прозрачный с точки зрения безопасности код в сборке. В противном случае прозрачный с точки зрения безопасности код не может получить доступ к закрытым или внутренним членам, критическим с точки зрения безопасности, внутри этой же сборки. Возможность такого доступа могла бы повлиять на работу критического с точки зрения безопасности кода и сделать возможным непредусмотренное повышение привилегий. Надежный с точки зрения безопасности код должен проходить строгий аудит безопасности. **Примечание:**  Типы и участники, обладатели безопасности, должны проверять разрешения абонентов, чтобы определить, имеет ли абонент право на доступ к защищенным ресурсам.|  
  
 Атрибут <xref:System.Security.SecuritySafeCriticalAttribute> позволяет прозрачному с точки зрения безопасности коду получать доступ к критическим с точки зрения безопасности членам внутри этой же сборки. Следует стараться разграничивать прозрачный и критический с точки зрения безопасности код внутри сборки, как если бы он принадлежал двум разным сборкам. Прозрачный с точки зрения безопасности код не сможет получать доступ к закрытым или внутренним членам критического с точки зрения безопасности кода. Кроме того, для критического с точки зрения безопасности кода обычно применяется контролируемый доступ к его открытому интерфейсу. Доступ к закрытому или внутреннему состоянию извне сборки обычно является нежелательным. Как правило, стремятся изолировать это состояние. Атрибут <xref:System.Security.SecuritySafeCriticalAttribute> обеспечивает изоляцию состояния между прозрачным и критическим с точки зрения безопасности кодом, но в то же время дает возможность при необходимости переопределить изоляцию. Прозрачный с точки зрения безопасности код может получить доступ к закрытым или внутренним членам критического с точки зрения безопасности кода, только если эти члены помечены атрибутом <xref:System.Security.SecuritySafeCriticalAttribute>. Перед применением атрибута <xref:System.Security.SecuritySafeCriticalAttribute> проведите аудит соответствующего члена, как если бы он был открытым.  
  
### <a name="assembly-wide-annotation"></a>Заметка на уровне сборки  
 В таблице ниже описываются последствия использования атрибутов безопасности на уровне сборки.  
  
|Атрибут сборки|Состояние сборки|  
|------------------------|--------------------|  
|Частично доверенная сборка без атрибутов|Все типы и члены являются прозрачными.|  
|Полностью доверенная сборка без атрибутов (находящаяся в глобальном кэше сборок или помеченная как полностью доверенная в `AppDomain`)|Все типы являются прозрачными, а все члены — надежными с точки зрения безопасности.|  
|`SecurityTransparent`|Все типы и члены являются прозрачными.|  
|`SecurityCritical(SecurityCriticalScope.Everything)`|Все типы и члены являются прозрачными.|  
|`SecurityCritical`|Весь код по умолчанию является прозрачным. Однако отдельные типы и члены могут иметь другие атрибуты.|  
  
<a name="security_transparency_examples"></a>
## <a name="security-transparency-examples"></a>Примеры использования прозрачности безопасности  
 Чтобы применить правила прозрачности платформы .NET Framework 2.0 (прозрачность уровня 1), используйте в сборке следующую заметку:  
  
```csharp
[assembly: SecurityRules(SecurityRuleSet.Level1)]  
```  
  
 Если нужно сделать прозрачной всю сборку, указав тем самым, что она не содержит критический код и не может повышать уровень привилегий, можно задать прозрачность для сборки явным образом с помощью следующего атрибута:  
  
```csharp  
[assembly: SecurityTransparent]  
```  
  
 Если сборка должна содержать как критический, так и прозрачный код, сначала примените атрибут <xref:System.Security.SecurityCriticalAttribute> ко всей сборке, чтобы указать на возможность включения в нее критического кода. Это можно сделать следующим образом:  
  
```csharp  
[assembly: SecurityCritical]  
```  
  
 Если нужно выполнять критические с точки зрения безопасности операции, следует явно применить еще один атрибут <xref:System.Security.SecurityCriticalAttribute> к коду, выполняющему критическую операцию, как показано в примере ниже.  
  
```csharp  
[assembly: SecurityCritical]  
public class A  
{  
    [SecurityCritical]  
    private void Critical()  
    {  
        // critical  
    }  
  
    public int SomeProperty  
    {  
        get {/* transparent */ }  
        set {/* transparent */ }  
    }  
}  
public class B  
{
    internal string SomeOtherProperty  
    {  
        get { /* transparent */ }  
        set { /* transparent */ }  
    }  
}  
```  
  
 Приведенный выше код является прозрачным за исключением метода `Critical`, который явным образом помечен как критический с точки зрения безопасности. Прозрачность задается по умолчанию даже при установленном на уровне сборки атрибуте <xref:System.Security.SecurityCriticalAttribute>.  
  
## <a name="see-also"></a>См. также раздел

- [Прозрачный с точки зрения безопасности код, уровень 2](security-transparent-code-level-2.md)
- [Изменения безопасности](../security/security-changes.md)
